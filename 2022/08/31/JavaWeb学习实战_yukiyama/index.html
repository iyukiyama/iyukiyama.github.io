<!DOCTYPE html><html lang="zh-CN," data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>JavaWeb学习实战 | yukiyama</title><meta name="author" content="yukiyama,iyukiyama@outlook.com"><meta name="copyright" content="yukiyama"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="JavaWeb学习实战_yukiyama 学习自: 尚硅谷丨2022版JavaWeb教程(全新技术栈,全程实战)， 配套文档。 本文是基于上述视频教程和视频配套文档的文字总结，本文所有代码及其他实验演示素材均存放于 javaweb_in_action 仓库中。 建议先克隆该仓库到本地，一边阅读本文，一边对照每一个工程代码进行学习。  JavaWeb 一般指使用 Java 开发 Web 服务的 技术">
<meta property="og:type" content="article">
<meta property="og:title" content="JavaWeb学习实战">
<meta property="og:url" content="https://iyukiyama.github.io/2022/08/31/JavaWeb%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98_yukiyama/index.html">
<meta property="og:site_name" content="yukiyama">
<meta property="og:description" content="JavaWeb学习实战_yukiyama 学习自: 尚硅谷丨2022版JavaWeb教程(全新技术栈,全程实战)， 配套文档。 本文是基于上述视频教程和视频配套文档的文字总结，本文所有代码及其他实验演示素材均存放于 javaweb_in_action 仓库中。 建议先克隆该仓库到本地，一边阅读本文，一边对照每一个工程代码进行学习。  JavaWeb 一般指使用 Java 开发 Web 服务的 技术">
<meta property="og:locale">
<meta property="article:published_time" content="2022-08-31T13:37:20.150Z">
<meta property="article:modified_time" content="2022-11-11T12:10:05.073Z">
<meta property="article:author" content="yukiyama">
<meta name="twitter:card" content="summary"><link rel="shortcut icon" href="https://raw.githubusercontent.com/iyukiyama/pics/f64481f5339a9a86561027eda41a81aaf1c3a92b/hexo-iyukiyama/site_img/favicon.svg"><link rel="canonical" href="https://iyukiyama.github.io/2022/08/31/JavaWeb%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98_yukiyama/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":500},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'JavaWeb学习实战',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-11 20:10:05'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/hexo-iyukiyama/site_img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">18</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">1</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-chart-simple"></i><span> 算法</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/2022/06/07/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E7%9D%A1/"><span> 二分查找</span></a></li><li><a class="site-page child" href="/2022/06/08/%E5%8D%81%E5%A4%A7%E6%8E%92%E5%BA%8F%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E8%B5%98/"><span> 十大排序</span></a></li><li><a class="site-page child" href="/2022/06/10/%E5%B9%B6%E6%9F%A5%E9%9B%86%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%87%BA%E9%97%A8/"><span> 并查集</span></a></li><li><a class="site-page child" href="/2022/06/15/%E5%9B%BE%E8%AE%BA%E7%AE%97%E6%B3%95%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E4%B8%8B/"><span> 图论算法</span></a></li><li><a class="site-page child" href="/2022/08/01/%E4%BA%8C%E5%8F%89%E6%9F%A5%E6%89%BE%E6%A0%91/"><span> 二叉查找树</span></a></li><li><a class="site-page child" href="/2022/08/17/AVL%E6%A0%91/"><span> AVL树</span></a></li><li><a class="site-page child" href="/2022/08/17/splay%E6%A0%91/"><span> splay树</span></a></li><li><a class="site-page child" href="/2022/07/26/%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E4%B8%8B%E8%BD%A6/"><span> 树状数组</span></a></li><li><a class="site-page child" href="/2022/07/26/%E7%BA%BF%E6%AE%B5%E6%A0%91%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%80%A5%E5%81%9C/"><span> 线段树</span></a></li><li><a class="site-page child" href="/2022/09/14/%E7%BA%A2%E9%BB%91%E6%A0%91%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%9C%8B%E5%BC%80/"><span> 红黑树</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-mug-saucer"></i><span> Java</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/2022/08/31/JavaWeb%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98_yukiyama/"><span> Java Web</span></a></li><li><a class="site-page child" href="/2022/10/07/spring5%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98_yukiyama/"><span> Spring Framework</span></a></li><li><a class="site-page child" href="/2022/10/20/SpringMVC%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98_yukiyama/"><span> SpringMVC</span></a></li><li><a class="site-page child" href="/2022/11/07/SpringBoot%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98_yukiyama/"><span> SpringBoot</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-database"></i><span> Database</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/2022/08/31/MySQL%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98_yukiyama/"><span> MySQL</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/2022/09/01/git%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98_yukiyama/"><i class="fa-fw fas fa-code-branch"></i><span> Git</span></a></div><div class="menus_item"><a class="site-page" href="/2022/08/31/Maven%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98_yukiyama/"><i class="fa-fw fas fa-feather"></i><span> Maven</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">yukiyama</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-chart-simple"></i><span> 算法</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/2022/06/07/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E7%9D%A1/"><span> 二分查找</span></a></li><li><a class="site-page child" href="/2022/06/08/%E5%8D%81%E5%A4%A7%E6%8E%92%E5%BA%8F%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E8%B5%98/"><span> 十大排序</span></a></li><li><a class="site-page child" href="/2022/06/10/%E5%B9%B6%E6%9F%A5%E9%9B%86%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%87%BA%E9%97%A8/"><span> 并查集</span></a></li><li><a class="site-page child" href="/2022/06/15/%E5%9B%BE%E8%AE%BA%E7%AE%97%E6%B3%95%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E4%B8%8B/"><span> 图论算法</span></a></li><li><a class="site-page child" href="/2022/08/01/%E4%BA%8C%E5%8F%89%E6%9F%A5%E6%89%BE%E6%A0%91/"><span> 二叉查找树</span></a></li><li><a class="site-page child" href="/2022/08/17/AVL%E6%A0%91/"><span> AVL树</span></a></li><li><a class="site-page child" href="/2022/08/17/splay%E6%A0%91/"><span> splay树</span></a></li><li><a class="site-page child" href="/2022/07/26/%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E4%B8%8B%E8%BD%A6/"><span> 树状数组</span></a></li><li><a class="site-page child" href="/2022/07/26/%E7%BA%BF%E6%AE%B5%E6%A0%91%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%80%A5%E5%81%9C/"><span> 线段树</span></a></li><li><a class="site-page child" href="/2022/09/14/%E7%BA%A2%E9%BB%91%E6%A0%91%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%9C%8B%E5%BC%80/"><span> 红黑树</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-mug-saucer"></i><span> Java</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/2022/08/31/JavaWeb%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98_yukiyama/"><span> Java Web</span></a></li><li><a class="site-page child" href="/2022/10/07/spring5%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98_yukiyama/"><span> Spring Framework</span></a></li><li><a class="site-page child" href="/2022/10/20/SpringMVC%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98_yukiyama/"><span> SpringMVC</span></a></li><li><a class="site-page child" href="/2022/11/07/SpringBoot%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98_yukiyama/"><span> SpringBoot</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-database"></i><span> Database</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/2022/08/31/MySQL%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98_yukiyama/"><span> MySQL</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/2022/09/01/git%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98_yukiyama/"><i class="fa-fw fas fa-code-branch"></i><span> Git</span></a></div><div class="menus_item"><a class="site-page" href="/2022/08/31/Maven%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98_yukiyama/"><i class="fa-fw fas fa-feather"></i><span> Maven</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">JavaWeb学习实战</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-08-31T13:37:20.150Z" title="Created 2022-08-31 21:37:20">2022-08-31</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-11-11T12:10:05.073Z" title="Updated 2022-11-11 20:10:05">2022-11-11</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="JavaWeb学习实战"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="JavaWeb学习实战-yukiyama"><a href="#JavaWeb学习实战-yukiyama" class="headerlink" title="JavaWeb学习实战_yukiyama"></a>JavaWeb学习实战_yukiyama</h1><blockquote>
<p>学习自: <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1AS4y177xJ/?spm_id_from=333.999.0.0&vd_source=c56ec421dded765a52ade50885eaab60">尚硅谷丨2022版JavaWeb教程(全新技术栈,全程实战)</a>， <a target="_blank" rel="noopener" href="https://heavy_code_industry.gitee.io/code_heavy_industry/pro001-javaweb/lecture/">配套文档</a>。</p>
<p>本文是基于上述视频教程和视频配套文档的文字总结，本文所有代码及其他实验演示素材均存放于 <a target="_blank" rel="noopener" href="https://github.com/iyukiyama/javaweb_in_action">javaweb_in_action</a> 仓库中。</p>
<p>建议先克隆该仓库到本地，一边阅读本文，一边对照每一个工程代码进行学习。</p>
</blockquote>
<p>JavaWeb 一般指使用 Java 开发 Web 服务的 <strong>技术栈</strong>。</p>
<p>所谓「Web 服务」即泛指客户端以 HTTP&#x2F;HTTPS 协议与服务端通信以获得服务端提供的服务。服务的形式是多样的，例如搜索信息服务 (百度)、资料存储服务 (网盘)、网购服务 (淘宝) 、影音娱乐资源 (音乐视频网站) 等等。无论具体的服务形式为何，交互的方式都是类似的，即通常由浏览器 (客户端) 发起请求，由服务提供商的服务器 (服务端) 处理请求，或返回相应的数据、资源，或处理计算，或存储数据等等，这种交互形式通常称为 Browser&#x2F;Server (BS) 架构。</p>
<p>当采用 Java 来实现 Web 服务时，所涉及的技术即可统称为 JavaWeb 技术，包括但不限于 <strong>Web 服务器 (如 Tomcat)</strong> 、<strong>Servlet</strong> 、<strong>JSP</strong> 、<strong>HTTP协议</strong> 、<strong>框架 (如 SpringMVC)</strong> 等等。</p>
<p>以在浏览器上输入 <code>http://www.baidu.com</code> 访问百度为例，概述最简单的 Web 服务场景：</p>
<blockquote>
<p>从客户端浏览器发出的请求，通过 URL ，找到提供百度首页的服务器 (略过包封装、ARP、路由、DNS等底层过程)。该服务器针对请求，返回百度首页资源 (页面) 给浏览器，浏览器解析后呈现首页搜索框等元素。</p>
</blockquote>
<p>本文后续内容，我们将以 Servlet 技术为重点，讲解 JavaWeb 相关技术，展示包括客户端浏览器发起请求，服务器响应请求，服务器与数据库交互等过程及其代码实现。</p>
<br />

<h2 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h2><p><a target="_blank" rel="noopener" href="https://tomcat.apache.org/">Tomcat</a> 是 Apache 开源基金会维护的项目，该项目提供支持 jsp 和 Servlet 的轻量级的 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Web_server">Web 服务器</a> (即 Tomcat Server)。Tomcat Server 是当前最流行的 Web 服务器之一。</p>
<br />

<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>通过 <a target="_blank" rel="noopener" href="https://tomcat.apache.org/">tomcat官网</a> 首页左侧导航栏找到需要的 Tomcat 版本，下载解压即可。如下一般选择 zip 或 tar.gz 下载到本地解压即完成安装 (绿色安装)。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/javaweb_in_action/tomcat-download.png" alt="tomcat-download"></p>
<p>解压后根目录 (如 <code>apache-tomcat-8.5.82</code>) 下的主要子目录及其存放内容如下。</p>
<table>
<thead>
<tr>
<th>子目录</th>
<th>存放内容</th>
</tr>
</thead>
<tbody><tr>
<td>bin</td>
<td>存放 Tomcat 的可执行程序</td>
</tr>
<tr>
<td>conf</td>
<td>存放 Tomcat 的配置文件</td>
</tr>
<tr>
<td>lib</td>
<td>存放 Tomcat 用到的 jar 包</td>
</tr>
<tr>
<td>logs</td>
<td>存放 Tomcat 运行时的日志</td>
</tr>
<tr>
<td>temp</td>
<td>存放 Tomcat 运行时产生的临时数据</td>
</tr>
<tr>
<td>webapps</td>
<td>存放部署到 Tomcat 的 Web 工程</td>
</tr>
<tr>
<td>work</td>
<td>Tomcat 工作时的目录</td>
</tr>
</tbody></table>
<p>bin 目录下的 <code>startup.sh</code> 和 <code>shutdown.sh</code> 分别为 (MacOS 和 Linux) 启动和关闭 Tomcat 的脚本 (若为 Windows 系统，则为 <code>startup.bat</code> 和 <code>shutdown.bat</code> ) 。执行相应的文件即可启动或关闭 Tomcat 服务器。例如 MacOS 上在启动脚本目录下执行 <code>./startup.sh</code> 启动 Tomcat 服务器如下。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama bin % pwd</span><br><span class="line">/Users/yukiyama/apache-tomcat-8.5.82/bin</span><br><span class="line">yukiyama@yukiyama bin % ./startup.sh</span><br><span class="line">Using CATALINA_BASE:   /Users/yukiyama/apache-tomcat-8.5.82</span><br><span class="line">Using CATALINA_HOME:   /Users/yukiyama/apache-tomcat-8.5.82</span><br><span class="line">Using CATALINA_TMPDIR: /Users/yukiyama/apache-tomcat-8.5.82/temp</span><br><span class="line">Using JRE_HOME:        /Library/Java/JavaVirtualMachines/jdk-16.0.1.jdk/Contents/Home</span><br><span class="line">Using CLASSPATH:       /Users/yukiyama/apache-tomcat-8.5.82/bin/bootstrap.jar:/Users/yukiyama/apache-tomcat-8.5.82/bin/tomcat-juli.jar</span><br><span class="line">Using CATALINA_OPTS:</span><br><span class="line">Tomcat started.</span><br><span class="line">yukiyama@yukiyama bin %</span><br></pre></td></tr></table></figure>

<p>出现 <code>Tomcat started</code> 表示启动成功，此时访问 <code>http://localhost:8080/</code> ，可打开如下页面。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/javaweb_in_action/startup-webpage.png" alt="startup-webpage"></p>
<p>执行 <code>./shutdown.sh</code> 可停止 Tomcat 服务器。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama bin % ./shutdown.sh</span><br><span class="line">Using CATALINA_BASE:   /Users/yukiyama/apache-tomcat-8.5.82</span><br><span class="line">Using CATALINA_HOME:   /Users/yukiyama/apache-tomcat-8.5.82</span><br><span class="line">Using CATALINA_TMPDIR: /Users/yukiyama/apache-tomcat-8.5.82/temp</span><br><span class="line">Using JRE_HOME:        /Library/Java/JavaVirtualMachines/jdk-16.0.1.jdk/Contents/Home</span><br><span class="line">Using CLASSPATH:       /Users/yukiyama/apache-tomcat-8.5.82/bin/bootstrap.jar:/Users/yukiyama/apache-tomcat-8.5.82/bin/tomcat-juli.jar</span><br><span class="line">Using CATALINA_OPTS:</span><br><span class="line">NOTE: Picked up JDK_JAVA_OPTIONS:  --add-opens=java.base/java.lang=ALL-UNNAMED --add-opens=java.base/java.io=ALL-UNNAMED --add-opens=java.base/java.util=ALL-UNNAMED --add-opens=java.base/java.util.concurrent=ALL-UNNAMED --add-opens=java.rmi/sun.rmi.transport=ALL-UNNAMED</span><br><span class="line">yukiyama@yukiyama bin %</span><br></pre></td></tr></table></figure>



<p>由于 Tomcat 需要 JRE 环境的支持，因此 Tomcat 能够正常运行的前提是已经安装了 JDK (或 JRE) ，并配置好了 <code>JAVA_HOME</code> 环境变量。</p>
<br />

<h3 id="部署应用"><a href="#部署应用" class="headerlink" title="部署应用"></a>部署应用</h3><h4 id="手动"><a href="#手动" class="headerlink" title="手动"></a>手动</h4><p>将创建好的应用项目 (application) 文件夹放置在 Tomcat 安装目录 (解压缩目录) 下的 <code>webapps</code> 子目录中。例如 web 应用项目 <code>demo</code> 如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">demo</span><br><span class="line">├── css</span><br><span class="line">│   └── demo05.css</span><br><span class="line">├── demo09.html</span><br><span class="line">├── imgs</span><br><span class="line">│   └── del.jpg</span><br><span class="line">└── js</span><br><span class="line">    └── demo09.js</span><br></pre></td></tr></table></figure>

<p>将 <code>demo</code> 放置到 <code>~/apache-tomcat-8.5.82/webapps</code> 中，此时的 <code>demo</code> 为一个 context root，接着在 <code>demo</code> 下新建一个 <code>WEB-INF</code> 目录，如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">webapps</span><br><span class="line">├── demo</span><br><span class="line">    ├── WEB-INF</span><br><span class="line">    ├── css</span><br><span class="line">    │   └── demo05.css</span><br><span class="line">    ├── demo09.html</span><br><span class="line">    ├── imgs</span><br><span class="line">    │   └── del.jpg</span><br><span class="line">    └── js</span><br><span class="line">        └── demo09.js</span><br></pre></td></tr></table></figure>

<p>Tomcat 服务运行状态下，在浏览器中输入 <code>http://localhost:8080/demo/demo09.html</code> ，Tomcat 会在 <code>webapps</code> 目录下寻找相应的 context root <code>demo</code>，然后找到 <code>demo09.html</code> ， 即可以 http 方式访问该页面。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/javaweb_in_action/demo09.png"></p>
<p>这个简单的例子反映了「Web Server」的核心，即 <strong>基于 HTTP 协议对外提供资源</strong> 。主要过程如下。</p>
<ul>
<li>浏览器 URL 中的 <code>http</code> 明确了客户端与 Web 服务器交互的协议。</li>
<li><code>localhost</code> 即本机 IP (因为 Tomcat 此时运行在本机上)。如果运行在其他主机上，则需为该主机 IP 地址。</li>
<li><code>8080</code> 是 Tomcat 服务端口，浏览器的请求报文到达 Tomcat 所在主机后 (本机) ，根据该端口找到具体的 Tomcat 程序。</li>
<li>Tomcat 程序继续根据 URL 中的 <code>demo</code> 在 <code>webapp</code> 目录下找到对应的 <code>demo</code> 目录，然后进一步找到 <code>demo09.html</code> ，最终将此「资源」发回到客户端浏览器，由浏览器解析呈现出上述页面。</li>
</ul>
<br />

<h4 id="自动"><a href="#自动" class="headerlink" title="自动"></a>自动</h4><p>使用 idea 自动部署。</p>
<p>首先在 idea 中创建 <code>javaweb_in_action</code> 父工程 (archetype: quickstart) ，然后再创建名为 <code>pro07-javaweb-begin</code> 的 web 子工程 (archetype: webapp)。在该子工程的 <code>webapp</code> 目录下创建名为 <code>hello01.html</code> 的 html 文件。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello World!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们将以 <code>pro07-javaweb-begin</code> 项目演示部署和运行过程。首先在项目界面右上侧选择 「Edit Configurations…」，在弹出的页面中完成部署。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/javaweb_in_action/edit-configurations.png" alt="edit-configurations"></p>
<p>在弹出页面的左上侧点击「+」，选择「Tomcat Server &gt; Local」。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/javaweb_in_action/tomcat-server-local.png" alt="tomcat-server-local"></p>
<p>选择本地 Tomcat Server，即 「Name: Tomcat 8.5.82」 。接着先在「Deployment」页签下添加 <code>pro07-javaweb-begin</code> ，可以将 「Application context」改为较简短的「&#x2F;pro07」(此处即为用于与浏览器 URL 端口号后的字符串对应的 context root) 。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/javaweb_in_action/tomcat-deployment.png" alt="tomcat-deployment"></p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/javaweb_in_action/tomcat-deployment1.png" alt="tomcat-deployment1"></p>
<p>接着在「Server」页签中完成如下设置。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/javaweb_in_action/tomcat-server-tab.png" alt="tomcat-server-tab"></p>
<p>上述主要设置的详细说明 (<a target="_blank" rel="noopener" href="https://www.jetbrains.com/help/idea/updating-applications-on-application-servers.html">参考1</a>, <a target="_blank" rel="noopener" href="http://t.zoukankan.com/labimeilexin-p-13404213.html">参考2</a>) 。</p>
<table>
<thead>
<tr>
<th>设置</th>
<th>描述</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>Open browser</td>
<td>After launch</td>
<td>勾选 After launch ，选择一个浏览器，表示在启动 Tomcat 运行指定的 web 项目后，自动唤起指定浏览器</td>
</tr>
<tr>
<td></td>
<td>URL</td>
<td>唤起浏览器时指定打开的 URL</td>
</tr>
<tr>
<td>On ‘Update’ action</td>
<td></td>
<td>若项目代码有更新，采取何种动作</td>
</tr>
<tr>
<td></td>
<td>Update Resources</td>
<td>若更新的是资源文件 (.jsp，.xml等，不包括 java 文件) ，则这些更新立即生效</td>
</tr>
<tr>
<td></td>
<td>Update classes and resources</td>
<td>包括资源文件和 java 文件在内，若有更新，则立即生效</td>
</tr>
<tr>
<td></td>
<td>Redeploy</td>
<td>重新部署应用</td>
</tr>
<tr>
<td></td>
<td>Restart Server</td>
<td>重启 Tomcat 服务器</td>
</tr>
<tr>
<td>On frame deactivation</td>
<td></td>
<td>失去焦点时 (例如最小化 IDEA 窗口），采取何种动作</td>
</tr>
<tr>
<td></td>
<td>Do nothing</td>
<td>无动作</td>
</tr>
<tr>
<td></td>
<td>Update resources</td>
<td>资源文件 (.jsp，.xml等，不包括 java 文件) 的更新立即生效</td>
</tr>
<tr>
<td></td>
<td>Update classes and resources</td>
<td>包括资源文件和 java 文件在内的更新立即生效</td>
</tr>
</tbody></table>
<p>接着运行 (或 debug) 。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/javaweb_in_action/tomcat-run-debug.png" alt="tomcat-run-debug"></p>
<p>正常情况下，默认浏览器会弹出「hello01.html」页面，如下表示部署成功。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/javaweb_in_action/web-project-open-webpage.png" alt="web-project-open-webpage"></p>
<br />

<h2 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h2><p>现在我们已经知道如何部署一个最简单的 web 项目，并看到 Tomcat 作为 Web 服务器，在浏览器发起请求后能够处理请求并发回对应的资源。实际上 <strong>真正处理请求的是 Servlet</strong> 。</p>
<p>Servlet (<strong>Serv</strong>er App<strong>let</strong>): Server 与 Applet 的合成词，即「服务器小程序」。Server 即 Web Server，也即我们使用的 Tomcat Server，所谓「小程序」，本质上是  <strong>Servlet 接口实现类的对象实例</strong> 。当 Tomcat 接收到浏览器请求时，会根据请求信息创建预先对应了此请求的 Servlet 实现类实例。详细过程后述。</p>
<p>相比此前介绍的简单的请求，对于一般的 web 项目，Tomcat 需要响应的资源远不止静态页面，它还会与数据库交互，使得我们可以在浏览器页面的操作 (请求)，经由不同的 Servlet，向数据库中写入数据或获取数据库信息发回到浏览器页面等，因此 Servlet 通常会由开发人员针对具体请求编写。</p>
<p>在前面的例子中我们并没有编写具体的 Servlet 类，这是因为当 Tomcat 找不到与请求相对应的 Servlet 时，会使用一个名为 <code>default</code> 的默认 Servlet 来处理请求。关于这一点后续也会详细说明。</p>
<br />

<h3 id="入门示例"><a href="#入门示例" class="headerlink" title="入门示例"></a>入门示例</h3><p>我们通过实现下述功能，讲解如何针对具体的请求编写相对应的 servlet ，并说明 servlet 处理该请求的过程。我们在前面已经创建的 <code>pro07-javaweb-begin</code> 项目中实现该功能。</p>
<blockquote>
<p>功能：通过「水果库存信息」页面，输入水果名称、价格、库存以及备注信息，点击提交后将这些信息加入到后台水果库存数据库中。</p>
</blockquote>
<br />

<h4 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h4><p>在本示例中我们使用的 Servlet 需要依赖第三方库 <code>javax.servlet-api</code> 的类，需引入 <a target="_blank" rel="noopener" href="https://mvnrepository.com/artifact/javax.servlet/javax.servlet-api">该依赖</a>。此外连接 MySQL 数据库要引入 <code>mysql-connector-java</code> 依赖。在 「Tomcat」一节中，我们已经创建了 <code>javaweb_in_action</code> 这个 Maven 项目，也创建了 <code>pro07-javaweb-begin</code> 这个子项目，maven 会自动将前者作为父工程，后者作为子工程，我们在父工程的 <code>pom.xml</code> 文件中使用 <code>&lt;dependenciesManager&gt;</code> 标签统一管理子工程的依赖。</p>
<p>※ Maven 的使用以及父子工程间依赖继承相关的知识可参考 <a target="_blank" rel="noopener" href="https://github.com/iyukiyama/maven_in_action">该仓库</a> 的 <a target="_blank" rel="noopener" href="https://github.com/iyukiyama/maven_in_action/blob/master/Maven%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98_yukiyama.md">Maven学习实战_yukiyama</a> 教程。</p>
<p>父工程 <code>javaweb_in_action</code> 的 <code>pom.xml</code> 。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.yukiyama.javaweb<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javaweb_in_action<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">module</span>&gt;</span>pro07-javaweb-begin<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>javaweb_in_action<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.apache.org<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.13.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.servlet/javax.servlet-api --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--      &lt;dependency&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;groupId&gt;mysql&lt;/groupId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;version&gt;8.0.11&lt;/version&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--      &lt;/dependency&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>子工程 <code>pro07-javaweb-begin</code> 的 <code>pom.xml</code> 。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javaweb_in_action<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.yukiyama.javaweb<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pro07-javaweb-begin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>pro07-javaweb-begin Maven Webapp<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.apache.org<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.servlet/javax.servlet-api --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;dependency&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;groupId&gt;mysql&lt;/groupId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;/dependency&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>pro07-javaweb-begin<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>但是在实际使用中，通过父工程继承的 <code>mysql-connector-java</code> 依赖并不生效，会报此错 <code>java.lang.ClassNotFoundException: com.mysql.jdbc.Driver</code> 。作者暂时还不知道为什么引用无法生效，即便直接在子工程中添加完整坐标的依赖也存在同样的问题。目前解决这个问题的办法是在 <code>WEB-INF</code> 下新建一个 <code>lib</code> 文件夹，将 <code>mysql-connector-java-x.x.x.jar</code> 放入其中，并手动添加到依赖中 (若使用的 IDE 为 idea，选中该 jar 包，右键，点击 「Add as Library…」，或者在 File &gt; Project Structure &gt; Modules 的 Dependencies 页签下完成添加) 。</p>
<br />

<h4 id="准备数据库"><a href="#准备数据库" class="headerlink" title="准备数据库"></a>准备数据库</h4><p>按如下 SQL 语句准备数据库 <code>fruitdb</code> 以及 <code>t_fruit</code> 表。</p>
<p>TODO: 导入方法和DBeaver软件</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE fruitdb charset utf8;</span><br><span class="line">USE fruitdb;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `t_fruit` (</span><br><span class="line">  `fid` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `fname` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `price` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `fcount` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `remark` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`fid`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">33</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span>  <span class="keyword">into</span> `t_fruit`(`fid`,`fname`,`price`,`fcount`,`remark`) </span><br><span class="line"><span class="keyword">values</span> </span><br><span class="line">(<span class="number">1</span>,<span class="string">&#x27;红富士&#x27;</span>,<span class="number">5</span>,<span class="number">16</span>,<span class="string">&#x27;红富士也是苹果!&#x27;</span>),</span><br><span class="line">(<span class="number">2</span>,<span class="string">&#x27;大瓜&#x27;</span>,<span class="number">5</span>,<span class="number">100</span>,<span class="string">&#x27;王校长的瓜真香&#x27;</span>),</span><br><span class="line">(<span class="number">3</span>,<span class="string">&#x27;南瓜&#x27;</span>,<span class="number">4</span>,<span class="number">456</span>,<span class="string">&#x27;水果真好吃&#x27;</span>),</span><br><span class="line">(<span class="number">4</span>,<span class="string">&#x27;苦瓜&#x27;</span>,<span class="number">5</span>,<span class="number">55</span>,<span class="string">&#x27;苦瓜很好吃&#x27;</span>),</span><br><span class="line">(<span class="number">5</span>,<span class="string">&#x27;莲雾&#x27;</span>,<span class="number">9</span>,<span class="number">99</span>,<span class="string">&#x27;莲雾是一种神奇的水果&#x27;</span>),</span><br><span class="line">(<span class="number">6</span>,<span class="string">&#x27;羊角蜜&#x27;</span>,<span class="number">4</span>,<span class="number">30</span>,<span class="string">&#x27;羊角蜜是一种神奇的瓜&#x27;</span>),</span><br><span class="line">(<span class="number">7</span>,<span class="string">&#x27;啃大瓜&#x27;</span>,<span class="number">13</span>,<span class="number">123</span>,<span class="string">&#x27;孤瓜&#x27;</span>);</span><br></pre></td></tr></table></figure>

<br />

<h4 id="编写浏览器页面"><a href="#编写浏览器页面" class="headerlink" title="编写浏览器页面"></a>编写浏览器页面</h4><p>首先编写如下浏览器页面 <code>add.html</code> 。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;add&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">        名称：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;fname&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        价格：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;price&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        库存：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;fcount&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        备注：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;remark&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;添加&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>该页面如下。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/javaweb_in_action/add_html_empty.png" alt="add_html_empty"></p>
<br />

<h4 id="编写FruitDao相关类"><a href="#编写FruitDao相关类" class="headerlink" title="编写FruitDao相关类"></a>编写FruitDao相关类</h4><p>从浏览器输入的水果库存信息要保存到数据库中，就要操作数据库，即需要编写 <code>Fruit</code> ORM 类、<code>BaseDao</code>、 <code>FruitDao</code> 接口、<code>FruitDaoImpl</code> 实现类。这部分需要 JDBC 的知识，读者可先阅读 <a target="_blank" rel="noopener" href="https://github.com/iyukiyama/jdbc_in_action">此仓库</a> 中的 <a target="_blank" rel="noopener" href="https://github.com/iyukiyama/jdbc_in_action/blob/master/jdbc%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98_yukiyama.md">jdbc学习实战_yukiyama</a> 一文完成相关知识的学习，当然也可以跳过这部分内容直接使用已经提供好的相关实现。</p>
<br />

<h4 id="编写AddServlet"><a href="#编写AddServlet" class="headerlink" title="编写AddServlet"></a>编写AddServlet</h4><p>创建一个继承 <code>HttpServlet</code> 的 <code>AddServlet</code> 类，用于响应通过 <code>add.html</code> 页面添加数据的请求。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.servlets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yukiyama.fruit.dao.FruitDAO;</span><br><span class="line"><span class="keyword">import</span> com.yukiyama.fruit.dao.impl.FruitDaoImpl;</span><br><span class="line"><span class="keyword">import</span> com.yukiyama.fruit.pojo.Fruit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        req.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>); <span class="comment">// post请求时，添加此句支持中文 (get请求无需此句)</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fname</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;fname&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">priceStr</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;price&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">price</span> <span class="operator">=</span> Integer.parseInt(priceStr);</span><br><span class="line">        <span class="type">String</span> <span class="variable">fcountStr</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;fcount&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> Integer.parseInt(fcountStr);</span><br><span class="line">        <span class="type">String</span> <span class="variable">remark</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;remark&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">FruitDAO</span> <span class="variable">fruitDAO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FruitDAOImpl</span>();</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> fruitDAO.addFruit(<span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="number">0</span>, fname, price, count, remark));</span><br><span class="line">        System.out.println(flag ? <span class="string">&quot;添加成功&quot;</span> : <span class="string">&quot;添加失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br />

<h4 id="配置web-xml"><a href="#配置web-xml" class="headerlink" title="配置web.xml"></a>配置web.xml</h4><p>将项目部署到 Tomcat 后，我们能够在浏览器中以 http 方式打开 <code>add.html</code> ，并能够填写相关信息。并且我们也编写好了 <code>FruitDao</code> 及相关的 JDBC 实现，能够将 <code>Addservlet</code> 通过 <code>doPost</code> 方法获取到的数据写入到数据库中。但目前 <code>add.html</code> 页面提交数据的请求，是无法找到 <code>AddServlet</code> 的，或者说 <code>AddServlet</code> 还不知道自己应该拦截什么请求。</p>
<p>我们还需要在 web.xml 中完成具体的 Servlet (<code>AddServlet</code>) 与具体的请求动作 (<code>action=&quot;add&quot;</code>) 的映射配置，Tomcat 通过该配置使得指定的 Servlet 拦截映射绑定的请求。</p>
<p><code>web.xml</code> 如下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置 AddServelet --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>AddServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.yukiyama.servlets.AddServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 映射 AddServlet 与 add --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>AddServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/add<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<br />

<h4 id="配置Tomcat"><a href="#配置Tomcat" class="headerlink" title="配置Tomcat"></a>配置Tomcat</h4><p>参考「Tomcat」-「部署应用」-「自动」，一个 web 项目要部署到 Web 服务器中才能运行，因此我们要将 <code>pro07-javaweb-begin</code> 这个 artifact 部署到 Tomcat 中。</p>
<p>若指定打开的 URL 未写上 <code>add.html</code> ，则 Tomcat 会寻找 <code>index.html</code> ，找不到则报 <code>404</code> 错误。若在 <code>webapp</code> 目录下存在 <code>index.html</code> ，则 URL 中可以省略 <code>index.html</code> 。实际上，在 Tomcat 程序安装路径下的 <code>conf</code> 目录的 <code>web.xml</code> 配置文件中，有如下配置及注释说明。可以看到，若是前述情形，则 Tomcat 会在相应文件夹中依次寻找 <code>index.html</code>, <code>index.htm</code>, <code>index.jsp</code> 。</p>
<p>也可以在具体的 web 项目的 <code>web.xml</code> 下添加 <code>&lt;welcome-file-list&gt;</code> 标签，使得 URL 访问时不必写出资源文件名。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ==================== Default Welcome File List ===================== --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- When a request URI refers to a directory, the default servlet looks  --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- for a &quot;welcome file&quot; within that directory and, if present, to the   --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- corresponding resource URI for display.                              --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- If no welcome files are present, the default servlet either serves a --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- directory listing (see default servlet configuration on how to       --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- customize) or returns a 404 status, depending on the value of the    --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- listings setting.                                                    --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                                                      --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- If you define welcome files in your own application&#x27;s web.xml        --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- deployment descriptor, that list *replaces* the list configured      --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- here, so be sure to include any of the default values that you wish  --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- to use within your application.                                       --&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br></pre></td></tr></table></figure>

<br />

<h4 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h4><p>完成上述步骤后，<code>pro07-javaweb-begin</code> 子工程目录如下，相关的文件都可以在 <a target="_blank" rel="noopener" href="https://github.com/iyukiyama/javaweb_in_action">javaweb_in_action</a> 仓库中获取。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">pro07-javaweb-begin</span><br><span class="line">├── pom.xml</span><br><span class="line">└── src</span><br><span class="line">    ├── main</span><br><span class="line">    │   ├── java</span><br><span class="line">    │   │   ├── com</span><br><span class="line">    │   │   │   └── yukiyama</span><br><span class="line">    │   │   │       └── servlets</span><br><span class="line">    │   │   │           └── AddServlet.java</span><br><span class="line">    │   │   └── com.yukiyama.fruit</span><br><span class="line">    │   │       ├── dao</span><br><span class="line">    │   │       │   ├── FruitDAO.java</span><br><span class="line">    │   │       │   ├── base</span><br><span class="line">    │   │       │   │   └── BaseDAO.java</span><br><span class="line">    │   │       │   └── impl</span><br><span class="line">    │   │       │       └── FruitDAOImpl.java</span><br><span class="line">    │   │       └── pojo</span><br><span class="line">    │   │           └── Fruit.java</span><br><span class="line">    │   ├── resources</span><br><span class="line">    │   └── webapp</span><br><span class="line">    │       ├── WEB-INF</span><br><span class="line">    │       │   ├── lib</span><br><span class="line">    │       │   │   └── mysql-connector-java-8.0.11.jar</span><br><span class="line">    │       │   └── web.xml</span><br><span class="line">    │       ├── add.html</span><br><span class="line">    │       └── hello01.html</span><br><span class="line">    └── test</span><br><span class="line">        ├── java</span><br><span class="line">        └── resources</span><br></pre></td></tr></table></figure>



<p>至此，我们完成了实现目标功能所需的所有工作。运行该工程，浏览器自动弹出 <code>add.html</code> 页面，填入相关信息后，如下。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/javaweb_in_action/add_html.png" alt="add_html"></p>
<p>正常情况下该请求 (名为 <code>add</code> 的 Post 请求) 会被 <code>AddServlet</code> 处理，根据请求类型为 Post ，调用其 <code>doPost</code> 方法，在方法中将通过 Tomcat 传入的 <code>HttpServletRequest</code> 实例的 <code>getParameter</code> 方法得到的数据，经由 <code>FruitDao</code> 实例方法 <code>addFruit</code> 写入到数据库中对应的表中。</p>
<p>此时查看数据库，可以看到数据已经被成功写入。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_fruit;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+-------+--------+--------------------------------+</span></span><br><span class="line"><span class="operator">|</span> fid <span class="operator">|</span> fname     <span class="operator">|</span> price <span class="operator">|</span> fcount <span class="operator">|</span> remark                         <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+-------+--------+--------------------------------+</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">1</span> <span class="operator">|</span> 红富士    <span class="operator">|</span>     <span class="number">5</span> <span class="operator">|</span>     <span class="number">16</span> <span class="operator">|</span> 红富士也是苹果！               <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">2</span> <span class="operator">|</span> 大瓜      <span class="operator">|</span>     <span class="number">5</span> <span class="operator">|</span>    <span class="number">100</span> <span class="operator">|</span> 王校长的瓜真香                 <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">3</span> <span class="operator">|</span> 南瓜      <span class="operator">|</span>     <span class="number">4</span> <span class="operator">|</span>    <span class="number">456</span> <span class="operator">|</span> 水果真好吃                     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">4</span> <span class="operator">|</span> 苦瓜      <span class="operator">|</span>     <span class="number">5</span> <span class="operator">|</span>     <span class="number">55</span> <span class="operator">|</span> 苦瓜很好吃                     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">5</span> <span class="operator">|</span> 莲雾      <span class="operator">|</span>     <span class="number">9</span> <span class="operator">|</span>     <span class="number">99</span> <span class="operator">|</span> 莲雾是一种神奇的水果           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">6</span> <span class="operator">|</span> 羊角蜜    <span class="operator">|</span>     <span class="number">4</span> <span class="operator">|</span>     <span class="number">30</span> <span class="operator">|</span> 羊角蜜是一种神奇的瓜           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">7</span> <span class="operator">|</span> 啃大瓜    <span class="operator">|</span>    <span class="number">13</span> <span class="operator">|</span>    <span class="number">123</span> <span class="operator">|</span> 孤瓜                           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">38</span> <span class="operator">|</span> apple     <span class="operator">|</span>    <span class="number">10</span> <span class="operator">|</span>    <span class="number">100</span> <span class="operator">|</span> apple added                    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+-------+--------+--------------------------------+</span></span><br><span class="line"><span class="number">8</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.07</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>

<br />

<h3 id="继承关系"><a href="#继承关系" class="headerlink" title="继承关系"></a>继承关系</h3><p>为了看清 servlet 是如何工作的，我们首先查看如下从具体实现类 <code>AddServlet</code> 上溯到 <code>Servlet</code> 接口的继承关系。可以看到继承路径为 <code>Servlet</code> 接口 &gt; <code>GenericServlet</code> 抽象类 &gt; <code>HttpServlet</code> 抽象类 &gt; <code>Servlet</code> 具体实现类。</p>
<p>※ 继承关系图打开方法：在 idea 环境中选中类，右键菜单栏底部选择 Diagrams &gt; Show Diagrams… 或 Show Diagrams Popup… 。此功能依赖「Diagrams」插件 (idea 已内置)，需开启。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/javaweb_in_action/servlet-extend-diagram.png" alt="servlet-extend-diagram"></p>
<p>在 <code>Servlet</code> 接口中，声明了如下五个抽象方法。我们指出，其中的 <code>init</code>, <code>service</code>, <code>destroy</code> 正是 servlet 工作的核心方法。这五个方法有些在 <code>GenericServlet</code> 或 <code>HttpServlet</code> 中已实现，有的需要在具体的  Servlet 实现类中重写实现，后续详细说明。</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>init</code></td>
<td>初始化方法。</td>
</tr>
<tr>
<td><code>getServletConfig</code></td>
<td>获取包含 servlet 的初始化和启动参数的 <code>ServletConfig</code> 对象。</td>
</tr>
<tr>
<td><code>service</code></td>
<td>服务方法。</td>
</tr>
<tr>
<td><code>getServletInfo</code></td>
<td>获取有关 servlet 的信息，如作者、版本和版权等。</td>
</tr>
<tr>
<td><code>destroy</code></td>
<td>销毁方法。</td>
</tr>
</tbody></table>
<br />

<h3 id="接口方法"><a href="#接口方法" class="headerlink" title="接口方法"></a>接口方法</h3><p>如下详细描述 <code>Servlet</code> 接口中的五个抽象方法。</p>
<br />

<h4 id="init"><a href="#init" class="headerlink" title="init"></a>init</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(ServletConfig config)</span> <span class="keyword">throws</span> ServletException;</span><br></pre></td></tr></table></figure>

<ul>
<li>由 servlet 容器调用，调用即表明该 servlet 正在服务。</li>
<li>实例化 servlet 之后，<code>init</code> 方法 <strong>只会被调用一次</strong> (因此 servlet 是单例的)。</li>
<li>servlet 处理请求前要求 <code>init</code> 方法必须已成功执行。</li>
<li><code>init</code> 方法已在 <code>GenericServlet</code> 抽象类中实现，将 Servlet 容器 (Tomcat) 传入的 <code>ServletConfig</code> 实例赋值给类字段 <code>config</code> 。</li>
<li><code>GenericServlet</code> 中实现 <code>Servlet</code> 的 <code>init</code> 方法中还会调用一个无参 <code>init</code> 方法，可以具体的 Servlet 实现类中重写 <code>init</code> 方法 (无参) ，以扩展初始化动作。</li>
<li><code>HttpServlet</code> 抽象类未实现该方法。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GenericServlet 抽象类中的 init 实现。</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(ServletConfig config)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">	<span class="built_in">this</span>.config = config;</span><br><span class="line">	<span class="built_in">this</span>.init();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GenericServlet 抽象类中的无参 init</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException &#123;&#125;</span><br></pre></td></tr></table></figure>

<br />

<h4 id="getServletConifg"><a href="#getServletConifg" class="headerlink" title="getServletConifg"></a>getServletConifg</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ServletConfig <span class="title function_">getServletConfig</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>返回包含 servlet 的初始化和启动参数的 <code>ServletConfig</code> 对象。</li>
<li>返回的 <code>ServletConfig</code> 对象就是传递给 <code>init</code> 方法的对象。</li>
<li><code>GenericServlet</code> 类已经实现了这个方法。因此具体的 servlet 实现类不必重写该方法。</li>
<li><code>HttpServlet</code> 抽象类未实现该方法 (因为<code>GenericServlet</code> 类已经实现了)。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GenericServlet 抽象类中的 getServletConfig 实现。</span></span><br><span class="line"><span class="keyword">public</span> ServletConfig <span class="title function_">getServletConfig</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> config;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br />

<h4 id="service"><a href="#service" class="headerlink" title="service"></a>service</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(ServletRequest req, ServletResponse res)</span> <span class="keyword">throws</span> ServletException, IOException;</span><br></pre></td></tr></table></figure>

<ul>
<li>由 servlet 容器调用，以允许 servlet 响应请求。</li>
<li>此方法只在 <code>init</code> 方法成功完成后才会被调用。</li>
<li>对于抛出或发送错误的 servlet，应设置响应的状态代码。</li>
<li>servlet 通常在多线程的 servlet 容器内运行，以同时处理多个请求。因此必须注意任何共享资源，如文件、网络连接以及 servlet 实例等的同步访问。</li>
<li>该方法在 <code>GenericServlet</code> 中也是抽象方法，因此必须在后续子类 (例如 <code>HttpServlet</code>) 中重写。</li>
<li>实际上由于 <code>HttpServlet</code> 重写实现了该方法，具体的 <code>Servlet</code> 实现类不必重写该方法 (源码注释中有言：There’s no need to override this method.)。</li>
</ul>
<p>如下是 <code>HttpServlet</code> 抽象类中的 <code>service</code> 方法的实现。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HttpServlet 抽象类中的 service(ServletRequest req, ServletResponse res) 实现。</span></span><br><span class="line"><span class="comment">// 源码注释中写道：</span></span><br><span class="line"><span class="comment">// Dispatches client requests to the protected service method. </span></span><br><span class="line"><span class="comment">// There&#x27;s no need to override this method.</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(ServletRequest req, ServletResponse res)</span></span><br><span class="line">    <span class="keyword">throws</span> ServletException, IOException</span><br><span class="line">&#123;</span><br><span class="line">    HttpServletRequest  request;</span><br><span class="line">    HttpServletResponse response;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!(req <span class="keyword">instanceof</span> HttpServletRequest &amp;&amp;</span><br><span class="line">            res <span class="keyword">instanceof</span> HttpServletResponse)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServletException</span>(<span class="string">&quot;non-HTTP request or response&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    request = (HttpServletRequest) req;</span><br><span class="line">    response = (HttpServletResponse) res;</span><br><span class="line"></span><br><span class="line">    service(request, response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，该实现先判断传入的 <code>ServletRequest</code> 、<code>ServletResponse</code> 实例能向下转型为 <code>HttpServletRequest</code> 、<code>HttpServletResponse</code> ，若不能，则抛出 <code>ServletException</code> 异常，并告知此请求或响应是「非 HTTP 的」(non-HTTP) 。若能向下转型，则转型后执行如下方法。</p>
<p>可以看到，下述 service 方法才是核心内容。该方法首先获取请求类型 (GET &#x2F; HEAD &#x2F; POST &#x2F; PUT &#x2F; DELET &#x2F; OPTIONS &#x2F; TRACE &#x2F; 不属于列出的任何类型)，然后通过 <code>if-else</code> 分支根据具体类型执行相应的 <code>doXXX</code> 方法或发送错误信息 (不属于列出的任何类型时)。</p>
<p>关于 <code>lastModified</code> </p>
<p>TODO</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HttpServlet 抽象类中的 service(HttpServletRequest req, HttpServletResponse resp) 实现。</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span><br><span class="line">    <span class="keyword">throws</span> ServletException, IOException</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> req.getMethod();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (method.equals(METHOD_GET)) &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">lastModified</span> <span class="operator">=</span> getLastModified(req);</span><br><span class="line">        <span class="keyword">if</span> (lastModified == -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// servlet doesn&#x27;t support if-modified-since, no reason</span></span><br><span class="line">            <span class="comment">// to go through further expensive logic</span></span><br><span class="line">            doGet(req, resp);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">ifModifiedSince</span> <span class="operator">=</span> req.getDateHeader(HEADER_IFMODSINCE);</span><br><span class="line">            <span class="keyword">if</span> (ifModifiedSince &lt; lastModified) &#123;</span><br><span class="line">                <span class="comment">// If the servlet mod time is later, call doGet()</span></span><br><span class="line">                <span class="comment">// Round down to the nearest second for a proper compare</span></span><br><span class="line">                <span class="comment">// A ifModifiedSince of -1 will always be less</span></span><br><span class="line">                maybeSetLastModified(resp, lastModified);</span><br><span class="line">                doGet(req, resp);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                resp.setStatus(HttpServletResponse.SC_NOT_MODIFIED);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_HEAD)) &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">lastModified</span> <span class="operator">=</span> getLastModified(req);</span><br><span class="line">        maybeSetLastModified(resp, lastModified);</span><br><span class="line">        doHead(req, resp);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_POST)) &#123;</span><br><span class="line">        doPost(req, resp);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_PUT)) &#123;</span><br><span class="line">        doPut(req, resp);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_DELETE)) &#123;</span><br><span class="line">        doDelete(req, resp);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_OPTIONS)) &#123;</span><br><span class="line">        doOptions(req,resp);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_TRACE)) &#123;</span><br><span class="line">        doTrace(req,resp);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="comment">// Note that this means NO servlet supports whatever</span></span><br><span class="line">        <span class="comment">// method was requested, anywhere on this server.</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">errMsg</span> <span class="operator">=</span> lStrings.getString(<span class="string">&quot;http.method_not_implemented&quot;</span>);</span><br><span class="line">        Object[] errArgs = <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">1</span>];</span><br><span class="line">        errArgs[<span class="number">0</span>] = method;</span><br><span class="line">        errMsg = MessageFormat.format(errMsg, errArgs);</span><br><span class="line"></span><br><span class="line">        resp.sendError(HttpServletResponse.SC_NOT_IMPLEMENTED, errMsg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br />

<h4 id="getServletInfo"><a href="#getServletInfo" class="headerlink" title="getServletInfo"></a>getServletInfo</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">getServletInfo</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>返回有关 servlet 的信息，如作者、版本和版权。</li>
<li>该方法返回的字符串应该是纯文本，而不是任何形式的标记 (如HTML、XML等)。</li>
<li><code>GenericServlet</code> 抽象类中实现了该方法，但只返回了 <code>&quot;&quot;</code> 。</li>
<li><code>HttpServlet</code> 抽象类未实现该方法。具体的 Servlet 实现类可根据实际需要重写该方法。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GenericServlet 抽象类中的 getServletInfo 实现。</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getServletInfo</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br />

<h4 id="destroy"><a href="#destroy" class="headerlink" title="destroy"></a>destroy</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>由 servlet 容器调用，表明该 servlet 正在退出服务。</li>
<li>只有在 servlet 的 <code>service</code> 方法中的所有线程都退出或超时后，才会调用这个方法。</li>
<li>在 servlet 容器调用此方法后，它将不再调用此 servlet 的 <code>service</code> 方法。</li>
<li>该方法给了 servlet 一个机会来清理任何被保留的资源 (例如内存、文件句柄、线程)，并确保任何持久化状态与 servlet 在内存中的当前状态同步。</li>
<li><code>GenericServlet</code> 抽象类中实现了该方法，但无任何动作。</li>
<li><code>HttpServlet</code> 抽象类未实现该方法。具体的 Servlet 实现类可根据实际需要重写该方法。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GenericServlet 抽象类中的 destroy 实现。</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<br />

<h3 id="HttpServlet"><a href="#HttpServlet" class="headerlink" title="HttpServlet"></a>HttpServlet</h3><p>现在我们知道，响应请求的核心方法是 <code>service</code> ，该方法在 <code>HttpServlet</code> 已被实现。我们也已展示过 <code>HttpServlet</code> 中 <code>service</code> 方法的内部实现，其中对应不同请求的 <code>doXxx</code> 方法是响应请求的具体动作。虽然 JDK 建议具体 <code>Servlet</code> 实现类不必再重写 <code>service</code> 方法，但却必须重写从 <code>HttpServlet</code> 继承的 <code>doXxx</code> 方法，以根据实际情况处理具体的请求。例如我们在「入门示例」中展示过的那样，从 post 请求中获取表单信息写入数据库中。实际上，当具体的 <code>Servlet</code> 实现类处理请求时，若未重写对应该请求的 <code>doXxx</code> 方法，则会返回 405 错误。</p>
<br />

<h4 id="doXxx"><a href="#doXxx" class="headerlink" title="doXxx"></a>doXxx</h4><p>以 <code>doPost</code> 作为例子说明。如下是 <code>HttpServlet</code> 实现的 <code>doPost</code> 方法。传入由 Tomcat 根据请求创建和维护的 <code>HttpServletRequest</code> 和 <code>HttpServletResponse</code> 。首先获取请求协议字符串，例如 <code>HTTP/1.1</code> ，接着获取 <code>msg</code> 字符串 (定义在 <code>LocalStrings.properties</code> 文件中) 。判断请求协议是否为 <code>HTTP/1.1</code> ，若是则发送 405 错误 (<code>HttpServletResponse.SC_METHOD_NOT_ALLOWED</code> 即 <code>int 405</code>) ，否则发送 400 错误 (<code>HttpServletResponse.SC_BAD_REQUEST </code> 即  <code>int 400</code>) 。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span><br><span class="line">    <span class="keyword">throws</span> ServletException, IOException</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">protocol</span> <span class="operator">=</span> req.getProtocol();</span><br><span class="line">    <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> lStrings.getString(<span class="string">&quot;http.method_post_not_supported&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (protocol.endsWith(<span class="string">&quot;1.1&quot;</span>)) &#123;</span><br><span class="line">        resp.sendError(HttpServletResponse.SC_METHOD_NOT_ALLOWED, msg);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        resp.sendError(HttpServletResponse.SC_BAD_REQUEST, msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>※ <code>LocalStrings.properties</code> 文件中定义的字符串，如下只展示其中的两条。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">http.method_get_not_supported</span>=<span class="string">HTTP method GET is not supported by this URL</span></span><br><span class="line"><span class="attr">http.method_post_not_supported</span>=<span class="string">HTTP method POST is not supported by this URL</span></span><br></pre></td></tr></table></figure>

<br />

<h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><p>新建一个 <code>pro08-javaweb-servlet</code> web 子工程，创建 <code>Demo01Servlet</code> 类继承 <code>HttpServlet</code> ，在 <code>Demo01Servlet</code> 中重写 <code>doPost</code> 方法 (只简单调用父类 <code>doPost</code> 方法)，如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.servlets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo01Servlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">super</span>.doPost(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接着按照我们已经熟悉的过程，在 <code>web.xml</code> 中配置该 servlet 与请求的映射关系。接着将该工程部署到 Tomcat 中，并使该项目运行后浏览器自动弹出指定页面 (将上下文设置为 <code>/pro08</code>) 。</p>
<p><code>web.xml</code> 的相关配置。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Demo01Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.yukiyama.servlets.Demo01Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Demo01Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/demo01<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>Tomcat 设置中勾选 Server 页签下的 Open Browser 设置项下的「After launch」，并将 URL 设置为 <code>http://localhost:8080/pro08/demo01</code> 。</p>
<p>运行后我们将发现页面显示 405 错误。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/javaweb_in_action/405page.png" alt="405page"></p>
<p>出现 <code>405</code> 的原因就在于默认请求为 Get 方式，而我们重写的是 <code>doPost</code> 方法 (我们并没有编写页面发送 <code>method=&quot;post&quot;</code> 的请求) ，因此在执行 <code>service</code> 方法时，会调用 <code>Demo01Servlet</code> 的父类 <code>doGet</code> 方法。最终执行如下语句，其中的 <code>HttpServletResponse.SC_METHOD_NOT_ALLOWED</code> 常量即 405。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (protocol.endsWith(<span class="string">&quot;1.1&quot;</span>)) &#123;</span><br><span class="line">    resp.sendError(HttpServletResponse.SC_METHOD_NOT_ALLOWED, msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 <code>HttpServletResponse</code> 中定义的 <code>SC_METHOD_NOT_ALLOWED</code> 常量。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SC_METHOD_NOT_ALLOWED</span> <span class="operator">=</span> <span class="number">405</span>;</span><br></pre></td></tr></table></figure>



<p>接着我们在 <code>Demo01Servlet</code> 中重写 <code>doGet</code> 方法，如下。重新运行后不会报之前的 405 错，且能够顺利打印出 <code>doGet...</code> 。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;doGet...&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>通过该实例，我们看到 <code>HttpServlet</code> 中实现的 <code>doXxx</code> 方法会返回 405 错误，<strong>因此必须根据实际请求编写对应的 <code>doXxx</code> 方法</strong>。</p>
<br />

<h3 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h3><p>servlet 的生命周期从实例创建开始，到 <code>destroy</code> 方法执行结束为止。主要有以下四个阶段。</p>
<ol>
<li>创建 <code>Servlet</code> 实例。<ol>
<li>当 Tomcat 服务接收到请求后，读取该请求 URL，根据预先配置在 <code>web.xml</code> 的「具体 servlet 实现类与 url-pattern 的映射关系」，通过反射创建对应的 Servlet 实现类的示例。</li>
<li>创建实例的过程会执行无参构造器。</li>
<li>对于相同的请求，相应的 Servlet 实例只会创建一个 (单例模式)，此后均由此实例响应后续相同请求。</li>
</ol>
</li>
<li>调用 <code>init</code> 。<ol>
<li>接着 Tomcat 会调用该实例的 <code>init</code> 方法。由于 <code>GenericServlet</code> 抽象类中的 <code>init</code> 方法实现将 <code>ServletConfig</code> 实例赋值给实例字段 <code>config</code> ，因此 <code>init</code> 执行后， Servlet 实例就会持有该 <code>config</code> 字段。</li>
<li>如果 Servlet 实例重写了 <code>init</code> ，将继续执行重写的内容。</li>
<li>该方法在 Servlet 实例创建后只会执行一次。</li>
</ol>
</li>
<li>调用 <code>service</code> 。<ol>
<li>若 <code>init</code> 执行成功，Tomcat 继续调用 <code>service</code> 。由于 <code>HttpServlet</code> 实现了该方法，具体的 <code>Servlet</code> 实现类不必重写 (JDK 注释中即建议不必重写) 。</li>
<li>该方法最终会根据传入的请求执行对应的 <code>doXXX</code> 方法或发送错误信息 (请参考前文「接口方法」一节)。</li>
<li>该方法每次接收到新的请求后都会相应执行一次。</li>
</ol>
</li>
<li>调用 <code>destroy</code> 。<ol>
<li><code>service</code> 方法中的所有线程都退出或超时后，调用 <code>destroy</code> 方法。</li>
<li>此方法在 servlet 结束服务前提供一个清理任何被保留的资源 (例如内存、文件句柄、线程) 的机会，并确保任何持久化状态与 servlet 在内存中的当前状态同步。</li>
<li>此方法已在 <code>GenericServlet</code> 中实现，无方法体，即不执行任何动作。因此若无需清理，则具体 Servlet 实现类不必重写该方法。若需要执行某些动作，重写即可。</li>
</ol>
</li>
</ol>
<p>我们在 <code>pro08-javaweb-servlet</code> web 子项目下创建 <code>Demo02Servlet</code> 类演示 servlet 的生命周期。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.servlets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo02Servlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Demo02Servlet</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Constructor Demo02Servlet() is running.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Method init() is running.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(ServletRequest req, ServletResponse res)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Method service() is running.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Method destroy() is running.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>与之前一样，在 <code>web.xml</code> 中配置该 servlet 与请求的映射关系。接着将该项目部署到 Tomcat 并在 Tomcat 的设置界面 Server 页签下的 「Open browser」中，不勾选「After launch」，即运行后不让浏览器自动弹出对应该 URL 的页面，而是手动输入访问。由于没有指定资源，所有方法都未调用对应的父类方法 (例如 <code>super.init()</code>) ，因此不会出现 405 错误。idea 下方的 Tomcat 信息栏中的 Server 页签中显示如下内容。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">com.yukiyama.servlets.Demo02Servlet@2f6691b4 Constructor Demo02Servlet() is running.</span><br><span class="line">com.yukiyama.servlets.Demo02Servlet@2f6691b4 Method init() is running.</span><br><span class="line">com.yukiyama.servlets.Demo02Servlet@2f6691b4 Method service() is running.</span><br></pre></td></tr></table></figure>

<p>每刷新一次页面，就会打印一次如下信息。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">com.yukiyama.servlets.Demo02Servlet@2f6691b4 Method service() is running.</span><br></pre></td></tr></table></figure>

<p>停止 Tomcat 服务时，如下信息被打印。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">com.yukiyama.servlets.Demo02Servlet@2f6691b4Method destroy() is running.</span><br></pre></td></tr></table></figure>

<p>由此我们清晰地看到 servlet 生命周期的四个阶段，并且确认了生命周期内只有一个 Servlet 实例，<code>init</code> 方法只被调用一次，每次请求都会调用一次 <code>service</code> 方法，servlet 停止服务前调用 <code>destroy</code> 方法。</p>
<p>值得注意的是，因为 <code>Servlet</code> 实例是单例的，同一个实例响应多个对应此 servlet 的请求时，该实例是「线程不安全」的。因此应尽量避免在 Servlet 实例中声明字段。</p>
<br />

<h4 id="实例创建时机"><a href="#实例创建时机" class="headerlink" title="实例创建时机"></a>实例创建时机</h4><p>通过观察 servlet 的生命周期，我们看到 Servlet 实例是在请求到达 Tomcat 时才被创建。由于需要创建实例，第一次请求的响应会比之后的请求的响应要更耗时。我们想，如果 <code>Servlet</code> 实例不是在第一次请求时才被创建，而是在此前就已经创建好，那么第一次请求也会被快速响应。实际上这一点可以通过在 <code>web.xml</code> 中为指定的 servlet 添加 <code>&lt;load-on-starup&gt;</code> 标签来实现。如下为 <code>Demo02Servlet</code> 配置该标签。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Demo02Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.yukiyama.servlets.Demo02Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>0<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>该标签的值必须是整数，即只能取 <strong>负整数、零或正整数</strong> ，不同取值的作用如下。</p>
<ul>
<li>0 或正整数：在 Tomcat 启动该 servlet 所在工程时，即实例化该 servlet。 <strong>数字越小，优先级越高</strong> ，即当有多个 servlet 设置了此标签时，数字较小的先被其实例先被创建。若数字相同，servlet 容器 (即 Tomcat) 将自行决定创建实例的顺序。</li>
<li>负数：与无此标签相同，即 servlet 容器 (即 Tomcat) 在接收到相应请求时才创建 <code>Servlet</code> 实例。</li>
</ul>
<p>在 idea 中，点击 <code>&lt;load-on-startup&gt;</code> (同时按住 command 键) ，会跳转到 <code>xsd</code> 文件该标签的定义处，可以查看到如下详细说明。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The load-on-startup element indicates that this servlet should be loaded (instantiated and have its init() called) on the startup of the web application. The optional contents of these element must be an integer indicating the order in which the servlet should be loaded. If the value is a negative integer, or the element is not present, the container is free to load the servlet whenever it chooses. If the value is a positive integer or 0, the container must load and initialize the servlet as the application is deployed. The container must guarantee that servlets marked with lower integers are loaded before servlets marked with higher integers. The container may choose the order of loading of servlets with the same load-on-start-up value.</span><br></pre></td></tr></table></figure>

<br />

<h3 id="session"><a href="#session" class="headerlink" title="session"></a>session</h3><p>session，即「会话」。会话出现是为了弥补 HTTP 协议无状态的缺陷，因为在很多「事务性」操作场景下，我们希望服务端识别一连串的请求是有关联的。最常被提到的例子是「购物操作」，即如果保持 HTTP 无状态的特点，每一次将商品加入购物车的请求都视作新的请求，那么一个购物车总是对应一件商品 (不考虑购物网站用户绑定购物车的关系)，如果服务端能够标识请求，使得多次将商品加入购物车的请求都有相同标识，那么就可以将该多次请求的商品加入同一个购物车中。</p>
<p>上述例子容易让我们将「会话」与「客户端服务端之间的连续通信」联系在一起，这是一种很模糊的理解。我们指出，针对 Tomcat 的 servlet 来说，session 的本质是 Java 对象，即 <code>javax.servlet.http.HttpSession</code> 类的实例，也即当我们在说 session (会话) 时，本质上是在谈论 <code>HttpSession</code> 实例对象。</p>
<br />

<h4 id="生命周期-1"><a href="#生命周期-1" class="headerlink" title="生命周期"></a>生命周期</h4><p>session 的生命周期为创建、存活与结束。</p>
<ul>
<li><p>session 创建，即 <code>HttpSession</code> 实例对象的创建。</p>
<ul>
<li>对于 Servlet 而言，只有执行 <code>req.getSession()</code> 或 <code>req.getSession(true)</code> 才会创建 <code>HttpSession</code> 实例。但若请求携带了 sessionID，且此时服务器存在对应该 sessionID 的 <code>HttpSession</code> 实例时，不会创建。</li>
</ul>
</li>
<li><p>session 存活，即 session 在创建与结束之间的过程。session 存活期间可通过 <code>req.getSession()</code> 获取，并可执行 <code>getId()</code>, <code>isNew()</code> 等一系列相关方法。</p>
</li>
<li><p>session 结束，即 <code>HttpSession</code> 实例对象的销毁。</p>
<ul>
<li><code>HttpSession</code> 实例对象超时。</li>
<li>调用了实例方法 <code>invalidate()</code> 。</li>
<li>服务器 (Tomcat) 关闭或卸载了 <code>HttpSession</code> 实例所在的 web 应用。</li>
</ul>
</li>
</ul>
<p><strong>超时时间</strong></p>
<p><code>HttpSession</code> 实例的 <strong>超时时间默认为 1800 秒</strong> ，即 30 分钟，可通过其实例方法 <code>getMaxInactiveInterval()</code> 查询。可以通过 <code>setMaxInactiveInterval(int interval)</code> 来设置 <strong>当前 session</strong> 的超时时间，<code>int interval</code> 单位为秒，若设置为 0 或 负数，则为永不超时。</p>
<p>也可以通过在 <code>web.xml</code> 文件中加入如下配置来设置当前 <strong>web 应用全局 session 的超时时间</strong> ，单位为分钟，若设置为 0 或 负数，则为永不超时。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 设置 HttpSession 超时时间 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">session-config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">session-timeout</span>&gt;</span>60<span class="tag">&lt;/<span class="name">session-timeout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">session-config</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p><strong>invalidate</strong></p>
<p><code>HttpSession</code>  接口的 <code>invalidate()</code> 抽象方法有如下注释，这表明会话实例调用该方法时，JVM 不会直接回收该对象 (在堆中) 的内存，而是清除所有对该实例的引用，这样在下一次 GC 时该对象会被回收。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/7484856/will-session-invalidate-remove-the-attribute-set-to-the-session">参考1</a>, <a target="_blank" rel="noopener" href="https://blog.csdn.net/wzumath/article/details/6214287?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~BlogCommendFromBaidu~Rate-1-6214287-blog-2205658.pc_relevant_aa&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~BlogCommendFromBaidu~Rate-1-6214287-blog-2205658.pc_relevant_aa&utm_relevant_index=1">参考2</a></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Invalidates this session then unbinds any objects bound to it.</span><br></pre></td></tr></table></figure>



<p><strong>session与cookie</strong></p>
<p>当服务端处理请求时创建了 <code>HttpSession</code> 实例后，对应该实例，会有一个唯一的 sessionID，可通过 <code>HttpSession</code> 实例方法 <code>getId()</code> 获取。此 sessionID 会附加到返回信息中，使得浏览器的该次请求的「Response Headers」中具有该 sessionID (set-cookie 字段)，且浏览器会以 cookie 的形式记录在本地，并将其加入到下一次请求中。于是服务器在处理下一次请求时，即可根据此 sessionID 判断此次请求与第一次请求为「同一次会话」。具体过程看下例。</p>
<br />

<h4 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h4><p>在 <code>pro08-javaweb-servlet</code> web 子工程中创建如下 <code>Demo03Servlet</code> 类，在重写的 <code>service</code> 方法中获取 <code>session</code> 信息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.servlets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo03Servlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> req.getSession();</span><br><span class="line">        System.out.println(<span class="string">&quot;session.getId() = &quot;</span> + session.getId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>与之前一样，在 <code>web.xml</code> 中配置 <code>Demo03Servlet</code> 与请求 <code>/demo03</code> 的映射关系，确保 <code>pro08-javaweb-servlet</code> 已经部署在 Tomcat 中 (之前已部署) 。运行此应用，可以看到 Tomcat 打印了如下 sessionID 信息。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.getId() = 9B41CA00381B384676117432AA6C2F4A</span><br></pre></td></tr></table></figure>

<p>确保在浏览器页面中打开 <code>http://localhost:8080/demo03</code> 时，调试控制台 (按 <code>F12</code>) 已打开，即可以看到如下「Response Headers」中记录了上述 SessionID ，即 Set-Cookie 字段。这表示服务器针对 <code>/demo03</code> 这个 Get 请求，发回给浏览器的响应报文中携带了 SessionID (此时已保存到浏览器的 Cookie 中) 。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200</span><br><span class="line">Set-Cookie: JSESSIONID=9B41CA00381B384676117432AA6C2F4A; Path=/pro08; HttpOnly</span><br><span class="line">Content-Length: 0</span><br><span class="line">Date: Wed, 12 Oct 2022 08:28:06 GMT</span><br><span class="line">Keep-Alive: timeout=20</span><br><span class="line">Connection: keep-alive</span><br></pre></td></tr></table></figure>

<p>此时我们注意到，在调试控制台下查看「Request Headers」，其中并未出现上述 SessionID 。这进一步说明首次请求时浏览器并未携带会话标记，是 <strong>服务端首次处理该请求时生成并返回给浏览器的</strong> 。</p>
<p>接着我们刷新页面，发送第二次 <code>/demo03</code> Get 请求。此时「Request Headers」中可看到其携带了前述 SessionID ，即其中的 Cookie 字段。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">GET /pro08/demo03 HTTP/1.1</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: en,zh-CN;q=0.9,zh;q=0.8,ko-KR;q=0.7,ko;q=0.6,ja;q=0.5</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Cookie: JSESSIONID=9B41CA00381B384676117432AA6C2F4A</span><br><span class="line">Host: localhost:8080</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-Site: none</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.0.0 Safari/537.36</span><br><span class="line">sec-ch-ua: &quot;Chromium&quot;;v=&quot;106&quot;, &quot;Google Chrome&quot;;v=&quot;106&quot;, &quot;Not;A=Brand&quot;;v=&quot;99&quot;</span><br><span class="line">sec-ch-ua-mobile: ?0</span><br></pre></td></tr></table></figure>

<p>而「Response Headers」中无 SessionID 。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200</span><br><span class="line">Content-Length: 0</span><br><span class="line">Date: Wed, 12 Oct 2022 08:43:18 GMT</span><br><span class="line">Keep-Alive: timeout=20</span><br><span class="line">Connection: keep-alive</span><br></pre></td></tr></table></figure>

<p>这是因为第一次请求后，服务器发回的响应报文中的 SesionID 已经记录在浏览器中，再次请求时，如我们看到的第二次请求的「Request Headers」那样，SessionID 携带于其中，服务端在处理第二次请求时，根据此 SessionID 得知这是同一次「会话」，也就不必再发回 SessionID 了。</p>
<p>从此示例中我们还可以得出如下结论。</p>
<ul>
<li><code>HttpSession</code> 实例对象只存在于服务器中。</li>
<li>cookie 本质是 <code>HttpSession</code> 实例的 ID，在服务器端生成，由服务器响应第一次请求时发回给浏览器。浏览器保存为本地 cookie，在此后的请求中携带该 sessionID ，以告知服务器当前请求属于哪一次会话，sessionID 相同的请求均为同一会话。</li>
</ul>
<br />

<h4 id="相关方法"><a href="#相关方法" class="headerlink" title="相关方法"></a>相关方法</h4><p>与 session 相关的方法总结如下。</p>
<table>
<thead>
<tr>
<th>session 相关常用方法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>req.getSession()</code></td>
<td>获取当前请求对应的会话，若无则创建一个新的会话。</td>
</tr>
<tr>
<td><code>req.getSession(true)</code></td>
<td>同 <code>req.getSession()</code></td>
</tr>
<tr>
<td><code>req.getSession(false)</code></td>
<td>获取当前请求对应的会话，若无则返回 <code>null</code>。</td>
</tr>
<tr>
<td><code>session.getId()</code></td>
<td>获取 SessionID</td>
</tr>
<tr>
<td><code>session.isNew()</code></td>
<td>判断是否为新创建的 session 。</td>
</tr>
<tr>
<td><code>session.getMaxInactiveInterval()</code></td>
<td>最大非激活间隔时长 (默认 1800s，即 30m) 。</td>
</tr>
<tr>
<td><code>session.setMaxInactiveInterval()</code></td>
<td>设置最大非激活间隔时长。</td>
</tr>
<tr>
<td><code>session.invalidate()</code></td>
<td>使会话立即失效。</td>
</tr>
<tr>
<td><code>session.getCreationTime()</code></td>
<td>获取会话创建时间。</td>
</tr>
<tr>
<td><code>session.getLastAccessedTime()</code></td>
<td>获取最近一次访问时间。</td>
</tr>
<tr>
<td><code>session.setAttribute()</code></td>
<td>保存指定数据到 session 作用域空间中</td>
</tr>
<tr>
<td><code>session.getAttribute()</code></td>
<td>从 session 作用域空间中获取指定数据</td>
</tr>
<tr>
<td><code>session.removeAttribute()</code></td>
<td>删除 session 作用域空间中的指定数据</td>
</tr>
</tbody></table>
<br />

<h3 id="转发与重定向"><a href="#转发与重定向" class="headerlink" title="转发与重定向"></a>转发与重定向</h3><p>TODO: 示意图</p>
<br />

<h4 id="转发"><a href="#转发" class="headerlink" title="转发"></a>转发</h4><p>转发 (forward) 。浏览器将请求发送到服务器，服务器根据请求信息找到对应的 servlet A，但 A 并不处理该请求，而是将其转发给 servlet B，这就是服务器端的请求转发，服务器端内的转发可经历多次，由具体实现决定。</p>
<p>在 <code>pro08-javaweb-servlet</code> 中新建 <code>Demo04Servlet</code> 和 <code>Demo05Servlet</code> 类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.servlets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 演示转发与重定向</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo04Servlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;demo04...&quot;</span>);</span><br><span class="line">        <span class="comment">// 服务器端内部转发</span></span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;demo07&quot;</span>).forward(req,resp);</span><br><span class="line">        <span class="comment">// resp.sendRedirect(&quot;demo05&quot;);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.servlets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 演示转发与重定向</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo05Servlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;demo05...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>web.xml</code> 及 Tomcat 设置不再赘述。运行后，访问 <code>http://localhost:8080/pro08/demo04</code> ，Tomcat 首先打印 <code>demo04...</code> ，接着打印 <code>demo05...</code> ，表明请求首先 <code>Demo04Servlet</code> 处理，随后通过 <code>servie</code> 方法中的 <code>getRequestDispatcher(&quot;demo05&quot;).forward(req, resp)</code> 转发给 <code>Demo05Servlet</code> 。虽被转发，但服务端的转发过程对浏览器不可见，浏览器地址栏无变化。</p>
<br />

<h4 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h4><p>重定向 (redirect) 。浏览器将请求发送到服务器，服务器根据请求信息找到对应的 servlet A，但 A 并不处理该请求，而是发回一个响应，该响应告知客户端浏览器应访问一指定页面 (告知浏览器发起一个指定的请求)，这就是服务器端的请求重定向。</p>
<p>仍然利用 <code>Demo04Servlet</code> 和 <code>Demo05Servlet</code> 观察，将 <code>Demo04Servlet</code> 的 <code>service</code> 方法中的 <code>req.getRequestDispatcher(&quot;demo05&quot;).forward(req,resp);</code> 替换为 <code>resp.sendRedirect(&quot;demo05&quot;);</code> 。运行应用后也将依次打印 <code>demo04...</code> 和 <code>demo05...</code> 。但与转发不同的是，在浏览器调试控制台中可以看到请求了两次 (<code>demo04</code> 和 <code>demo05</code>) ，且第一次请求 (<code>demo04</code>) 的响应报文头 Respond Headers 中，可看到响应状态码为 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status">302</a> ，意为重定向，重定向到 <code>Location: demo05</code> 。 我们还能看到浏览器地址栏从 <code>http://localhost:8080/pro08/demo04</code> 变为了 <code>http://localhost:8080/pro08/demo05</code> 。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 302</span><br><span class="line">Location: demo05</span><br><span class="line">Content-Length: 0</span><br><span class="line">Date: Wed, 12 Oct 2022 10:40:33 GMT</span><br><span class="line">Keep-Alive: timeout=20</span><br><span class="line">Connection: keep-alive</span><br></pre></td></tr></table></figure>

<br />

<h3 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h3><p>Servlet <a target="_blank" rel="noopener" href="https://docs.oracle.com/javaee/7/tutorial/servlets003.htm#BNAFO">作用域 (Scope) </a> 。web 应用各组件需要共享数据，这些共享的数据可共享的范围即此处讨论的「作用域」。这是一个不太容易理解的概念，详细说明如下。</p>
<p>「共享的数据」本质上是 web 应用中的基本数据类型数据或引用类型的对象实例。「共享范围」即所谓「作用域 (scope)」，从小到大可分为 <strong>page</strong> &#x2F; <strong>request</strong> &#x2F; <strong>session</strong> &#x2F; <strong>web context (application)</strong> 这四种，它们的本质是四种类对象 ( scope object, 见后表) ，即 <strong>「域对象」</strong> 。「作用域」不是一个确定的内存空间域，也不是一个明确的「时间域」，而是与四个具体的类对象相绑定的概念。当我们说一个被共享的实例 (例如 <code>String str</code> ) 的作用域是 session，我们指的是该 <code>str</code> 实例与一个具体的 <code>HttpSession</code> 实例 <code>httpSession</code> 产生了关联，要使用 <code>str</code> ，需要通过这个 <code>httpSession</code> 来获取。回想「session」一节中的例子，当 <code>httpSession</code> 不可用时，<code>str</code> 也即不可用，其他作用域同理。总之四种作用域分别表示共享的对象实例可在同一 <strong>JSP页面</strong> &#x2F; <strong>请求</strong> &#x2F; <strong>会话</strong> &#x2F; <strong>应用</strong> (对象实例) 中共享。</p>
<p>更详细地，对于一个对象实例 <code>Object value</code>，当我们要共享它时，先确定要共享的范围，即作用域，例如要在 session 作用域下共享，那么就要明确是在哪个 <code>HttpSession</code> 实例下共享，例如在实例 <code>httpSession</code> 中共享，于是我们通过 <code>httpSeesion.setAttribute(String name, Object value)</code> 来将 <code>value</code> 与 <code>httpSession</code> 绑定。当我们要使用 <code>value</code> 时，通过 <code>httpSession.getAttribute(String name)</code> 来获取。 <code>httpSeesion</code> 是执行 <code>setAttribute</code> 方法时的 <code>httpSession</code> ， <code>name</code> 是执行 <code>setAttribute</code> 方法时的参数 <code>String name</code> 。</p>
<p>如下是四种作用域及其对应的类，后续我们以一些场景展示对象实例如何在不同的作用域中共享。</p>
<table>
<thead>
<tr>
<th align="left">Scope Object</th>
<th align="left">Class</th>
<th align="left">Accessible From</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Web context  (Application)</td>
<td align="left"><code>javax.servlet.ServletContext</code></td>
<td align="left">Web components within a web context. See <a target="_blank" rel="noopener" href="https://docs.oracle.com/javaee/7/tutorial/servlets008.htm#BNAGL">Accessing the Web Context</a>.</td>
</tr>
<tr>
<td align="left">Session</td>
<td align="left"><code>javax.servlet.http.HttpSession</code></td>
<td align="left">Web components handling a request that belongs to the session. See <a target="_blank" rel="noopener" href="https://docs.oracle.com/javaee/7/tutorial/servlets009.htm#BNAGM">Maintaining Client State</a>.</td>
</tr>
<tr>
<td align="left">Request</td>
<td align="left">Subtype of <code>javax.servlet.ServletRequest</code></td>
<td align="left">Web components handling the request.</td>
</tr>
<tr>
<td align="left">Page</td>
<td align="left"><code>javax.servlet.jsp.JspContext</code></td>
<td align="left">The JSP page that creates the object.</td>
</tr>
</tbody></table>
<br />

<h4 id="request作用域"><a href="#request作用域" class="headerlink" title="request作用域"></a>request作用域</h4><p>在 <code>pro08-java-servlet</code> web子项目中创建 <code>Demo06Servlet</code> 和 <code>Demo07Servlet</code> 类演示 session 作用域。</p>
<p>在 <code>Demo06Servlet</code> 类的 <code>service</code> 方法内，向 request 作用域中设置属性名为 <code>name</code> 的数据，该数据 (属性值) 为字符串 <code>yukiyama</code> ，随后打印该字符串。并将请求转发给 <code>demo07</code> 。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.servlets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 演示 request 作用域</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo06Servlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        req.setAttribute(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;yukiyama&quot;</span>);</span><br><span class="line">        <span class="comment">// System.out.println(&quot;request: &quot; + req);</span></span><br><span class="line">        System.out.println(<span class="string">&quot;demo06:&quot;</span> + req.getAttribute(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">        <span class="comment">// 转发</span></span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;demo07&quot;</span>).forward(req, resp);</span><br><span class="line">        <span class="comment">// 重定向</span></span><br><span class="line">        <span class="comment">// resp.sendRedirect(&quot;demo07&quot;);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>在 <code>Demo07Servlet</code> 类的 <code>service</code> 方法中，按属性名 <code>name</code> ，从 request 作用域中获取相应的数据 (属性值) 并打印。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.servlets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 演示 request 作用域</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo07Servlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// System.out.println(&quot;request: &quot; + req);</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">name</span> <span class="operator">=</span> req.getAttribute(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;demo07: &quot;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><code>web.xml</code> 完成相关配置，运行该 web 子工程，在浏览器中首先访问 <code>http://localhost:8080/demo06</code> ，可以看到在 Tomcat 控制台分别打印了 <code>demo06: yukiyama</code> 以及 <code>demo07: yukiyama</code> 。如我们所知，转发请求仍是同一请求，两次获取 <code>name</code> 都是在同一 request 作用域下，符合预期。</p>
<p>接着在 <code>Demo06Servlet</code> 的 <code>service</code> 方法中将转发语句替换为重定向语句 <code>resp.sendRedirect(&quot;demo07&quot;);</code> ，再次访问 <code>http://localhost:8080/demo06</code> ，可以看到 Tomcat 控制台分别打印了 <code>demo06: yukiyama</code> 以及 <code>demo07: null</code> 。这是重定向后的请求与第一次请求是两次不同的请求，因此第一次请求时的 request 作用域下的 <code>name</code> 无法在第二次请求的作用域中取到。</p>
<p>【我的疑惑。。。】</p>
<p>但是打印 request 实例的时候，正好相反。「转发」时两个 servlet 打印的 request 实例是不同的，但是「重定向」时两个 servlet 打印的 request 实例是相同的。</p>
<br />

<h4 id="session作用域"><a href="#session作用域" class="headerlink" title="session作用域"></a>session作用域</h4><p>在 <code>pro08-java-servlet</code> web子项目中创建 <code>Demo08Servlet</code> 和 <code>Demo09Servlet</code> 类演示 session 作用域。</p>
<p>在 <code>Demo08Servlet</code> 类的 <code>service</code> 方法内，向 session 作用域中属性名为 <code>userName</code> 的数据，该数据 (属性值) 为字符串 <code>yukiyama</code> ，随后打印该字符串。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.servlets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 演示 session 作用域</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo08Servlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        req.getSession().setAttribute(<span class="string">&quot;userName&quot;</span>, <span class="string">&quot;yukiyama&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">userName</span> <span class="operator">=</span> req.getSession().getAttribute(<span class="string">&quot;userName&quot;</span>);</span><br><span class="line">        System.out.println(userName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>在 <code>Demo09Servlet</code> 类的 <code>service</code> 方法中获取 session 后，从该 session 作用域中，按属性名 <code>userName</code> 获取相应的数据 (属性值) 并打印。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.servlets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 演示 session 作用域</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo09Servlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">userName</span> <span class="operator">=</span> req.getSession().getAttribute(<span class="string">&quot;userName&quot;</span>);</span><br><span class="line">        System.out.println(userName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><code>web.xml</code> 完成相关配置，运行该 web 子工程，在浏览器中首先访问 <code>http://localhost:8080/demo08</code> ，可以在 Tomcat 控制台看到打印了 <code>yukiyama</code> 。此时我们将 URL 改为 <code>http://localhost:8080/demo09</code> ，可以看到 <code>yukiyama</code> 再次被打印。这是因为两次请求为同一次会话，而 <code>userName</code> 属性值保存在 session 作用域中。</p>
<p>但若此时我们打开另一个浏览器 (对于服务端 Tomcat 来说，这是另一个客户端) ，则会创建新的会话，由于 <code>yukiyama</code> 的是 session 作用域下的属性值，因此在另一个浏览器中访问 <code>http://localhost:8080/demo09</code> ，打印的是 <code>null</code> 。</p>
<br />

<h4 id="web-context作用域"><a href="#web-context作用域" class="headerlink" title="web context作用域"></a>web context作用域</h4><p>在 <code>pro08-java-servlet</code> web子项目中创建 <code>Demo10Servlet</code> 和 <code>Demo11Servlet</code> 类演示 web context (application) 作用域。</p>
<p>在 <code>Demo10Servlet</code> 类的 <code>service</code> 方法内，向 web context 作用域中属性名为 <code>userName</code> 的数据，该数据 (属性值) 为字符串 <code>yukiyama</code> ，随后打印该字符串。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.servlets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 演示 web context (application) 作用域</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo10Servlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">ServletContext</span> <span class="variable">app</span> <span class="operator">=</span> req.getServletContext();</span><br><span class="line">        app.setAttribute(<span class="string">&quot;userName&quot;</span>, <span class="string">&quot;yukiyama&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">userName</span> <span class="operator">=</span> app.getAttribute(<span class="string">&quot;userName&quot;</span>);</span><br><span class="line">        System.out.println( <span class="string">&quot;demo10&quot;</span> + userName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>在 <code>Demo11Servlet</code> 类的 <code>service</code> 方法中获取 web context 后，从该 web context 作用域中，按属性名 <code>userName</code> 获取相应的数据 (属性值) 并打印。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.servlets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 演示 session 作用域</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo11Servlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">ServletContext</span> <span class="variable">app</span> <span class="operator">=</span> req.getServletContext();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">userName</span> <span class="operator">=</span> app.getAttribute(<span class="string">&quot;userName&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;demo11&quot;</span> + userName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><code>web.xml</code> 完成相关配置，运行该 web 子工程，在浏览器中首先访问 <code>http://localhost:8080/demo10</code> ，可以在 Tomcat 控制台看到打印了 <code>yukiyama</code> 。接着我们用另一个浏览器打开 <code>http://localhost:8080/demo11</code> ，可以看到 <code>yukiyama</code> 再次被打印。</p>
<p>只要该应用仍在运行，则处于该作用域的共享数据就一直能够获取到。</p>
<br />

<h3 id="路径问题"><a href="#路径问题" class="headerlink" title="路径问题"></a>路径问题</h3><p>在 webapp 下的某个 html 文件中，若引用其他路径下的资源文件，有相对路径与绝对路径写法，建议写为绝对路径。在 html 页面中使用 <code>base</code> 标签定义绝对路径，则该页面中的其他路径自动拼接到 <code>base</code> 标签定义的路径之后，形成绝对路径。</p>
<p><img src="/Users/lixueshan/Library/Application%20Support/typora-user-images/image-20221013214718528.png" alt="image-20221013214718528"></p>
<br />

<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>在 「HttpServlet」小结中我们通过一个示例观察了</p>
<br />

<p>标签含义如下。</p>
<table>
<thead>
<tr>
<th>标签</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p><img src="/Users/lixueshan/Library/Application%20Support/typora-user-images/image-20221011171815593.png" alt="image-20221011171815593"></p>
<h2 id="Thymeleaf"><a href="#Thymeleaf" class="headerlink" title="Thymeleaf"></a>Thymeleaf</h2><p><a target="_blank" rel="noopener" href="https://www.thymeleaf.org/">Thymeleaf</a> 是一种「视图模版」技术，支持在 Web 应用 (基于 servlet) 以及在非 Web 环境中工作。Thymeleaf 旨在完全取代 JSP，相比 JSP 的一大特点是实现了「自然模版 (natural tamplate)」，即利用 Thymeleaf 编写的 html 模版仍是一个 html 文件，且看起来以及工作起来均与 html 类似。当它工作在 Web 环境中时，能够动态渲染数据，在非 Web 环境中时就像静态 html 页面那样能够被浏览器解析。</p>
<br />

<h3 id="入门示例-1"><a href="#入门示例-1" class="headerlink" title="入门示例"></a>入门示例</h3><p>创建 <code>pro09-fruit4-thymeleaf</code> 子工程演示 Thymeleaf 的使用。</p>
<br />

<h4 id="引入Thymeleaf依赖"><a href="#引入Thymeleaf依赖" class="headerlink" title="引入Thymeleaf依赖"></a>引入Thymeleaf依赖</h4><p>首先在父工程中 <code>javaweb_in_action</code> 的 <code>pom.xml</code> 中引入 Thymeleaf 依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.thymeleaf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.12.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>接着在子工程子工程 <code>pro09-fruit4-thymeleaf</code> 的 <code>pom.xml</code> 中引用。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.thymeleaf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意 mysql-connector 要像之前一样手动加入 (在 <code>WEB-INF</code> 目录中添加 <code>lib</code> 文件夹，导入 <code>mysql-connector-java-8.0.11.jar</code>)。</p>
<br />

<h4 id="准备数据库-1"><a href="#准备数据库-1" class="headerlink" title="准备数据库"></a>准备数据库</h4><p>使用已在「Servlet」-「入门示例」-「准备数据库」中准备好的数据库 <code>fruitdb</code> 。</p>
<br />

<h4 id="编写浏览器页面-1"><a href="#编写浏览器页面-1" class="headerlink" title="编写浏览器页面"></a>编写浏览器页面</h4><p>编写如下 <code>index.html</code> 页面，放在 <code>webapp &gt; WEB-INF</code> 目录下。可以看到引入了 Thymeleaf 的命名空间，<code>th</code> 即为 Thymeleaf 标签。</p>
<p>此外还有相应的 css 与图片资源文件，均可在 <a target="_blank" rel="noopener" href="https://github.com/iyukiyama/javaweb_in_action">javaweb_in_action</a> 仓库中获取，此处不列出。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/index.css&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div_container&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div_fruit_list&quot;</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;center f30&quot;</span>&gt;</span>欢迎使用水果库存后台管理系统<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">&quot;tbl_fruit&quot;</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>单价<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>库存<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;#lists.isEmpty(session.fruitList)&#125;&quot;</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;4&quot;</span>&gt;</span>对不起，库存为空！<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:unless</span>=<span class="string">&quot;$&#123;#lists.isEmpty(session.fruitList)&#125;&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;fruit : $&#123;session.fruitList&#125;&quot;</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;fruit.fname&#125;&quot;</span>&gt;</span>苹果<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;fruit.price&#125;&quot;</span>&gt;</span>5<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;fruit.fcount&#125;&quot;</span>&gt;</span>20<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;imgs/del.jpg&quot;</span> <span class="attr">class</span>=<span class="string">&quot;delImg&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<br />

<h4 id="编写FruitDao相关类-1"><a href="#编写FruitDao相关类-1" class="headerlink" title="编写FruitDao相关类"></a>编写FruitDao相关类</h4><p>与已在「Servlet」-「入门示例」-「编写FruitDao相关类」写好的相关类类似，不在此处列出，相关文件可以在 <a target="_blank" rel="noopener" href="https://github.com/iyukiyama/javaweb_in_action">javaweb_in_action</a> 仓库中获取。</p>
<br />

<h4 id="编写IndexServlet"><a href="#编写IndexServlet" class="headerlink" title="编写IndexServlet"></a>编写IndexServlet</h4><p>如下是 Servlet 具体实现类 <code>IndexServlet</code> 。需要注意的是，这里继承的不是 <code>HttpServlet</code> 而是 <code>ViewBaseServlet</code> 。 <code>ViewBaseServlet</code> 来自 Thymeleaf 源码，该类继承了 <code>HttpServlet</code> 。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.fruit.servlets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yukiyama.fruit.dao.FruitDao;</span><br><span class="line"><span class="keyword">import</span> com.yukiyama.fruit.dao.impl.FruitDaoImpl;</span><br><span class="line"><span class="keyword">import</span> com.yukiyama.fruit.pojo.Fruit;</span><br><span class="line"><span class="keyword">import</span> com.yukiyama.myssm.myspringmvc.ViewBaseServlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Servlet 从 3.0 版本开始支持注解方式的注册</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexServlet</span> <span class="keyword">extends</span> <span class="title class_">ViewBaseServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">FruitDao</span> <span class="variable">fruitDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FruitDaoImpl</span>();</span><br><span class="line">        List&lt;Fruit&gt; fruitList = fruitDao.getFruitList();</span><br><span class="line">        <span class="comment">// 保存到 session 作用域</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> req.getSession();</span><br><span class="line">        session.setAttribute(<span class="string">&quot;fruitList&quot;</span>, fruitList);</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="built_in">super</span>.processTemplate(<span class="string">&quot;index&quot;</span>, req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><code>ViewBaseServlet</code> 类。</p>
<p>该类中的 <code>processTemplate</code> 方法完成资源转发与数据渲染。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.myssm.myspringmvc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.TemplateEngine;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.context.WebContext;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.templatemode.TemplateMode;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.templateresolver.ServletContextTemplateResolver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ViewBaseServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> TemplateEngine templateEngine;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        <span class="comment">// 1. 获取 ServletContext 对象</span></span><br><span class="line">        <span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> <span class="built_in">this</span>.getServletContext();</span><br><span class="line">        <span class="comment">// 2. 创建 Thymeleaf 解析器对象</span></span><br><span class="line">        <span class="type">ServletContextTemplateResolver</span> <span class="variable">templateResolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletContextTemplateResolver</span>(servletContext);</span><br><span class="line">        <span class="comment">// 3. 给解析器对象设置参数</span></span><br><span class="line">        <span class="comment">// ① HTML 是默认模式，明确设置是为了代码更容易理解</span></span><br><span class="line">        templateResolver.setTemplateMode(TemplateMode.HTML);</span><br><span class="line">        <span class="comment">// ② 设置前缀</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">viewPrefix</span> <span class="operator">=</span> servletContext.getInitParameter(<span class="string">&quot;view-prefix&quot;</span>);</span><br><span class="line">        templateResolver.setPrefix(viewPrefix);</span><br><span class="line">        <span class="comment">// ③ 设置后缀</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">viewSuffix</span> <span class="operator">=</span> servletContext.getInitParameter(<span class="string">&quot;view-suffix&quot;</span>);</span><br><span class="line">        templateResolver.setSuffix(viewSuffix);</span><br><span class="line">        <span class="comment">// ④ 设置缓存过期时间（毫秒）</span></span><br><span class="line">        templateResolver.setCacheTTLMs(<span class="number">60000L</span>);</span><br><span class="line">        <span class="comment">// ⑤ 设置是否缓存</span></span><br><span class="line">        templateResolver.setCacheable(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// ⑥ 设置服务器端编码方式</span></span><br><span class="line">        templateResolver.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        <span class="comment">// 4. 创建模板引擎对象</span></span><br><span class="line">        templateEngine = <span class="keyword">new</span> <span class="title class_">TemplateEngine</span>();</span><br><span class="line">        <span class="comment">// 5. 给模板引擎对象设置模板解析器</span></span><br><span class="line">        templateEngine.setTemplateResolver(templateResolver);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">processTemplate</span><span class="params">(String templateName, HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 1. 设置响应体内容类型和字符集</span></span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">        <span class="comment">// 2. 创建WebContext对象</span></span><br><span class="line">        <span class="type">WebContext</span> <span class="variable">webContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebContext</span>(req, resp, getServletContext());</span><br><span class="line">        <span class="comment">// 3. 处理模板数据</span></span><br><span class="line">        templateEngine.process(templateName, webContext, resp.getWriter());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br />

<h4 id="配置web-xml-1"><a href="#配置web-xml-1" class="headerlink" title="配置web.xml"></a>配置web.xml</h4><p>要将浏览器请求映射到具体的 Servlet 实现类，此前都是通过在 <code>web.xml</code> 中配置 <code>&lt;servlet&gt;</code> 以及 <code>&lt;servlet-mapping&gt;</code> 标签来完成。Servlet 3.0 版本开始支持 <strong>注解方式映射</strong> ，即在 Servlet 实现类上添加 <code>@WebServlet</code> 类注解完成与请求的映射，其 <code>value</code> 属性为请求路径字符串。在前面给出的 <code>IndexServlet</code> 中已写好。因此这部分配置无需借助 web.xml 完成。但需要在 web.xml  中配置「上下文参数」。</p>
<p>配置「上下文参数」，设置 <strong>视图前缀 (view-prefix)</strong> 与 <strong>视图后缀 (view-suffix)</strong> 。这两个参数在 <code>ViewBaseServlet</code> 类的 <code>init</code> 方法中被获取。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置上下文参数 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>view-prefix<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>/<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>view-suffix<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>.html<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<br />

<h4 id="配置Tomcat-1"><a href="#配置Tomcat-1" class="headerlink" title="配置Tomcat"></a>配置Tomcat</h4><p>请参考「Tomcat」-「部署应用」-「自动」。</p>
<br />

<h4 id="运行-1"><a href="#运行-1" class="headerlink" title="运行"></a>运行</h4><p>完成上述步骤后，<code>pro09-fruit4-thymeleaf</code> 子工程目录如下，相关的文件都可以在 <a target="_blank" rel="noopener" href="https://github.com/iyukiyama/javaweb_in_action">javaweb_in_action</a> 仓库中获取。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">pro09-fruit4-thymeleaf</span><br><span class="line">├── pom.xml</span><br><span class="line">└── src</span><br><span class="line">    └── main</span><br><span class="line">        ├── java</span><br><span class="line">        │   └── com</span><br><span class="line">        │       └── yukiyama</span><br><span class="line">        │           ├── fruit</span><br><span class="line">        │           │   ├── dao</span><br><span class="line">        │           │   │   ├── FruitDao.java</span><br><span class="line">        │           │   │   └── impl</span><br><span class="line">        │           │   │       └── FruitDaoImpl.java</span><br><span class="line">        │           │   ├── pojo</span><br><span class="line">        │           │   │   └── Fruit.java</span><br><span class="line">        │           │   └── servlets</span><br><span class="line">        │           │       └── IndexServlet.java</span><br><span class="line">        │           └── myssm</span><br><span class="line">        │               ├── basedao</span><br><span class="line">        │               │   └── BaseDAO.java</span><br><span class="line">        │               └── myspringmvc</span><br><span class="line">        │                   └── ViewBaseServlet.java</span><br><span class="line">        ├── resources</span><br><span class="line">        └── webapp</span><br><span class="line">            ├── WEB-INF</span><br><span class="line">            │   ├── lib</span><br><span class="line">            │   │   └── mysql-connector-java-8.0.11.jar</span><br><span class="line">            │   └── web.xml</span><br><span class="line">            ├── css</span><br><span class="line">            │   └── index.css</span><br><span class="line">            ├── imgs</span><br><span class="line">            │   └── del.jpg</span><br><span class="line">            └── index.html</span><br><span class="line"></span><br><span class="line">19 directories, 12 files</span><br></pre></td></tr></table></figure>



<p>至此，我们完成了实现目标功能所需的所有工作。运行该工程，浏览器自动弹出 <code>index.html</code> 页面。注意此时 URL 为 <code>http://localhost:8080/pro09/index</code> (无 <code>.html</code> 文件名后缀)，但能够打开 <code>index.html</code> 页面。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/javaweb_in_action/pro09_index.png" alt="pro09_index"></p>
<br />

<h3 id="编辑和更新示例"><a href="#编辑和更新示例" class="headerlink" title="编辑和更新示例"></a>编辑和更新示例</h3><p>创建 <code>pro10-fruit5-thymeleaf</code> 子工程，演示使用 Thymeleaf 编写 html 页面，实现在浏览器页面上编辑获取到的数据库信息，并将编辑后的结果更新到数据库中。</p>
<p>该子工程直接拷贝「入门示例」的 <code>pro09-fruit4-thymeleaf</code> ，并在此之上扩展。首先增加 <code>edit.html</code> 页面，使得点击 <code>index</code> 页面表格中的「名称」，例如「红富士」，可以跳转到「红富士」的编辑页面，编辑页面也为一表格，自动获取数据库中关于红富士的水果信息显示在文本框中，即「名称」、「价格」、「库存」、「备注」。编辑文本框修改字段后点击底部的「修改」按钮使修改反映到数据库中。预先展示编辑页面如下。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/javaweb_in_action/edit-page.png" alt="edit-page"></p>
<p>后续的「删除和添加示例」章节会继续在 <code>pro10-fruit5-thymeleaf</code> 子工程中演示增删条目、分页和按关键字查询的功能，预先列出完成这些演示后对应的后续的 <code>pro12-fruit7-keyword</code> 工程的文件结构，如下。所有文件均可在 <a target="_blank" rel="noopener" href="https://github.com/iyukiyama/javaweb_in_action">javaweb_in_action</a> 仓库中获取。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">pro12-fruit7-keyword</span><br><span class="line">├── pom.xml</span><br><span class="line">└── src</span><br><span class="line">    └── main</span><br><span class="line">        ├── java</span><br><span class="line">        │   └── com</span><br><span class="line">        │       └── yukiyama</span><br><span class="line">        │           ├── fruit</span><br><span class="line">        │           │   ├── dao</span><br><span class="line">        │           │   │   ├── FruitDao.java</span><br><span class="line">        │           │   │   └── impl</span><br><span class="line">        │           │   │       └── FruitDaoImpl.java</span><br><span class="line">        │           │   ├── pojo</span><br><span class="line">        │           │   │   └── Fruit.java</span><br><span class="line">        │           │   └── servlets</span><br><span class="line">        │           │       ├── AddServlet.java</span><br><span class="line">        │           │       ├── DelServlet.java</span><br><span class="line">        │           │       ├── EditServlet.java</span><br><span class="line">        │           │       ├── IndexServlet.java</span><br><span class="line">        │           │       └── UpdateServlet.java</span><br><span class="line">        │           └── myssm</span><br><span class="line">        │               ├── basedao</span><br><span class="line">        │               │   └── BaseDAO.java</span><br><span class="line">        │               ├── myspringmvc</span><br><span class="line">        │               │   └── ViewBaseServlet.java</span><br><span class="line">        │               └── util</span><br><span class="line">        │                   └── StringUtils.java</span><br><span class="line">        ├── resources</span><br><span class="line">        └── webapp</span><br><span class="line">            ├── WEB-INF</span><br><span class="line">            │   ├── lib</span><br><span class="line">            │   │   └── mysql-connector-java-8.0.11.jar</span><br><span class="line">            │   └── web.xml</span><br><span class="line">            ├── add.html</span><br><span class="line">            ├── css</span><br><span class="line">            │   ├── add.css</span><br><span class="line">            │   ├── edit.css</span><br><span class="line">            │   └── index.css</span><br><span class="line">            ├── edit.html</span><br><span class="line">            ├── imgs</span><br><span class="line">            │   └── del.jpg</span><br><span class="line">            ├── index.html</span><br><span class="line">            ├── js</span><br><span class="line">            │   └── index.js</span><br><span class="line">            └── web</span><br><span class="line">                └── WEB-INF</span><br><span class="line">                    └── web.xml</span><br><span class="line"></span><br><span class="line">23 directories, 23 files</span><br></pre></td></tr></table></figure>

<br />

<h4 id="引入Thymeleaf依赖-1"><a href="#引入Thymeleaf依赖-1" class="headerlink" title="引入Thymeleaf依赖"></a>引入Thymeleaf依赖</h4><p>同「入门示例」。父工程已引入，在子工程 <code>pro10-fruit5-thymeleaf</code> 的 <code>pom.xml</code> 中引入。mysql-connector 依赖的处理也同前。</p>
<br />

<h4 id="准备数据库-2"><a href="#准备数据库-2" class="headerlink" title="准备数据库"></a>准备数据库</h4><p>「入门示例」中已完成。</p>
<br />

<h4 id="编写浏览器页面-2"><a href="#编写浏览器页面-2" class="headerlink" title="编写浏览器页面"></a>编写浏览器页面</h4><h5 id="index-html"><a href="#index-html" class="headerlink" title="index.html"></a>index.html</h5><p>在「入门示例」的基础上主要多了如下一行。用于跳转到编辑页。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;fruit.fname&#125;&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/edit.do(fid=$&#123;fruit.fid&#125;)&#125;&quot;</span>&gt;</span>苹果<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p><code>index.html</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/index.css&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div_container&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div_fruit_list&quot;</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;center f30&quot;</span>&gt;</span>欢迎使用水果库存后台管理系统<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">&quot;tbl_fruit&quot;</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>单价<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>库存<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;#lists.isEmpty(session.fruitList)&#125;&quot;</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;4&quot;</span>&gt;</span>对不起，库存为空！<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:unless</span>=<span class="string">&quot;$&#123;#lists.isEmpty(session.fruitList)&#125;&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;fruit : $&#123;session.fruitList&#125;&quot;</span>&gt;</span></span><br><span class="line">						<span class="comment">&lt;!--  &lt;td&gt;&lt;a th:text=&quot;$&#123;fruit.fname&#125;&quot; th:href=&quot;@&#123;&#x27;/edit.do?fid=&#x27;+$&#123;fruit.fid&#125;&#125;&quot;&gt;苹果&lt;/a&gt;&lt;/td&gt;  --&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;fruit.fname&#125;&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/edit.do(fid=$&#123;fruit.fid&#125;)&#125;&quot;</span>&gt;</span>苹果<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;fruit.price&#125;&quot;</span>&gt;</span>5<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;fruit.fcount&#125;&quot;</span>&gt;</span>20<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;imgs/del.jpg&quot;</span> <span class="attr">class</span>=<span class="string">&quot;delImg&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<br />

<h5 id="edit-html"><a href="#edit-html" class="headerlink" title="edit.html"></a>edit.html</h5><p>编写如下 <code>edit.html</code> 页面，放在 <code>webapp &gt; WEB-INF</code> 目录下。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/edit.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div_container&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div_fruit_list&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;center f30&quot;</span>&gt;</span>编辑库存信息<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/update.do&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">th:object</span>=<span class="string">&quot;$&#123;fruit&#125;&quot;</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 隐藏域 ： 功能类似于文本框 ， 它的值会随着表单的发送也会发送给服务器，但是界面上用户看不到 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;fid&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;*&#123;fid&#125;&quot;</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">&quot;tbl_fruit&quot;</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>名称：<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">					<span class="comment">&lt;!-- &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;fname&quot; th:value=&quot;$&#123;fruit.fname&#125;&quot;/&gt;&lt;/td&gt; --&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;fname&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;*&#123;fname&#125;&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>单价：<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;price&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;*&#123;price&#125;&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>库存：<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;fcount&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;*&#123;fcount&#125;&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>备注：<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;remark&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;*&#123;remark&#125;&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">th</span> <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;修改&quot;</span> /&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<br />

<h4 id="编写FruitDao相关类-2"><a href="#编写FruitDao相关类-2" class="headerlink" title="编写FruitDao相关类"></a>编写FruitDao相关类</h4><p>「入门示例」中已完成。有部分调整，请参考仓库。</p>
<br />

<h4 id="编写Servlet具体实现类"><a href="#编写Servlet具体实现类" class="headerlink" title="编写Servlet具体实现类"></a>编写Servlet具体实现类</h4><h5 id="IndexServlet"><a href="#IndexServlet" class="headerlink" title="IndexServlet"></a>IndexServlet</h5><p>「入门示例」中已完成。</p>
<br />

<h5 id="EditServlet"><a href="#EditServlet" class="headerlink" title="EditServlet"></a>EditServlet</h5><p>与 <code>/edit.do</code> 绑定。</p>
<p>TODO：说明</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.fruit.servlets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yukiyama.fruit.dao.FruitDao;</span><br><span class="line"><span class="keyword">import</span> com.yukiyama.fruit.dao.impl.FruitDaoImpl;</span><br><span class="line"><span class="keyword">import</span> com.yukiyama.fruit.pojo.Fruit;</span><br><span class="line"><span class="keyword">import</span> com.yukiyama.myssm.myspringmvc.ViewBaseServlet;</span><br><span class="line"><span class="keyword">import</span> com.yukiyama.myssm.util.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/edit.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EditServlet</span> <span class="keyword">extends</span> <span class="title class_">ViewBaseServlet</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">FruitDao</span> <span class="variable">fruitDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FruitDaoImpl</span>();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">fidStr</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;fid&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isNotEmpty(fidStr))&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">fid</span> <span class="operator">=</span> Integer.parseInt(fidStr);</span><br><span class="line">            <span class="type">Fruit</span> <span class="variable">fruit</span> <span class="operator">=</span> fruitDao.getFruitByFid(fid);</span><br><span class="line">            req.setAttribute(<span class="string">&quot;fruit&quot;</span>, fruit);</span><br><span class="line">            <span class="built_in">super</span>.processTemplate(<span class="string">&quot;edit&quot;</span>, req, resp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br />

<h5 id="UpdateServlet"><a href="#UpdateServlet" class="headerlink" title="UpdateServlet"></a>UpdateServlet</h5><p>与 <code>/update.do</code> 绑定。</p>
<p>TODO：说明</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.fruit.servlets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yukiyama.fruit.dao.FruitDao;</span><br><span class="line"><span class="keyword">import</span> com.yukiyama.fruit.dao.impl.FruitDaoImpl;</span><br><span class="line"><span class="keyword">import</span> com.yukiyama.fruit.pojo.Fruit;</span><br><span class="line"><span class="keyword">import</span> com.yukiyama.myssm.myspringmvc.ViewBaseServlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/update.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UpdateServlet</span> <span class="keyword">extends</span> <span class="title class_">ViewBaseServlet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">FruitDao</span> <span class="variable">fruitDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FruitDaoImpl</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//1.设置编码</span></span><br><span class="line">        request.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.获取参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fidStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fid&quot;</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">fid</span> <span class="operator">=</span> Integer.parseInt(fidStr);</span><br><span class="line">        <span class="type">String</span> <span class="variable">fname</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fname&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">priceStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;price&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">price</span> <span class="operator">=</span> Integer.parseInt(priceStr);</span><br><span class="line">        <span class="type">String</span> <span class="variable">fcountStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fcount&quot;</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">fcount</span> <span class="operator">=</span> Integer.parseInt(fcountStr);</span><br><span class="line">        <span class="type">String</span> <span class="variable">remark</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;remark&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.执行更新</span></span><br><span class="line">        fruitDao.updateFruit(<span class="keyword">new</span> <span class="title class_">Fruit</span>(fid,fname, price ,fcount ,remark ));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.资源跳转</span></span><br><span class="line">        <span class="comment">//super.processTemplate(&quot;index&quot;,request,response); // 想到于跳转</span></span><br><span class="line">        <span class="comment">//request.getRequestDispatcher(&quot;index.html&quot;).forward(request,response);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//此处需要重定向，目的是重新给IndexServlet发请求，重新获取furitList，然后覆盖到session中，这样index.html页面上显示的session中的数据才是最新的</span></span><br><span class="line">        response.sendRedirect(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br />

<h4 id="配置web-xml-2"><a href="#配置web-xml-2" class="headerlink" title="配置web.xml"></a>配置web.xml</h4><p>同「入门示例」。</p>
<br />

<h4 id="配置Tomcat-2"><a href="#配置Tomcat-2" class="headerlink" title="配置Tomcat"></a>配置Tomcat</h4><p>方法同前，略。</p>
<br />

<h4 id="运行-2"><a href="#运行-2" class="headerlink" title="运行"></a>运行</h4><p>完成上述步骤后，运行 <code>pro10-fruit5-thymeleaf</code> 应用。浏览器自动弹出 <code>index.html</code> 页面。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/javaweb_in_action/pro10-index-link.png" alt="pro10-index-link"></p>
<p>可以看到所有「名称」都变为了链接，点击后跳转到编辑页。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/javaweb_in_action/edit-page.png" alt="edit-page"></p>
<p>编辑并提交后，回到 index 页面，这是通过 <code>UpdateServlet</code> 类 <code>doPost</code> 方法中的 <code>response.sendRedirect(&quot;index&quot;);</code> 做到的 。页面显示正确 (单价改成了 55，库存改成了 160) 。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/javaweb_in_action/after-added-index.png" alt="after-added-index"></p>
<p>接着查看到数据库，相关项确实更新了。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_fruit;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+-------+--------+--------------------------------+</span></span><br><span class="line"><span class="operator">|</span> fid <span class="operator">|</span> fname     <span class="operator">|</span> price <span class="operator">|</span> fcount <span class="operator">|</span> remark                         <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+-------+--------+--------------------------------+</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">1</span> <span class="operator">|</span> 红富士    <span class="operator">|</span>    <span class="number">55</span> <span class="operator">|</span>    <span class="number">160</span> <span class="operator">|</span> 红富士也是苹果！               <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">2</span> <span class="operator">|</span> 大瓜      <span class="operator">|</span>     <span class="number">5</span> <span class="operator">|</span>    <span class="number">100</span> <span class="operator">|</span> 王校长的瓜真香                 <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">3</span> <span class="operator">|</span> 南瓜      <span class="operator">|</span>     <span class="number">4</span> <span class="operator">|</span>    <span class="number">456</span> <span class="operator">|</span> 水果真好吃                     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">4</span> <span class="operator">|</span> 苦瓜      <span class="operator">|</span>     <span class="number">5</span> <span class="operator">|</span>     <span class="number">55</span> <span class="operator">|</span> 苦瓜很好吃                     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">5</span> <span class="operator">|</span> 莲雾      <span class="operator">|</span>     <span class="number">9</span> <span class="operator">|</span>     <span class="number">99</span> <span class="operator">|</span> 莲雾是一种神奇的水果           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">6</span> <span class="operator">|</span> 羊角蜜    <span class="operator">|</span>     <span class="number">4</span> <span class="operator">|</span>     <span class="number">30</span> <span class="operator">|</span> 羊角蜜是一种神奇的瓜           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">7</span> <span class="operator">|</span> 啃大瓜    <span class="operator">|</span>    <span class="number">13</span> <span class="operator">|</span>    <span class="number">123</span> <span class="operator">|</span> 孤瓜                           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">38</span> <span class="operator">|</span> apple     <span class="operator">|</span>    <span class="number">10</span> <span class="operator">|</span>    <span class="number">100</span> <span class="operator">|</span> apple added                    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+-------+--------+--------------------------------+</span></span><br><span class="line"><span class="number">8</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.04</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>

<br />

<h3 id="删除和添加示例"><a href="#删除和添加示例" class="headerlink" title="删除和添加示例"></a>删除和添加示例</h3><p>继续在 <code>pro10-fruit5-thymeleaf</code> 子工程中为库存系统增加「删除」和「新增」数据的功能。</p>
<br />

<h4 id="增加删除功能"><a href="#增加删除功能" class="headerlink" title="增加删除功能"></a>增加删除功能</h4><p>更新 <code>index.html</code>， 为删除 icon 添加点击事件。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/index.css&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&quot;JavaScript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;js/index.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div_container&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div_fruit_list&quot;</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;center f30&quot;</span>&gt;</span>欢迎使用水果库存后台管理系统<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">&quot;tbl_fruit&quot;</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>单价<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>库存<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;#lists.isEmpty(session.fruitList)&#125;&quot;</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;4&quot;</span>&gt;</span>对不起，库存为空！<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:unless</span>=<span class="string">&quot;$&#123;#lists.isEmpty(session.fruitList)&#125;&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;fruit : $&#123;session.fruitList&#125;&quot;</span>&gt;</span></span><br><span class="line">						<span class="comment">&lt;!--  &lt;td&gt;&lt;a th:text=&quot;$&#123;fruit.fname&#125;&quot; th:href=&quot;@&#123;&#x27;/edit.do?fid=&#x27;+$&#123;fruit.fid&#125;&#125;&quot;&gt;苹果&lt;/a&gt;&lt;/td&gt;  --&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;fruit.fname&#125;&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/edit.do(fid=$&#123;fruit.fid&#125;)&#125;&quot;</span>&gt;</span>苹果<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;fruit.price&#125;&quot;</span>&gt;</span>5<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;fruit.fcount&#125;&quot;</span>&gt;</span>20<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!--  &lt;td&gt;&lt;img src=&quot;imgs/del.jpg&quot; class=&quot;delImg&quot; th:onclick=&quot;&#x27;delFruit(&#x27;+$&#123;fruit.fid&#125;+&#x27;)&#x27;&quot;/&gt;&lt;/td&gt;  --&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;imgs/del.jpg&quot;</span> <span class="attr">class</span>=<span class="string">&quot;delImg&quot;</span> <span class="attr">th:onclick</span>=<span class="string">&quot;|delFruit($&#123;fruit.fid&#125;)|&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>其中， <code>index.js</code> 如下。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">delFruit</span>(<span class="params">fid</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_">confirm</span>(<span class="string">&#x27;是否确认删除？&#x27;</span>))&#123;</span><br><span class="line">        <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>=<span class="string">&#x27;del.do?fid=&#x27;</span>+fid;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br />

<h4 id="新增DelServlet实现类"><a href="#新增DelServlet实现类" class="headerlink" title="新增DelServlet实现类"></a>新增DelServlet实现类</h4><p>如下，新增 <code>DelServlet</code> 实现类。<code>FruitDao</code> 和 <code>FruitDaoImpl</code> 增加 <code>delFruit</code> 方法。</p>
<p>TODO：说明</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.fruit.servlets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yukiyama.fruit.dao.FruitDao;</span><br><span class="line"><span class="keyword">import</span> com.yukiyama.fruit.dao.impl.FruitDaoImpl;</span><br><span class="line"><span class="keyword">import</span> com.yukiyama.myssm.myspringmvc.ViewBaseServlet;</span><br><span class="line"><span class="keyword">import</span> com.yukiyama.myssm.util.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/del.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DelServlet</span> <span class="keyword">extends</span> <span class="title class_">ViewBaseServlet</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">FruitDao</span> <span class="variable">fruitDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FruitDaoImpl</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">fidStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fid&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isNotEmpty(fidStr))&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">fid</span> <span class="operator">=</span> Integer.parseInt(fidStr);</span><br><span class="line">            fruitDao.delFruit(fid);</span><br><span class="line">            response.sendRedirect(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>运行该子工程，点击最后一行的删除 icon，弹出提示信息，点击「OK」删除。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/javaweb_in_action/index-delete.png" alt="index-delete"></p>
<p>与编辑功能类似，删除后跳转回 index 页面，可以看到删除完成。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/javaweb_in_action/index-after-deletion.png" alt="index-after-deletion"></p>
<br />

<h4 id="增加新增功能"><a href="#增加新增功能" class="headerlink" title="增加新增功能"></a>增加新增功能</h4><p>继续在 <code>index.html</code> 中增加新增库存条目的功能，如下。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/index.css&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&quot;JavaScript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;js/index.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div_container&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div_fruit_list&quot;</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;center f30&quot;</span>&gt;</span>欢迎使用水果库存后台管理系统<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;border:0px solid red;width:60%;margin-left:20%;text-align:right;&quot;</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/add.html&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;border:0px solid blue;margin-bottom:4px;&quot;</span>&gt;</span>添加新库存记录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">&quot;tbl_fruit&quot;</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>单价<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>库存<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;#lists.isEmpty(session.fruitList)&#125;&quot;</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;4&quot;</span>&gt;</span>对不起，库存为空！<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:unless</span>=<span class="string">&quot;$&#123;#lists.isEmpty(session.fruitList)&#125;&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;fruit : $&#123;session.fruitList&#125;&quot;</span>&gt;</span></span><br><span class="line">						<span class="comment">&lt;!--  &lt;td&gt;&lt;a th:text=&quot;$&#123;fruit.fname&#125;&quot; th:href=&quot;@&#123;&#x27;/edit.do?fid=&#x27;+$&#123;fruit.fid&#125;&#125;&quot;&gt;苹果&lt;/a&gt;&lt;/td&gt;  --&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;fruit.fname&#125;&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/edit.do(fid=$&#123;fruit.fid&#125;)&#125;&quot;</span>&gt;</span>苹果<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;fruit.price&#125;&quot;</span>&gt;</span>5<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;fruit.fcount&#125;&quot;</span>&gt;</span>20<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!--  &lt;td&gt;&lt;img src=&quot;imgs/del.jpg&quot; class=&quot;delImg&quot; th:onclick=&quot;&#x27;delFruit(&#x27;+$&#123;fruit.fid&#125;+&#x27;)&#x27;&quot;/&gt;&lt;/td&gt;  --&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;imgs/del.jpg&quot;</span> <span class="attr">class</span>=<span class="string">&quot;delImg&quot;</span> <span class="attr">th:onclick</span>=<span class="string">&quot;|delFruit($&#123;fruit.fid&#125;)|&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<br />

<h4 id="新增AddServlet实现类"><a href="#新增AddServlet实现类" class="headerlink" title="新增AddServlet实现类"></a>新增AddServlet实现类</h4><p>如下，新增 <code>AddServlet</code> 实现类。<code>FruitDao</code> 和 <code>FruitDaoImpl</code> 增加 <code>addFruit</code> 方法。</p>
<p>TODO：说明</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.fruit.servlets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yukiyama.fruit.dao.FruitDao;</span><br><span class="line"><span class="keyword">import</span> com.yukiyama.fruit.dao.impl.FruitDaoImpl;</span><br><span class="line"><span class="keyword">import</span> com.yukiyama.fruit.pojo.Fruit;</span><br><span class="line"><span class="keyword">import</span> com.yukiyama.myssm.myspringmvc.ViewBaseServlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/add.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddServlet</span> <span class="keyword">extends</span> <span class="title class_">ViewBaseServlet</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">FruitDao</span> <span class="variable">fruitDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FruitDaoImpl</span>();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//1.设置编码</span></span><br><span class="line">        req.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.获取参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fname</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;fname&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">priceStr</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;price&quot;</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">price</span> <span class="operator">=</span> Integer.parseInt(priceStr);</span><br><span class="line">        <span class="type">String</span> <span class="variable">fcountStr</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;fcount&quot;</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">fcount</span> <span class="operator">=</span> Integer.parseInt(fcountStr);</span><br><span class="line">        <span class="type">String</span> <span class="variable">remark</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;remark&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Fruit</span> <span class="variable">fruit</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="number">0</span>, fname, price, fcount, remark);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.执行添加</span></span><br><span class="line">        fruitDao.addFruit(fruit);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.资源跳转</span></span><br><span class="line">        <span class="comment">//super.processTemplate(&quot;index&quot;,request,response); // 想到于跳转</span></span><br><span class="line">        <span class="comment">//request.getRequestDispatcher(&quot;index.html&quot;).forward(request,response);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//此处需要重定向，目的是重新给IndexServlet发请求，重新获取furitList，然后覆盖到session中，这样index.html页面上显示的session中的数据才是最新的</span></span><br><span class="line">        resp.sendRedirect(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>运行该子工程，可以看到 index 页表格右上角出现了「添加新库存记录」的可点击链接。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/javaweb_in_action/index-add.png" alt="index-add"></p>
<p>点击后跳转到新增库存信息编辑页面。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/javaweb_in_action/add-page.png" alt="add-page"></p>
<p>编辑后点击「添加」。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/javaweb_in_action/add-editing.png" alt="add-editing"></p>
<p>跳转到 index 页面，可以看到新增的库存信息已经更新到该页面表格中。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/javaweb_in_action/index-after-addition.png" alt="index-after-addition"></p>
<br />

<h3 id="分页示例"><a href="#分页示例" class="headerlink" title="分页示例"></a>分页示例</h3><p>复制一份 <code>pro10-fruit5-thymeleaf</code> ，重命名为 <code>pro11-fruit6-pagination</code> ，使用此子工程中为库存系统增加表格分页展示的功能。</p>
<br />

<h4 id="增加分页功能"><a href="#增加分页功能" class="headerlink" title="增加分页功能"></a>增加分页功能</h4><p>更新 <code>index.html</code>， 在 <code>&lt;table&gt;</code> 标签下新增分页用的按钮，并设置点击事件。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/index.css&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&quot;JavaScript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;js/index.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div_container&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div_fruit_list&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;center f30&quot;</span>&gt;</span>欢迎使用水果库存后台管理系统<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;border:0px solid red;width:60%;margin-left:20%;text-align:right;&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/add.html&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;border:0px solid blue;margin-bottom:4px;&quot;</span>&gt;</span>添加新库存记录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">&quot;tbl_fruit&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>名称1<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>单价<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>库存<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;#lists.isEmpty(session.fruitList)&#125;&quot;</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;4&quot;</span>&gt;</span>对不起，库存为空！<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:unless</span>=<span class="string">&quot;$&#123;#lists.isEmpty(session.fruitList)&#125;&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;fruit : $&#123;session.fruitList&#125;&quot;</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- &lt;td&gt;&lt;a th:text=&quot;$&#123;fruit.fname&#125;&quot; th:href=&quot;@&#123;&#x27;/edit.do?fid=&#x27;+$&#123;fruit.fid&#125;&#125;&quot;&gt;苹果&lt;/a&gt;&lt;/td&gt; --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;fruit.fname&#125;&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/edit.do(fid=$&#123;fruit.fid&#125;)&#125;&quot;</span>&gt;</span>苹果<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;fruit.price&#125;&quot;</span>&gt;</span>5<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;fruit.fcount&#125;&quot;</span>&gt;</span>20<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- &lt;td&gt;&lt;img src=&quot;imgs/del.jpg&quot; class=&quot;delImg&quot; th:onclick=&quot;&#x27;delFruit(&#x27;+$&#123;fruit.fid&#125;+&#x27;)&#x27;&quot;/&gt;&lt;/td&gt; --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;imgs/del.jpg&quot;</span> <span class="attr">class</span>=<span class="string">&quot;delImg&quot;</span> <span class="attr">th:onclick</span>=<span class="string">&quot;|delFruit($&#123;fruit.fid&#125;)|&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;width:60%;margin-left:20%;border:0px solid red;padding-top:4px;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;首  页&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span> <span class="attr">th:onclick</span>=<span class="string">&quot;|page(1)|&quot;</span> <span class="attr">th:disabled</span>=<span class="string">&quot;$&#123;session.pageNo==1&#125;&quot;</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;上一页&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span> <span class="attr">th:onclick</span>=<span class="string">&quot;|page($&#123;session.pageNo-1&#125;)|&quot;</span> <span class="attr">th:disabled</span>=<span class="string">&quot;$&#123;session.pageNo==1&#125;&quot;</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;下一页&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span> <span class="attr">th:onclick</span>=<span class="string">&quot;|page($&#123;session.pageNo+1&#125;)|&quot;</span> <span class="attr">th:disabled</span>=<span class="string">&quot;$&#123;session.pageNo==session.pageCount&#125;&quot;</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;尾  页&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span> <span class="attr">th:onclick</span>=<span class="string">&quot;|page($&#123;session.pageCount&#125;)|&quot;</span> <span class="attr">th:disabled</span>=<span class="string">&quot;$&#123;session.pageNo==session.pageCount&#125;&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>为实现分页，<code>IndexServlet</code> 的 <code>doGet</code> 方法以及 <code>FruitDao</code>, <code>FruitDaoImpl</code> 都需要相应新增一些内容，详细请看代码文件。</p>
<p>完成修改后运行工程，可以看到如下分页效果。四个按钮的状态和点击后的效果也如预期。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/javaweb_in_action/index-pagination.png" alt="index-pagination"></p>
<br />

<h3 id="查询示例"><a href="#查询示例" class="headerlink" title="查询示例"></a>查询示例</h3><p>复制一份 <code>pro11-fruit6-pagination</code> ，重命名为 <code>pro12-fruit7-keyword</code> ，使用此子工程中为库存系统增加按关键字查询功能。</p>
<br />

<h4 id="增加查询功能"><a href="#增加查询功能" class="headerlink" title="增加查询功能"></a>增加查询功能</h4><p>更新 <code>index.html</code>， 新增查询用的关键字文本框和按钮。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/index.css&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&quot;JavaScript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;js/index.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div_container&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div_fruit_list&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;center f30&quot;</span>&gt;</span>欢迎使用水果库存后台管理系统<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;border:0px solid red;width:60%;margin-left:20%;text-align:right;&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/index&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">style</span>=<span class="string">&quot;float:left;width:60%;margin-left:20%;&quot;</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;oper&quot;</span> <span class="attr">value</span>=<span class="string">&quot;search&quot;</span>/&gt;</span></span><br><span class="line">				请输入关键字：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;keyword&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;session.keyword&#125;&quot;</span>/&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;查询&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/add.html&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;border:0px solid blue;margin-bottom:4px;&quot;</span>&gt;</span>添加新库存记录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">&quot;tbl_fruit&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>单价<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;w20&quot;</span>&gt;</span>库存<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;#lists.isEmpty(session.fruitList)&#125;&quot;</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;4&quot;</span>&gt;</span>对不起，库存为空！<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:unless</span>=<span class="string">&quot;$&#123;#lists.isEmpty(session.fruitList)&#125;&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;fruit : $&#123;session.fruitList&#125;&quot;</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- &lt;td&gt;&lt;a th:text=&quot;$&#123;fruit.fname&#125;&quot; th:href=&quot;@&#123;&#x27;/edit.do?fid=&#x27;+$&#123;fruit.fid&#125;&#125;&quot;&gt;苹果&lt;/a&gt;&lt;/td&gt; --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;fruit.fname&#125;&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/edit.do(fid=$&#123;fruit.fid&#125;)&#125;&quot;</span>&gt;</span>苹果<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;fruit.price&#125;&quot;</span>&gt;</span>5<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;fruit.fcount&#125;&quot;</span>&gt;</span>20<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- &lt;td&gt;&lt;img src=&quot;imgs/del.jpg&quot; class=&quot;delImg&quot; th:onclick=&quot;&#x27;delFruit(&#x27;+$&#123;fruit.fid&#125;+&#x27;)&#x27;&quot;/&gt;&lt;/td&gt; --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;imgs/del.jpg&quot;</span> <span class="attr">class</span>=<span class="string">&quot;delImg&quot;</span> <span class="attr">th:onclick</span>=<span class="string">&quot;|delFruit($&#123;fruit.fid&#125;)|&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;width:60%;margin-left:20%;border:0px solid red;padding-top:4px;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;首  页&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span> <span class="attr">th:onclick</span>=<span class="string">&quot;|page(1)|&quot;</span> <span class="attr">th:disabled</span>=<span class="string">&quot;$&#123;session.pageNo==1&#125;&quot;</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;上一页&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span> <span class="attr">th:onclick</span>=<span class="string">&quot;|page($&#123;session.pageNo-1&#125;)|&quot;</span> <span class="attr">th:disabled</span>=<span class="string">&quot;$&#123;session.pageNo==1&#125;&quot;</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;下一页&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span> <span class="attr">th:onclick</span>=<span class="string">&quot;|page($&#123;session.pageNo+1&#125;)|&quot;</span> <span class="attr">th:disabled</span>=<span class="string">&quot;$&#123;session.pageNo==session.pageCount&#125;&quot;</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;尾  页&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span> <span class="attr">th:onclick</span>=<span class="string">&quot;|page($&#123;session.pageCount&#125;)|&quot;</span> <span class="attr">th:disabled</span>=<span class="string">&quot;$&#123;session.pageNo==session.pageCount&#125;&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>为实现关键字查询，<code>IndexServlet</code> 的需要新增 <code>doPost</code> 方法 (内部调用 <code>doGet</code> 方法)， <code>doGet</code> 方法以及 <code>FruitDao</code>, <code>FruitDaoImpl</code> 都需要相应修改一些内容，详细请看代码文件。</p>
<p>完成修改后运行工程，可以看到如下关键字查询框如下，查询效果也符合预期。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/javaweb_in_action/index-keyword.png" alt="index-keyword"></p>
<br />

<h2 id="MVC"><a href="#MVC" class="headerlink" title="MVC"></a>MVC</h2><p>MVC : Model（模型）、View（视图）、Controller（控制器）<br>视图层：用于做数据展示以及和用户交互的一个界面<br>控制层：能够接受客户端的请求，具体的业务功能还是需要借助于模型组件来完成<br>模型层：模型分为很多种：有比较简单的pojo&#x2F;vo(value object)，有业务模型组件，有数据访问层组件</p>
<ol>
<li><p>pojo &#x2F; vo : 值对象</p>
</li>
<li><p>DAO ： 数据访问对象</p>
</li>
<li><p>BO ： 业务对象</p>
</li>
<li><p>区分业务对象和数据访问对象：<br>  1） DAO中的方法都是单精度方法或者称之为细粒度方法。什么叫单精度？一个方法只考虑一个操作，比如添加，那就是insert操作、查询那就是select操作….<br>2） BO中的方法属于业务方法，也实际的业务是比较复杂的，因此业务方法的粒度是比较粗的<br>   注册这个功能属于业务功能，也就是说注册这个方法属于业务方法。<br>   那么这个业务方法中包含了多个DAO方法。也就是说注册这个业务功能需要通过多个DAO方法的组合调用，从而完成注册功能的开发。<br>   注册：<br>     1. 检查用户名是否已经被注册 - DAO中的select操作<br>            2. 向用户表新增一条新用户记录 - DAO中的insert操作<br>            3. 向用户积分表新增一条记录（新用户默认初始化积分100分） - DAO中的insert操作<br>                   4. 向系统消息表新增一条记录（某某某新用户注册了，需要根据通讯录信息向他的联系人推送消息） - DAO中的insert操作<br>                   5. 向系统日志表新增一条记录（某用户在某IP在某年某月某日某时某分某秒某毫秒注册） - DAO中的insert操作<br>                          6. ….</p>
</li>
<li><p>在库存系统中添加业务层组件</p>
</li>
</ol>
<br />

<h3 id="优化一：引入-Controller"><a href="#优化一：引入-Controller" class="headerlink" title="优化一：引入 Controller"></a>优化一：引入 Controller</h3><p>复制 <code>pro12-fruit7-keyword</code> 子工程，更名为 <code>pro13-fruit8-mvc</code> ，在此基础上优化原有代码，将多个 Servlet 具体实现类的功能集中于一个 FruitServlet 实现类中。FruitServlet 实际上对应的是 MVC 结构中的 Controller 。</p>
<br />

<h4 id="FruitServlet"><a href="#FruitServlet" class="headerlink" title="FruitServlet"></a>FruitServlet</h4><p>将 <code>IndexServlet</code>, <code>AddServlet</code>, <code>EditServlet</code>, <code>DelServlet</code>, <code>UpdateServlet</code> 的主要方法 (<code>doGet</code>, <code>doPost</code>) 都写入一个新建的 <code>FruitServlet</code> 类中，分别对应 <code>index</code>, <code>add</code>, <code>edit</code>, <code>del</code>, <code>update</code> 方法。在该类中的 <code>service</code> 方法中使用 <code>switch-case</code> 来将具体请求匹配执行具体方法。</p>
<p>这样即可由 <code>FruitServlet</code> 这一个 servlet 来取代之前的多个 servlet ，此一设计正是 controller (控制器) 的概念，即一个控制器对应一个模块的功能。仍以水果库存系统为例，该系统可以存在多个功能模块，例如「用户注册登陆」模块，「用户权限管理」模块等，每个模块对应一个 Controller，由 Controller 调用具体的方法处理对应模块的具体请求。</p>
<p>TODO: 图</p>
<p>本例是「水果库存信息」模块，负责水果库存信息的增删改查等功能，具体的增删改查操作由此控制器通过调用对应的方法执行。</p>
<p>在后续的优化中我们会看到在浏览器和 Controller 之间还会设置一个「中央控制器」用于统一调度所有请求，根据请求信息将其分配到不同的 Controller 。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.fruit.servlets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yukiyama.fruit.dao.FruitDao;</span><br><span class="line"><span class="keyword">import</span> com.yukiyama.fruit.dao.impl.FruitDaoImpl;</span><br><span class="line"><span class="keyword">import</span> com.yukiyama.fruit.pojo.Fruit;</span><br><span class="line"><span class="keyword">import</span> com.yukiyama.myssm.myspringmvc.ViewBaseServlet;</span><br><span class="line"><span class="keyword">import</span> com.yukiyama.myssm.util.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/fruit.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FruitServlet</span> <span class="keyword">extends</span> <span class="title class_">ViewBaseServlet</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">FruitDao</span> <span class="variable">fruitDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FruitDaoImpl</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        req.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">operate</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;operate&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(operate))&#123;</span><br><span class="line">            operate = <span class="string">&quot;index&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">switch</span> (operate)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;index&quot;</span>:</span><br><span class="line">                index(req, resp);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;add&quot;</span>:</span><br><span class="line">                add(req, resp);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;del&quot;</span>:</span><br><span class="line">                del(req, resp);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;edit&quot;</span>:</span><br><span class="line">                edit(req, resp);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;update&quot;</span>:</span><br><span class="line">                update(req, resp);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;operate值非法&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//1.设置编码</span></span><br><span class="line">        request.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.获取参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fidStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fid&quot;</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">fid</span> <span class="operator">=</span> Integer.parseInt(fidStr);</span><br><span class="line">        <span class="type">String</span> <span class="variable">fname</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fname&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">priceStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;price&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">price</span> <span class="operator">=</span> Integer.parseInt(priceStr);</span><br><span class="line">        <span class="type">String</span> <span class="variable">fcountStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fcount&quot;</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">fcount</span> <span class="operator">=</span> Integer.parseInt(fcountStr);</span><br><span class="line">        <span class="type">String</span> <span class="variable">remark</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;remark&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.执行更新</span></span><br><span class="line">        fruitDao.updateFruit(<span class="keyword">new</span> <span class="title class_">Fruit</span>(fid,fname, price ,fcount ,remark ));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.资源跳转</span></span><br><span class="line">        <span class="comment">//super.processTemplate(&quot;index&quot;,request,response); // 想到于跳转</span></span><br><span class="line">        <span class="comment">//request.getRequestDispatcher(&quot;index.html&quot;).forward(request,response);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//此处需要重定向，目的是重新给IndexServlet发请求，重新获取furitList，然后覆盖到session中，这样index.html页面上显示的session中的数据才是最新的</span></span><br><span class="line">        response.sendRedirect(<span class="string">&quot;fruit.do&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">edit</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">fidStr</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;fid&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isNotEmpty(fidStr))&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">fid</span> <span class="operator">=</span> Integer.parseInt(fidStr);</span><br><span class="line">            <span class="type">Fruit</span> <span class="variable">fruit</span> <span class="operator">=</span> fruitDao.getFruitByFid(fid);</span><br><span class="line">            req.setAttribute(<span class="string">&quot;fruit&quot;</span>, fruit);</span><br><span class="line">            <span class="built_in">super</span>.processTemplate(<span class="string">&quot;edit&quot;</span>, req, resp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">del</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">fidStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fid&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isNotEmpty(fidStr))&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">fid</span> <span class="operator">=</span> Integer.parseInt(fidStr);</span><br><span class="line">            fruitDao.delFruit(fid);</span><br><span class="line">            response.sendRedirect(<span class="string">&quot;fruit.do&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">operate</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;operate&quot;</span>);</span><br><span class="line">            <span class="comment">//1.设置编码</span></span><br><span class="line">            req.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//2.获取参数</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">fname</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;fname&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">priceStr</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;price&quot;</span>);</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">price</span> <span class="operator">=</span> Integer.parseInt(priceStr);</span><br><span class="line">            <span class="type">String</span> <span class="variable">fcountStr</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;fcount&quot;</span>);</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">fcount</span> <span class="operator">=</span> Integer.parseInt(fcountStr);</span><br><span class="line">            <span class="type">String</span> <span class="variable">remark</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;remark&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">Fruit</span> <span class="variable">fruit</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="number">0</span>, fname, price, fcount, remark);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//3.执行添加</span></span><br><span class="line">            fruitDao.addFruit(fruit);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//4.资源跳转</span></span><br><span class="line">            <span class="comment">//super.processTemplate(&quot;index&quot;,request,response); // 想到于跳转</span></span><br><span class="line">            <span class="comment">//request.getRequestDispatcher(&quot;index.html&quot;).forward(request,response);</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//此处需要重定向，目的是重新给IndexServlet发请求，重新获取furitList，然后覆盖到session中，这样index.html页面上显示的session中的数据才是最新的</span></span><br><span class="line">            resp.sendRedirect(<span class="string">&quot;fruit.do&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">index</span><span class="params">(HttpServletRequest req , HttpServletResponse resp)</span><span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> req.getSession() ;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">pageNo</span> <span class="operator">=</span> <span class="number">1</span> ;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">oper</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;oper&quot;</span>);</span><br><span class="line">        <span class="comment">//如果oper!=null 说明 通过表单的查询按钮点击过来的</span></span><br><span class="line">        <span class="comment">//如果oper是空的，说明 不是通过表单的查询按钮点击过来的</span></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">keyword</span> <span class="operator">=</span> <span class="literal">null</span> ;</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isNotEmpty(oper) &amp;&amp; <span class="string">&quot;search&quot;</span>.equals(oper))&#123;</span><br><span class="line">            <span class="comment">//说明是点击表单查询发送过来的请求</span></span><br><span class="line">            <span class="comment">//此时，pageNo应该还原为1 ， keyword应该从请求参数中获取</span></span><br><span class="line">            pageNo = <span class="number">1</span> ;</span><br><span class="line">            keyword = req.getParameter(<span class="string">&quot;keyword&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(StringUtils.isEmpty(keyword))&#123;</span><br><span class="line">                keyword = <span class="string">&quot;&quot;</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">            session.setAttribute(<span class="string">&quot;keyword&quot;</span>,keyword);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//说明此处不是点击表单查询发送过来的请求（比如点击下面的上一页下一页或者直接在地址栏输入网址）</span></span><br><span class="line">            <span class="comment">//此时keyword应该从session作用域获取</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">pageNoStr</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;pageNo&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(StringUtils.isNotEmpty(pageNoStr))&#123;</span><br><span class="line">                pageNo = Integer.parseInt(pageNoStr);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">keywordObj</span> <span class="operator">=</span> session.getAttribute(<span class="string">&quot;keyword&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(keywordObj!=<span class="literal">null</span>)&#123;</span><br><span class="line">                keyword = (String)keywordObj ;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                keyword = <span class="string">&quot;&quot;</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        session.setAttribute(<span class="string">&quot;pageNo&quot;</span>,pageNo);</span><br><span class="line"></span><br><span class="line">        <span class="type">FruitDao</span> <span class="variable">fruitDAO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FruitDaoImpl</span>();</span><br><span class="line">        List&lt;Fruit&gt; fruitList = fruitDAO.getFruitList(keyword , pageNo);</span><br><span class="line"></span><br><span class="line">        session.setAttribute(<span class="string">&quot;fruitList&quot;</span>,fruitList);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//总记录条数</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">fruitCount</span> <span class="operator">=</span> fruitDAO.getFruitCount(keyword);</span><br><span class="line">        <span class="comment">//总页数</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">pageCount</span> <span class="operator">=</span> (fruitCount+ <span class="number">2</span> -<span class="number">1</span>) / <span class="number">2</span> ;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        总记录条数       总页数</span></span><br><span class="line"><span class="comment">        1               1</span></span><br><span class="line"><span class="comment">        5               1</span></span><br><span class="line"><span class="comment">        6               2</span></span><br><span class="line"><span class="comment">        10              2</span></span><br><span class="line"><span class="comment">        11              3</span></span><br><span class="line"><span class="comment">        fruitCount      (fruitCount+5-1)/5</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        session.setAttribute(<span class="string">&quot;pageCount&quot;</span>,pageCount);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//此处的视图名称是 index</span></span><br><span class="line">        <span class="comment">//那么thymeleaf会将这个 逻辑视图名称 对应到 物理视图 名称上去</span></span><br><span class="line">        <span class="comment">//逻辑视图名称 ：   index</span></span><br><span class="line">        <span class="comment">//物理视图名称 ：   view-prefix + 逻辑视图名称 + view-suffix</span></span><br><span class="line">        <span class="comment">//所以真实的视图名称是：      /       index       .html</span></span><br><span class="line">        <span class="built_in">super</span>.processTemplate(<span class="string">&quot;index&quot;</span>,req,resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br />

<h4 id="其他修改"><a href="#其他修改" class="headerlink" title="其他修改"></a>其他修改</h4><p>由于引入了 <code>FruitServlet</code> ，对应的请求为 <code>fruit.do</code> ，与此相关的各处 js, html 文件均要相应修改，具体请看源文件。</p>
<p>完成修改后运行，效果与修改前一致，不再展示。</p>
<br />

<h3 id="优化二：利用反射"><a href="#优化二：利用反射" class="headerlink" title="优化二：利用反射"></a>优化二：利用反射</h3><p>在 <code>FruitServlet</code> 的 <code>service</code> 中使用了 <code>switch-case</code> 来匹配请求与处理该请求的方法，不同的请求越多，<code>switch-case</code> 就会越长，更重要的是，让需要新增一个请求时，必须新增一个 case，不符合开闭原则。我们可以使用反射技术来实现 <code>switch-case</code> 的功能。</p>
<p>拷贝 <code>pro13-fruit8-mvc</code> 子项目，更名为 <code>pro14-fruit9-mvc-reflection</code> ，在此子项目中实现本节优化。</p>
<br />

<h4 id="反射"><a href="#反射" class="headerlink" title="反射"></a>反射</h4><p>在 <code>FruitServlet</code> 中将 <code>service</code> 方法修改为如下。通过反射获取具体的方法名，根据 operate 的名称与方法名称的匹配关系通过 <code>method.invoke()</code> 执行对应的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    req.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">operate</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;operate&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(StringUtils.isEmpty(operate))&#123;</span><br><span class="line">        operate = <span class="string">&quot;index&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 获取当前类的所有方法</span></span><br><span class="line">    Method[] methods = <span class="built_in">this</span>.getClass().getDeclaredMethods();</span><br><span class="line">    <span class="keyword">for</span> (Method method : methods)&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> method.getName();</span><br><span class="line">        <span class="keyword">if</span>(operate.equals(methodName))&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                method.invoke(<span class="built_in">this</span>, req,resp);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;operate值非法&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br />

<h3 id="优化三：DispatcherServlet"><a href="#优化三：DispatcherServlet" class="headerlink" title="优化三：DispatcherServlet"></a>优化三：DispatcherServlet</h3><p>在「优化一」中我们提到过系统中的多个功能模块对应多个 Controller ，可以在浏览器请求发起端和 Controller 之间再设计一个「中央控制器」，用于统一调度所有请求。此「中央控制器」是一个 servlet，即 <code>DispatcherServlet</code> 。见名知义，该 servlet 是一个针对请求的 <code>dispatcher</code> (分派器) 。在「优化二」中，我们利用反射技术代替了 <code>FruitServlet</code> 中不符合开闭原则的 <code>switch-case</code> 写法，但对于每一个 servlet (即 controller) ，都需要同样的反射代码，因此 <code>DispatcherServlet</code> 的另一个作用是可以在其中实现反射代码，而不必在每一个 controller 中重复实现。</p>
<p>拷贝 <code>pro14-fruit9-mvc-reflection</code> 子项目，更名为 <code>pro15-fruit10-mvc-dispatcherServlet</code> ，在此子项目中实现本节优化。</p>
<br />

<h4 id="DispatcherServlet"><a href="#DispatcherServlet" class="headerlink" title="DispatcherServlet"></a>DispatcherServlet</h4><p>如下 <code>DispacherServlet</code> 的实现，可知其工作流程如下。</p>
<ol>
<li>类注解 <code>@WebServlet(&quot;*.do&quot;)</code> 表示处理所有请求。</li>
<li>当 Web 服务器 (Tomcat) 接受到请求后，调用 <code>DispatcherServlet</code> 的 <code>init</code> 方法，解析 <code>applicationCOntext.xml</code> 文件，获取 xml 文件所有 <code>&lt;bean&gt;</code> 标签中的 <code>id</code> 和 <code>class</code>，通过反射创建所有 <code>class</code> 对应的类对象实例 (即 Controller 对象实例)，将 <code>id</code> 作为 key，对象实例作为 value ，放入对象容器中 (map) 。</li>
<li>执行 <code>service</code> ，通过 <code>req.getServletPath()</code> 方法获取到的 URL 中的请求目的地名，如 <code>/hello.do</code> ，解析出 <code>hello</code> 。通过 <code>req.getParameter()</code> 获取到请求动作名 (如 <code>edit</code>) 。由 <code>hello</code> 从 bean 容器 map 中获取相应的 Controller 对象 <code>controllerBeanObj</code> ，再由 <code>controllerBeanObj.getClass().getDeclaredMethod</code> 反射方法和已经得到的 <code>edit</code> 来最终执行对应浏览器请求的方法。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.myssm.myspringmvc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yukiyama.myssm.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.Document;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.Element;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.Node;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.NodeList;</span><br><span class="line"><span class="keyword">import</span> org.xml.sax.SAXException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.xml.parsers.DocumentBuilder;</span><br><span class="line"><span class="keyword">import</span> javax.xml.parsers.DocumentBuilderFactory;</span><br><span class="line"><span class="keyword">import</span> javax.xml.parsers.ParserConfigurationException;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;*.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DispatcherServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; beanMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DispatcherServlet</span><span class="params">()</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> getClass().getClassLoader().getResourceAsStream(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">            <span class="comment">//1.创建DocumentBuilderFactory</span></span><br><span class="line">            <span class="type">DocumentBuilderFactory</span> <span class="variable">documentBuilderFactory</span> <span class="operator">=</span> DocumentBuilderFactory.newInstance();</span><br><span class="line">            <span class="comment">//2.创建DocumentBuilder对象</span></span><br><span class="line">            <span class="type">DocumentBuilder</span> <span class="variable">documentBuilder</span> <span class="operator">=</span> documentBuilderFactory.newDocumentBuilder() ;</span><br><span class="line">            <span class="comment">//3.创建Document对象</span></span><br><span class="line">            <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> documentBuilder.parse(inputStream);</span><br><span class="line">            <span class="comment">//4.获取所有的bean节点</span></span><br><span class="line">            <span class="type">NodeList</span> <span class="variable">beanNodeList</span> <span class="operator">=</span> document.getElementsByTagName(<span class="string">&quot;bean&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i&lt;beanNodeList.getLength() ; i++)&#123;</span><br><span class="line">                <span class="type">Node</span> <span class="variable">beanNode</span> <span class="operator">=</span> beanNodeList.item(i);</span><br><span class="line">                <span class="keyword">if</span>(beanNode.getNodeType() == Node.ELEMENT_NODE)&#123;</span><br><span class="line">                    <span class="type">Element</span> <span class="variable">beanElement</span> <span class="operator">=</span> (Element)beanNode ;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">beanId</span> <span class="operator">=</span>  beanElement.getAttribute(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">                    <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> beanElement.getAttribute(<span class="string">&quot;class&quot;</span>);</span><br><span class="line">                    <span class="type">Class</span> <span class="variable">controllerBeanClass</span> <span class="operator">=</span> Class.forName(className);</span><br><span class="line">                    <span class="type">Object</span> <span class="variable">beanObj</span> <span class="operator">=</span> controllerBeanClass.newInstance() ;</span><br><span class="line">                    <span class="type">Method</span> <span class="variable">setServletContextMethod</span> <span class="operator">=</span> controllerBeanClass.getDeclaredMethod(<span class="string">&quot;setServletContext&quot;</span>, ServletContext.class);</span><br><span class="line">                    setServletContextMethod.invoke(beanObj , <span class="built_in">this</span>.getServletContext());</span><br><span class="line">                    beanMap.put(beanId , beanObj) ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParserConfigurationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SAXException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 设置编码</span></span><br><span class="line">        req.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="comment">// 若 url 为: http://localhost:8080/pro15/hello.do</span></span><br><span class="line">        <span class="comment">// 则 servletPath = &quot;/hello.do&quot;</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">servletPath</span> <span class="operator">=</span> req.getServletPath();</span><br><span class="line">        servletPath = servletPath.substring(<span class="number">1</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">lastDotIndex</span> <span class="operator">=</span> servletPath.lastIndexOf(<span class="string">&quot;.do&quot;</span>);</span><br><span class="line">        servletPath = servletPath.substring(<span class="number">0</span>, lastDotIndex);</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">controllerBeanObj</span> <span class="operator">=</span> beanMap.get(servletPath);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">operate</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;operate&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(operate))&#123;</span><br><span class="line">            operate = <span class="string">&quot;index&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> controllerBeanObj.getClass().getDeclaredMethod(operate, HttpServletRequest.class, HttpServletResponse.class);</span><br><span class="line">            method.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">if</span>(method != <span class="literal">null</span>)&#123;</span><br><span class="line">                method.invoke(controllerBeanObj, req, resp);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;operate值非法&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br />

<h4 id="applicationContext-xml"><a href="#applicationContext-xml" class="headerlink" title="applicationContext.xml"></a>applicationContext.xml</h4><p>在 <code>resources</code> 文件夹中新建 <code>applicationContext.xml</code> 文件，用于配置 bean (即 Java 类) 。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;fruit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yukiyama.fruit.controllers.FruitController&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<br />

<h4 id="FruitController"><a href="#FruitController" class="headerlink" title="FruitController"></a>FruitController</h4><p>将原先的 <code>FruitServlet</code> 改名为 <code>FruitController</code> ，其所在包名也从 <code>servlets</code> 改成 <code>controllers</code> 。由于所有请求均由 <code>DispatcherServlet</code> 统一处理，因此 <code>FruitController</code> 不再是一个 servlet，应删除其类注解 <code>@WebServlet</code> 。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<br />

<h3 id="优化四：提取视图资源通用代码"><a href="#优化四：提取视图资源通用代码" class="headerlink" title="优化四：提取视图资源通用代码"></a>优化四：提取视图资源通用代码</h3><p>对于一个 controller ，例如 <code>FruitController</code> ，其中每一个具体的方法最后会涉及到重定向到某个页面 (<code>resp.sendRedirect()</code> 方法) 或者执行视图模版方法 (<code>processTemplate()</code>) 。可以提取这部分代码到 <code>DispatcherServlet</code> 中实现。</p>
<p>拷贝 <code>pro15-fruit10-mvc-dispatcherServlet</code> 子项目，更名为 <code>pro16-fruit11-mvc-controller</code> ，在此子项目中实现本节优化。</p>
<br />

<h4 id="FruitController-1"><a href="#FruitController-1" class="headerlink" title="FruitController"></a>FruitController</h4><p>在 <code>FruitController</code> 中修改针对请求执行的方法，用返回字符串的方式取代最后的重定向或执行视图模版方法。</p>
<p>例如 <code>update</code> 中的重定向可改为返回 <code>&quot;redirect:fruit.do&quot;</code> 字符串。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String <span class="title function_">update</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">    <span class="comment">//2.获取参数</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">fidStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fid&quot;</span>);</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">fid</span> <span class="operator">=</span> Integer.parseInt(fidStr);</span><br><span class="line">    <span class="type">String</span> <span class="variable">fname</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fname&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">priceStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;price&quot;</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">price</span> <span class="operator">=</span> Integer.parseInt(priceStr);</span><br><span class="line">    <span class="type">String</span> <span class="variable">fcountStr</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fcount&quot;</span>);</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">fcount</span> <span class="operator">=</span> Integer.parseInt(fcountStr);</span><br><span class="line">    <span class="type">String</span> <span class="variable">remark</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;remark&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.执行更新</span></span><br><span class="line">    fruitDao.updateFruit(<span class="keyword">new</span> <span class="title class_">Fruit</span>(fid,fname, price ,fcount ,remark ));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.资源跳转</span></span><br><span class="line">    <span class="comment">// response.sendRedirect(&quot;fruit.do&quot;);</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:fruit.do&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>edit</code> 方法中的执行视图模版方法改为返回 <code>&quot;edit&quot;</code> 字符串。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String <span class="title function_">edit</span><span class="params">(HttpServletRequest req)</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">fidStr</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;fid&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(StringUtils.isNotEmpty(fidStr))&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">fid</span> <span class="operator">=</span> Integer.parseInt(fidStr);</span><br><span class="line">        <span class="type">Fruit</span> <span class="variable">fruit</span> <span class="operator">=</span> fruitDao.getFruitByFid(fid);</span><br><span class="line">        req.setAttribute(<span class="string">&quot;fruit&quot;</span>, fruit);</span><br><span class="line">        <span class="comment">// super.processTemplate(&quot;edit&quot;, req, resp);</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;edit&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这些字符串将返回到 <code>DispatcherServlet</code> 的中统一处理。</p>
<br />

<h4 id="DispatcherServlet-1"><a href="#DispatcherServlet-1" class="headerlink" title="DispatcherServlet"></a>DispatcherServlet</h4><p>针对 <code>FruitController</code> 类中方法的字符串返回值，在 <code>service</code> 方法中，根据返回的字符串是否以 <code>&quot;redirect:&quot;</code> 为前缀，分别处理。若有此前缀，则执行重定向方法，若无，则执行视图模版方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    req.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">servletPath</span> <span class="operator">=</span> req.getServletPath();</span><br><span class="line">    servletPath = servletPath.substring(<span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">lastDotIndex</span> <span class="operator">=</span> servletPath.lastIndexOf(<span class="string">&quot;.do&quot;</span>);</span><br><span class="line">    servletPath = servletPath.substring(<span class="number">0</span>, lastDotIndex);</span><br><span class="line"></span><br><span class="line">    <span class="type">Object</span> <span class="variable">controllerBeanObj</span> <span class="operator">=</span> beanMap.get(servletPath);</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">operate</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;operate&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(StringUtils.isEmpty(operate))&#123;</span><br><span class="line">        operate = <span class="string">&quot;index&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> controllerBeanObj.getClass().getDeclaredMethod(operate, HttpServletRequest.class);</span><br><span class="line">        <span class="keyword">if</span>(method != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">// 2. controller 组件方法调用</span></span><br><span class="line">            method.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            <span class="type">Object</span> <span class="variable">returnObj</span> <span class="operator">=</span> method.invoke(controllerBeanObj, req);</span><br><span class="line">            <span class="type">String</span> <span class="variable">methodReturnStr</span> <span class="operator">=</span> (String) returnObj;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3. 视图处理</span></span><br><span class="line">            <span class="keyword">if</span>(methodReturnStr.startsWith(<span class="string">&quot;redirect:&quot;</span>))&#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">redirectStr</span> <span class="operator">=</span> methodReturnStr.substring(<span class="string">&quot;redirect:&quot;</span>.length());</span><br><span class="line">                resp.sendRedirect(redirectStr);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">super</span>.processTemplate(methodReturnStr, req, resp);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;operate值非法&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br />

<h3 id="优化五：提取参数获取通用代码"><a href="#优化五：提取参数获取通用代码" class="headerlink" title="优化五：提取参数获取通用代码"></a>优化五：提取参数获取通用代码</h3><p>对于一个 controller ，例如 <code>FruitController</code> ，其中每一个具体的方法都会获取请求中的参数，可以参数获取的代码统一到 <code>DispatcherServlet</code> 中实现。</p>
<p>拷贝 <code>pro16-fruit11-mvc-controller</code> 子项目，更名为 <code>pro16-fruit11-mvc-controller-param</code> ，在此子项目中实现本节优化。</p>
<br />

<h4 id="FruitController-2"><a href="#FruitController-2" class="headerlink" title="FruitController"></a>FruitController</h4><p><code>FruitController</code> 中的方法均改为直接传入参数，这些参数在 <code>DispatcherServlet</code> 中获取并在反射调用 <code>FruitController</code> 相关方法时传入。</p>
<p>例如 <code>update</code> 改为如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String <span class="title function_">update</span><span class="params">(Integer fid, String fname, Integer price, Integer fcount, String remark)</span>&#123;</span><br><span class="line">    fruitDao.updateFruit(<span class="keyword">new</span> <span class="title class_">Fruit</span>(fid,fname, price ,fcount ,remark ));</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:fruit.do&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>edit</code> 方法改为如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String <span class="title function_">edit</span><span class="params">(Integer fid, HttpServletRequest request)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(fid!=<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="type">Fruit</span> <span class="variable">fruit</span> <span class="operator">=</span> fruitDao.getFruitByFid(fid);</span><br><span class="line">        request.setAttribute(<span class="string">&quot;fruit&quot;</span>,fruit);</span><br><span class="line">        <span class="comment">//super.processTemplate(&quot;edit&quot;,request,response);</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;edit&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;error&quot;</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br />

<h4 id="DispatcherServlet-2"><a href="#DispatcherServlet-2" class="headerlink" title="DispatcherServlet"></a>DispatcherServlet</h4><p>在 <code>DispatcherServlet</code> 的 <code>service</code> 方法中通过反射获取对应请求方法所需的参数值，在反射调用 controller 相关方法时传入。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="comment">//设置编码</span></span><br><span class="line">    request.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">    <span class="comment">//假设url是：  http://localhost:8080/pro15/hello.do</span></span><br><span class="line">    <span class="comment">//那么servletPath是：    /hello.do</span></span><br><span class="line">    <span class="comment">// 我的思路是：</span></span><br><span class="line">    <span class="comment">// 第1步： /hello.do -&gt;   hello   或者  /fruit.do  -&gt; fruit</span></span><br><span class="line">    <span class="comment">// 第2步： hello -&gt; HelloController 或者 fruit -&gt; FruitController</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">servletPath</span> <span class="operator">=</span> request.getServletPath();</span><br><span class="line">    servletPath = servletPath.substring(<span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">lastDotIndex</span> <span class="operator">=</span> servletPath.lastIndexOf(<span class="string">&quot;.do&quot;</span>) ;</span><br><span class="line">    servletPath = servletPath.substring(<span class="number">0</span>,lastDotIndex);</span><br><span class="line"></span><br><span class="line">    <span class="type">Object</span> <span class="variable">controllerBeanObj</span> <span class="operator">=</span> beanMap.get(servletPath);</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">operate</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;operate&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(StringUtils.isEmpty(operate))&#123;</span><br><span class="line">        operate = <span class="string">&quot;index&quot;</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Method[] methods = controllerBeanObj.getClass().getDeclaredMethods();</span><br><span class="line">        <span class="keyword">for</span>(Method method : methods)&#123;</span><br><span class="line">            <span class="keyword">if</span>(operate.equals(method.getName()))&#123;</span><br><span class="line">                <span class="comment">//1.统一获取请求参数</span></span><br><span class="line">                <span class="comment">//1-1.获取当前方法的参数，返回参数数组</span></span><br><span class="line">                Parameter[] parameters = method.getParameters();</span><br><span class="line">                <span class="comment">//1-2.parameterValues 用来承载参数的值</span></span><br><span class="line">                Object[] parameterValues = <span class="keyword">new</span> <span class="title class_">Object</span>[parameters.length];</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; parameters.length; i++) &#123;</span><br><span class="line">                    <span class="type">Parameter</span> <span class="variable">parameter</span> <span class="operator">=</span> parameters[i];</span><br><span class="line">                    <span class="type">String</span> <span class="variable">parameterName</span> <span class="operator">=</span> parameter.getName() ;</span><br><span class="line">                    <span class="comment">//如果参数名是request,response,session 那么就不是通过请求中获取参数的方式了</span></span><br><span class="line">                    <span class="keyword">if</span>(<span class="string">&quot;request&quot;</span>.equals(parameterName))&#123;</span><br><span class="line">                        parameterValues[i] = request ;</span><br><span class="line">                    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;response&quot;</span>.equals(parameterName))&#123;</span><br><span class="line">                        parameterValues[i] = response ;</span><br><span class="line">                    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;session&quot;</span>.equals(parameterName))&#123;</span><br><span class="line">                        parameterValues[i] = request.getSession() ;</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="comment">//从请求中获取参数值</span></span><br><span class="line">                        <span class="type">String</span> <span class="variable">parameterValue</span> <span class="operator">=</span> request.getParameter(parameterName);</span><br><span class="line">                        <span class="type">String</span> <span class="variable">typeName</span> <span class="operator">=</span> parameter.getType().getName();</span><br><span class="line"></span><br><span class="line">                        <span class="type">Object</span> <span class="variable">parameterObj</span> <span class="operator">=</span> parameterValue ;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span>(parameterObj!=<span class="literal">null</span>) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (<span class="string">&quot;java.lang.Integer&quot;</span>.equals(typeName)) &#123;</span><br><span class="line">                                parameterObj = Integer.parseInt(parameterValue);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        parameterValues[i] = parameterObj ;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//2.controller组件中的方法调用</span></span><br><span class="line">                method.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                <span class="type">Object</span> <span class="variable">returnObj</span> <span class="operator">=</span> method.invoke(controllerBeanObj, parameterValues);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//3.视图处理</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">methodReturnStr</span> <span class="operator">=</span> (String)returnObj ;</span><br><span class="line">                <span class="keyword">if</span>(methodReturnStr.startsWith(<span class="string">&quot;redirect:&quot;</span>))&#123;        <span class="comment">//比如：  redirect:fruit.do</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">redirectStr</span> <span class="operator">=</span> methodReturnStr.substring(<span class="string">&quot;redirect:&quot;</span>.length());</span><br><span class="line">                    response.sendRedirect(redirectStr);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="built_in">super</span>.processTemplate(methodReturnStr,request,response);    <span class="comment">// 比如：  &quot;edit&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br />

<h3 id="优化六：引入-Service"><a href="#优化六：引入-Service" class="headerlink" title="优化六：引入 Service"></a>优化六：引入 Service</h3><p>在之前的实现中，controller 中直接操作 dao 来获取数据，但在实际的业务中，与数据库交互的逻辑相比当前实现会更为复杂，有必要在 controller 层与 dao 层之间再引入 service 层，controller 执行具体方法时，通过其持有的 service 实例完成与数据库的交互，controller 不必关系 service 的具体实现。</p>
<p>拷贝 <code>pro16-fruit11-mvc-controller-param</code> 子项目，更名为 <code>pro17-fruit12-mvc-ioc-service</code> ，在此子项目中实现本节优化。</p>
<br />

<h4 id="FruitService"><a href="#FruitService" class="headerlink" title="FruitService"></a>FruitService</h4><p>新增 service 包，在该包下新建 <code>FruitService</code> 接口，声明服务方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.fruit.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yukiyama.fruit.pojo.Fruit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FruitService</span> &#123;</span><br><span class="line">    <span class="comment">//获取指定页面的库存列表信息</span></span><br><span class="line">    List&lt;Fruit&gt; <span class="title function_">getFruitList</span><span class="params">(String keyword , Integer pageNo)</span>;</span><br><span class="line">    <span class="comment">//添加库存记录信息</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addFruit</span><span class="params">(Fruit fruit)</span>;</span><br><span class="line">    <span class="comment">//根据id查看指定库存记录</span></span><br><span class="line">    Fruit <span class="title function_">getFruitByFid</span><span class="params">(Integer fid)</span>;</span><br><span class="line">    <span class="comment">//删除特定库存记录</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">delFruit</span><span class="params">(Integer fid)</span>;</span><br><span class="line">    <span class="comment">//获取总页数</span></span><br><span class="line">    Integer <span class="title function_">getPageCount</span><span class="params">(String keyword)</span>;</span><br><span class="line">    <span class="comment">//修改特定库存记录</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">updateFruit</span><span class="params">(Fruit fruit)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>新建 <code>FruitServiceImpl</code> 实现类实现 <code>FruitService</code> 接口，在其内持用 dao 实例，并完成与 dao 的交互来获取数据。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.fruit.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yukiyama.fruit.service.FruitService;</span><br><span class="line"><span class="keyword">import</span> com.yukiyama.fruit.dao.FruitDao;</span><br><span class="line"><span class="keyword">import</span> com.yukiyama.fruit.dao.impl.FruitDaoImpl;</span><br><span class="line"><span class="keyword">import</span> com.yukiyama.fruit.pojo.Fruit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FruitServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">FruitService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">FruitDao</span> <span class="variable">fruitDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FruitDaoImpl</span>();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Fruit&gt; <span class="title function_">getFruitList</span><span class="params">(String keyword, Integer pageNo)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fruitDao.getFruitList(keyword,pageNo);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addFruit</span><span class="params">(Fruit fruit)</span> &#123;</span><br><span class="line">        fruitDao.addFruit(fruit);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Fruit <span class="title function_">getFruitByFid</span><span class="params">(Integer fid)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fruitDao.getFruitByFid(fid);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delFruit</span><span class="params">(Integer fid)</span> &#123;</span><br><span class="line">        fruitDao.delFruit(fid);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getPageCount</span><span class="params">(String keyword)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> fruitDao.getFruitCount(keyword);</span><br><span class="line">        <span class="type">int</span> <span class="variable">pageCount</span> <span class="operator">=</span> (count + <span class="number">2</span> - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">return</span> pageCount;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateFruit</span><span class="params">(Fruit fruit)</span> &#123;</span><br><span class="line">        fruitDao.updateFruit(fruit);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br />

<h4 id="FruitController-3"><a href="#FruitController-3" class="headerlink" title="FruitController"></a>FruitController</h4><p><code>FruitController</code> 不再直接操作 dao，而是持有一个 <code>FruitService</code> 实例，由 <code>FruitService</code> 来提供服务。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.fruit.controllers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yukiyama.fruit.service.FruitService;</span><br><span class="line"><span class="keyword">import</span> com.yukiyama.fruit.service.impl.FruitServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.yukiyama.fruit.pojo.Fruit;</span><br><span class="line"><span class="keyword">import</span> com.yukiyama.myssm.util.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FruitController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">FruitService</span> <span class="variable">fruitService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FruitServiceImpl</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">update</span><span class="params">(Integer fid, String fname, Integer price, Integer fcount, String remark)</span>&#123;</span><br><span class="line">        fruitService.updateFruit(<span class="keyword">new</span> <span class="title class_">Fruit</span>(fid,fname, price ,fcount ,remark ));</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:fruit.do&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">edit</span><span class="params">(Integer fid, HttpServletRequest request)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(fid!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="type">Fruit</span> <span class="variable">fruit</span> <span class="operator">=</span> fruitService.getFruitByFid(fid);</span><br><span class="line">            request.setAttribute(<span class="string">&quot;fruit&quot;</span>,fruit);</span><br><span class="line">            <span class="comment">//super.processTemplate(&quot;edit&quot;,request,response);</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;edit&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;error&quot;</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">del</span><span class="params">(Integer fid  )</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(fid!=<span class="literal">null</span>)&#123;</span><br><span class="line">            fruitService.delFruit(fid);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;redirect:fruit.do&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">add</span><span class="params">(String fname , Integer price , Integer fcount , String remark )</span> &#123;</span><br><span class="line">        <span class="type">Fruit</span> <span class="variable">fruit</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="number">0</span>,fname , price , fcount , remark ) ;</span><br><span class="line">        fruitService.addFruit(fruit);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:fruit.do&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">index</span><span class="params">(String oper , String keyword , Integer pageNo , HttpServletRequest request )</span> &#123;</span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession() ;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(pageNo==<span class="literal">null</span>)&#123;</span><br><span class="line">            pageNo = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isNotEmpty(oper) &amp;&amp; <span class="string">&quot;search&quot;</span>.equals(oper))&#123;</span><br><span class="line">            pageNo = <span class="number">1</span> ;</span><br><span class="line">            <span class="keyword">if</span>(StringUtils.isEmpty(keyword))&#123;</span><br><span class="line">                keyword = <span class="string">&quot;&quot;</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">            session.setAttribute(<span class="string">&quot;keyword&quot;</span>,keyword);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">keywordObj</span> <span class="operator">=</span> session.getAttribute(<span class="string">&quot;keyword&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(keywordObj!=<span class="literal">null</span>)&#123;</span><br><span class="line">                keyword = (String)keywordObj ;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                keyword = <span class="string">&quot;&quot;</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 重新更新当前页的值</span></span><br><span class="line">        session.setAttribute(<span class="string">&quot;pageNo&quot;</span>,pageNo);</span><br><span class="line"></span><br><span class="line">        List&lt;Fruit&gt; fruitList = fruitService.getFruitList(keyword , pageNo);</span><br><span class="line">        session.setAttribute(<span class="string">&quot;fruitList&quot;</span>,fruitList);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">pageCount</span> <span class="operator">=</span> fruitService.getPageCount(keyword);</span><br><span class="line"></span><br><span class="line">        session.setAttribute(<span class="string">&quot;pageCount&quot;</span>,pageCount);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br />

<h3 id="优化七：IoC"><a href="#优化七：IoC" class="headerlink" title="优化七：IoC"></a>优化七：IoC</h3><p>当前的实现中，controller 持有 service 实例，service 实例持有 dao 实例。A 类持有 B 类的实例使得在 A 类中必须引入 B 类，于是这两个类产生了耦合。我们希望去掉这样的耦合，即当 A 类需要用到 B 类时，再实时地为 A 类提供 B 类的实例。实现这种解耦合的技术称为 IoC (Inversion of Control) ，即「依赖反转」。所谓依赖即前述耦合，反转指的是原先由 A 类管理 B 类的实例，但解耦之后 A 类不再管理其所依赖的对象，而是交给外界管理，在 IoC 的实现中，由一个专门的对象容器来产生以及管理对象实例。</p>
<p>IoC 有时根据其实现方式也被称作 DI (Dependency Injection) ，即「依赖注入」，也就是前面说到的，当 A 类需要 B 类时，由对象容器将 B 类实例 (作为 A 类字段) 「注入」到 A 类 (实例) 中。</p>
<p>拷贝 <code>pro17-fruit12-mvc-ioc-service</code> 子项目，更名为 <code>pro17-fruit12-mvc-ioc-beanFactory</code> ，在此子项目中实现本节优化。</p>
<br />

<h4 id="类的解耦"><a href="#类的解耦" class="headerlink" title="类的解耦"></a>类的解耦</h4><p>对于原先持有 <code>FruitDaoImpl</code> 实例的 <code>FruitServiceImpl</code> 类，持有 <code>FruitServiceImpl</code> 实例的 <code>FruitController</code> 类，我们将其中的字段值声明为 <code>null</code> 以去除耦合。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// FruitServiceImpl 类中的 FruitDao 的声明，不再通过 new 持有 FruitDaoImpl 实例，而是声明为 null</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">FruitDao</span> <span class="variable">fruitDao</span> <span class="operator">=</span> <span class="literal">null</span> ;</span><br><span class="line"></span><br><span class="line"><span class="comment">// FruitController 类中 FruitService 的声明，不再通过 new 持有 FruitServiceImpl 实例，而是声明为 null</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">FruitService</span> <span class="variable">fruitService</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>

<br />

<h4 id="applicationContext-xml-1"><a href="#applicationContext-xml-1" class="headerlink" title="applicationContext.xml"></a>applicationContext.xml</h4><p>在「优化三」中我们引入过「applicationContext.xml」，在该文件中以 <code>&lt;bean&gt;</code> 标签声明了 <code>FruitController</code> 类。在 <code>DispatcherServlet</code> 类中，通过解析 <code>applicationContext.xml</code> ，利用反射技术将 <code>FruitController</code> 实例放入 <code>map</code> 容器中，并在需要时 (在 <code>service</code> 方法中)  使用将 <code>map</code> 容器中的 <code>FruitController</code> 实例。</p>
<p>类似地，我们在前面已经接触了类的耦合，因此有必要通过相同的方式将后续需要用到的对象放入到容器中，因此在 <code>applicationContext.xml</code> 文件中新增两个 bean 标签，记录 <code>FruitServiceImpl</code> 类及 <code>FruitController</code> 类的信息，通常称作「配置 bean」。所谓「bean」，即指由 IoC 容器管理的类或类对象。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;fruitDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yukiyama.fruit.dao.impl.FruitDaoImpl&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;fruitService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yukiyama.fruit.service.impl.FruitServiceImpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;fruitDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;fruitDao&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;fruit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yukiyama.fruit.controllers.FruitController&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;fruitService&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;fruitService&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<br />

<h4 id="BeanFactory"><a href="#BeanFactory" class="headerlink" title="BeanFactory"></a>BeanFactory</h4><p><code>BeanFactory</code> 接口中声明 <code>Object getBean(String id);</code> 方法，参数中的 <code>id</code> 对应了 <code>applicationContext.xml</code> 中 <code>&lt;bean&gt;</code> 标签的 <code>id</code> 属性。<code>BeanFactory</code> 具体实现类将实现 <code>getBean</code> 方法，解析 xml 配置文件，根据 <code>id</code> 从 IoC 容器 (<code>map</code>) 中获取相应的类对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.myssm.io;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BeanFactory</span> &#123;</span><br><span class="line">    Object <span class="title function_">getBean</span><span class="params">(String id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br />

<h4 id="ClassPathXmlApplicationContext"><a href="#ClassPathXmlApplicationContext" class="headerlink" title="ClassPathXmlApplicationContext"></a>ClassPathXmlApplicationContext</h4><p><code>ClassPathXmlApplicationContext</code> 是 <code>BeanFactory</code> 的实现类。该实现类解析 <code>applicationContext.xml</code> 文件，通过反射得到每个 <code>&lt;bean&gt;</code> 标签对应的类对象，并放入其持用的对象容器 <code>map</code> 中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.myssm.io;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.Document;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.Element;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.Node;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.NodeList;</span><br><span class="line"><span class="keyword">import</span> org.xml.sax.SAXException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.xml.parsers.DocumentBuilder;</span><br><span class="line"><span class="keyword">import</span> javax.xml.parsers.DocumentBuilderFactory;</span><br><span class="line"><span class="keyword">import</span> javax.xml.parsers.ParserConfigurationException;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassPathXmlApplicationContext</span> <span class="keyword">implements</span> <span class="title class_">BeanFactory</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; beanMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ClassPathXmlApplicationContext</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> getClass().getClassLoader().getResourceAsStream(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">            <span class="comment">//1.创建DocumentBuilderFactory</span></span><br><span class="line">            <span class="type">DocumentBuilderFactory</span> <span class="variable">documentBuilderFactory</span> <span class="operator">=</span> DocumentBuilderFactory.newInstance();</span><br><span class="line">            <span class="comment">//2.创建DocumentBuilder对象</span></span><br><span class="line">            <span class="type">DocumentBuilder</span> <span class="variable">documentBuilder</span> <span class="operator">=</span> documentBuilderFactory.newDocumentBuilder() ;</span><br><span class="line">            <span class="comment">//3.创建Document对象</span></span><br><span class="line">            <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> documentBuilder.parse(inputStream);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//4.获取所有的bean节点</span></span><br><span class="line">            <span class="type">NodeList</span> <span class="variable">beanNodeList</span> <span class="operator">=</span> document.getElementsByTagName(<span class="string">&quot;bean&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i&lt;beanNodeList.getLength() ; i++)&#123;</span><br><span class="line">                <span class="type">Node</span> <span class="variable">beanNode</span> <span class="operator">=</span> beanNodeList.item(i);</span><br><span class="line">                <span class="keyword">if</span>(beanNode.getNodeType() == Node.ELEMENT_NODE)&#123;</span><br><span class="line">                    <span class="type">Element</span> <span class="variable">beanElement</span> <span class="operator">=</span> (Element)beanNode ;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">beanId</span> <span class="operator">=</span>  beanElement.getAttribute(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">                    <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> beanElement.getAttribute(<span class="string">&quot;class&quot;</span>);</span><br><span class="line">                    <span class="type">Class</span> <span class="variable">beanClass</span> <span class="operator">=</span> Class.forName(className);</span><br><span class="line">                    <span class="type">Object</span> <span class="variable">beanObj</span> <span class="operator">=</span> beanClass.newInstance() ;</span><br><span class="line">                    beanMap.put(beanId , beanObj) ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//5.组装bean之间的依赖关系</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i&lt;beanNodeList.getLength() ; i++)&#123;</span><br><span class="line">                <span class="type">Node</span> <span class="variable">beanNode</span> <span class="operator">=</span> beanNodeList.item(i);</span><br><span class="line">                <span class="keyword">if</span>(beanNode.getNodeType() == Node.ELEMENT_NODE) &#123;</span><br><span class="line">                    <span class="type">Element</span> <span class="variable">beanElement</span> <span class="operator">=</span> (Element) beanNode;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">beanId</span> <span class="operator">=</span> beanElement.getAttribute(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">                    <span class="type">NodeList</span> <span class="variable">beanChildNodeList</span> <span class="operator">=</span> beanElement.getChildNodes();</span><br><span class="line">                    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; beanChildNodeList.getLength() ; j++) &#123;</span><br><span class="line">                        <span class="type">Node</span> <span class="variable">beanChildNode</span> <span class="operator">=</span> beanChildNodeList.item(j);</span><br><span class="line">                        <span class="keyword">if</span>(beanChildNode.getNodeType()==Node.ELEMENT_NODE &amp;&amp; <span class="string">&quot;property&quot;</span>.equals(beanChildNode.getNodeName()))&#123;</span><br><span class="line">                            <span class="type">Element</span> <span class="variable">propertyElement</span> <span class="operator">=</span> (Element) beanChildNode;</span><br><span class="line">                            <span class="type">String</span> <span class="variable">propertyName</span> <span class="operator">=</span> propertyElement.getAttribute(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">                            <span class="type">String</span> <span class="variable">propertyRef</span> <span class="operator">=</span> propertyElement.getAttribute(<span class="string">&quot;ref&quot;</span>);</span><br><span class="line">                            <span class="comment">//1) 找到propertyRef对应的实例</span></span><br><span class="line">                            <span class="type">Object</span> <span class="variable">refObj</span> <span class="operator">=</span> beanMap.get(propertyRef);</span><br><span class="line">                            <span class="comment">//2) 将refObj设置到当前bean对应的实例的property属性上去</span></span><br><span class="line">                            <span class="type">Object</span> <span class="variable">beanObj</span> <span class="operator">=</span> beanMap.get(beanId);</span><br><span class="line">                            <span class="type">Class</span> <span class="variable">beanClazz</span> <span class="operator">=</span> beanObj.getClass();</span><br><span class="line">                            <span class="type">Field</span> <span class="variable">propertyField</span> <span class="operator">=</span> beanClazz.getDeclaredField(propertyName);</span><br><span class="line">                            propertyField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                            propertyField.set(beanObj,refObj);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParserConfigurationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SAXException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getBean</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> beanMap.get(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br />

<h4 id="DispatcherServlet-3"><a href="#DispatcherServlet-3" class="headerlink" title="DispatcherServlet"></a>DispatcherServlet</h4><p>引入 bean 工厂后，<code>DispatcherServlet</code> 不必再直接持有 bean 容器，而是持有一个 beanFactory ，并在 <code>init()</code> 方法中以 <code>ClassPathXmlApplicationContext</code> 实例化该 beanFactory，这样当 <code>DispatcherServlet</code> 相应请求执行 <code>init()</code> 方法时就会创建 xml 配置文件中配置的 bean ，并放入 beanFactory 持有的 <code>map</code> 中 (IoC 容器)。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.myssm.myspringmvc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yukiyama.myssm.io.BeanFactory;</span><br><span class="line"><span class="keyword">import</span> com.yukiyama.myssm.io.ClassPathXmlApplicationContext;</span><br><span class="line"><span class="keyword">import</span> com.yukiyama.myssm.util.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Parameter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;*.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DispatcherServlet</span> <span class="keyword">extends</span> <span class="title class_">ViewBaseServlet</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> BeanFactory beanFactory;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DispatcherServlet</span><span class="params">()</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        <span class="built_in">super</span>.init();</span><br><span class="line">        beanFactory = <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//设置编码</span></span><br><span class="line">        request.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="comment">//假设url是：  http://localhost:8080/pro15/hello.do</span></span><br><span class="line">        <span class="comment">//那么servletPath是：    /hello.do</span></span><br><span class="line">        <span class="comment">// 我的思路是：</span></span><br><span class="line">        <span class="comment">// 第1步： /hello.do -&gt;   hello   或者  /fruit.do  -&gt; fruit</span></span><br><span class="line">        <span class="comment">// 第2步： hello -&gt; HelloController 或者 fruit -&gt; FruitController</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">servletPath</span> <span class="operator">=</span> request.getServletPath();</span><br><span class="line">        servletPath = servletPath.substring(<span class="number">1</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">lastDotIndex</span> <span class="operator">=</span> servletPath.lastIndexOf(<span class="string">&quot;.do&quot;</span>) ;</span><br><span class="line">        servletPath = servletPath.substring(<span class="number">0</span>,lastDotIndex);</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">controllerBeanObj</span> <span class="operator">=</span> beanFactory.getBean(servletPath);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">operate</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;operate&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(operate))&#123;</span><br><span class="line">            operate = <span class="string">&quot;index&quot;</span> ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Method[] methods = controllerBeanObj.getClass().getDeclaredMethods();</span><br><span class="line">            <span class="keyword">for</span>(Method method : methods)&#123;</span><br><span class="line">                <span class="keyword">if</span>(operate.equals(method.getName()))&#123;</span><br><span class="line">                    <span class="comment">//1.统一获取请求参数</span></span><br><span class="line">                    <span class="comment">//1-1.获取当前方法的参数，返回参数数组</span></span><br><span class="line">                    Parameter[] parameters = method.getParameters();</span><br><span class="line">                    <span class="comment">//1-2.parameterValues 用来承载参数的值</span></span><br><span class="line">                    Object[] parameterValues = <span class="keyword">new</span> <span class="title class_">Object</span>[parameters.length];</span><br><span class="line">                    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; parameters.length; i++) &#123;</span><br><span class="line">                        <span class="type">Parameter</span> <span class="variable">parameter</span> <span class="operator">=</span> parameters[i];</span><br><span class="line">                        <span class="type">String</span> <span class="variable">parameterName</span> <span class="operator">=</span> parameter.getName() ;</span><br><span class="line">                        <span class="comment">//如果参数名是request,response,session 那么就不是通过请求中获取参数的方式了</span></span><br><span class="line">                        <span class="keyword">if</span>(<span class="string">&quot;request&quot;</span>.equals(parameterName))&#123;</span><br><span class="line">                            parameterValues[i] = request ;</span><br><span class="line">                        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;response&quot;</span>.equals(parameterName))&#123;</span><br><span class="line">                            parameterValues[i] = response ;</span><br><span class="line">                        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;session&quot;</span>.equals(parameterName))&#123;</span><br><span class="line">                            parameterValues[i] = request.getSession() ;</span><br><span class="line">                        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                            <span class="comment">//从请求中获取参数值</span></span><br><span class="line">                            <span class="type">String</span> <span class="variable">parameterValue</span> <span class="operator">=</span> request.getParameter(parameterName);</span><br><span class="line">                            <span class="type">String</span> <span class="variable">typeName</span> <span class="operator">=</span> parameter.getType().getName();</span><br><span class="line"></span><br><span class="line">                            <span class="type">Object</span> <span class="variable">parameterObj</span> <span class="operator">=</span> parameterValue ;</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">if</span>(parameterObj!=<span class="literal">null</span>) &#123;</span><br><span class="line">                                <span class="keyword">if</span> (<span class="string">&quot;java.lang.Integer&quot;</span>.equals(typeName)) &#123;</span><br><span class="line">                                    parameterObj = Integer.parseInt(parameterValue);</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            parameterValues[i] = parameterObj ;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//2.controller组件中的方法调用</span></span><br><span class="line">                    method.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                    <span class="type">Object</span> <span class="variable">returnObj</span> <span class="operator">=</span> method.invoke(controllerBeanObj,parameterValues);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//3.视图处理</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">methodReturnStr</span> <span class="operator">=</span> (String)returnObj ;</span><br><span class="line">                    <span class="keyword">if</span>(methodReturnStr.startsWith(<span class="string">&quot;redirect:&quot;</span>))&#123;        <span class="comment">//比如：  redirect:fruit.do</span></span><br><span class="line">                        <span class="type">String</span> <span class="variable">redirectStr</span> <span class="operator">=</span> methodReturnStr.substring(<span class="string">&quot;redirect:&quot;</span>.length());</span><br><span class="line">                        response.sendRedirect(redirectStr);</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="built_in">super</span>.processTemplate(methodReturnStr,request,response);    <span class="comment">// 比如：  &quot;edit&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 常见错误： IllegalArgumentException: argument type mismatch</span></span><br></pre></td></tr></table></figure>

<br />

<h3 id="初始化参数"><a href="#初始化参数" class="headerlink" title="初始化参数"></a>初始化参数</h3><p>可以预先设置 servlet 的初始化参数。 <code>ServletConfig</code> 实例持有该参数，并可通过实例方法 <code>getInitParameters</code> 来获取该参数。可通过在 <code>web.xml</code> 中配置 <code>&lt;init-param&gt;</code> 标签来实现，也可以采用注解方式来实现。</p>
<p>新建 <code>pro18-servlet-api</code> webapp 子项目，新增如下 <code>Demo01Servlet</code> 类。通过该子工程演示如何设置和获取初始化参数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.servlets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebInitParam;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo01Servlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        <span class="type">ServletConfig</span> <span class="variable">config</span> <span class="operator">=</span> getServletConfig();</span><br><span class="line">        <span class="type">String</span> <span class="variable">hello</span> <span class="operator">=</span> config.getInitParameter(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> config.getInitParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;hello = &quot;</span> + hello);</span><br><span class="line">        System.out.println(<span class="string">&quot;name = &quot;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br />

<h4 id="web-xml配置方式"><a href="#web-xml配置方式" class="headerlink" title="web.xml配置方式"></a>web.xml配置方式</h4><p>在 <code>web.xml</code> 文件中增加 <code>&lt;init-param&gt;</code> 标签并按如下设置参数名及其值，可设置多个。启动 Tomcat 运行 <code>pro18-servlet-api</code> 应用，即可在控制台看到 <code>hello</code> 及 <code>name</code> 的值被打印输出。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.yukiyama.servlets.Demo01Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>world<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>name<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>yukiyama<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/demo01<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<br />

<h4 id="注解方式"><a href="#注解方式" class="headerlink" title="注解方式"></a>注解方式</h4><p>为 <code>Demo01Servlet</code> 添加如下类注解，即可在无 <code>web.xml</code> 文件的情况下设置和获取初始化参数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(urlPatterns = &#123;&quot;/demo01&quot;&#125;,</span></span><br><span class="line"><span class="meta">        initParams = &#123;</span></span><br><span class="line"><span class="meta">        @WebInitParam(name = &quot;hello&quot;, value = &quot;world&quot;),</span></span><br><span class="line"><span class="meta">        @WebInitParam(name = &quot;name&quot;, value = &quot;yukiyama&quot;),</span></span><br><span class="line"><span class="meta">        &#125;</span></span><br><span class="line"><span class="meta">)</span></span><br></pre></td></tr></table></figure>

<br />













</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="https://iyukiyama.github.io">yukiyama</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://iyukiyama.github.io/2022/08/31/JavaWeb%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98_yukiyama/">https://iyukiyama.github.io/2022/08/31/JavaWeb%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98_yukiyama/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/09/01/git%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98_yukiyama/"><img class="prev-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Git学习实战</div></div></a></div><div class="next-post pull-right"><a href="/2022/08/31/jdbc%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98_yukiyama/"><img class="next-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">JDBC学习实战</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/hexo-iyukiyama/site_img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">yukiyama</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">18</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">1</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/iyukiyama" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:iyukiyama@outlook.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#JavaWeb%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98-yukiyama"><span class="toc-number">1.</span> <span class="toc-text">JavaWeb学习实战_yukiyama</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Tomcat"><span class="toc-number">1.1.</span> <span class="toc-text">Tomcat</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">1.1.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E5%BA%94%E7%94%A8"><span class="toc-number">1.1.2.</span> <span class="toc-text">部署应用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">手动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">自动</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Servlet"><span class="toc-number">1.2.</span> <span class="toc-text">Servlet</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A5%E9%97%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.2.1.</span> <span class="toc-text">入门示例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">引入依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">准备数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E6%B5%8F%E8%A7%88%E5%99%A8%E9%A1%B5%E9%9D%A2"><span class="toc-number">1.2.1.3.</span> <span class="toc-text">编写浏览器页面</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99FruitDao%E7%9B%B8%E5%85%B3%E7%B1%BB"><span class="toc-number">1.2.1.4.</span> <span class="toc-text">编写FruitDao相关类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99AddServlet"><span class="toc-number">1.2.1.5.</span> <span class="toc-text">编写AddServlet</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEweb-xml"><span class="toc-number">1.2.1.6.</span> <span class="toc-text">配置web.xml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AETomcat"><span class="toc-number">1.2.1.7.</span> <span class="toc-text">配置Tomcat</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C"><span class="toc-number">1.2.1.8.</span> <span class="toc-text">运行</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB"><span class="toc-number">1.2.2.</span> <span class="toc-text">继承关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E6%96%B9%E6%B3%95"><span class="toc-number">1.2.3.</span> <span class="toc-text">接口方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#init"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">init</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#getServletConifg"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">getServletConifg</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#service"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">service</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#getServletInfo"><span class="toc-number">1.2.3.4.</span> <span class="toc-text">getServletInfo</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#destroy"><span class="toc-number">1.2.3.5.</span> <span class="toc-text">destroy</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HttpServlet"><span class="toc-number">1.2.4.</span> <span class="toc-text">HttpServlet</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#doXxx"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">doXxx</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">示例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">1.2.5.</span> <span class="toc-text">生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B%E5%88%9B%E5%BB%BA%E6%97%B6%E6%9C%BA"><span class="toc-number">1.2.5.1.</span> <span class="toc-text">实例创建时机</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#session"><span class="toc-number">1.2.6.</span> <span class="toc-text">session</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F-1"><span class="toc-number">1.2.6.1.</span> <span class="toc-text">生命周期</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-1"><span class="toc-number">1.2.6.2.</span> <span class="toc-text">示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%96%B9%E6%B3%95"><span class="toc-number">1.2.6.3.</span> <span class="toc-text">相关方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BD%AC%E5%8F%91%E4%B8%8E%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">1.2.7.</span> <span class="toc-text">转发与重定向</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BD%AC%E5%8F%91"><span class="toc-number">1.2.7.1.</span> <span class="toc-text">转发</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">1.2.7.2.</span> <span class="toc-text">重定向</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-number">1.2.8.</span> <span class="toc-text">作用域</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#request%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-number">1.2.8.1.</span> <span class="toc-text">request作用域</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#session%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-number">1.2.8.2.</span> <span class="toc-text">session作用域</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web-context%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-number">1.2.8.3.</span> <span class="toc-text">web context作用域</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E5%BE%84%E9%97%AE%E9%A2%98"><span class="toc-number">1.2.9.</span> <span class="toc-text">路径问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">1.2.10.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Thymeleaf"><span class="toc-number">1.3.</span> <span class="toc-text">Thymeleaf</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A5%E9%97%A8%E7%A4%BA%E4%BE%8B-1"><span class="toc-number">1.3.1.</span> <span class="toc-text">入门示例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%95%E5%85%A5Thymeleaf%E4%BE%9D%E8%B5%96"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">引入Thymeleaf依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E6%95%B0%E6%8D%AE%E5%BA%93-1"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">准备数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E6%B5%8F%E8%A7%88%E5%99%A8%E9%A1%B5%E9%9D%A2-1"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">编写浏览器页面</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99FruitDao%E7%9B%B8%E5%85%B3%E7%B1%BB-1"><span class="toc-number">1.3.1.4.</span> <span class="toc-text">编写FruitDao相关类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99IndexServlet"><span class="toc-number">1.3.1.5.</span> <span class="toc-text">编写IndexServlet</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEweb-xml-1"><span class="toc-number">1.3.1.6.</span> <span class="toc-text">配置web.xml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AETomcat-1"><span class="toc-number">1.3.1.7.</span> <span class="toc-text">配置Tomcat</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C-1"><span class="toc-number">1.3.1.8.</span> <span class="toc-text">运行</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E5%92%8C%E6%9B%B4%E6%96%B0%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.3.2.</span> <span class="toc-text">编辑和更新示例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%95%E5%85%A5Thymeleaf%E4%BE%9D%E8%B5%96-1"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">引入Thymeleaf依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E6%95%B0%E6%8D%AE%E5%BA%93-2"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">准备数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E6%B5%8F%E8%A7%88%E5%99%A8%E9%A1%B5%E9%9D%A2-2"><span class="toc-number">1.3.2.3.</span> <span class="toc-text">编写浏览器页面</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#index-html"><span class="toc-number">1.3.2.3.1.</span> <span class="toc-text">index.html</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#edit-html"><span class="toc-number">1.3.2.3.2.</span> <span class="toc-text">edit.html</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99FruitDao%E7%9B%B8%E5%85%B3%E7%B1%BB-2"><span class="toc-number">1.3.2.4.</span> <span class="toc-text">编写FruitDao相关类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99Servlet%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="toc-number">1.3.2.5.</span> <span class="toc-text">编写Servlet具体实现类</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#IndexServlet"><span class="toc-number">1.3.2.5.1.</span> <span class="toc-text">IndexServlet</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#EditServlet"><span class="toc-number">1.3.2.5.2.</span> <span class="toc-text">EditServlet</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#UpdateServlet"><span class="toc-number">1.3.2.5.3.</span> <span class="toc-text">UpdateServlet</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEweb-xml-2"><span class="toc-number">1.3.2.6.</span> <span class="toc-text">配置web.xml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AETomcat-2"><span class="toc-number">1.3.2.7.</span> <span class="toc-text">配置Tomcat</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C-2"><span class="toc-number">1.3.2.8.</span> <span class="toc-text">运行</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%92%8C%E6%B7%BB%E5%8A%A0%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.3.3.</span> <span class="toc-text">删除和添加示例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0%E5%88%A0%E9%99%A4%E5%8A%9F%E8%83%BD"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">增加删除功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B0%E5%A2%9EDelServlet%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">新增DelServlet实现类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0%E6%96%B0%E5%A2%9E%E5%8A%9F%E8%83%BD"><span class="toc-number">1.3.3.3.</span> <span class="toc-text">增加新增功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B0%E5%A2%9EAddServlet%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="toc-number">1.3.3.4.</span> <span class="toc-text">新增AddServlet实现类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.3.4.</span> <span class="toc-text">分页示例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0%E5%88%86%E9%A1%B5%E5%8A%9F%E8%83%BD"><span class="toc-number">1.3.4.1.</span> <span class="toc-text">增加分页功能</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.3.5.</span> <span class="toc-text">查询示例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0%E6%9F%A5%E8%AF%A2%E5%8A%9F%E8%83%BD"><span class="toc-number">1.3.5.1.</span> <span class="toc-text">增加查询功能</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MVC"><span class="toc-number">1.4.</span> <span class="toc-text">MVC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E4%B8%80%EF%BC%9A%E5%BC%95%E5%85%A5-Controller"><span class="toc-number">1.4.1.</span> <span class="toc-text">优化一：引入 Controller</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#FruitServlet"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">FruitServlet</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E4%BF%AE%E6%94%B9"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">其他修改</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E4%BA%8C%EF%BC%9A%E5%88%A9%E7%94%A8%E5%8F%8D%E5%B0%84"><span class="toc-number">1.4.2.</span> <span class="toc-text">优化二：利用反射</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">反射</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E4%B8%89%EF%BC%9ADispatcherServlet"><span class="toc-number">1.4.3.</span> <span class="toc-text">优化三：DispatcherServlet</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#DispatcherServlet"><span class="toc-number">1.4.3.1.</span> <span class="toc-text">DispatcherServlet</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#applicationContext-xml"><span class="toc-number">1.4.3.2.</span> <span class="toc-text">applicationContext.xml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#FruitController"><span class="toc-number">1.4.3.3.</span> <span class="toc-text">FruitController</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E5%9B%9B%EF%BC%9A%E6%8F%90%E5%8F%96%E8%A7%86%E5%9B%BE%E8%B5%84%E6%BA%90%E9%80%9A%E7%94%A8%E4%BB%A3%E7%A0%81"><span class="toc-number">1.4.4.</span> <span class="toc-text">优化四：提取视图资源通用代码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#FruitController-1"><span class="toc-number">1.4.4.1.</span> <span class="toc-text">FruitController</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DispatcherServlet-1"><span class="toc-number">1.4.4.2.</span> <span class="toc-text">DispatcherServlet</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E4%BA%94%EF%BC%9A%E6%8F%90%E5%8F%96%E5%8F%82%E6%95%B0%E8%8E%B7%E5%8F%96%E9%80%9A%E7%94%A8%E4%BB%A3%E7%A0%81"><span class="toc-number">1.4.5.</span> <span class="toc-text">优化五：提取参数获取通用代码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#FruitController-2"><span class="toc-number">1.4.5.1.</span> <span class="toc-text">FruitController</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DispatcherServlet-2"><span class="toc-number">1.4.5.2.</span> <span class="toc-text">DispatcherServlet</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E5%85%AD%EF%BC%9A%E5%BC%95%E5%85%A5-Service"><span class="toc-number">1.4.6.</span> <span class="toc-text">优化六：引入 Service</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#FruitService"><span class="toc-number">1.4.6.1.</span> <span class="toc-text">FruitService</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#FruitController-3"><span class="toc-number">1.4.6.2.</span> <span class="toc-text">FruitController</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E4%B8%83%EF%BC%9AIoC"><span class="toc-number">1.4.7.</span> <span class="toc-text">优化七：IoC</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB%E7%9A%84%E8%A7%A3%E8%80%A6"><span class="toc-number">1.4.7.1.</span> <span class="toc-text">类的解耦</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#applicationContext-xml-1"><span class="toc-number">1.4.7.2.</span> <span class="toc-text">applicationContext.xml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#BeanFactory"><span class="toc-number">1.4.7.3.</span> <span class="toc-text">BeanFactory</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ClassPathXmlApplicationContext"><span class="toc-number">1.4.7.4.</span> <span class="toc-text">ClassPathXmlApplicationContext</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DispatcherServlet-3"><span class="toc-number">1.4.7.5.</span> <span class="toc-text">DispatcherServlet</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E5%8F%82%E6%95%B0"><span class="toc-number">1.4.8.</span> <span class="toc-text">初始化参数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#web-xml%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F"><span class="toc-number">1.4.8.1.</span> <span class="toc-text">web.xml配置方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E6%96%B9%E5%BC%8F"><span class="toc-number">1.4.8.2.</span> <span class="toc-text">注解方式</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/11/07/SpringBoot%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98_yukiyama/" title="SpringBoot学习实战"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringBoot学习实战"/></a><div class="content"><a class="title" href="/2022/11/07/SpringBoot%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98_yukiyama/" title="SpringBoot学习实战">SpringBoot学习实战</a><time datetime="2022-11-07T12:40:06.330Z" title="Created 2022-11-07 20:40:06">2022-11-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/10/20/SpringMVC%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98_yukiyama/" title="SpringMVC学习实战"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringMVC学习实战"/></a><div class="content"><a class="title" href="/2022/10/20/SpringMVC%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98_yukiyama/" title="SpringMVC学习实战">SpringMVC学习实战</a><time datetime="2022-10-19T16:00:00.000Z" title="Created 2022-10-20 00:00:00">2022-10-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/10/07/spring5%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98_yukiyama/" title="Spring5框架学习实战"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring5框架学习实战"/></a><div class="content"><a class="title" href="/2022/10/07/spring5%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98_yukiyama/" title="Spring5框架学习实战">Spring5框架学习实战</a><time datetime="2022-10-07T04:54:34.999Z" title="Created 2022-10-07 12:54:34">2022-10-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/14/%E7%BA%A2%E9%BB%91%E6%A0%91%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%9C%8B%E5%BC%80/" title="红黑树从入门到看开"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="红黑树从入门到看开"/></a><div class="content"><a class="title" href="/2022/09/14/%E7%BA%A2%E9%BB%91%E6%A0%91%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%9C%8B%E5%BC%80/" title="红黑树从入门到看开">红黑树从入门到看开</a><time datetime="2022-09-14T10:32:06.989Z" title="Created 2022-09-14 18:32:06">2022-09-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/01/git%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98_yukiyama/" title="Git学习实战"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Git学习实战"/></a><div class="content"><a class="title" href="/2022/09/01/git%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98_yukiyama/" title="Git学习实战">Git学习实战</a><time datetime="2022-08-31T16:10:22.004Z" title="Created 2022-09-01 00:10:22">2022-09-01</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By yukiyama</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container').forEach(node => {
            if (node.hasAttribute('display')) {
              btf.wrap(node, 'div', { class: 'mathjax-overflow' })
            } else {
              btf.wrap(node, 'span', { class: 'mathjax-overflow' })
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>