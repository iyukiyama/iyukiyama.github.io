<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>GoF设计模式讲解与实现 | yukiyama</title><meta name="author" content="yukiyama,iyukiyama@outlook.com"><meta name="copyright" content="yukiyama"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="讲解 GoF 23 种 (+静态工厂) 设计模式，并逐一给出实现。">
<meta property="og:type" content="article">
<meta property="og:title" content="GoF设计模式讲解与实现">
<meta property="og:url" content="https://iyukiyama.github.io/design-pattern/index.html">
<meta property="og:site_name" content="yukiyama">
<meta property="og:description" content="讲解 GoF 23 种 (+静态工厂) 设计模式，并逐一给出实现。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/iyukiyama/pics/master/hexo-iyukiyama/site_img/posts/design-patterns-bg.png">
<meta property="article:published_time" content="2022-02-24T10:12:49.066Z">
<meta property="article:modified_time" content="2022-11-13T06:52:38.299Z">
<meta property="article:author" content="yukiyama">
<meta property="article:tag" content="设计模式">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/iyukiyama/pics/master/hexo-iyukiyama/site_img/posts/design-patterns-bg.png"><link rel="shortcut icon" href="https://raw.githubusercontent.com/iyukiyama/pics/f64481f5339a9a86561027eda41a81aaf1c3a92b/hexo-iyukiyama/site_img/favicon.svg"><link rel="canonical" href="https://iyukiyama.github.io/design-pattern/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="8txPepZr-K8-G42klmRZPinO36bw-JYKtqBKyT6YLow"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":500},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: yukiyama","link":"链接: ","source":"来源: yukiyama","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'GoF设计模式讲解与实现',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-13 14:52:38'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/hexo-iyukiyama/site_img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">31</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">49</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-chart-simple"></i><span> 算法</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/binary-search/"><span> 二分查找</span></a></li><li><a class="site-page child" href="/sorting/"><span> 十大排序</span></a></li><li><a class="site-page child" href="/union-find/"><span> 并查集</span></a></li><li><a class="site-page child" href="/graph/"><span> 图论算法</span></a></li><li><a class="site-page child" href="/binary-search-tree/"><span> 二叉查找树</span></a></li><li><a class="site-page child" href="/avl-tree/"><span> AVL树</span></a></li><li><a class="site-page child" href="/splay-tree/"><span> splay树</span></a></li><li><a class="site-page child" href="/binary-indexed-tree/"><span> 树状数组</span></a></li><li><a class="site-page child" href="/segment-tree/"><span> 线段树</span></a></li><li><a class="site-page child" href="/red-black-tree/"><span> 红黑树</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-diagram-project"></i><span> 图论证明</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/dijkstra-proof/"><span> Dijkstra</span></a></li><li><a class="site-page child" href="/prim-proof/"><span> Prim</span></a></li><li><a class="site-page child" href="/bellman-ford-spfa-proof/"><span> Bellman-Ford &amp; SPFA</span></a></li><li><a class="site-page child" href="/floyd-warshall-proof/"><span> Floyd-Warshall</span></a></li><li><a class="site-page child" href="/max-flow-min-cut-proof/"><span> 最大流最小割定理</span></a></li><li><a class="site-page child" href="/edmonds-karp-complexity-proof/"><span> Edmonds-Karp</span></a></li><li><a class="site-page child" href="/dinic-complexity-proof/"><span> Dinic</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="https://iyukiyama.github.io/docsify-leetcode/"><i class="fa-fw fas fa-code"></i><span> LeetCode</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-mug-saucer"></i><span> Java</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/jdbc-in-action/"><span> JDBC</span></a></li><li><a class="site-page child" href="/javaweb-in-action/"><span> Java Web</span></a></li><li><a class="site-page child" href="/spring5-framework-in-action/"><span> Spring Framework</span></a></li><li><a class="site-page child" href="/springmvc-in-action/"><span> SpringMVC</span></a></li><li><a class="site-page child" href="/springboot-in-action/"><span> SpringBoot</span></a></li><li><a class="site-page child" href="/lombok-in-action/"><span> Lombok</span></a></li><li><a class="site-page child" href="/concurrency-in-action/"><span> Concurrency</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://iyukiyama.gitbook.io/design-pattern/"><i class="fa-fw fas fa-palette"></i><span> 设计模式</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-database"></i><span> Database</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/mysql-in-action/"><span> MySQL</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-screwdriver-wrench"></i><span> Tools</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/git-in-action/"><span> Git</span></a></li><li><a class="site-page child" href="/maven-in-action/"><span> Maven</span></a></li><li><a class="site-page child" href="/docsify-in-action/"><span> docsify</span></a></li><li><a class="site-page child" href="/intellij-idea/"><span> IntelliJ Idea</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-circle-info"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://raw.githubusercontent.com/iyukiyama/pics/master/hexo-iyukiyama/site_img/posts/design-patterns-bg.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">yukiyama</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-chart-simple"></i><span> 算法</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/binary-search/"><span> 二分查找</span></a></li><li><a class="site-page child" href="/sorting/"><span> 十大排序</span></a></li><li><a class="site-page child" href="/union-find/"><span> 并查集</span></a></li><li><a class="site-page child" href="/graph/"><span> 图论算法</span></a></li><li><a class="site-page child" href="/binary-search-tree/"><span> 二叉查找树</span></a></li><li><a class="site-page child" href="/avl-tree/"><span> AVL树</span></a></li><li><a class="site-page child" href="/splay-tree/"><span> splay树</span></a></li><li><a class="site-page child" href="/binary-indexed-tree/"><span> 树状数组</span></a></li><li><a class="site-page child" href="/segment-tree/"><span> 线段树</span></a></li><li><a class="site-page child" href="/red-black-tree/"><span> 红黑树</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-diagram-project"></i><span> 图论证明</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/dijkstra-proof/"><span> Dijkstra</span></a></li><li><a class="site-page child" href="/prim-proof/"><span> Prim</span></a></li><li><a class="site-page child" href="/bellman-ford-spfa-proof/"><span> Bellman-Ford &amp; SPFA</span></a></li><li><a class="site-page child" href="/floyd-warshall-proof/"><span> Floyd-Warshall</span></a></li><li><a class="site-page child" href="/max-flow-min-cut-proof/"><span> 最大流最小割定理</span></a></li><li><a class="site-page child" href="/edmonds-karp-complexity-proof/"><span> Edmonds-Karp</span></a></li><li><a class="site-page child" href="/dinic-complexity-proof/"><span> Dinic</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="https://iyukiyama.github.io/docsify-leetcode/"><i class="fa-fw fas fa-code"></i><span> LeetCode</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-mug-saucer"></i><span> Java</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/jdbc-in-action/"><span> JDBC</span></a></li><li><a class="site-page child" href="/javaweb-in-action/"><span> Java Web</span></a></li><li><a class="site-page child" href="/spring5-framework-in-action/"><span> Spring Framework</span></a></li><li><a class="site-page child" href="/springmvc-in-action/"><span> SpringMVC</span></a></li><li><a class="site-page child" href="/springboot-in-action/"><span> SpringBoot</span></a></li><li><a class="site-page child" href="/lombok-in-action/"><span> Lombok</span></a></li><li><a class="site-page child" href="/concurrency-in-action/"><span> Concurrency</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://iyukiyama.gitbook.io/design-pattern/"><i class="fa-fw fas fa-palette"></i><span> 设计模式</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-database"></i><span> Database</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/mysql-in-action/"><span> MySQL</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-screwdriver-wrench"></i><span> Tools</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/git-in-action/"><span> Git</span></a></li><li><a class="site-page child" href="/maven-in-action/"><span> Maven</span></a></li><li><a class="site-page child" href="/docsify-in-action/"><span> docsify</span></a></li><li><a class="site-page child" href="/intellij-idea/"><span> IntelliJ Idea</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-circle-info"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">GoF设计模式讲解与实现</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-02-24T10:12:49.066Z" title="发表于 2022-02-24 18:12:49">2022-02-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-11-13T06:52:38.299Z" title="更新于 2022-11-13 14:52:38">2022-11-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">28.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>104分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="GoF设计模式讲解与实现"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1>GoF设计模式讲解与实现</h1>
<p>本材料旨在记录和分享设计模式的学习过程和总结，试图提炼每一种模式的核心要点，并给出经过验证的展现模式工作过程的代码。期望读者在细读每一个模式的讲解后，能够理解每一种模式的工作原理，并能够根据理解独立实现该模式的代码。</p>
<p>学习过程中我主要参考了程杰的《大话设计模式》和<a href="https://link.zhihu.com/?target=https%3A//link.juejin.cn/%3Ftarget%3Dhttp%3A%2F%2Fc.biancheng.net%2Fview%2F1317.html">这个网站</a>。前者以生活场景化，对话化的形式讲解，在设计模式初学者中广受好评，但无关主旨的背景介绍较多，且无Java示例代码。后者网站虽然用的是Java，但每一个示例都用窗体展示，夹杂了大量无关模式的awt和swing代码，不利于集中理解模式的核心内容。另外，网上许多关于设计模式的文章，总是充斥着很多抽象说明和到处复制粘贴的UML图，对初学者理解模式本身反而造成干扰。例如下面这种抽象描述，实际上是对模式完全理解之后的高度概括，很多文章上来就写这种抽象定义，纯属浪费时间。这种描述对模式识别的理解不但不是必须的，对初学者来说甚至是有害的。</p>
<blockquote>
<p>状态（State）模式的定义：对有状态的对象，把复杂的“判断逻辑”提取到不同的状态对象中，允许状态对象在其内部状态发生改变时改变其行为。</p>
</blockquote>
<p>在本材料中我讲侧重于每一个模式的代码实现而非连篇累牍的文字来讲解，代码示例都已经过验证。每一个模式讲解顺序如下：</p>
<ul>
<li><strong>模式说明</strong>：简要说明模式使用场景和该模式的优点，例如相比简单粗暴方法（通常是if-esle或者单个类封装等）的好处，另外像组合模式里有透明方式和安全方式，单例模式里有饿汉方式和懒汉方式，模板模式里有钩子方法等，也会简要说明这些不同的方式方法。</li>
<li><strong>结构</strong>：列明该模式用到的抽象和具体类。</li>
<li><strong>代码演示</strong>：可执行测试的该模式的示例代码，关键语句附有注释。</li>
</ul>
<p>在进入具体模式讲解前，先给出模式一览，对每个模式做简要说明，也给出设计原则一览，可在具体模式讲解中体会各项原则。</p>
<br />
<h2 id="设计模式一览">设计模式一览</h2>
<p>每一种模式的「说明」都是对该模式的总结概括，因此在未学习该模式前，「说明」内容可能会比较抽象且难以理解。建议在学习该模式后再重新阅读体会。</p>
<table>
<thead>
<tr>
<th>模式名称</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>创建型</strong></td>
<td><strong>创建型模式用于创建对象实例。</strong></td>
</tr>
<tr>
<td>单例 (Singleton)</td>
<td>某个类只能生成一个实例，该类提供了一个静态方法供外部获取唯一实例，且无法通过new来创建实例。</td>
</tr>
<tr>
<td>原型 (Prototype)</td>
<td>将一个对象作为原型，通过对其进行复制而克隆出多个和基于原型的新实例。</td>
</tr>
<tr>
<td>简单工厂(Simple Factory) *</td>
<td>通过不同变量来获取不同产品实例。<br />*该模式不属于GoF23种设计模式之一。</td>
</tr>
<tr>
<td>工厂方法 (Factory Method)</td>
<td>定义一个用于创建产品的接口，由子类决定生产什么产品。</td>
</tr>
<tr>
<td>抽象工厂 (AbstractFactory)</td>
<td>提供一个创建产品族的接口，其每个子类可以生产一系列相关的产品。</td>
</tr>
<tr>
<td>建造者 (Builder)</td>
<td>将一个复杂对象分解成多个相对简单的部分，然后根据不同需要分别创建它们，最后构建成该复杂对象。</td>
</tr>
<tr>
<td><strong>结构型</strong></td>
<td><strong>结构型模式用于将类或对象按某种方式组成更大的结构。</strong></td>
</tr>
<tr>
<td>代理 (Proxy)</td>
<td>为某对象提供一种代理以控制对该对象的访问。客户端通过代理间接地访问该对象，从而限制、增强或修改该对象的一些特性。</td>
</tr>
<tr>
<td>适配器 (Adapter)</td>
<td>将一个类的接口转换成客户端希望的另外一个接口，使得原本由于接口不兼容而不能一起工作的那些类能一起工作。</td>
</tr>
<tr>
<td>桥接 (Bridge)</td>
<td>将抽象与实现分离，使它们可以独立变化。它是用组合关系代替继承关系来实现，从而降低了抽象和实现这两个可变维度的耦合度。</td>
</tr>
<tr>
<td>装饰 (Decorator)</td>
<td>动态的给对象增加一些职责，即增加其额外的功能。</td>
</tr>
<tr>
<td>外观 (Facade)</td>
<td>为多个复杂的子系统提供一个一致的接口，使这些子系统更加容易被访问。</td>
</tr>
<tr>
<td>享元 (Flyweight)</td>
<td>运用共享技术来有效地支持大量细粒度对象的复用。</td>
</tr>
<tr>
<td>组合 (Composite)</td>
<td>将对象组合成树状层次结构，使用户对单个对象和组合对象具有一致的访问性。</td>
</tr>
<tr>
<td><strong>行为型</strong></td>
<td><strong>行为型模式用于描述多个对象间如何互相协作，完成单个对象难以完成的任务。</strong></td>
</tr>
<tr>
<td>模板方法 (TemplateMethod)</td>
<td>定义一个操作中的算法骨架，而将算法的一些步骤延迟到子类中，使得子类可以不改变该算法结构的情况下重定义该算法的某些特定步骤。</td>
</tr>
<tr>
<td>策略 (Strategy)</td>
<td>定义了一系列算法，并将每个算法封装起来，使它们可以相互替换，且算法的改变不会影响使用算法的客户。</td>
</tr>
<tr>
<td>命令 (Command)</td>
<td>将一个请求封装为一个对象，使发出请求的责任和执行请求的责任分割开。</td>
</tr>
<tr>
<td>职责链 (Chain of Responsibility)</td>
<td>把请求从链中的一个对象传到下一个对象，直到请求被响应为止。通过这种方式去除对象之间的耦合。</td>
</tr>
<tr>
<td>状态 (State)</td>
<td>允许一个对象在其内部状态发生改变时改变其行为能力。</td>
</tr>
<tr>
<td>观察者 (Observer)</td>
<td>多个对象间存在一对多关系，当一个对象发生改变时，把这种改变通知给其他多个对象，从而影响其他对象的行为。</td>
</tr>
<tr>
<td>中介者 (Mediator)</td>
<td>定义一个中介对象来简化原有对象之间的交互关系，降低系统中对象间的耦合度，使原有对象之间不必相互了解。</td>
</tr>
<tr>
<td>迭代器 (Iterator)</td>
<td>提供一种方法来顺序访问聚合对象中的一系列数据，而不暴露聚合对象的内部表示。</td>
</tr>
<tr>
<td>访问者 (Visitor)</td>
<td>在不改变集合元素的前提下，为一个集合中的每个元素提供多种访问方式，即每个元素有多个访问者对象访问。</td>
</tr>
<tr>
<td>备忘录 (Memento)</td>
<td>在不破坏封装性的前提下，获取并保存一个对象的内部状态，以便以后恢复它。</td>
</tr>
<tr>
<td>解释器 (Interpreter)</td>
<td>提供如何定义语言的文法，以及对语言句子的解释方法，即解释器。</td>
</tr>
</tbody>
</table>
<br />
<h2 id="设计原则一览">设计原则一览</h2>
<table>
<thead>
<tr>
<th>设计原则</th>
<th>一句话归纳</th>
<th>目的</th>
</tr>
</thead>
<tbody>
<tr>
<td>开闭原则 (Open Closed Principle，OCP）</td>
<td>对扩展开放，对修改关闭。</td>
<td>降低维护带来的新风险。</td>
</tr>
<tr>
<td>依赖倒置原则 (Dependence Inversion Principle, DIP)</td>
<td>高层不应该依赖低层，要面向接口编程。</td>
<td>更利于代码结构的升级扩展。</td>
</tr>
<tr>
<td>单一职责原则 (Single Responsibility Principle, SRP)</td>
<td>一个类只干一件事，实现类要单一。</td>
<td>便于理解，提高代码的可读性。</td>
</tr>
<tr>
<td>接口隔离原则 (Interface Segregation Principle, ISP)</td>
<td>一个接口只干一件事，接口要精简单一。</td>
<td>功能解耦，高聚合、低耦合。</td>
</tr>
<tr>
<td>迪米特法则 (Law of Demeter, LoD)</td>
<td>不该知道的不要知道，一个类应该保持对其它对象最少的了解，降低耦合度。</td>
<td>只和朋友交流，不和陌生人说话，减少代码臃肿。</td>
</tr>
<tr>
<td>里氏替换原则 （Liskov Substitution Principle，LSP）</td>
<td>不要破坏继承体系，子类重写方法功能发生改变，不应该影响父类方法的含义。</td>
<td>防止继承泛滥。</td>
</tr>
<tr>
<td>合成复用原则 (Composite Reuse Principle, CRP)</td>
<td>尽量使用组合或者聚合关系实现代码复用，少使用继承。</td>
<td>降低代码耦合。</td>
</tr>
</tbody>
</table>
<br />
<h2 id="创建型设计模式">创建型设计模式</h2>
<p>创建型模式用于创建对象实例，包含6种创建型模式（其中“简单工厂模式”不在GoF23种之列）。</p>
<ul>
<li>单例 / 原型 / 简单工厂(静态工厂) / 工厂方法 / 抽象工厂 / 建造者</li>
</ul>
<br />
<h3 id="单例模式">单例模式</h3>
<h4 id="模式说明">模式说明</h4>
<p>对于一个对象只能有唯一实例的场景，可以通过单例模式实现。由于只能有一个实例，因此该类的构造器必须用<code>private</code>修饰来禁止通过<code>new</code>操作符来新建实例。类内持有一个<code>private</code>修饰的本类实例，声明为类成员(静态字段)，如该类类名<code>Singleton</code>，可声明为：<br>
<code>private static Singleton instance;</code><br>
通过类内的一个<code>public</code>修饰的<code>getIntance</code>方法来获取实例，该方法也是<code>static</code>的。根据实例产生的时机分为饿汉模式和懒汉模式，懒汉模式中有线程安全和不安全两种写法。</p>
<p><strong>饿汉模式</strong><br>
类属性Singleton instance在声明时就实例化。<br>
<code>private static Singleton instance = new Singleton();</code></p>
<p><strong>懒汉模式</strong><br>
类属性<code>Singleton</code>只声明但不实例化，将实例化动作放到<code>getInstance</code>方法中，只有调用<code>getInstance</code>时才能获取<code>Singleton</code>的实例。懒汉模式因为在调用<code>getInstance</code>时才获得实例，存在多线程竞争的问题，因此可以结合<code>volatile</code>(避免指令重排)和<code>synchronized</code>(保证原子性)以双锁检测方式将<code>Singleton</code>写成线程安全的类。</p>
<p>本示例演示饿汉写法，非线程安全懒汉写法和双锁检测线程安全懒汉写法。</p>
<br />
<h4 id="结构">结构</h4>
<table>
<thead>
<tr>
<th>类/接口</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>单例类</td>
<td>持有一个本类的类属性，维护一个<code>getInstance</code>方法。</td>
</tr>
</tbody>
</table>
<br />
<h4 id="代码演示">代码演示</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 单例模式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingletonDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		<span class="type">SingletonSimple</span> <span class="variable">s1</span> <span class="operator">=</span> SingletonSimple.getInstance();</span><br><span class="line">		<span class="type">SingletonSimple</span> <span class="variable">s2</span> <span class="operator">=</span> SingletonSimple.getInstance();</span><br><span class="line">		<span class="comment">// 输出“true”，说明s1与s2是同一个实例</span></span><br><span class="line">		System.out.println(s1 == s2);</span><br><span class="line">		<span class="type">SingletonHungry</span> <span class="variable">s3</span> <span class="operator">=</span> SingletonHungry.getInstance();</span><br><span class="line">		<span class="type">SingletonHungry</span> <span class="variable">s4</span> <span class="operator">=</span> SingletonHungry.getInstance();</span><br><span class="line">		<span class="comment">// 输出“true”，说明s3与s4是同一个实例</span></span><br><span class="line">		System.out.println(s3 == s4);</span><br><span class="line">		<span class="type">Singleton</span> <span class="variable">s5</span> <span class="operator">=</span> Singleton.getInstance();</span><br><span class="line">		<span class="type">Singleton</span> <span class="variable">s6</span> <span class="operator">=</span> Singleton.getInstance();</span><br><span class="line">		<span class="comment">// 输出“true”，说明s3与s4是同一个实例</span></span><br><span class="line">		System.out.println(s5 == s6);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 饿汉模式</span></span><br><span class="line"><span class="comment"> * 在类加载时创建常量化实例，不存在多线程导致可能出现多个实例的问题</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SingletonHungry</span>&#123;</span><br><span class="line">	<span class="comment">// 在定义SingletonHungry类型的属性时直接实例化，类内可以访问private构造器</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">SingletonHungry</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SingletonHungry</span>();</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 将构造器声明为private，外部无法用new获取</span></span><br><span class="line">	<span class="keyword">private</span> <span class="title function_">SingletonHungry</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">	<span class="comment">// 外部通过一个public的getInstance()方法获取该类实例</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> SingletonHungry <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> instance;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 懒汉模式</span></span><br><span class="line"><span class="comment"> * 非线程安全版</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SingletonSimple</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> SingletonSimple instance;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 将构造器声明为private，外部无法用new获取</span></span><br><span class="line">	<span class="keyword">private</span> <span class="title function_">SingletonSimple</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">	<span class="comment">// 外部通过一个public的getInstance()方法获取该类实例</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> SingletonSimple <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="comment">// 每次获取前判断该类实例是否已存在，若无则new一个</span></span><br><span class="line">		<span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">			instance = <span class="keyword">new</span> <span class="title class_">SingletonSimple</span>();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> instance;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 多线程下的双锁检测(Double-Check Locking)单例</span></span><br><span class="line"><span class="comment"> * 懒汉模式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Singleton</span>&#123;</span><br><span class="line">	<span class="comment">// 以volatile修饰</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> Singleton instance;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="comment">// 第一次判断的目的是避免每次getInstance()都加锁</span></span><br><span class="line">		<span class="comment">// 若已经存在实例，直接返回</span></span><br><span class="line">		<span class="keyword">if</span>(instance == <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="keyword">synchronized</span> (Singleton.class) &#123;</span><br><span class="line">				<span class="comment">// 再次判断是防止两个线程在instance==null时</span></span><br><span class="line">				<span class="comment">// 同时进入第一个if内，由于加锁，其中一个先new了</span></span><br><span class="line">				<span class="comment">// 实例，此时必须再判断一次防止第二个也new一个实例</span></span><br><span class="line">				<span class="keyword">if</span>(instance == <span class="literal">null</span>) &#123;</span><br><span class="line">					instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> instance;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />
<h3 id="原型模式">原型模式</h3>
<h4 id="模式说明-2">模式说明</h4>
<p>需要获取一个类的多个实例的场景下，若该类的构造器需要做较多的初始化工作，则创建多个实例，会因为每次创建都需要执行构造器中的初始化过程，耗时耗资源。如果在创建第一个实例后，后续实例都直接拷贝该实例，就可以避免每次获取实例时的初始化开销，对于需要修改的字段针对性修改即可，这就是原型模式。根据对拷贝对象中的引用类型字段的拷贝程度分为浅拷贝和深拷贝。</p>
<p><strong>浅拷贝</strong></p>
<p>对原型<code>P</code>的实例<code>p1</code>执行实例<code>p1.clone()</code>方法拷贝给<code>p2</code>时(<code>P p2 = p1.clone()</code>)，对<code>p1</code>内的引用类型字段(准确地说是可变引用类型)<code>q</code>(类型<code>Q</code>)，只拷贝其引用，这就是浅拷贝。Java中重写<code>clone</code>方法时若只调用<code>super.clone()</code>，则该<code>clone</code>方法在使用时即为浅拷贝，即上述<code>p1.q == p2.q</code>。注意<code>clone</code>方法在<code>Cloneable</code>接口中是<code>native</code>方法，返回类型是<code>Object</code>，赋值给<code>p2</code>时要向下转型。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一个实例通过new创建</span></span><br><span class="line"><span class="type">P</span> <span class="variable">p1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">P</span>();</span><br><span class="line"><span class="comment">// 此后通过拷贝创建</span></span><br><span class="line"><span class="type">P</span> <span class="variable">p2</span> <span class="operator">=</span> (P)p1.clone();</span><br></pre></td></tr></table></figure>
<p>可以这样描述：<code>p1.clone()</code>在堆中生成一个新的实例，p2是这个新实例的引用(地址)，新实例中有<code>p1</code>的基本数据和不变类型(<code>final</code>修饰的引用类型如<code>String</code>)的独立的完整拷贝，但对于可变的引用类型，只拷贝其引用。即如果<code>p1</code>中有一可变引用字段<code>Q</code>，那么<code>p1.q == p2.q，p1</code>和<code>p2</code>中的<code>q</code>指向同一个实例，即原本<code>p1</code>中的<code>q</code>实例。</p>
<p><strong>深拷贝</strong></p>
<p>以上述浅拷贝中的描述为例，深拷贝对<code>p</code>中的可变引用类型<code>q</code>，也拷贝一个完整的<code>q</code>到新实例<code>p2</code>中(与<code>q</code>并列的独立的<code>Q</code>类型新实例)，此时<code>p1.q !=p2.q</code>。深拷贝要求<code>Q</code>自身也要实现<code>Cloneable</code>接口并重写<code>clone</code>方法。并在原型<code>P</code>的重写<code>clone</code>方法内针对<code>q</code>要有类似如下的语句。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p.q = (Q)p.getQ().clone();</span><br></pre></td></tr></table></figure>
<br />
<p>本示例定义一个<code>Person</code>类，使其实现<code>Cloneable</code>接口并通过重写<code>clone</code>方法使其支持浅拷贝。在<code>Person</code>类中定义一个不变引用类型<code>Country</code>和一个可变引用类型<code>WorkExperience</code>，展示浅拷贝<code>Person</code>时，对不变类型<code>Country</code>拷贝出一个新实例，对可变引用类型<code>WorkExperience</code>拷贝的是它的引用(地址)。作为对比，本示例定义一个<code>PersonDeep</code>类，该类内有一个可变引用类型<code>WorkExperienceDeep</code>，使<code>WorkExperienceDeep</code>也实现<code>Cloneable</code>接口并重写<code>clone</code>方法，且在<code>PersonDeep</code>类的<code>clone</code>方法中，针对可变引用l类型<code>WorkExperienceDeep</code>，执行一条对它的<code>clone</code>方法来得到它的一个实例，从而实现对<code>PersonDeep</code>的深拷贝。</p>
<br />
<h4 id="结构-2">结构</h4>
<table>
<thead>
<tr>
<th>类/接口</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>原型接口</strong>: 通常为<code>Cloneable</code>。<br>
<strong>具体原型类</strong>: 实现<code>Cloneable</code>接口并重写<code>clone</code>方法，分为深拷贝和浅拷贝。</p>
<br />
<h4 id="代码演示-2">代码演示</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.pattern.creation;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 原型模式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProtoTypeDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;====如下是深拷贝示例====&quot;</span>);</span><br><span class="line">		<span class="comment">// 声明一个支持深拷贝的实例p1</span></span><br><span class="line">		<span class="type">PersonDeep</span> <span class="variable">pd1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PersonDeep</span>();</span><br><span class="line">		<span class="comment">// 通过原型类中的clone()方法拷贝p1</span></span><br><span class="line">		<span class="type">PersonDeep</span> <span class="variable">pd2</span> <span class="operator">=</span> (PersonDeep) pd1.clone();</span><br><span class="line">		<span class="comment">// p1和p2是两个不同的实例，输出“false”</span></span><br><span class="line">		System.out.println(pd1 == pd2);</span><br><span class="line">		<span class="comment">// 设置p1</span></span><br><span class="line">		pd1.setName(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">		pd1.setOccupation(<span class="string">&quot;程序员&quot;</span>);</span><br><span class="line">		pd1.setWorkExperienceDeep(<span class="string">&quot;Alibaba&quot;</span>);</span><br><span class="line">		<span class="comment">// 设置拷贝而来的p2</span></span><br><span class="line">		pd2.setName(<span class="string">&quot;李四&quot;</span>);</span><br><span class="line">		pd2.setOccupation(<span class="string">&quot;老师&quot;</span>);</span><br><span class="line">		pd2.setWorkExperienceDeep(<span class="string">&quot;Tsinghua&quot;</span>);</span><br><span class="line">		<span class="comment">// 以下3行分别输出“张三”， “程序员”， “Alibaba”</span></span><br><span class="line">		<span class="comment">// WorkExperienceDeep没有被pd2修改为&quot;Tsinghua&quot;，说明PersonDeep是深拷贝类型</span></span><br><span class="line">		System.out.println(pd1.getName());</span><br><span class="line">		System.out.println(pd1.getOccupation());</span><br><span class="line">		System.out.println(pd1.getWorkExperience().getCompany());</span><br><span class="line">		<span class="comment">// 以下3行分别输出“李四”， “老师”， “Tsinghua”</span></span><br><span class="line">		System.out.println(pd2.getName());</span><br><span class="line">		System.out.println(pd2.getOccupation());</span><br><span class="line">		System.out.println(pd2.getWorkExperience().getCompany());</span><br><span class="line">		<span class="comment">// 如下输出“false”，说明p1和p2中的引用类型WorkExperience是不同的实例</span></span><br><span class="line">		System.out.println(pd1.getWorkExperience() == pd2.getWorkExperience());</span><br><span class="line">		</span><br><span class="line">		System.out.println(<span class="string">&quot;====如下是浅拷贝示例====&quot;</span>);</span><br><span class="line">		<span class="type">Person</span> <span class="variable">p1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">		<span class="type">Person</span> <span class="variable">p2</span> <span class="operator">=</span> (Person) p1.clone();</span><br><span class="line">		<span class="comment">// p1和p2是两个不同的实例，输出“false”</span></span><br><span class="line">		System.out.println(p1 == p2);</span><br><span class="line">		<span class="comment">// 设置p1</span></span><br><span class="line">		p1.setName(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">		p1.setOccupation(<span class="string">&quot;程序员&quot;</span>);</span><br><span class="line">		p1.setWorkExperience(<span class="string">&quot;Alibaba&quot;</span>);</span><br><span class="line">		p1.setCountry(<span class="string">&quot;CHINA&quot;</span>);</span><br><span class="line">		<span class="comment">// 设置拷贝而来的p2</span></span><br><span class="line">		p2.setName(<span class="string">&quot;李四&quot;</span>);</span><br><span class="line">		p2.setOccupation(<span class="string">&quot;老师&quot;</span>);</span><br><span class="line">		p2.setWorkExperience(<span class="string">&quot;Tsinghua&quot;</span>);</span><br><span class="line">		p2.setCountry(<span class="string">&quot;SINGAPORE&quot;</span>);</span><br><span class="line">		<span class="comment">// 以下4行分别输出“张三”， “程序员”， “Tsinghua”，“CHINA”</span></span><br><span class="line">		<span class="comment">// WorkExperience被p2修改为&quot;Tsinghua&quot;，说明Person是浅拷贝类型</span></span><br><span class="line">		<span class="comment">// 另外，p1中的CHINA并没有因为p2设置为了SINGAPORE而受到影响，</span></span><br><span class="line">		<span class="comment">// 说明自定义的不变类Country在浅拷贝中也拷贝到了新实例，而不是只拷贝其引用</span></span><br><span class="line">		System.out.println(p1.getName());</span><br><span class="line">		System.out.println(p1.getOccupation());</span><br><span class="line">		System.out.println(p1.getWorkExperience().getCompany());</span><br><span class="line">		System.out.println(p1.getCountry());</span><br><span class="line">		<span class="comment">// 以下4行分别输出“李四”， “老师”， “Tsinghua”，“SINGAPORE”</span></span><br><span class="line">		System.out.println(p2.getName());</span><br><span class="line">		System.out.println(p2.getOccupation());</span><br><span class="line">		System.out.println(p2.getWorkExperience().getCompany());</span><br><span class="line">		System.out.println(p2.getCountry());</span><br><span class="line">		<span class="comment">// 如下输出“true”，说明p1和p2中的引用类型WorkExperience是相同的实例</span></span><br><span class="line">		System.out.println(p1.getWorkExperience() == p2.getWorkExperience());</span><br><span class="line">		<span class="comment">// 如下输出“false”，说明p1和p2中的引用类型Country是不同的实例</span></span><br><span class="line">		System.out.println(p1.getCountry() == p2.getCountry());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 深拷贝版</span></span><br><span class="line"><span class="comment"> * 原型类</span></span><br><span class="line"><span class="comment"> * 实现Cloneable接口并重写clone方法</span></span><br><span class="line"><span class="comment"> * 本类中的非不变引用类型字段也通过该字段自身的clone()进行拷贝</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PersonDeep</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String occupation;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">	<span class="keyword">private</span> WorkExperienceDeep workExperience;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 在构造器中实例化引用类型WorkExperience</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">PersonDeep</span><span class="params">()</span> &#123;</span><br><span class="line">		workExperience = <span class="keyword">new</span> <span class="title class_">WorkExperienceDeep</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> age;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.age = age;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getOccupation</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> occupation;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setOccupation</span><span class="params">(String occupation)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.occupation = occupation;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> WorkExperienceDeep <span class="title function_">getWorkExperience</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> workExperience;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setWorkExperienceDeep</span><span class="params">(String company)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.workExperience.setCompany(company);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 重写clone()使得原型类Person能够执行clone()从而被拷贝</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">protected</span> Object <span class="title function_">clone</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="type">PersonDeep</span> <span class="variable">person</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			person = (PersonDeep) <span class="built_in">super</span>.clone();</span><br><span class="line">			person.workExperience = (WorkExperienceDeep) person.getWorkExperience().clone();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (CloneNotSupportedException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> person;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 深拷贝版</span></span><br><span class="line"><span class="comment"> * 原型类型中的引用类型字段</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WorkExperienceDeep</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String company;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getCompany</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> company;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCompany</span><span class="params">(String company)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.company = company;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">protected</span> Object <span class="title function_">clone</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="type">WorkExperienceDeep</span> <span class="variable">we</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			we = (WorkExperienceDeep) <span class="built_in">super</span>.clone();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (CloneNotSupportedException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> we;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 浅拷贝版</span></span><br><span class="line"><span class="comment"> * 原型类，实现Cloneable接口并重写clone方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String occupation;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">	<span class="keyword">private</span> WorkExperience workExperience;</span><br><span class="line">	<span class="keyword">private</span> Country country;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 在构造器中实例化引用类型WorkExperience</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">Person</span><span class="params">()</span> &#123;</span><br><span class="line">		workExperience = <span class="keyword">new</span> <span class="title class_">WorkExperience</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> age;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.age = age;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getOccupation</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> occupation;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setOccupation</span><span class="params">(String occupation)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.occupation = occupation;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> WorkExperience <span class="title function_">getWorkExperience</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> workExperience;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getCountry</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> country.getCountryName();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCountry</span><span class="params">(String countryName)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.country = <span class="keyword">new</span> <span class="title class_">Country</span>(countryName);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setWorkExperience</span><span class="params">(String company)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.workExperience.setCompany(company);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 重写clone()使得原型类Person能够对外拷贝</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">protected</span> Object <span class="title function_">clone</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			person = (Person) <span class="built_in">super</span>.clone();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (CloneNotSupportedException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> person;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 浅拷贝版</span></span><br><span class="line"><span class="comment"> * 原型类型中的引用类型字段</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WorkExperience</span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String company;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getCompany</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> company;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCompany</span><span class="params">(String company)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.company = company;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 浅拷贝版</span></span><br><span class="line"><span class="comment"> * 自定义不变类，用于演示在浅拷贝中对不变类的拷贝结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Country</span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String countryName;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">Country</span><span class="params">(String countryName)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.countryName = countryName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getCountryName</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> countryName;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />
<h3 id="简单-静态-工厂模式">简单(静态)工厂模式</h3>
<h4 id="模式说明-3">模式说明</h4>
<p>当客户端需要根据 <strong>某个变量的不同值来获取不同的对象实例</strong> 时，可以使用简单工厂模式。该模式设置了一个生产产品 (前述的对象实例) 的工厂类，此工厂类通过静态方法 (所以称为静态工厂) 传入变量参数，方法体内有选择分支 (<code>if-else</code> 或 <code>switch-case</code>)，根据参数返回具体的产品。</p>
<p>例如，天气是变量，客户端根据天气的不同情况，令服装工厂生产不同的服装，雨天生产雨衣，低温天气生产羽绒服，高温天气生产泳衣等等。在这个例子中服装工厂就是静态工厂，不同的衣服是不同的具体产品。 <strong>天气情况就是工厂类里静态方法的参数</strong> 。让不同的产品都继承同一个抽象产品类，那么抽象产品类，具体的产品类和静态工厂类就形成了简单工厂模式的完整结构。</p>
<blockquote>
<p>注：简单工厂模式不在GoF的23种设计模式之列。</p>
</blockquote>
<p>当产品类有增删改时，需要在静态工厂类中修改选择分支，因此 <strong>简单工厂模式不满足开闭原则</strong> 。后续的工厂方法模式将解决这个问题。</p>
<p>本示例以四则运算为例，演示客户端如何通过运算符从运算工厂中获取相应的运算产品，然后执行该产品的产品方法 (执行运算) 返回结果。</p>
<br />
<h4 id="结构-3">结构</h4>
<table>
<thead>
<tr>
<th>类/接口</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>静态工厂类</td>
<td>维护一个静态方法，根据参数返回具体产品类的实例 (返回类型是抽象产品类型) 。</td>
</tr>
<tr>
<td>抽象产品类</td>
<td>定义产品字段和方法(操作数<code>a,b</code>和运算方法<code>result()</code>) 。</td>
</tr>
<tr>
<td>具体产品类</td>
<td>继承抽象产品类，实现具体运算方法</td>
</tr>
</tbody>
</table>
<br />
<h4 id="代码演示-3">代码演示</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 简单工厂模式(静态工厂模式)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StaticFactoryDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 通过静态工厂类静态方法返回一个具体产品。</span></span><br><span class="line">        <span class="type">Operation</span> <span class="variable">oper</span> <span class="operator">=</span> OperationFactory.operate(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">// 执行该产品的方法。输出“12”</span></span><br><span class="line">        System.out.println(oper.result(<span class="number">3</span>, <span class="number">4</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 静态工厂类</span></span><br><span class="line"><span class="comment"> * 通过一个类静态方法，根据输入返回相应的工厂类。内部通常为 if-else 或 switch-case。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OperationFactory</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Operation <span class="title function_">operate</span><span class="params">(String sign)</span> &#123;</span><br><span class="line">        <span class="type">Operation</span> <span class="variable">oper</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">switch</span> (sign) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;+&quot;</span>:</span><br><span class="line">            oper = <span class="keyword">new</span> <span class="title class_">OperationAdd</span>();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;-&quot;</span>:</span><br><span class="line">            oper = <span class="keyword">new</span> <span class="title class_">OperationSub</span>();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;*&quot;</span>:</span><br><span class="line">            oper = <span class="keyword">new</span> <span class="title class_">OperationMul</span>();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;/&quot;</span>:</span><br><span class="line">            oper = <span class="keyword">new</span> <span class="title class_">OperationDiv</span>();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            System.out.println(<span class="string">&quot;不支持此运算。&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> oper;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象产品类</span></span><br><span class="line"><span class="comment"> * 定义产品的抽象方法。</span></span><br><span class="line"><span class="comment"> * 下例以四则运算为产品，内有对两个int数的运算方法。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Operation</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">int</span> <span class="title function_">result</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体产品类</span></span><br><span class="line"><span class="comment"> * 继承抽象产品类，实现抽象方法。下例为加法产品。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OperationAdd</span> <span class="keyword">extends</span> <span class="title class_">Operation</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">result</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体产品类，减法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OperationSub</span> <span class="keyword">extends</span> <span class="title class_">Operation</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">result</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a - b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体产品类，乘法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OperationMul</span> <span class="keyword">extends</span> <span class="title class_">Operation</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">result</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a * b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体产品类，除法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OperationDiv</span> <span class="keyword">extends</span> <span class="title class_">Operation</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">result</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(b == <span class="number">0</span>) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;除数不能为0.&quot;</span>);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> a / b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />
<h3 id="工厂方法模式">工厂方法模式</h3>
<h4 id="模式说明-4">模式说明</h4>
<p>在简单工厂模式中，当出现产品类的增删改时，均需要 <strong>修改静态产品工厂类内的选择分支</strong> ，破坏了开闭原则。针对这个不足，可以将生产不同产品的工厂也单独成类，他们继承同一个抽象工厂类。这样在出现新产品时只增加相应的产品类和生产他的工厂类，对其他代码均无需改动其他。等到要使用这个新工厂时，再在客户端中声明这个工厂的实例，由它来生产产品即可。这就是 <strong>符合开闭原则的工厂方法模式</strong> 。</p>
<p>本示例以四则运算为例，演示客户端如何声明一个具体的运算工厂并通过该工厂生产相应的运算产品，然后执行该产品的产品方法 (执行运算) 返回结果。</p>
<br />
<h4 id="结构-4">结构</h4>
<table>
<thead>
<tr>
<th>类/接口</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>抽象工厂类</td>
<td>定义一个创建产品的抽象方法。</td>
</tr>
<tr>
<td>具体工厂类</td>
<td>继承抽象工厂类，实现创建产品的抽象方法。</td>
</tr>
<tr>
<td>抽象产品类</td>
<td>定义抽象产品方法。</td>
</tr>
<tr>
<td>具体产品类</td>
<td>继承抽象产品类，实现抽象产品方法。</td>
</tr>
</tbody>
</table>
<br />
<h4 id="代码演示-4">代码演示</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 工厂方法模式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FactoryMethodDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 声明一个具体运算工厂</span></span><br><span class="line">        <span class="type">OperFactory</span> <span class="variable">fa</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AddFactory</span>();</span><br><span class="line">        <span class="comment">// 由该工厂提供运算产品</span></span><br><span class="line">        <span class="type">Oper</span> <span class="variable">oper</span> <span class="operator">=</span> fa.createOper();</span><br><span class="line">        <span class="comment">// 执行产品的运算方法得到结果，输出“7”</span></span><br><span class="line">        System.out.println(oper.result(<span class="number">3</span>, <span class="number">4</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象工厂类</span></span><br><span class="line"><span class="comment"> * 定义一个创建产品的抽象方法。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">OperFactory</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Oper <span class="title function_">createOper</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体工厂类</span></span><br><span class="line"><span class="comment"> * 继承抽象工厂类，实现创建产品的抽象方法。</span></span><br><span class="line"><span class="comment"> * 下例是加法工厂。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AddFactory</span> <span class="keyword">extends</span> <span class="title class_">OperFactory</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Oper <span class="title function_">createOper</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OperAdd</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体工厂类</span></span><br><span class="line"><span class="comment"> * 下例是减法工厂。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SubFactory</span> <span class="keyword">extends</span> <span class="title class_">OperFactory</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Oper <span class="title function_">createOper</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OperSub</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 下例是乘法工厂</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MulFactory</span> <span class="keyword">extends</span> <span class="title class_">OperFactory</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Oper <span class="title function_">createOper</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OperMul</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 下例是除法工厂</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DivFactory</span> <span class="keyword">extends</span> <span class="title class_">OperFactory</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Oper <span class="title function_">createOper</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OperDiv</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象产品类</span></span><br><span class="line"><span class="comment"> * 定义抽象产品方法。</span></span><br><span class="line"><span class="comment"> * 本示例的产品为四则运算，产品方法为运算过程。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Oper</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">int</span> <span class="title function_">result</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体产品类</span></span><br><span class="line"><span class="comment"> * 继承抽象产品类，实现抽象产品方法。</span></span><br><span class="line"><span class="comment"> * 下例是加法产品。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OperAdd</span> <span class="keyword">extends</span> <span class="title class_">Oper</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">result</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体产品类</span></span><br><span class="line"><span class="comment"> * 下例是减法产品。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OperSub</span> <span class="keyword">extends</span> <span class="title class_">Oper</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">result</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a - b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体产品类</span></span><br><span class="line"><span class="comment"> * 下例是乘法产品。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OperMul</span> <span class="keyword">extends</span> <span class="title class_">Oper</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">result</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a * b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体产品类</span></span><br><span class="line"><span class="comment"> * 下例是除法产品。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OperDiv</span> <span class="keyword">extends</span> <span class="title class_">Oper</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">result</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(b == <span class="number">0</span>) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;除数不能为0.&quot;</span>);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> a / b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />
<h3 id="抽象工厂模式">抽象工厂模式</h3>
<h4 id="模式说明-5">模式说明</h4>
<p>工厂方法模式的扩展，结构相似，但工厂方法中的工厂类只能生产一种产品，<strong>抽象工厂的工厂类可以生产多种产品</strong> 。形式上，若工厂模式中的抽象工厂类，有不止一个生产产品的抽象方法，且这些产品 (方法返回类型) 不同，具体工厂类实现该抽象工厂类时重写所有抽象方法，那它就是抽象工厂模式。</p>
<p>本示例以四则运算为例，演示客户端如何声明一个具体的运算工厂并获取多种不同的运算产品，然后这些产品执行其产品方法(执行运算)返回结果。</p>
<br />
<h4 id="结构-5">结构</h4>
<table>
<thead>
<tr>
<th>类/接口</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>抽象工厂类</td>
<td>定义多个创建产品的抽象方法。有多少种产品就写多少个方法。</td>
</tr>
<tr>
<td>具体工厂类</td>
<td>继承抽象工厂类，实现创建产品的抽象方法。</td>
</tr>
<tr>
<td>抽象产品类</td>
<td>抽象工厂中有多少种不同产品的抽象方法，就有多少个抽象产品类。定义抽象产品方法。</td>
</tr>
<tr>
<td>具体产品类</td>
<td>继承抽象产品类，实现抽象产品方法。</td>
</tr>
</tbody>
</table>
<br />
<h4 id="代码演示-5">代码演示</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象工厂模式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AbstractFactoryDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 声明一个具体运算工厂，加法工厂</span></span><br><span class="line">        <span class="type">IFactory</span> <span class="variable">fa</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OperationAddFactory</span>();</span><br><span class="line">        <span class="comment">// 该加法工厂生产int型加法产品(运算)</span></span><br><span class="line">        <span class="type">OperationInt</span> <span class="variable">operInt</span> <span class="operator">=</span> fa.createOperationInt();</span><br><span class="line">        <span class="comment">// 该加法工厂生产另一种产品(运算)，double型产品</span></span><br><span class="line">        <span class="type">OperationDouble</span> <span class="variable">operDouble</span> <span class="operator">=</span> fa.createOperationDouble();</span><br><span class="line">        <span class="comment">// int型产品执行其产品方法(执行运算)</span></span><br><span class="line">        System.out.println(operInt.result(<span class="number">4</span>, <span class="number">5</span>));</span><br><span class="line">        <span class="comment">// double型产品执行其产品方法(执行运算)</span></span><br><span class="line">        System.out.println(operDouble.result(<span class="number">1.2</span>, <span class="number">1.7</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象工厂类</span></span><br><span class="line"><span class="comment"> * 定义多个创建产品的抽象方法。有多少种产品就写多少个方法。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">IFactory</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> OperationInt <span class="title function_">createOperationInt</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">// 工厂方法模式的产品(运算)只有int型的，抽象工厂模式中多了double型产品</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> OperationDouble <span class="title function_">createOperationDouble</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体工厂类</span></span><br><span class="line"><span class="comment"> * 继承抽象工厂类，实现创建产品的抽象方法。</span></span><br><span class="line"><span class="comment"> * 下例是加法工厂。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OperationAddFactory</span> <span class="keyword">extends</span> <span class="title class_">IFactory</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> OperationInt <span class="title function_">createOperationInt</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OperationIntAdd</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> OperationDouble <span class="title function_">createOperationDouble</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OperationDoubleAdd</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象产品类</span></span><br><span class="line"><span class="comment"> * 定义抽象产品方法。</span></span><br><span class="line"><span class="comment"> * 下例是int类型运算产品的抽象类。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">OperationInt</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">int</span> <span class="title function_">result</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象产品类</span></span><br><span class="line"><span class="comment"> * 下例是double类型运算产品的抽象类。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">OperationDouble</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">double</span> <span class="title function_">result</span><span class="params">(<span class="type">double</span> a, <span class="type">double</span> b)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体产品类</span></span><br><span class="line"><span class="comment"> * 继承抽象产品类，实现抽象产品方法。</span></span><br><span class="line"><span class="comment"> * 下例是int加法产品。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OperationIntAdd</span> <span class="keyword">extends</span> <span class="title class_">OperationInt</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">result</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体产品类</span></span><br><span class="line"><span class="comment"> * 下例是double加法类。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OperationDoubleAdd</span> <span class="keyword">extends</span> <span class="title class_">OperationDouble</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">result</span><span class="params">(<span class="type">double</span> a, <span class="type">double</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />
<h3 id="建造者模式">建造者模式</h3>
<h4 id="模式说明-6">模式说明</h4>
<p>有一些同类型的不同对象，他们由多个部件构成，构成的方式相同，但每个部件在不同对象中可能有不同的特征细节。举例来说，无论是哪个品牌的电脑，都由CPU，显示器，硬盘内存，键盘等部件构成，只是对不同品牌不同型号的PC，部件的细节不同，例如苹果电脑的CPU是苹果自研的，联想电脑CPU是英特尔的。在客户端中完成对不同对象的建造，最直接的方式是分别声明他们，然后调用各自的建造动作来完成。但这样的做法无法利用不同对象建造过程稳定且相同(只是细节不同)的特点，达不到代码复用的效果。针对这种场景，可以使用建造者模式来实现。</p>
<p>建造者模式提供一个抽象建造者类，类内定义了稳定的产品建造过程，即建造具体产品各部件的抽象方法。这样具体建造者继承抽象建造者类后，可以根据需要重写某些部件的建造方法。具体建造者类内持有一个产品类实例，用于保存建造完成后的产品，并通过他的getter的方法获取该产品的实例。展示产品细节的动作在产品类中完成，这就是所谓的将复杂对象(即本模式中的产品类)的构造和表示分离，实际就是建造者类(负责产品建造)和产品类(负责表示)分离。客户端发起产品建造时，可以声明一个具体建造类，并调用其建造过程(多个部件的<code>build</code>方法)，但这样一来就对客户端暴露了建造过程，且加重了客户端的任务。避免这个缺点的办法是另外设置一个指挥者类，该类只有一个<code>produce</code>方法，方法参数是具体建造者实例，传入该实例，在<code>produce</code>内部调用该实例建造各部件的方法。通过设置指挥者类，将本来暴露在客户端中的建造者对建造过程的调用转移到了指挥者类内部。至此，客户端只需要声明一个指挥者，再声明一个具体建造者，将具体建造者作为指挥者的<code>produce</code>方法参数，指挥者执行其<code>produce</code>完成建造。执行后需要查看得到的产品细节，再调用产品建造者的<code>getProduce</code>方法即可。</p>
<p>本示例以汽车生产为例，展示如何利用建造者模式来生产F1赛车和普通家用汽车。</p>
<br />
<h4 id="结构-6">结构</h4>
<table>
<thead>
<tr>
<th>类/接口</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>指挥者类</strong>: 提供一个指挥生产的方法<code>produce</code>，传入建造者，其内调用建造者的建造方法。<br>
<strong>抽象建造者类</strong>: 提供建造产品各部件的抽象方法和一个返回产品的方法。<br>
<strong>具体建造者类</strong>: 继承抽象建造者类，并持有一个产品实例以供获取。实现产品各部分抽象建造方法和返回产品的抽象方法。<br>
<strong>产品类</strong>: 持有产品各部件的一个集合实例，有一个增加部件的<code>add</code>方法，一个用于展现组成部件的<code>show</code>方法。</p>
<br />
<h4 id="代码演示-6">代码演示</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.pattern.creation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 建造者模式(生成器模式)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BuilderDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 声明一个指挥者</span></span><br><span class="line">        <span class="type">Director</span> <span class="variable">director</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Director</span>();</span><br><span class="line">        <span class="comment">// 声明一个具体建造者</span></span><br><span class="line">        <span class="type">CarMaker</span> <span class="variable">carMaker</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">F1CarMaker</span>();</span><br><span class="line">        <span class="comment">// 指挥者执行produce方法，传入具体建造者执行建造</span></span><br><span class="line">        director.produce(carMaker);</span><br><span class="line">        <span class="comment">// 通过建造者的get方法得到建造后的产品</span></span><br><span class="line">        <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> carMaker.getCar();</span><br><span class="line">        <span class="comment">// 产品调用show方法展示建造后的产品细节</span></span><br><span class="line">        car.show();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 指挥者类</span></span><br><span class="line"><span class="comment"> * 提供一个指挥生产的方法produce，传入具体建造者，执行既定的建造产品的方法</span></span><br><span class="line"><span class="comment"> * 完成产品制造。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Director</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">produce</span><span class="params">(CarMaker cm)</span> &#123;</span><br><span class="line">        cm.buildWheels();</span><br><span class="line">        cm.buildEngine();</span><br><span class="line">        cm.buildSeats();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象建造者类</span></span><br><span class="line"><span class="comment"> * 提供建造产品各部件的抽象方法和一个返回产品的方法。</span></span><br><span class="line"><span class="comment"> * 下例为一个抽象汽车制造者类。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">CarMaker</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">buildWheels</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">buildEngine</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">buildSeats</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Car <span class="title function_">getCar</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体建造者类</span></span><br><span class="line"><span class="comment"> * 继承抽象建造者类，并持有一个产品实例，实现产品各部分抽象建造方法和返回</span></span><br><span class="line"><span class="comment"> * 产品的抽象方法(返回其持有的产品实例)。</span></span><br><span class="line"><span class="comment"> * 下例是F1赛车制造者</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">F1CarMaker</span> <span class="keyword">extends</span> <span class="title class_">CarMaker</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buildWheels</span><span class="params">()</span> &#123;</span><br><span class="line">        car.add(<span class="string">&quot;赛车轮胎&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buildEngine</span><span class="params">()</span> &#123;</span><br><span class="line">        car.add(<span class="string">&quot;赛车引擎&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buildSeats</span><span class="params">()</span> &#123;</span><br><span class="line">        car.add(<span class="string">&quot;赛车座椅&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Car <span class="title function_">getCar</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> car;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体建造者类</span></span><br><span class="line"><span class="comment"> * 按照该建造者的实际情况实现产品各部分建造方法和返回产品方法</span></span><br><span class="line"><span class="comment"> * 下例是家用车制造者</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HomeCarMaker</span> <span class="keyword">extends</span> <span class="title class_">CarMaker</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buildWheels</span><span class="params">()</span> &#123;</span><br><span class="line">        car.add(<span class="string">&quot;家用车轮胎&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buildEngine</span><span class="params">()</span> &#123;</span><br><span class="line">        car.add(<span class="string">&quot;家用车引擎&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buildSeats</span><span class="params">()</span> &#123;</span><br><span class="line">        car.add(<span class="string">&quot;家用车座椅&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Car <span class="title function_">getCar</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> car;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 要建造的产品类</span></span><br><span class="line"><span class="comment"> * 持有产品各部件的集合List&lt;String&gt;，定义一个add方法用于添加构件。另定义</span></span><br><span class="line"><span class="comment"> * 一个show方法用于展示建造的产品细节。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; parts = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(String part)</span> &#123;</span><br><span class="line">        parts.add(part);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(parts);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />
<h2 id="结构型设计模式">结构型设计模式</h2>
<p>结构型模式用于将类或对象按某种方式组成更大的结构，包含如下7种模式。</p>
<ul>
<li>代理 / 适配器 / 桥接 / 装饰器 / 外观 / 享元 / 组合。</li>
</ul>
<br />
<h3 id="代理模式">代理模式</h3>
<h4 id="模式说明-7">模式说明</h4>
<p>客户端不直接声明实际对象 (主体类) ，而是声明代理类对象，通过 <strong>调用代理类对象的方法来间接执行真实主体类的行为</strong> 。</p>
<p>本示例中以代理售房场景为例。该场景要求房东告知房屋信息如房子类型，价格等给购房者。在客户端中不方便暴露房东时，即可采用代理模式，通过房屋中介来完成告知动作。<strong>代理类持有主体类实例</strong> ，即房屋中介持有一个房东实例 ，客户端只声明代理类，调用代理类实例中与房东类相同的方法来完成。房东类和代理类都是目标接口实现类，实现相同的抽象方法，代理类实现该抽象方法的方式仅仅是调用其持有的房东类的方法。</p>
<p>JDK 中的 Thread 即实现了代理模式。</p>
<br />
<h4 id="结构-7">结构</h4>
<table>
<thead>
<tr>
<th>类/接口</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>抽象主体类</td>
<td>定义真实主体的方法。</td>
</tr>
<tr>
<td>具体主体类</td>
<td>继承抽象类，实现抽象方法。</td>
</tr>
<tr>
<td>代理类</td>
<td>内部持有一个具体主体类的实例，通过调用该具体主题实例的方法来实现抽象主题类的抽象方法。</td>
</tr>
</tbody>
</table>
<br />
<h4 id="代码演示-7">代码演示</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProxyDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 声明一个房屋代理类</span></span><br><span class="line">        <span class="type">HouseAgent</span> <span class="variable">agent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HouseAgent</span>(<span class="keyword">new</span> <span class="title class_">HouseHolder</span>(<span class="string">&quot;三室一厅&quot;</span>, <span class="number">100</span>));</span><br><span class="line">        agent.showHouse(); <span class="comment">// 调用代理类的方法，输出“三室一厅”</span></span><br><span class="line">        agent.negotiatePrice(); <span class="comment">// 输出“100万”</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象主题类</span></span><br><span class="line"><span class="comment"> * 下例为抽象房东类，有抽象展示房屋方法和抽象价格交涉方法。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Subject</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">showHouse</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">negotiatePrice</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体主题类</span></span><br><span class="line"><span class="comment"> * 继承抽象主题类，实现抽象方法。</span></span><br><span class="line"><span class="comment"> * 下例为房东类。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HouseHolder</span> <span class="keyword">extends</span> <span class="title class_">Subject</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String house;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> price;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HouseHolder</span><span class="params">(String house, <span class="type">int</span> price)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.house = house;</span><br><span class="line">        <span class="built_in">this</span>.price = price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showHouse</span><span class="params">()</span> &#123;</span><br><span class="line">        house = <span class="string">&quot;三室一厅&quot;</span>;</span><br><span class="line">        System.out.println(house);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">negotiatePrice</span><span class="params">()</span> &#123;</span><br><span class="line">        price = <span class="number">100</span>;</span><br><span class="line">        System.out.println(price + <span class="string">&quot;万&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 代理类</span></span><br><span class="line"><span class="comment"> * 持有一个具体主题类实例(房东)，实现接口抽象方法，在内部调用真实主题的方法。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HouseAgent</span> <span class="keyword">extends</span> <span class="title class_">Subject</span>&#123;</span><br><span class="line">    HouseHolder holder;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HouseAgent</span><span class="params">(HouseHolder holder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.holder = holder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showHouse</span><span class="params">()</span> &#123;</span><br><span class="line">        before();</span><br><span class="line">        holder.showHouse();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">negotiatePrice</span><span class="params">()</span> &#123;</span><br><span class="line">        holder.negotiatePrice();</span><br><span class="line">        after();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;====中介与房东沟通===&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;====中介与买家沟通===&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />
<h3 id="适配器模式">适配器模式</h3>
<h4 id="模式说明-8">模式说明</h4>
<p>当前有一工具(一个已存在的类)，能实现若干功能(方法)，需要在某平台(目标)上使用，但与平台的接口不同(已存在的类的方法与接口方法名不同)，需提供一个适配器(适配器类)转换为平台接口。这种场景可以使用适配器模式实现。与代理模式比较类似，但代理类中的<code>RealSubject</code>和<code>Proxy</code>都需要实现<code>Subject</code>抽象类。而适配器模式中的<code>Adaptee</code>类是原本就已存在的类，内部的方法与接口中定义的抽象方法不同(行为一致，方法名不同)。</p>
<p>本示例中，以<code>Typec</code>为抽象目标类，其内有标准充电方法<code>typecChange</code>和标准数据传输方<code>typecDataTran</code>。现有<code>Typeb</code>类和<code>Lightning</code>类，均有自己的充电方法和数据传输方法。演示如何为他们设置适配器类，使得客户端能够通过调用适配器中的符合<code>Typec</code>的标准方法来间接使用<code>Typeb</code>和<code>Lightning</code>的充电和数据传输功能(方法)。</p>
<br />
<h4 id="结构-8">结构</h4>
<table>
<thead>
<tr>
<th>类/接口</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>抽象目标类</strong>: 定义抽象标准方法。<br>
<strong>被适配类</strong>: 有与目标类相同功能的方法，但接口(方法名)不符合标准接口(与目标类内定义的方法的方法名不同)。<br>
<strong>适配器类</strong>: 继承目标抽象类，内部持有一个被适配类实例，实现目标抽象类的抽象方法，在方法内部调用其持有的被适配类的原有方法。</p>
<br />
<h4 id="代码演示-8">代码演示</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.pattern.structure;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 适配器模式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdapterDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 使用非标准物件时，声明其适配器</span></span><br><span class="line">        <span class="type">Typec</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AdapterB2C</span>();</span><br><span class="line">        <span class="type">Typec</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AdapterL2C</span>();</span><br><span class="line">        <span class="comment">// 通过调用对应适配器的标准方法，间接使用</span></span><br><span class="line">        <span class="comment">// 输出“使用TypeB接口充电”</span></span><br><span class="line">        t1.typecCharge();</span><br><span class="line">        <span class="comment">// 输出“使用TypeB接口传输数据”</span></span><br><span class="line">        t1.typecDataTrans();</span><br><span class="line">        <span class="comment">// 输出“使用TypeB接口充电”</span></span><br><span class="line">        t2.typecCharge();</span><br><span class="line">        <span class="comment">// 输出“使用TypeB接口传输数据”</span></span><br><span class="line">        t2.typecDataTrans();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象目标类</span></span><br><span class="line"><span class="comment"> * 定义抽象标准方法。</span></span><br><span class="line"><span class="comment"> * 下例是Typec方式的充电方法和数据传输方法。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Typec</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">typecCharge</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">typecDataTrans</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象目标类的继承类</span></span><br><span class="line"><span class="comment"> * 在本模式中不是必须的，只是为了展示无需适配的情况。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HuaweiTypeC</span> <span class="keyword">extends</span> <span class="title class_">Typec</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">typecCharge</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;使用TypeC接口充电&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">typecDataTrans</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;使用TypeC接口传输数据&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 被适配类(需要适配的类)</span></span><br><span class="line"><span class="comment"> * 有与目标类相同功能的方法，但接口(方法名)不符合标准接口(与目标类内定义</span></span><br><span class="line"><span class="comment"> * 的方法的方法名不同)。</span></span><br><span class="line"><span class="comment"> * 下例是Typeb类，使用Typeb方式的充电和数据传输方法。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Typeb</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">typebCharge</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;使用TypeB接口充电&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">typebDataTrans</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;使用TypeB接口传输数据&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 适配器类</span></span><br><span class="line"><span class="comment"> * 继承目标抽象类，内部持有一个被适配类实例，实现目标抽象类的抽象方法，在</span></span><br><span class="line"><span class="comment"> * 方法内部调用其持有的被适配类的原有方法。</span></span><br><span class="line"><span class="comment"> * 下例是Typeb转Typec的适配器。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AdapterB2C</span> <span class="keyword">extends</span> <span class="title class_">Typec</span>&#123;</span><br><span class="line">    <span class="type">Typeb</span> <span class="variable">typeb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Typeb</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">typecCharge</span><span class="params">()</span> &#123;</span><br><span class="line">        typeb.typebCharge();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">typecDataTrans</span><span class="params">()</span> &#123;</span><br><span class="line">        typeb.typebDataTrans();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 被适配类(需要适配的类)</span></span><br><span class="line"><span class="comment"> * 下例是Lightning类，使用Lightning方式的充电和数据传输方法。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Lightning</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">lightningCharge</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;使用Lightning接口充电&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">lightningDataTrans</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;使用Lightning接口传输数据&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 适配器类</span></span><br><span class="line"><span class="comment"> * 下例是Lightning转Typec的适配器。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AdapterL2C</span> <span class="keyword">extends</span> <span class="title class_">Typec</span>&#123;</span><br><span class="line">    <span class="type">Lightning</span> <span class="variable">ln</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Lightning</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">typecCharge</span><span class="params">()</span> &#123;</span><br><span class="line">        ln.lightningCharge();;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">typecDataTrans</span><span class="params">()</span> &#123;</span><br><span class="line">        ln.lightningDataTrans();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />
<h3 id="桥接模式">桥接模式</h3>
<h4 id="模式说明-9">模式说明</h4>
<p>当一个事物可以通过多个维度描述时，要避免多个维度层层继承该事物的抽象类，而应该将这些不同的维度从事物中分离出来独立变化。例如电脑可以通过不同品牌和不同软件描述，可以将电脑作为一个<code>PC</code>抽象类，以品牌为主体，不同品牌继承该<code>PC</code>类如<code>ApplePC</code>。软件分离出来成为一个独立的抽象类<code>Software</code>，具体软件继承该<code>Software</code>抽象类，例如<code>Browser</code>类。在PC抽象类中以组合形式拥有<code>Software</code>，并通过调用<code>Software</code>的方法，实施<code>Software</code>中的行为。在UML图中分离事物抽象类通过带组合箭头的线与主体事物抽象类连接，故名桥接。</p>
<p>本示例演示上述PC场景。如果希望增加一个华为品牌PC只需增加继承<code>PC</code>类的<code>HuaweiPC</code>类即可，无需改动其他类。同理希望增加视频软件时，也只需要增加<code>VideoPlayer</code>类而无需关注品牌。这就是各自独立变化。另，本示例中主体事物<code>PC</code>只持有一个<code>Software</code>实例，如果想同时持有多个<code>Software</code>实例，可以声明为集合类型(如<code>List</code>)，然后增加相应的<code>add</code>方法。</p>
<br />
<h4 id="结构-9">结构</h4>
<table>
<thead>
<tr>
<th>类/接口</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>抽象主体事物类</strong>: 主体事物，类内声明一个以protected修饰的分离事物(以抽象类型声明)。声明一个用于实施分离事物行为的抽象方法。<br>
<strong>具体主体事物类</strong>: 继承抽象主体事物类，实现抽象方法。<br>
<strong>抽象分离事物类</strong>: 能够描述主体事物的某个维度的事物，声明自己的行为。<br>
<strong>具体分离事物类</strong>: 继承抽象分离事物类，实现抽象方法。</p>
<br />
<h4 id="代码示例">代码示例</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.pattern.structure;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 桥接模式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BridgeDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 声明一个PC(主体事物)</span></span><br><span class="line">        <span class="type">PC</span> <span class="variable">pc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ApplePC</span>();</span><br><span class="line">        <span class="comment">// 声明一个软件(分离事物)</span></span><br><span class="line">        <span class="type">Software</span> <span class="variable">soft1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Browser</span>();</span><br><span class="line">        <span class="comment">// 将软件组合进PC中(主体持有分离)</span></span><br><span class="line">        pc.setSoftware(soft1);</span><br><span class="line">        <span class="comment">// 通过调用主体事物的方法来间接执行分离事物的方法</span></span><br><span class="line">        <span class="comment">// 输出&quot;启动: Browser&quot;</span></span><br><span class="line">        pc.run();</span><br><span class="line">        <span class="comment">// 增加一个软件后，同上</span></span><br><span class="line">        <span class="type">Software</span> <span class="variable">soft2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MusicPlayer</span>();</span><br><span class="line">        pc.setSoftware(soft2);</span><br><span class="line">        <span class="comment">// 输出&quot;启动: MusicPlayer&quot;</span></span><br><span class="line">        pc.run();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 主体事物抽象类</span></span><br><span class="line"><span class="comment"> * 以PC为例，内部声明protected修饰的分离事物Software。非抽象方法</span></span><br><span class="line"><span class="comment"> * setSoftware()传入分离事物使得主体持有分离。声明用于实施Software</span></span><br><span class="line"><span class="comment"> * 行为抽象方法run()。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">PC</span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> Software soft;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSoftware</span><span class="params">(Software soft)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.soft = soft;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 主体事物具体类</span></span><br><span class="line"><span class="comment"> * 继承抽象主体事物类，实现抽象方法run，内部实际调用Software自身的run。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ApplePC</span> <span class="keyword">extends</span> <span class="title class_">PC</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.soft.run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象分离事物类</span></span><br><span class="line"><span class="comment"> * 有自身的属性和方法。</span></span><br><span class="line"><span class="comment"> * 下例是从软件维度描述PC的软件抽象类。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Software</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体分离事物类</span></span><br><span class="line"><span class="comment"> * 继承抽象分离事物类，实现抽抽象方法。</span></span><br><span class="line"><span class="comment"> * 下例是浏览器类。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Browser</span> <span class="keyword">extends</span> <span class="title class_">Software</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Browser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setName(<span class="string">&quot;Browser&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;启动: &quot;</span>+<span class="built_in">this</span>.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体分离事物类</span></span><br><span class="line"><span class="comment"> * 下例是音乐播放器类。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MusicPlayer</span> <span class="keyword">extends</span> <span class="title class_">Software</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MusicPlayer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setName(<span class="string">&quot;MusicPlayer&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;启动: &quot;</span>+<span class="built_in">this</span>.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />
<h3 id="装饰器模式">装饰器模式</h3>
<h4 id="模式说明-10">模式说明</h4>
<p>使用组合关系来创建一个可以被层层包装的对象(即装饰对器象)来包裹被装饰的主体对象，并在保持主体对象的类结构不变的前提下，通过装饰器对象自己的方法，为被装饰的主体对象提供额外的功能(装饰)。</p>
<p>本示例以技术为抽象主体类(<code>TechComponent</code>)，一项核心技术为具体主体类(<code>JavaComponent</code>)。以其他扩展技术为抽象装饰类(<code>TechDecorator</code>)，其具体装饰类为web技术(<code>WebTechDecorator</code>)和Spring技术(<code>SpringTechDecorator</code>)。演示如何在核心技术上扩展&quot;web&quot;和&quot;Spring&quot;技术。</p>
<br />
<h4 id="结构-10">结构</h4>
<table>
<thead>
<tr>
<th>类/接口</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>主体接口</strong>: 定义一种行为方法。<br>
<strong>具体主体类</strong>: 实现抽象主体接口，实现抽象方法。<br>
<strong>抽象装饰器类</strong>: 装饰部件抽象类，实现抽象主体接口，实现抽象方法。<br>
<strong>具体装饰器类</strong>: 继承抽象装饰类，拥有自己的行为方法的同时实现抽象方法，并在其中调用自己的行为方法以及完成其所装饰的主体的行为方法。即所谓在保持主体对象不变的前提下，为其提供额外功能。</p>
<br />
<h4 id="代码演示-9">代码演示</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.pattern.structure;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 装饰器模式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DecoratorDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 声明一个主体com</span></span><br><span class="line">        <span class="type">Functionable</span> <span class="variable">com</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JavaComponent</span>();</span><br><span class="line">        <span class="comment">// 声明修饰对象deco1和deco2</span></span><br><span class="line">        <span class="type">TechDecorator</span> <span class="variable">deco1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebTechDecorator</span>();</span><br><span class="line">        <span class="type">TechDecorator</span> <span class="variable">deco2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpringTechDecorator</span>();</span><br><span class="line">        <span class="comment">// 此时主体为com，要在其上装饰deco1，为deco1传入com</span></span><br><span class="line">        deco1.decorate(com);</span><br><span class="line">        <span class="comment">// 此时的主体为deco1，要在其上装饰deco2，为deco2传入deco1</span></span><br><span class="line">        deco2.decorate(deco1);</span><br><span class="line">        <span class="comment">// 调用最后一层装饰对象的func()，会依次调用之前的所有装饰对象的</span></span><br><span class="line">        <span class="comment">// func()方法，最终调用到原始主体com的func()方法</span></span><br><span class="line">        deco2.func();</span><br><span class="line">        <span class="comment">// 修饰顺序不同，调用的装饰器的功能顺序也不同</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 主体接口</span></span><br><span class="line"><span class="comment"> * 声明主体的行为方法funcc()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Functionable</span>&#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">func</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体主体类</span></span><br><span class="line"><span class="comment"> * 实现抽象主体接口。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">JavaComponent</span> <span class="keyword">implements</span> <span class="title class_">Functionable</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">tech</span> <span class="operator">=</span> <span class="string">&quot;JavaSE&quot;</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">func</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;展示主体技术%s的技术内容。\n&quot;</span>, tech);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象装饰器类</span></span><br><span class="line"><span class="comment"> * 实现抽象主体接口，持有一个被本装饰器类装饰前的主体类，实现一个非抽象装饰</span></span><br><span class="line"><span class="comment"> * 方法addTech传入被修饰对象，一个抽象的主体行为方法。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">TechDecorator</span> <span class="keyword">implements</span> <span class="title class_">Functionable</span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> Functionable component;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">decorate</span><span class="params">(Functionable component)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.component = component;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 抽象类实现接口，可以不必实现接口内的抽象方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">func</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体装饰器类</span></span><br><span class="line"><span class="comment"> * 继承抽象装饰器类，拥有自己的行为方法，实现抽象方法的时候调用自己的行为</span></span><br><span class="line"><span class="comment"> * 方法并完成其所装饰的主体的行为方法。</span></span><br><span class="line"><span class="comment"> * 下例是Web技术。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WebTechDecorator</span> <span class="keyword">extends</span> <span class="title class_">TechDecorator</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">tech</span> <span class="operator">=</span> <span class="string">&quot;WebTech&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 重写func()并在其中执行自身功能，即装饰效果</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">func</span><span class="params">()</span> &#123;</span><br><span class="line">        myFunc();</span><br><span class="line">        component.func();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 具体装饰类自身的功能</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">myFunc</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;展示扩展技术%s的技术内容。\n&quot;</span>, tech);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体装饰器类</span></span><br><span class="line"><span class="comment"> * 下例是Spring技术。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpringTechDecorator</span> <span class="keyword">extends</span> <span class="title class_">TechDecorator</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">tech</span> <span class="operator">=</span> <span class="string">&quot;SpringTech&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 重写func()并在其中执行自身功能，即装饰效果</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">func</span><span class="params">()</span> &#123;</span><br><span class="line">        myFunc();</span><br><span class="line">        component.func();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 具体装饰类自身的功能</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">myFunc</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;展示扩展技术%s的技术内容。\n&quot;</span>, tech);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />
<h3 id="外观模式">外观模式</h3>
<h4 id="模式说明-11">模式说明</h4>
<p>当客户端需要通过调用多个对象各自不同的方法时，可以建立一个持有所有这些对象的外观类，根据客户端对上述多个对象的需要，外观类内有多个方法，这些方法内部调用多个不同对象的方法以满足客户端的不同需求。如此客户端就只需要调用外观类的方法，而无需访问多个对象。例如投资者买股票，投资者是客户端，不同公司的股票形成数量众多的对象。此时投资者可以通过基金经理来间接买股票，基金经理就是外观类，他通过不同的投资策略封装了多个股票的买入和卖出等方法，投资者只需要调用基金经理不同的策略方法即可，无需了解每一支股票。</p>
<p>本示例以上述投资者买股票场景为例，演示外观模式的使用。</p>
<br />
<h4 id="结构-11">结构</h4>
<table>
<thead>
<tr>
<th>类/接口</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>外观类</strong>: 持有所有子系统的信息，并为客户端提供了一系列访问子系统的方法，这些方法内根据需要调用一个或多个子系统的方法。<br>
<strong>子系统类</strong>: 可以有多个子系统，每个子系统都有各自的方法。</p>
<br />
<h4 id="代码演示-10">代码演示</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.pattern.structure;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 外观模式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FacadeDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 声明一个外观类</span></span><br><span class="line">        <span class="type">Fund</span> <span class="variable">f</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Fund</span>();</span><br><span class="line">        System.out.println(<span class="string">&quot;====执行基金策略1====&quot;</span>);</span><br><span class="line">        <span class="comment">// 执行既定策略1</span></span><br><span class="line">        f.strategy1();</span><br><span class="line">        System.out.println(<span class="string">&quot;====执行基金策略2====&quot;</span>);</span><br><span class="line">        <span class="comment">// 执行既定策略2</span></span><br><span class="line">        f.strategy2();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 外观类</span></span><br><span class="line"><span class="comment"> * 下例为基金，持有三支股票对象，有两个策略方法，封装对三只股票的不同行为组合。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Fund</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">StockApple</span> <span class="variable">sa</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StockApple</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">StockMaotai</span> <span class="variable">sm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StockMaotai</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">NationalDebt</span> <span class="variable">nd</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NationalDebt</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">strategy1</span><span class="params">()</span> &#123;</span><br><span class="line">        sa.buy();</span><br><span class="line">        sm.toYuebao();</span><br><span class="line">        nd.sell();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">strategy2</span><span class="params">()</span> &#123;</span><br><span class="line">        sa.sell();</span><br><span class="line">        sm.sell();</span><br><span class="line">        nd.buy();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 子系统类</span></span><br><span class="line"><span class="comment"> * 苹果公司股票</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StockApple</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sell</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;卖出Apple股票&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buy</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;买入Apple股票&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 子系统类</span></span><br><span class="line"><span class="comment"> * 茅台股票</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StockMaotai</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">toYuebao</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Maotai股票转入余额宝&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sell</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;买入Maotai股票&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 子系统类</span></span><br><span class="line"><span class="comment"> * 国债</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NationalDebt</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sell</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;卖出国债&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buy</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;买入国债&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />
<h3 id="享元模式">享元模式</h3>
<h4 id="模式说明-12">模式说明</h4>
<p>某些对象相似度很高，只有少量字段或方法不同，当需要大量这类对象时，若为每一次需求都创建实例，内存开销会很大。此时可以提炼出这些对象的相同部分，作为所谓的享元，创建一个享元工厂类，持有享元实例。需要使用上述对象时，从享元工厂中获取该实例。若这些对象有不同部分，提取这些不同部分单独成类，使用时作为享元中的方法参数传入享元(使相同和不同部分结合)。这样无论使用多少次，对于享元而言，只有一个实例的开销。</p>
<p>本示例以网站为抽象享元，博客网站和电子商务网站为具体享元，用户为外部非享元。展示如何通过享元工厂类添加和获取享元，如何将非享元作为享元方法的参数传入到享元内。</p>
<br />
<h4 id="结构-12">结构</h4>
<table>
<thead>
<tr>
<th>类/接口</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>抽象享元类</strong>: 被使用对象中提炼出的相同内容的集合，定义享元的抽象方法。<br>
<strong>具体享元类</strong>: 继承抽象享元类，实现抽象方法。<br>
<strong>非享元类</strong>: 需要使用但不能被提炼为享元内容的部分，单独成类，需要时传入享元。<br>
<strong>享元工厂类</strong>: 持有具体享元实例，有添加享元和获取享元的方法。</p>
<br />
<h4 id="代码演示-11">代码演示</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.pattern.structure;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 享元模式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FlyweightDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 声明享元工厂</span></span><br><span class="line">        <span class="type">WebsiteFactory</span> <span class="variable">fa</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebsiteFactory</span>();</span><br><span class="line">        <span class="comment">// 声明具体享元博客网站和电子商务网站</span></span><br><span class="line">        <span class="type">Website</span> <span class="variable">blog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BlogWebsite</span>(<span class="string">&quot;Blog&quot;</span>);</span><br><span class="line">        <span class="type">Website</span> <span class="variable">ec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BlogWebsite</span>(<span class="string">&quot;EC&quot;</span>);</span><br><span class="line">        <span class="comment">// 向享元工厂中添加如上两种享元</span></span><br><span class="line">        fa.addFlyweight(blog);</span><br><span class="line">        fa.addFlyweight(ec);</span><br><span class="line">        <span class="comment">// 通过享元工厂，创建两个博客网站和两个电子商务网站</span></span><br><span class="line">        <span class="type">Website</span> <span class="variable">blog1</span> <span class="operator">=</span> fa.getFlyweight(<span class="string">&quot;Blog&quot;</span>);</span><br><span class="line">        <span class="type">Website</span> <span class="variable">blog2</span> <span class="operator">=</span> fa.getFlyweight(<span class="string">&quot;Blog&quot;</span>);</span><br><span class="line">        <span class="type">Website</span> <span class="variable">ec1</span> <span class="operator">=</span> fa.getFlyweight(<span class="string">&quot;EC&quot;</span>);</span><br><span class="line">        <span class="type">Website</span> <span class="variable">ec2</span> <span class="operator">=</span> fa.getFlyweight(<span class="string">&quot;EC&quot;</span>);</span><br><span class="line">        <span class="comment">// 将两个博客网站和两个电子商务网站分给不同的使用者</span></span><br><span class="line">        blog1.use(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;莫小言&quot;</span>));</span><br><span class="line">        blog2.use(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;金大庸&quot;</span>));</span><br><span class="line">        ec1.use(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;马风&quot;</span>));</span><br><span class="line">        ec2.use(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;刘强西&quot;</span>));</span><br><span class="line">        <span class="comment">// 如下均输出“true”，即通过享元工厂获取的多个享元以及</span></span><br><span class="line">        <span class="comment">// 工厂内持有的享元均为同一个。</span></span><br><span class="line">        System.out.println(blog == blog1 &amp;&amp; blog1 == blog2);</span><br><span class="line">        System.out.println(ec == ec1 &amp;&amp; ec1 == ec2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 享元工厂类</span></span><br><span class="line"><span class="comment"> * 以Map数据结构持有享元，key为网站类型，value为Website实例。</span></span><br><span class="line"><span class="comment"> * 实现添加享元，获取享元的方法。</span></span><br><span class="line"><span class="comment"> * 客户端声明享元工厂后，需要继续创建享元并将其添加进享元工厂中。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WebsiteFactory</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Website&gt; flyweights = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addFlyweight</span><span class="params">(Website web)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(!flyweights.containsKey(web.getCatagory())) &#123;</span><br><span class="line">            flyweights.put(web.getCatagory(), web);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;已存在该享元。&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Website <span class="title function_">getFlyweight</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(!flyweights.containsKey(key)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;无此享元。&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> flyweights.get(key);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 享元抽象类</span></span><br><span class="line"><span class="comment"> * 声明享元的字段和相关方法。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Website</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String catagory;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Website</span><span class="params">(String catagory)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.catagory = catagory;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCatagory</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> catagory;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">use</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体享元类</span></span><br><span class="line"><span class="comment"> * 继承享元抽象类，实现抽象方法。</span></span><br><span class="line"><span class="comment"> * 如下是博客网站类。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BlogWebsite</span> <span class="keyword">extends</span> <span class="title class_">Website</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BlogWebsite</span><span class="params">(String catagory)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(catagory);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">use</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;这是一个%s网站，提供文章发布服务。\n&quot;</span>, getCatagory());</span><br><span class="line">        System.out.printf(<span class="string">&quot;网站用户为%s。\n&quot;</span>, user.getUser());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体享元类</span></span><br><span class="line"><span class="comment"> * 如下是电子商务网站类。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ECWebsite</span> <span class="keyword">extends</span> <span class="title class_">Website</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ECWebsite</span><span class="params">(String catagory)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(catagory);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">use</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;这是一个%s网站，提供商品发布服务。\n&quot;</span>, getCatagory());</span><br><span class="line">        System.out.printf(<span class="string">&quot;网站用户为%s。\n&quot;</span>, user.getUser());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 非享元类</span></span><br><span class="line"><span class="comment"> * 享元Website需要结合非享元User使用，例如对博客网站来说，他们可能共用</span></span><br><span class="line"><span class="comment"> * 相同的文章编辑器控件(作为享元的一部分)，但各自使用的用户不同(非享元)。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String user;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String user)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.user = user;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />
<h3 id="组合模式">组合模式</h3>
<h4 id="模式说明-13">模式说明</h4>
<p>一系列对象可以用树来描述，形成树-子树-叶子的层次机构。如一家大型公司，根节点是总公司，下设若干子公司和若干非子公司的直属部门如总公司财经部，总公司人力资源部门。子公司中如同总公司结构，也包含它自己的子公司和直属部门。则子公司对象是所属公司对象的子树，直属部门对象是所属公司对象的叶子。客户端对单个对象和组合对象具有一致的访问性。即上层公司A(根)和其子公司B(子树)，其直属部门C(树叶)继承同一个抽象构件类，有相同的方法。但因为树叶不再有子节点，根据树叶中是否包含针对子节点的方法(例如<code>add</code>增加儿子，<code>remove</code>，<code>getChild</code>等)，分为透明方式和安全方式。</p>
<p>本示例以总公司和子公司场景为例，演示透明方式的组合模式。在客户端中将树枝和树叶机构加入到根(总公司)中，然后调用总公司的方法，实现对其下属机构的递归调用。</p>
<p><strong>透明方式</strong><br>
树叶与树枝具有同样的，在抽象构件类中声明的针对子节点的方法时，对客户端而言，一个对象是树枝还是树叶是透明的，客户端无需关心。这种方式下，树叶无儿子，却仍需实现针对儿子的各种方法(空方法或抛出异常)，存在安全性问题。</p>
<p><strong>安全方式</strong><br>
与透明方式相对，不在抽象构件类和树叶实现类中声明针对儿子的方法，只在树枝中实现。缺点是客户端需要提前知道哪些对象是树枝，哪些是树叶，失去透明性。</p>
<br />
<h4 id="结构-13">结构</h4>
<table>
<thead>
<tr>
<th>类/接口</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>抽象构件类</strong>: 树枝和树叶的抽象类，声明了公共抽象方法，实现默认行为。<br>
<strong>具体实现树枝类</strong>: 继承抽象构件类，具有儿子的对象，包含针对儿子的各种方法。<br>
<strong>具体实现树叶类</strong>: 继承抽象构件，不具有儿子的对象。若包含针对儿子的各种方法为透明方式，不包含则为安全模式。</p>
<br />
<h4 id="代码演示-12">代码演示</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.pattern.structure;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 组合模式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CompositeDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 声明上海总公司</span></span><br><span class="line">        <span class="type">Company</span> <span class="variable">hq</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteCompany</span>();</span><br><span class="line">        hq.setName(<span class="string">&quot;上海总公司&quot;</span>);</span><br><span class="line">        <span class="comment">// 声明上海总公司的叶子机构并添加到总公司中</span></span><br><span class="line">        <span class="type">Company</span> <span class="variable">hqHR</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HRDepartment</span>();</span><br><span class="line">        hqHR.setName(<span class="string">&quot;上海总公司人力资源部&quot;</span>);</span><br><span class="line">        hq.add(hqHR);</span><br><span class="line">        <span class="type">Company</span> <span class="variable">hqFi</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FinanceDepartment</span>();</span><br><span class="line">        hqFi.setName(<span class="string">&quot;上海总公司财务部&quot;</span>);</span><br><span class="line">        hq.add(hqFi);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 声明上海总公司的树枝机构广州分公司，并完成其下属机构的添加</span></span><br><span class="line">        <span class="type">Company</span> <span class="variable">gzSub</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteCompany</span>();</span><br><span class="line">        gzSub.setName(<span class="string">&quot;广州分公司&quot;</span>);</span><br><span class="line">        <span class="type">Company</span> <span class="variable">gzHR</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HRDepartment</span>();</span><br><span class="line">        gzHR.setName(<span class="string">&quot;广州分公司人力资源部&quot;</span>);</span><br><span class="line">        gzSub.add(gzHR);</span><br><span class="line">        <span class="type">Company</span> <span class="variable">gzFi</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FinanceDepartment</span>();</span><br><span class="line">        gzFi.setName(<span class="string">&quot;广州分公司财务部&quot;</span>);</span><br><span class="line">        gzSub.add(gzFi);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 将广州分公司添加到上海总公司</span></span><br><span class="line">        hq.add(gzSub);</span><br><span class="line">        <span class="comment">// 调用总公司hq的display()方法，递归调用其下分支机构的display()方法</span></span><br><span class="line">        System.out.println(<span class="string">&quot;====机构====&quot;</span>);</span><br><span class="line">        hq.display();</span><br><span class="line">        <span class="comment">// 调用总公司hq的duty()方法，递归调用其下分支机构的duty()方法</span></span><br><span class="line">        System.out.println(<span class="string">&quot;====职责====&quot;</span>);</span><br><span class="line">        hq.duty();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象构件类</span></span><br><span class="line"><span class="comment"> * 持有实例字段和非抽象实例方法，定义抽象方法。</span></span><br><span class="line"><span class="comment"> * 下例以公司为抽象构件类。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Company</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Company com)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(Company com)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">duty</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 树枝类</span></span><br><span class="line"><span class="comment"> * 继承抽象构件类，比抽象类多一个用于保存儿子的List，实现抽象方法。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteCompany</span> <span class="keyword">extends</span> <span class="title class_">Company</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Company&gt; subs = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Company com)</span> &#123;</span><br><span class="line">        subs.add(com);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(Company com)</span> &#123;</span><br><span class="line">        subs.remove(com);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="built_in">this</span>.getName());</span><br><span class="line">        <span class="keyword">for</span>(Company com : subs) &#123;</span><br><span class="line">            com.display();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">duty</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;%s，统筹公司所有事务。\n&quot;</span>, <span class="built_in">this</span>.getName());</span><br><span class="line">        <span class="keyword">for</span>(Company com : subs) &#123;</span><br><span class="line">            com.duty();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 树叶类</span></span><br><span class="line"><span class="comment"> * 继承抽象构件类，实现抽象方法，但对于针对儿子的方法，被调用时打印不支持</span></span><br><span class="line"><span class="comment"> * 操作的提示。</span></span><br><span class="line"><span class="comment"> * 下例是HR部门类。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HRDepartment</span> <span class="keyword">extends</span> <span class="title class_">Company</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Company com)</span> &#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;%s无子机构，不支持此操作。\n&quot;</span>, <span class="built_in">this</span>.getName());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(Company com)</span> &#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;%s无子机构，不支持此操作。\n&quot;</span>, <span class="built_in">this</span>.getName());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="built_in">this</span>.getName());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">duty</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;%s，负责公司员工招聘薪酬管理。\n&quot;</span>, <span class="built_in">this</span>.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 树叶类</span></span><br><span class="line"><span class="comment"> * 下例是财务部门类。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FinanceDepartment</span> <span class="keyword">extends</span> <span class="title class_">Company</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Company com)</span> &#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;%s无子机构，不支持此操作。\n&quot;</span>, <span class="built_in">this</span>.getName());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(Company com)</span> &#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;%s无子机构，不支持此操作。\n&quot;</span>, <span class="built_in">this</span>.getName());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="built_in">this</span>.getName());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">duty</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;%s，负责公司财务管理。\n&quot;</span>, <span class="built_in">this</span>.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />
<h2 id="行为型设计模式">行为型设计模式</h2>
<p>行为型模式用于描述多个对象间如何互相协作，完成单个对象难以完成的任务，包含如下11种行为型模式。</p>
<ul>
<li>模板方法 / 策略 / 命令 / 责任链 / 状态 / 观察者 / 中介者 / 迭代器 / 访问者 / 备忘录 / 解释器</li>
</ul>
<br />
<h3 id="模板方法模式">模板方法模式</h3>
<h4 id="模式说明-14">模式说明</h4>
<p>有这样一些对象，他们都要执行若干动作，这些动作中多数类似或完全相同，例如不同客户到银行处理业务，都需要取号，排队，与柜员交流，处理后对服务评分等。在这里取号，排队，评分动作是完全相同的，与柜员交流的细节可能不同，可能是办理存款业务，也可能是取款，购买基金等。针对此类场景，可以将设置一个抽象模板类，类内声明相关方法，再定义一个驱动方法来调用这些相关方法。这样子类继承抽象模板类后自动复用了大部分的代码，对于具体实现中有区别的细节，在子类中重写即可。</p>
<p>本示例以大学生和小学生入学活动为例，将入学活动中相同的部分放在抽象模板类中，子类继承时自动获得，而子类中不同部分在抽象类中定义为抽象方法或钩子方法，具体实现延迟到子类中。</p>
<br />
<h4 id="结构-14">结构</h4>
<table>
<thead>
<tr>
<th>类/接口</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>抽象模板类</strong>: 定义方法骨架，并确定一个<code>procedure</code>方法，将需要执行的方法集中放置其中，客户端调用该<code>procedure</code>即可统一执行多个既定的方法。该类内方法分为普通方法，抽象方法和钩子方法。<br>
<strong>具体实现类</strong>: 继承抽象模板类，按自身情况实现其中的各种方法。</p>
<br />
<h4 id="代码演示-13">代码演示</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.pattern.behavior;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 模板方法模式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TemplateMethodDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Admission</span> <span class="variable">ad1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CollegeAdmission</span>();</span><br><span class="line">        System.out.println(<span class="string">&quot;====大学生的入学活动====&quot;</span>);</span><br><span class="line">        ad1.templateProcedure();</span><br><span class="line">        System.out.println(<span class="string">&quot;====小学生的入学活动====&quot;</span>);</span><br><span class="line">        <span class="type">Admission</span> <span class="variable">ad2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PrimarySchoolAdmission</span>();</span><br><span class="line">        ad2.templateProcedure();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象模板类</span></span><br><span class="line"><span class="comment"> * 定义方法骨架，并确定一个procedure方法，将需要执行的方法集中放置，客户端</span></span><br><span class="line"><span class="comment"> * 调用该procedure即可统一执行多个既定的方法。该类内方法分为普通方法，抽象</span></span><br><span class="line"><span class="comment"> * 方法和钩子方法。普通方法是所有子类均的共同步骤，且细节一致。抽象方法也是</span></span><br><span class="line"><span class="comment"> * 共同步骤，但细节不同，延迟到子类中实现。钩子方法分为简单钩子和挂载钩子方法。</span></span><br><span class="line"><span class="comment"> * 对于简单钩子方法，抽象类中将其声明为空方法体的普通方法，子类可以选择重写</span></span><br><span class="line"><span class="comment"> * 扩展，若不重写则执行空方法体(相当于不执行)。对于挂载钩子方法，抽象类中先</span></span><br><span class="line"><span class="comment"> * 定义一个用于判断是否执行挂载钩子方法的返回boolean类型的抽象方法。再在挂载</span></span><br><span class="line"><span class="comment"> * 钩子方法中通过一个if-else判断上述boolean类型方法的返回值，true则执行，</span></span><br><span class="line"><span class="comment"> * false则进入空分支(相当于不执行)。boolean类型抽象方法延迟到子类实现，由</span></span><br><span class="line"><span class="comment"> * 子类决定是否进入执行挂载钩子方法的执行分支。挂载钩子方法本身在抽象类中可以</span></span><br><span class="line"><span class="comment"> * 作为普通方法，这样子类中就不必重写了。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Admission</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">templateProcedure</span><span class="params">()</span> &#123;</span><br><span class="line">        healthCheck();</span><br><span class="line">        payTuition();</span><br><span class="line">        militaryTraining();</span><br><span class="line">        morningExercise();</span><br><span class="line">        registerClasses();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">healthCheck</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;到教育部指定体检机构体检。&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">payTuition</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;通过教育部统一学费缴纳平台缴费。&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 将军训设置为一个简单钩子方法，具体实现类可选择实现</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">militaryTraining</span><span class="params">()</span> &#123;&#125;;</span><br><span class="line">    <span class="comment">// 将早操设置为一个挂载钩子方法，具体实现类中先实现hasMorningExcercise，</span></span><br><span class="line">    <span class="comment">// true则执行(要做早操)，false不执行(进入空分支，相当于不执行)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">boolean</span> <span class="title function_">hasMorningExcercise</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">morningExercise</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(hasMorningExcercise()) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;要做早操。&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">registerClasses</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">choseDormitory</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体实现类</span></span><br><span class="line"><span class="comment"> * 继承抽象模板类，按自身情况实现其中的各种方法。</span></span><br><span class="line"><span class="comment"> * 下例是大学生入学活动类。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CollegeAdmission</span> <span class="keyword">extends</span> <span class="title class_">Admission</span> &#123;</span><br><span class="line">    <span class="comment">// 具体实现类中扩展钩子方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">militaryTraining</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;高校新生入学后要参加军训。&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 重写抽象类中的挂载钩子方法的触发方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasMorningExcercise</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerClasses</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;高校新生课程注册由新生自行完成。&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">choseDormitory</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;高校新生入学后请在校内宿舍系统内选择宿舍。&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体实现类</span></span><br><span class="line"><span class="comment"> * 下例是小学生入学活动类。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PrimarySchoolAdmission</span> <span class="keyword">extends</span> <span class="title class_">Admission</span>&#123;</span><br><span class="line">    <span class="comment">// 没有实现抽象类中的简单钩子方法militaryTraining</span></span><br><span class="line">    <span class="comment">// 重写抽象类中的挂载钩子方法的触发方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasMorningExcercise</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerClasses</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;小学新生课程注册由班主任完成。&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">choseDormitory</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;小学新生原则上不提供校内住宿，特殊情况请单独申请。&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />
<h3 id="策略模式">策略模式</h3>
<h4 id="模式说明-15">模式说明</h4>
<p>处理同样的事情可以有多种方法，例如排序数组，可以用冒泡，选择，插入，希尔，快速等等排序方法，对于同样的输入有多种策略能来处理并输出不同策略处理的结果。在程序中使用某一种策略，最直接的方式是在在客户端中将不同的策略写入<code>if-else</code>或<code>switch-case</code>的分支，然后由客户端进行选择。缺点是客户端职责过大，违背单一职责原则，其次是某个策略变动需要修改客户端代码，违背开闭原则。针对此类场景可以使用策略模式。每一种策略单独成类，均继承一个抽象策略类，设置一个持有策略类的环境，客户端不必了解每个策略细节，而是声明某个具体策略后，借由上下文类来执行其中的策略动作。如需增减策略，只需要增减相应的策略类。一个已存在的策略出现变动，也只需要修改该策略类本身，增删改都不会影响已有客户端程序，满足开闭原则。一个策略类实现一种策略方法，满足单一职责原则。</p>
<p>本示例以处理收款为例，演示客户端如何通过环境类来指定某种收款策略得到应收结果。</p>
<br />
<h4 id="结构-15">结构</h4>
<table>
<thead>
<tr>
<th>类/接口</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>抽象策略类</strong>: 定义一个收款抽象方法<code>acceptCash</code>。<br>
<strong>具体策略类</strong>: 继承抽象策略类，实现具体策略。<br>
<strong>环境类(上下文类):</strong> 持有一个收费策略类，维护一个收款方法，该方法内实际调用收费策略类的收款方法。</p>
<br />
<h4 id="代码演示-14">代码演示</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.pattern.behavior;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 策略模式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StrategyDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 声明收费具体策略类cash1，按85折收费</span></span><br><span class="line">        <span class="type">Cash</span> <span class="variable">cash1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CashDiscount</span>(<span class="number">0.15</span>);</span><br><span class="line">        <span class="comment">// 声明收费具体策略cash2，正常收费</span></span><br><span class="line">        <span class="type">Cash</span> <span class="variable">cash2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CashNormal</span>();</span><br><span class="line">        <span class="comment">// 声明收费上下文，通过构造器初始化收费策略为cash1</span></span><br><span class="line">        <span class="type">CashContext</span> <span class="variable">cc1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CashContext</span>(cash1);</span><br><span class="line">        <span class="comment">// 声明收费上下文，通过构造器初始化收费策略为cash2</span></span><br><span class="line">        <span class="type">CashContext</span> <span class="variable">cc2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CashContext</span>(cash2);</span><br><span class="line">        <span class="comment">// 付款100，返回cash1策略的应收费用</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">requestMoney1</span> <span class="operator">=</span> cc1.acceptCash(<span class="number">100</span>);</span><br><span class="line">        <span class="comment">// 输出“85.0”</span></span><br><span class="line">        System.out.println(requestMoney1);</span><br><span class="line">        <span class="comment">// 付款100，返回cash1策略的应收费用，输出“100”</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">requestMoney2</span> <span class="operator">=</span> cc2.acceptCash(<span class="number">100</span>);</span><br><span class="line">        <span class="comment">// 输出“100.0”</span></span><br><span class="line">        System.out.println(requestMoney2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象策略类</span></span><br><span class="line"><span class="comment"> * 定义一个收款抽象方法acceptCash，入参是客户付款，返回应收费用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Cash</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">double</span> <span class="title function_">acceptCash</span><span class="params">(<span class="type">double</span> money)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体策略类</span></span><br><span class="line"><span class="comment"> * 继承抽象策略类，实现具体策略。</span></span><br><span class="line"><span class="comment"> * 下例是按原价收费。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CashNormal</span> <span class="keyword">extends</span> <span class="title class_">Cash</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">acceptCash</span><span class="params">(<span class="type">double</span> money)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> money;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体策略类</span></span><br><span class="line"><span class="comment"> * 下例是按折扣收费，折扣在声明具体Cash类时通过构造器传入并初始化。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CashDiscount</span> <span class="keyword">extends</span> <span class="title class_">Cash</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> rate;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CashDiscount</span><span class="params">(<span class="type">double</span> discount)</span> &#123;</span><br><span class="line">        rate = <span class="number">1.0</span> - discount;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">acceptCash</span><span class="params">(<span class="type">double</span> money)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> money * rate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 环境类(上下文类)</span></span><br><span class="line"><span class="comment"> * 持有一个收费策略类，并通过有参构造器传入收费策略实例初始化。</span></span><br><span class="line"><span class="comment"> * 维护一个收款方法，内部调用其所持有的具体收费策略的收款方法。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CashContext</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Cash cash;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CashContext</span><span class="params">(Cash cash)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cash = cash;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">acceptCash</span><span class="params">(<span class="type">double</span> money)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cash.acceptCash(money);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />
<h3 id="命令模式">命令模式</h3>
<h4 id="模式说明-16">模式说明</h4>
<p>请求某个命令执行者执行命令时，最直接的方式是客户端直接传入命令给执行者，但这样就无法管理命令(或者说只能由客户端来管理)，加重了客户端的负担。此类场景可以将命令封装成类，其内持有命令执行者实例，另有一个<code>execute</code>方法，该方法调用命令执行者实例的执行方法。再引入一个命令请求者(或称命令传递者，命令管理者)类来持有命令集合实例，其内有追加命令方法，删除命令方法，最重要的是有一个传递命令的方法<code>request</code>，该方法通过调用其持有的命令对象的<code>execute</code>方法来实现请求(<code>execute</code>内部调用了命令执行者自身的执行方法)。</p>
<p>本示例展示点菜场景下，命令请求者服务员(<code>Waiter</code>类)如何管理命令(<code>Order</code>类)，并通过<code>request</code>调用<code>Order</code>内的<code>excute</code>方法，让厨师(<code>Chef</code>类)执行做菜方法。</p>
<br />
<h4 id="结构-16">结构</h4>
<table>
<thead>
<tr>
<th>类/接口</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>抽象命令类</strong>: 持有一个命令执行者<code>Chef</code>类，并通过带参构造方法初始化<code>Chef</code>属性。有一个抽象方法<code>execute</code>。<br>
<strong>具体命令类</strong>: 继承抽象命令类，实现<code>execute</code>方法，内部调用Chef的做菜方法。<br>
<strong>命令执行类</strong>: 执行命令的角色<code>Chef</code>，内有做菜方法(本例中的<code>makeMutton</code>和<code>makeChickenWings</code>)。<br>
<strong>命令请求者类</strong>: 管理命令和请求执行者执行命令的角色，类内以<code>List</code>持有多个命令实例。维护追加命令方法<code>addOrder</code>，撤销命令方法<code>cancelOrder</code>和请求方法<code>request</code>。<code>request</code>内遍历<code>Order</code>并调用其<code>execute</code>方法。</p>
<br />
<h4 id="代码演示-15">代码演示</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.pattern.behavior;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 命令模式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommandDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 声明命令执行者</span></span><br><span class="line">        <span class="type">Chef</span> <span class="variable">chef</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Chef</span>();</span><br><span class="line">        <span class="comment">// 声明具体命令，通过构造器传入该命令对应的执行者(本例只有一个执行者)</span></span><br><span class="line">        <span class="type">Order</span> <span class="variable">muttonOrder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MuttonOrder</span>(chef);</span><br><span class="line">        <span class="type">Order</span> <span class="variable">wingsOrder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChickenWingsOrder</span>(chef);</span><br><span class="line">        <span class="comment">// 声明命令请求者</span></span><br><span class="line">        <span class="type">Waiter</span> <span class="variable">waiter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Waiter</span>();</span><br><span class="line">        <span class="comment">// 将命令传入请求者内</span></span><br><span class="line">        waiter.addOrder(muttonOrder);</span><br><span class="line">        waiter.addOrder(wingsOrder);</span><br><span class="line">        <span class="comment">// 命令请求者执行request方法，输出&quot;烤羊肉串&quot;，“烤鸡翅”</span></span><br><span class="line">        waiter.request();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象命令类</span></span><br><span class="line"><span class="comment"> * 持有命令执行者类Chef，通过有参构造器传入Chef来初始化。有一个execute抽象方法。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Order</span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> Chef chef;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Order</span><span class="params">(Chef chef)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.chef = chef;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体命令类</span></span><br><span class="line"><span class="comment"> * 实现抽象命令类，实现execute方法，方法内部调用其持有的Chef的做菜方法。</span></span><br><span class="line"><span class="comment"> * 下例是点羊肉串的命令MuttonOrder，execute方法内调用Chef的做羊肉串方法</span></span><br><span class="line"><span class="comment"> * makeMutton。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MuttonOrder</span> <span class="keyword">extends</span> <span class="title class_">Order</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MuttonOrder</span><span class="params">(Chef chef)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(chef);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> &#123;</span><br><span class="line">        chef.makeMutton();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体命令类</span></span><br><span class="line"><span class="comment"> * 下例是点鸡翅的命令ChickenWingsOrder，execute方法内调用Chef的做鸡翅</span></span><br><span class="line"><span class="comment"> * 方法makeChickenWings。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChickenWingsOrder</span> <span class="keyword">extends</span> <span class="title class_">Order</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ChickenWingsOrder</span><span class="params">(Chef chef)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(chef);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> &#123;</span><br><span class="line">        chef.makeChickenWings();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 命令请求者类</span></span><br><span class="line"><span class="comment"> * 持有一个命令实例集合List&lt;Order&gt;。维护管理命令的方法addOrder，cancel，</span></span><br><span class="line"><span class="comment"> * request。其中传递命令的请求方法request遍历该类持有的命令集合，并执行命令</span></span><br><span class="line"><span class="comment"> * 类的execute方法。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Waiter</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Order&gt; orders = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addOrder</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        orders.add(order);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cancelOrder</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        orders.remove(order);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">request</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(Order order : orders) &#123;</span><br><span class="line">            order.execute();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 命令执行者类</span></span><br><span class="line"><span class="comment"> * 真正执行命令的角色，维护做菜方法。</span></span><br><span class="line"><span class="comment"> * 下例是烤羊肉串MakeMutton和烤鸡翅MakeChickenWings方法。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Chef</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">makeMutton</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;烤羊肉串&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">makeChickenWings</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;烤鸡翅&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />
<h3 id="责任链模式">责任链模式</h3>
<h4 id="模式说明-17">模式说明</h4>
<p>工作中可能有这样的请求处理场景，例如假期审批，会根据申请假期的天数长短，由不同权限的主管者审批，但提交申请时总是提交给自己的直接主管，由直接主管来判断是否需要上升到更高权限的管理者来审批。类似场景可以描述为一个请求根据其内容由不同级别的处理者处理，申请入口总是最低级别的处理者。在客户端中处理此类请求，最简单直接的做法用<code>if-else</code>语句遍询所有处理者，最终总能够被某一权限的处理者处理。这种做法的缺点是客户端责任太大，违背了单一职责原则，另外可扩展性也很差，当需要修改或删减处理者时，需要修改客户端代码。对于这种场景可以使用责任链模式实现，创建每一层级的处理者类，内部均实现一个处理方法，请求从最底层处理者开始，每一层级处理者处理请求时，如判断不在权限范围内，则向后继处理者传递该请求，直至最后一层。这种做法很好地实践了单一职责原则，由于每一层级处理者均为一类，对处理者的变化也有良好的扩展能力。</p>
<p>本示例以假期申请为例，演示不同天数的申请如何通过责任链传递从最低层级管理者传递到具有相应权限的管理者处并得到处理。</p>
<br />
<h4 id="结构-17">结构</h4>
<table>
<thead>
<tr>
<th>类/接口</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>抽象处理者类</strong>: 处理请求的对象，类内实现一个设置后继处理者的普通方法，定义一个处理请求的抽象方法。<br>
<strong>具体处理者类</strong>: 继承抽象处理者类，实现抽象方法。<br>
<strong>请求类(可选)</strong>: 当请求比较复杂时，可以将其封装成类。当请求比较简单，如申请假期的场景，可以只用<code>int</code>表示请求。</p>
<br />
<h4 id="代码演示-16">代码演示</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.pattern.behavior;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 责任链模式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResponsibilityChainDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 声明责任链上所有级别的处理者</span></span><br><span class="line">        <span class="comment">// L1处理者有小于3天的请假审批权</span></span><br><span class="line">        <span class="type">Manager</span> <span class="variable">L1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">L1Manager</span>(<span class="string">&quot;一级主管&quot;</span>);</span><br><span class="line">        <span class="comment">// L2处理者有3到10天的请假审批权</span></span><br><span class="line">        <span class="type">Manager</span> <span class="variable">L2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">L2Manager</span>(<span class="string">&quot;二级主管&quot;</span>);</span><br><span class="line">        <span class="comment">// L3处理者有20天以内的请假审批权，超过则驳回</span></span><br><span class="line">        <span class="type">Manager</span> <span class="variable">L3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">L3Manager</span>(<span class="string">&quot;三级主管&quot;</span>);</span><br><span class="line">        <span class="comment">// 从低到高，每个层级的处理者设置自己的上级(后继)处理者</span></span><br><span class="line">        <span class="comment">// 使请求能够从最低级处理者开始传递到最高级处理者</span></span><br><span class="line">        L1.setSuperior(L2);</span><br><span class="line">        L2.setSuperior(L3);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 声明一个请求并设置请求的内容</span></span><br><span class="line">        <span class="type">Application</span> <span class="variable">app</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Application</span>();</span><br><span class="line">        app.setDaysNum(<span class="number">2</span>);</span><br><span class="line">        <span class="comment">// 每次申请均只需由最低级处理者一级主管L1来执行申请</span></span><br><span class="line">        <span class="comment">// 输出&quot;一级主管批准2天请假申请。&quot;</span></span><br><span class="line">        L1.apply(app);</span><br><span class="line">        </span><br><span class="line">        app.setDaysNum(<span class="number">5</span>);</span><br><span class="line">        <span class="comment">// 输出“二级主管批准5天请假申请。”</span></span><br><span class="line">        L1.apply(app);</span><br><span class="line">        </span><br><span class="line">        app.setDaysNum(<span class="number">15</span>);</span><br><span class="line">        <span class="comment">// 输出“三级主管批准15天请假申请。”</span></span><br><span class="line">        L1.apply(app);</span><br><span class="line">        </span><br><span class="line">        app.setDaysNum(<span class="number">21</span>);</span><br><span class="line">        <span class="comment">// 输出“该请假申请天数为21天，三级主管驳回超过20天假期申请。”</span></span><br><span class="line">        L1.apply(app);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象处理者类</span></span><br><span class="line"><span class="comment"> * 持有一个name属性，并在有参构造器中初始化该属性。持有自己的后继处理者</span></span><br><span class="line"><span class="comment"> * superior，通过普通方法setSuperior设置。定义了一个处理申请的抽象</span></span><br><span class="line"><span class="comment"> * 方法apply(Application app)。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Manager</span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> String name;</span><br><span class="line">    <span class="keyword">protected</span> Manager superior;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Manager</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSuperior</span><span class="params">(Manager superior)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.superior = superior;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">apply</span><span class="params">(Application app)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体处理者类</span></span><br><span class="line"><span class="comment"> * 继承抽象处理者类，实现了抽象方法apply，根据申请内容的不同，不能处理时</span></span><br><span class="line"><span class="comment"> * 调用后继处理者的apply方法交由后继处理者处理。</span></span><br><span class="line"><span class="comment"> * 下例是最低级别的处理者L1。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">L1Manager</span> <span class="keyword">extends</span> <span class="title class_">Manager</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">L1Manager</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">apply</span><span class="params">(Application app)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(app.getDaysNum() &lt; <span class="number">3</span>) &#123;</span><br><span class="line">            System.out.printf(<span class="string">&quot;%s批准%d天请假申请。\n&quot;</span>, name, app.getDaysNum());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(superior != <span class="literal">null</span>) &#123;</span><br><span class="line">                superior.apply(app);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体处理者类</span></span><br><span class="line"><span class="comment"> * 下例是L1的后继处理者L2。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">L2Manager</span> <span class="keyword">extends</span> <span class="title class_">Manager</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">L2Manager</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">apply</span><span class="params">(Application app)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(app.getDaysNum() &gt;= <span class="number">3</span> &amp;&amp; app.getDaysNum() &lt;= <span class="number">10</span>) &#123;</span><br><span class="line">            System.out.printf(<span class="string">&quot;%s批准%d天请假申请。\n&quot;</span>, name, app.getDaysNum());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(superior != <span class="literal">null</span>) &#123;</span><br><span class="line">                superior.apply(app);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体处理者类</span></span><br><span class="line"><span class="comment"> * 下例是L2的后继处理者L3。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">L3Manager</span> <span class="keyword">extends</span> <span class="title class_">Manager</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">L3Manager</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">apply</span><span class="params">(Application app)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(app.getDaysNum() &gt; <span class="number">10</span> &amp;&amp; app.getDaysNum() &lt;= <span class="number">20</span>) &#123;</span><br><span class="line">            System.out.printf(<span class="string">&quot;%s批准%d天请假申请。\n&quot;</span>, name, app.getDaysNum());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.printf(<span class="string">&quot;该请假申请天数为%d天，%s驳回超过20天假期申请。\n&quot;</span>, app.getDaysNum(), name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 请求类(可选)</span></span><br><span class="line"><span class="comment"> * 当请求包含较多属性时，可以将请求封装成类。当请求比较简单如申请放假天数，</span></span><br><span class="line"><span class="comment"> * 也可以只用基本数据类型。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Application</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> daysNum;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getDaysNum</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> daysNum;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDaysNum</span><span class="params">(<span class="type">int</span> daysNum)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.daysNum = daysNum;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />
<h3 id="状态模式">状态模式</h3>
<h4 id="模式说明-18">模式说明</h4>
<p>一个对象根据自身属性的变化而做出相应的动作，生活中该场景很常见，例如根据心情的不同，人(心情是人的属性)会做出不同的事情，例如高兴时手舞足蹈，悲伤时哭泣等等。在客户端实现此类场景时，最简单的做法是<code>if-else</code>或<code>switch-case</code>做分支判断/选择。缺点是显而易见的，当变量变化的种类增加时，对象需要相应地增加处理分支，又或者某一变化的动作需要修改时，也要改动源码，这将违背开闭原则。客户端责任过多，违背单一职责原则，另外程序也不易扩展。对于此类场景，可以使用状态模式实现。以一个环境类(上下文类)代表前述对象，其内部持有当前状态属性值和当前状态实例。环境类主要维护三个方法，状态属性值设置方法，状态实例设置方法，对应当前状态的响应方法，该响应方法内部调用不同状态类的响应方法。不同状态单独成类，均继承自一个抽象状态类。客户端使用时，声明环境类，设置状态值后执行环境类的响应方法。方法内实际调用由声明环境类时通过构造器初始化的默认状态实例的响应方法。每个状态类的响应方法会判断状态值，符合本状态实例的要求就处理，否则将自身状态修改为下一个状态(新状态实例赋值给状态对象属性)。如此就可以实现状态的自动转移，直到某个能响应的状态或到最后一个状态也未能响应，处理结束。</p>
<p><strong>状态模式与责任链模式比较</strong><br>
与责任链模式的相似点是都有处理传递的动作，不同之处是责任链模式中所有层级的处理者对象共存，从低往高传。状态模式则是一个环境对象从某个状态开始响应状态值，在当前状态不能响应的情况下，自身状态改变为下一状态，不存在多状态共存的情况</p>
<br />
<p>本示例以根据分数定等级的场景为例，演示如下内容。客户端为一个分数评级类(环境类)<br>
<code>ScoreLevel</code>设置分数后，执行该评级类的响应方法<code>queryLevel</code>返回该分数对应的等级。</p>
<br />
<h4 id="结构-18">结构</h4>
<table>
<thead>
<tr>
<th>类/接口</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>抽象状态类</strong>: 持有状态的一些属性，定义一个状态响应方法。<br>
<strong>具体状态类</strong>: 继承抽象状态类，实现抽象状态类的抽象方法。结合传入的分数评级类(环境类)判断响应或转移状态。<br>
<strong>环境类(上下文类)</strong>: 持有当前状态值和当前状态实例。维护四个方法，<code>getScore/setScore</code>，<code>setScoreState</code>用于设置当前状态实例，<code>queryLevel</code>响应当前状态，返回评级结果。</p>
<br />
<h4 id="代码演示-17">代码演示</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.pattern.behavior;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 状态模式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StateDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 声明一个环境类</span></span><br><span class="line">        <span class="type">ScoreLevel</span> <span class="variable">scoreLevel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ScoreLevel</span>();</span><br><span class="line">        <span class="comment">// 给出当前状态值</span></span><br><span class="line">        scoreLevel.setScore(<span class="number">50</span>);</span><br><span class="line">        <span class="comment">// 输出“该成绩等级为D。”</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">level1</span> <span class="operator">=</span> scoreLevel.queryLevel();</span><br><span class="line">        System.out.printf(<span class="string">&quot;该成绩等级为%s。\n&quot;</span>, level1);</span><br><span class="line">        </span><br><span class="line">        scoreLevel.setScore(<span class="number">60</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">level2</span> <span class="operator">=</span> scoreLevel.queryLevel();</span><br><span class="line">        <span class="comment">// 输出“该成绩等级为C。”</span></span><br><span class="line">        System.out.printf(<span class="string">&quot;该成绩等级为%s。\n&quot;</span>, level2);</span><br><span class="line">        </span><br><span class="line">        scoreLevel.setScore(<span class="number">80</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">level3</span> <span class="operator">=</span> scoreLevel.queryLevel();</span><br><span class="line">        <span class="comment">// 输出“该成绩等级为B。”</span></span><br><span class="line">        System.out.printf(<span class="string">&quot;该成绩等级为%s。\n&quot;</span>, level3);</span><br><span class="line">        </span><br><span class="line">        scoreLevel.setScore(<span class="number">90</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">level4</span> <span class="operator">=</span> scoreLevel.queryLevel();</span><br><span class="line">        <span class="comment">// 输出“该成绩等级为A。”</span></span><br><span class="line">        System.out.printf(<span class="string">&quot;该成绩等级为%s。\n&quot;</span>, level4);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象状态类</span></span><br><span class="line"><span class="comment"> * 持有状态的一些属性，定义一个状态响应方法，参数是环境类实例。</span></span><br><span class="line"><span class="comment"> * 本示例只有一个等级属性。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">ScoreState</span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> String level;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title function_">queryLevel</span><span class="params">(ScoreLevel sl)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体状态类</span></span><br><span class="line"><span class="comment"> * 实现抽象状态类的抽象方法。通过传入的分数评级类(环境类)获取到当前状态值</span></span><br><span class="line"><span class="comment"> * (分数)，判断是否可以响应，可以时返回响应结果，否则调用分数评级类的的</span></span><br><span class="line"><span class="comment"> * setScoreState方法，将当前状态实例设置为C等级状态(状态转移)。</span></span><br><span class="line"><span class="comment"> * 下例是D等级的状态类，为D对应的分数做出响应，令level属性值为D并返回。</span></span><br><span class="line"><span class="comment"> * 判断不能响应时将状态改为C等级状态。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DScoreState</span> <span class="keyword">extends</span> <span class="title class_">ScoreState</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">queryLevel</span><span class="params">(ScoreLevel sl)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(sl.getScore() &lt; <span class="number">60</span>) &#123;</span><br><span class="line">            level = <span class="string">&quot;D&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> level;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            sl.setScoreState(<span class="keyword">new</span> <span class="title class_">CScoreState</span>());</span><br><span class="line">            <span class="keyword">return</span> sl.queryLevel();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体状态类</span></span><br><span class="line"><span class="comment"> * 下例是C等级的状态类，为C对应的分数做出响应，令level属性值为C并返回。</span></span><br><span class="line"><span class="comment"> * 判断不能响应时将状态改为B等级状态。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CScoreState</span> <span class="keyword">extends</span> <span class="title class_">ScoreState</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">queryLevel</span><span class="params">(ScoreLevel sl)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(sl.getScore() &gt;= <span class="number">60</span> &amp;&amp; sl.getScore() &lt; <span class="number">80</span>) &#123;</span><br><span class="line">            level = <span class="string">&quot;C&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> level;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            sl.setScoreState(<span class="keyword">new</span> <span class="title class_">BScoreState</span>());</span><br><span class="line">            <span class="keyword">return</span> sl.queryLevel();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体状态类</span></span><br><span class="line"><span class="comment"> * 下例是B等级的状态类，为B对应的分数做出响应，令level属性值为B并返回。</span></span><br><span class="line"><span class="comment"> * 判断不能响应时将状态改为A等级状态。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BScoreState</span> <span class="keyword">extends</span> <span class="title class_">ScoreState</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">queryLevel</span><span class="params">(ScoreLevel sl)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(sl.getScore() &gt;= <span class="number">80</span> &amp;&amp; sl.getScore() &lt; <span class="number">90</span>) &#123;</span><br><span class="line">            level = <span class="string">&quot;B&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> level;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            sl.setScoreState(<span class="keyword">new</span> <span class="title class_">AScoreState</span>());</span><br><span class="line">            <span class="keyword">return</span> sl.queryLevel();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体状态类</span></span><br><span class="line"><span class="comment"> * 下例是A等级的状态类，为A对应的分数做出响应，令level属性值为A并返回。</span></span><br><span class="line"><span class="comment"> * 最终状态，无转移。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AScoreState</span> <span class="keyword">extends</span> <span class="title class_">ScoreState</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">queryLevel</span><span class="params">(ScoreLevel sl)</span> &#123;</span><br><span class="line">        level = <span class="string">&quot;A&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> level;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 环境类(上下文类)</span></span><br><span class="line"><span class="comment"> * 持有当前状态值int score和当前状态实例ScoreState state。通过无参</span></span><br><span class="line"><span class="comment"> * 构造器初始化state为DScoreState。维护四个方法，getScore/setScore</span></span><br><span class="line"><span class="comment"> * 方法是score的getter/setter；setScoreState用于设置当前状态实例，</span></span><br><span class="line"><span class="comment"> * 状态转移时使用；queryLevel是状态响应方法，通过调用当前状态实例的</span></span><br><span class="line"><span class="comment"> * queryLevel方法返回评级结果。</span></span><br><span class="line"><span class="comment"> * 下例是一个分数评级类。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ScoreLevel</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> score;</span><br><span class="line">    <span class="keyword">private</span> ScoreState state;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 通过构造器初始化当前状态为DScoreState</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ScoreLevel</span><span class="params">()</span>&#123;</span><br><span class="line">        state = <span class="keyword">new</span> <span class="title class_">DScoreState</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getScore</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> score;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setScore</span><span class="params">(<span class="type">int</span> score)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(score &gt;= <span class="number">0</span> &amp;&amp; score &lt;= <span class="number">100</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.score = score;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;分数输入有误。&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setScoreState</span><span class="params">(ScoreState state)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.state = state;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">queryLevel</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> state.queryLevel(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />
<h3 id="观察者模式">观察者模式</h3>
<h4 id="模式说明-19">模式说明</h4>
<p>当一个对象变化时，所有与他有关联关系的对象都将因为这个变化而变化，将前者称为目标对象，后者称为观察者对象。例如以人行道上的红绿灯为目标对象，行人和车辆为观察者对象。当红绿灯从红灯变为绿灯时，行人因为这个变化而从等待转变为过马路，而汽车则从通过转变为等待，这些观察者都对目标的变化做出了反映。此类场景可以用观察者模式实现。</p>
<p>本示例以人民币汇率为目标对象，进口公司和出口公司作为观察者对象。演示目标对象变化时，如何通知所有观察者做出其响应的动作。</p>
<br />
<h4 id="结构-19">结构</h4>
<table>
<thead>
<tr>
<th>类/接口</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>抽象目标类</strong>: 观察者需要观察的对象，类内实现添加和删除观察者的普通方法，定义一个通知所有观察者的抽象方法。<br>
<strong>具体目标类</strong>: 继承抽象目标类，实现抽象方法。<br>
<strong>抽象观察者类</strong>: 持有一个<code>name</code>属性，并有对应的<code>getter/setter</code>。定义了一个响应目标对象变化的抽象方法<code>action</code>，被目标类通知时执行。<br>
<strong>具体观察者类</strong>: 继承抽象观察者类，实现抽象方法<code>action</code>。</p>
<br />
<h4 id="代码演示-18">代码演示</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.pattern.behavior;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 观察者模式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ObserverDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 声明一个具体目标对象，人民币汇率</span></span><br><span class="line">        <span class="type">Rate</span> <span class="variable">rate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RMBRate</span>();</span><br><span class="line">        <span class="comment">// 声明两个不同的观察者对象，进口公司和出口公司</span></span><br><span class="line">        <span class="type">Company</span> <span class="variable">watcher1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ImportCompany</span>();</span><br><span class="line">        <span class="type">Company</span> <span class="variable">watcher2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExportCompany</span>();</span><br><span class="line">        <span class="comment">// 将观察者都加入到目标对象中，以便目标能够在自身产生变化时通知所有观察者</span></span><br><span class="line">        rate.add(watcher1);</span><br><span class="line">        rate.add(watcher2);</span><br><span class="line">        <span class="comment">// 当汇率升高3.5%时，进出口公司分别对这个变化做出应对</span></span><br><span class="line">        rate.change(<span class="number">0.035</span>);</span><br><span class="line">        <span class="comment">// 当汇率下降6.8%时，进出口公司分别对这个变化做出应对</span></span><br><span class="line">        rate.change(-<span class="number">0.068</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象目标类(被观察事物)</span></span><br><span class="line"><span class="comment"> * 持有一个观察者类实例的集合，实现两个非抽象方法，add方法用来添加观察者</span></span><br><span class="line"><span class="comment"> * 实例，remove方法用来删除观察者实例。另有一个抽象方法change，传入变化。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Rate</span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;Company&gt; companies = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Company company)</span> &#123;</span><br><span class="line">        companies.add(company);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(Company company)</span> &#123;</span><br><span class="line">        companies.remove(company);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">change</span><span class="params">(<span class="type">double</span> changedRate)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体目标类</span></span><br><span class="line"><span class="comment"> * 继承抽象目标类，实现抽象方法change，在方法内遍历其持有的所有观察者，</span></span><br><span class="line"><span class="comment"> * 传入变化，执行观察者的action方法。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RMBRate</span> <span class="keyword">extends</span> <span class="title class_">Rate</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">change</span><span class="params">(<span class="type">double</span> changedRate)</span> &#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;人民币汇率变动%.1f%%\n&quot;</span>, changedRate*<span class="number">100</span>);</span><br><span class="line">        <span class="keyword">for</span>(Company company : <span class="built_in">this</span>.companies) &#123;</span><br><span class="line">            company.action(changedRate);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象观察者类</span></span><br><span class="line"><span class="comment"> * 持有一个name属性，并有对应的getter/setter。定义了一个action抽象方法。</span></span><br><span class="line"><span class="comment"> * 下例以公司为抽象观察者类。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Company</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">action</span><span class="params">(<span class="type">double</span> changedRate)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体观察者类</span></span><br><span class="line"><span class="comment"> * 通过无参构造器初始化name。实现抽象观察者类中的抽象方法action。</span></span><br><span class="line"><span class="comment"> * 下例是进口公司观察者，action内实现当人民币汇率降低时减少相应比例</span></span><br><span class="line"><span class="comment"> * 的进口量，升高时增加相应比例的进口量。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ImportCompany</span> <span class="keyword">extends</span> <span class="title class_">Company</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ImportCompany</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setName(<span class="string">&quot;进口公司&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">action</span><span class="params">(<span class="type">double</span> changedRate)</span> &#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;%s动作：\n&quot;</span>, <span class="built_in">this</span>.getName());</span><br><span class="line">        <span class="keyword">if</span>(changedRate &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.printf(<span class="string">&quot;人民币汇率下降了%.1f%%，减少%.1f%%进口量。\n&quot;</span>, </span><br><span class="line">                    -changedRate*<span class="number">100</span>, -changedRate*<span class="number">100</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.printf(<span class="string">&quot;人民币汇率上升了%.1f%%，增加%.1f%%进口量。\n&quot;</span>, </span><br><span class="line">                    changedRate*<span class="number">100</span>, changedRate*<span class="number">100</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体观察者类</span></span><br><span class="line"><span class="comment"> * 下例是出口公司观察者，action内实现当人民币汇率降低时增加相应比例</span></span><br><span class="line"><span class="comment"> * 的进口量，升高时减少相应比例的进口量。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ExportCompany</span> <span class="keyword">extends</span> <span class="title class_">Company</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ExportCompany</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setName(<span class="string">&quot;出口公司&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">action</span><span class="params">(<span class="type">double</span> changedRate)</span> &#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;%s动作：\n&quot;</span>, <span class="built_in">this</span>.getName());</span><br><span class="line">        <span class="keyword">if</span>(changedRate &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.printf(<span class="string">&quot;人民币汇率下降了%.1f%%，增加%.1f%%出口量。\n&quot;</span>, </span><br><span class="line">                    -changedRate*<span class="number">100</span>, -changedRate*<span class="number">100</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.printf(<span class="string">&quot;人民币汇率上升了%.1f%%，下降%.1f%%出口量。\n&quot;</span>, </span><br><span class="line">                    changedRate*<span class="number">100</span>, changedRate*<span class="number">100</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />
<h3 id="中介者模式">中介者模式</h3>
<h4 id="模式说明-20">模式说明</h4>
<p>存在许多需要两两交互信息的同类对象，如果互相之间直接交互，将会形成网状结构，每一个对象都需要知道所有其他对象，且若某对象需要修改，那么其他对象可能也要做出修改，造成牵一发动全身的不良后果。针对这种场景，可以设置一个中介者，将对象间的网状两两交互，转变为通过中介者来居中传递信息，能够大大降低同类对象间的耦合，系统也会变得易扩展易维护。例如新增一个需要通信的成员(本设计模式中所谓的同事)，只需要创建它并注册到中介者中即可，不影响任何其他成员(同事)。</p>
<p>本示例展示中介者闲鱼平台如何向卖家转发买家的商品需求信息，向买家转发卖家的商品上架信息。当有一个买家发布一条商品需求信息时，所有卖家均能收到。当一个卖家发布一条商品上架信息时，所有买家均能收到。</p>
<br />
<h4 id="结构-20">结构</h4>
<table>
<thead>
<tr>
<th>类/接口</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>抽象中介者类</strong>: 定义管理同事和传递信息的方法。本示例中为注册同事的方法<code>register(User user)</code>，转发信息的方法<code>relay(User user, String message)</code>。<br>
<strong>具体中介者类</strong>: 继承抽象中介者。持有一个已完成注册的同事的集合List&lt;User&gt;，实现抽象中介者类中的抽象方法<code>register</code>和<code>relay</code>。<br>
<strong>抽象同事类</strong>: 持有一个中介者实例属性，一个名字属性，通过有参构造器初始化名字属性。定义三个抽象方法，设置中介者的方法<code>setMediator</code>，发送消息的方法<code>send</code>，接收消息的方法<code>receive</code>。<br>
<strong>具体同事类</strong>: 继承抽象同事类。实现抽象同事类中的三个抽象方法。</p>
<br />
<h4 id="代码演示-19">代码演示</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.pattern.behavior;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 中介者模式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MediatorDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 声明一个具体中介者实例闲鱼平台</span></span><br><span class="line">        <span class="type">Mediator</span> <span class="variable">xianyu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XianyuMediator</span>();</span><br><span class="line">        <span class="comment">// 声明卖家1</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">seller1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Seller</span>(<span class="string">&quot;卖家1&quot;</span>);</span><br><span class="line">        <span class="comment">// 声明买家1</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">buyer1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Buyer</span>(<span class="string">&quot;买家1&quot;</span>);</span><br><span class="line">        <span class="comment">// 声明卖家2</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">seller2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Seller</span>(<span class="string">&quot;卖家2&quot;</span>);</span><br><span class="line">        <span class="comment">// 声明买家2</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">buyer2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Buyer</span>(<span class="string">&quot;买家2&quot;</span>);</span><br><span class="line">        <span class="comment">// 将买家和卖家都注册到闲鱼中介者上</span></span><br><span class="line">        xianyu.register(seller1);</span><br><span class="line">        xianyu.register(buyer1);</span><br><span class="line">        xianyu.register(seller2);</span><br><span class="line">        xianyu.register(buyer2);</span><br><span class="line">        <span class="comment">// 当卖家1发布一条商品上架信息时，所有买家都能收到通过闲鱼中介者转发的该消息</span></span><br><span class="line">        seller1.send(<span class="string">&quot;上架了一台小米手机。&quot;</span>);</span><br><span class="line">        <span class="comment">// 当买家1发布一条商品需求信息时，所有卖家都能收到通过闲鱼中介者转发的该消息</span></span><br><span class="line">        buyer1.send(<span class="string">&quot;想要一个皮卡丘手办。&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象中介者类</span></span><br><span class="line"><span class="comment"> * 定义管理同事和传递信息的方法。本示例中为注册同事的方法register(User user)，</span></span><br><span class="line"><span class="comment"> * 转发信息的方法relay(User user, String message)。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Mediator</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(User user)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">relay</span><span class="params">(User user, String message)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体中介者类</span></span><br><span class="line"><span class="comment"> * 继承抽象中介者。持有一个已完成注册的同事的集合List&lt;User&gt;，实现抽象</span></span><br><span class="line"><span class="comment"> * 中介者类中的抽象方法register和relay。relay方法参数为用户User和消息</span></span><br><span class="line"><span class="comment"> * message，判断User属于卖家Seller还是买家Buyer，如果是卖家则该消息是</span></span><br><span class="line"><span class="comment"> * 一则商品上架消息，通知所有买家该消息。如果是买家则该消息是一则商品需求</span></span><br><span class="line"><span class="comment"> * 消息，通知所有卖家该消息。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">XianyuMediator</span> <span class="keyword">extends</span> <span class="title class_">Mediator</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;User&gt; users = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//将user添加到中介者持有的User类集合中，添加时执行User的setMediator方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(!users.contains(user)) &#123;</span><br><span class="line">            users.add(user);</span><br><span class="line">            user.setMediator(<span class="built_in">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">relay</span><span class="params">(User user, String message)</span> &#123;</span><br><span class="line">        <span class="comment">// 打印该用户发出的消息</span></span><br><span class="line">        System.out.println(user.getName()+message);</span><br><span class="line">        <span class="comment">// 判断用户类型，如果是卖家</span></span><br><span class="line">        <span class="keyword">if</span>(user <span class="keyword">instanceof</span> Seller) &#123;</span><br><span class="line">            <span class="comment">// 所有买家接收该消息</span></span><br><span class="line">            <span class="keyword">for</span>(User u : users) &#123;</span><br><span class="line">                <span class="keyword">if</span>(u <span class="keyword">instanceof</span> Buyer) &#123;</span><br><span class="line">                    u.receive(user.getName()+message);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 判断用户类型，如果是买家</span></span><br><span class="line">        <span class="keyword">if</span>(user <span class="keyword">instanceof</span> Buyer) &#123;</span><br><span class="line">            <span class="comment">// 所有卖家接收该消息</span></span><br><span class="line">            <span class="keyword">for</span>(User u : users) &#123;</span><br><span class="line">                <span class="keyword">if</span>(u <span class="keyword">instanceof</span> Seller) &#123;</span><br><span class="line">                    u.receive(user.getName()+message);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象同事类</span></span><br><span class="line"><span class="comment"> * 持有一个中介者实例属性，一个名字属性，通过有参构造器初始化名字属性，</span></span><br><span class="line"><span class="comment"> * 并有一个名字属性的getter。</span></span><br><span class="line"><span class="comment"> * 定义三个抽象方法，设置中介者的方法setMediator，发送消息的方法send，</span></span><br><span class="line"><span class="comment"> * 接收消息的方法receive。</span></span><br><span class="line"><span class="comment"> * 本例的同事类为User类。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">User</span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> Mediator mediator;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">setMediator</span><span class="params">(Mediator mediator)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String message)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">receive</span><span class="params">(String message)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体同事类</span></span><br><span class="line"><span class="comment"> * 继承抽象同事类。实现抽象同事类中的三个抽象方法。setMediator方法传入</span></span><br><span class="line"><span class="comment"> * 中介者实例，赋值给该同事类持有的中介者属性。send方法调用中介者的转发</span></span><br><span class="line"><span class="comment"> * 方法relay，传入当前同事实例(this)和message。receive方法接收message</span></span><br><span class="line"><span class="comment"> * 并打印出来。</span></span><br><span class="line"><span class="comment"> * 下例是卖家类。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Seller</span> <span class="keyword">extends</span> <span class="title class_">User</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Seller</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMediator</span><span class="params">(Mediator mediator)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mediator = mediator;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mediator.relay(<span class="built_in">this</span>, message);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receive</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        System.out.println(<span class="built_in">this</span>.getName() + <span class="string">&quot;收到一条商品需求信息：&quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体同事类</span></span><br><span class="line"><span class="comment"> * 下例是买家类。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Buyer</span> <span class="keyword">extends</span> <span class="title class_">User</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Buyer</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMediator</span><span class="params">(Mediator mediator)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mediator = mediator;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mediator.relay(<span class="built_in">this</span>, message);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receive</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        System.out.println(<span class="built_in">this</span>.getName() + <span class="string">&quot;收到一条商品发布信息：&quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />
<h3 id="迭代器模式">迭代器模式</h3>
<h4 id="模式说明-21">模式说明</h4>
<p>对于由多个相同元素聚合而成的对象，需要遍历内部元素时，最直接的做法是在客户端通过一个<code>for</code>循环来实现遍历操作。该做法的缺点是对客户端暴露了聚合对象的内部，且增加了客户端的负担。另一种做法是在聚合对象内封装一个遍历方法，在客户端调用该方法。缺点同样明显，当要改变遍历方式(例如原本是从前往后，改成从后往前)，就需要修改聚合类中的遍历方法，违背开闭原则。针对这种场景，结合前两种方式的特点，可以将遍历方法分离出来，但不是在客户端中实现，而是创建一个迭代器类，类中持有聚合对象，并实现迭代方法。这样对客户端不用暴露聚合对象内部，又实现了遍历方法和聚合对象的分离。</p>
<p>本示例展示如何在客户端中通过自定义迭代器遍历自定义聚合类内的元素。客户端声明一个具体聚合类(以抽象聚合接口类型声明)，然后初始化该聚合的元素。再通过聚合类的<code>getIterator</code>方法获取具体迭代器类实例(以抽象迭代器类型)。最后调用该<code>Iterator</code>的相关方法完成遍历。</p>
<br />
<h4 id="结构-21">结构</h4>
<table>
<thead>
<tr>
<th>类/接口</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>迭代器接口</strong>: 定义迭代器角色的方法，获取聚合内第一个元素的方法<code>first</code>，获取下一个元素的方法<code>next</code>，判断是否有下一个元素的方法<code>hasNext</code>。<br>
<strong>具体迭代器类</strong>: 迭代器接口的实现类。持有聚合元素的集合<code>List&lt;Object&gt;</code>，持有当前处理元素的下标<code>index</code>。实现<code>fist</code>，<code>next</code>和<code>hasNext</code>三个接口方法。<br>
<strong>抽象聚合接口</strong>: 定义聚合角色的方法，增加聚合元素的方法add，移除聚合元素的方法<code>remove</code>，获取一个迭代器示例的方法<code>getIterator</code>。<br>
<strong>具体聚合类</strong>: 抽象聚合接口的实现类，以<code>List&lt;Object&gt;</code>持有一个聚合示例。实现抽象聚合接口中的<code>add</code>，<code>remove</code>，<code>getIterator</code>方法</p>
<br />
<h4 id="代码演示-20">代码演示</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.pattern.behavior;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 迭代器模式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IteratorDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 声明一个聚合实例</span></span><br><span class="line">        <span class="type">AbstractAggregation</span> <span class="variable">agg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyAggregation</span>();</span><br><span class="line">        <span class="comment">// 通过add方法初始化这个聚合</span></span><br><span class="line">        agg.add(<span class="string">&quot;刘备&quot;</span>);</span><br><span class="line">        agg.add(<span class="string">&quot;关羽&quot;</span>);</span><br><span class="line">        agg.add(<span class="string">&quot;张飞&quot;</span>);</span><br><span class="line">        <span class="comment">// 声明一个迭代器实例</span></span><br><span class="line">        <span class="type">Iterator</span> <span class="variable">iter</span> <span class="operator">=</span> agg.getIterator();</span><br><span class="line">        <span class="comment">// 取出第一个元素</span></span><br><span class="line">        System.out.println(<span class="string">&quot;第一个元素: &quot;</span> + iter.first().toString());</span><br><span class="line">        <span class="comment">// 调用迭代器的hasNext和next方法迭代遍历，用toString将元素转为String输出</span></span><br><span class="line">        System.out.println(<span class="string">&quot;====开始迭代遍历====&quot;</span>);</span><br><span class="line">        <span class="keyword">while</span>(iter.hasNext()) &#123;</span><br><span class="line">            System.out.println(iter.next().toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 迭代器接口</span></span><br><span class="line"><span class="comment"> * 定义迭代器角色的方法，获取聚合内第一个元素的方法first，获取下一个元素</span></span><br><span class="line"><span class="comment"> * 的方法next，判断是否有下一个元素的方法hasNext。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Iterator</span>&#123;</span><br><span class="line">    Object <span class="title function_">first</span><span class="params">()</span>;</span><br><span class="line">    Object <span class="title function_">next</span><span class="params">()</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体迭代器实现类</span></span><br><span class="line"><span class="comment"> * 迭代器接口的实现类。持有聚合元素的集合List&lt;Object&gt;，并通过有参构造器</span></span><br><span class="line"><span class="comment"> * 初始化该集合。持有当前处理元素的下标index，初始值为-1，表示初识时未</span></span><br><span class="line"><span class="comment"> * 处理任何元素。实现fist，next和hasNext三个接口方法。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyIterator</span> <span class="keyword">implements</span> <span class="title class_">Iterator</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Object&gt; list;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyIterator</span><span class="params">(List&lt;Object&gt; list)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.list = list;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">first</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> list.get(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">// 判断有下一个元素时，获取下一个元素，当前元素下标index+1</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">this</span>.hasNext()) &#123;</span><br><span class="line">            obj = list.get(index + <span class="number">1</span>);</span><br><span class="line">            index++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(index &lt; list.size() - <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象聚合类接口</span></span><br><span class="line"><span class="comment"> * 定义三个聚合角色的方法，增加聚合元素的方法add，移除聚合元素的方法remove，</span></span><br><span class="line"><span class="comment"> * 获取一个迭代器实例的方法getIterator。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">AbstractAggregation</span>&#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Object obj)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(Object obj)</span>;</span><br><span class="line">    <span class="keyword">public</span> Iterator <span class="title function_">getIterator</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体聚合实现类</span></span><br><span class="line"><span class="comment"> * 抽象聚合接口的实现类，以List&lt;Object&gt;持有一个聚合实例。实现抽象聚合接口</span></span><br><span class="line"><span class="comment"> * 中的add，remove，getIterator方法。其中getIterator获取一个具体迭代器</span></span><br><span class="line"><span class="comment"> * 类的实例，获取方式是通过有参构造器new一个具体迭代类的实例并返回，构造器</span></span><br><span class="line"><span class="comment"> * 参数是聚合类内部持有的聚合对象List&lt;Object&gt; list。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyAggregation</span> <span class="keyword">implements</span> <span class="title class_">AbstractAggregation</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Object&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">        list.add(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">        list.remove(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Iterator <span class="title function_">getIterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyIterator</span>(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />
<h3 id="访问者模式">访问者模式</h3>
<h4 id="模式说明-22">模式说明</h4>
<p>以不同地方的厨师对相同食材的处理为例描述访问者模式。例如对于鸡，广东厨师会按粤菜做法做成白斩鸡，而四川厨师会做成川菜辣子鸡。对于鱼也类似，广东厨师将其做成清蒸鱼而四川厨师会处理成水煮鱼。可以把厨师描述为访问者，食材是被访问对象，不同的访问者访问相同的对象有不同的结果。具有这种特征的行为模式就是访问者模式。</p>
<p>本示例中，厨师为抽象访问者，广东厨师和四川厨师为具体访问者。被访问事物是鸡和鱼，它们都继承一个抽象访问对象类。广东厨师处理(访问)鸡和鱼会做出白斩鸡和清蒸鱼，而四川厨师处理鸡和鱼会做出辣子鸡和水煮鱼。设置一个访问对象结构类，其内持有所有的访问对象，有管理访问对象的方法<code>add</code>(增加访问对象)和<code>remove</code>(移除访问对象)。在客户端声明一个访问对象结构，然后<code>add</code>具体的访问对象。接着声明具体访问者，调用访问对象结构的访问方法<code>accpet</code>(传入具体访问者)。最终得到该访问者访问所有访问对象的结果。</p>
<br />
<h4 id="结构-22">结构</h4>
<table>
<thead>
<tr>
<th>类/接口</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>抽象访问者类</strong>: 定义对所有访问对象的抽象访问方法。<br>
<strong>具体访问者类</strong>: 继承抽象访问者类，实现抽象访问方法。<br>
<strong>抽象访问对象类</strong>: 定义抽象访问方法<code>accept</code>，用于接受一个具体的访问者类的访问。<br>
<strong>具体访问对象类</strong>: 继承抽象访问对象类，实现抽象方法<code>accept</code>。<br>
<strong>访问对象结构类</strong>: 持有访问对象的集合<code>List&lt;Material&gt;</code>，有若干管理访问对象的方法，有一个传入访问者的访问方法，方法内遍历其持有的访问对象并执行访问动作。</p>
<br />
<h4 id="代码演示-21">代码演示</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.pattern.behavior;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 访问者模式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VisitorDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		<span class="comment">// 声明一个访问对象结构实例</span></span><br><span class="line">		<span class="type">ObjectStructure</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectStructure</span>();</span><br><span class="line">		<span class="comment">// 增加访问对象至结构中</span></span><br><span class="line">		obj.add(<span class="keyword">new</span> <span class="title class_">ChickenMaterial</span>());</span><br><span class="line">		obj.add(<span class="keyword">new</span> <span class="title class_">FishMaterial</span>());</span><br><span class="line">		<span class="comment">// 声明访问者</span></span><br><span class="line">		<span class="type">Cook</span> <span class="variable">gdCook</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GuangdongCook</span>();</span><br><span class="line">		<span class="type">Cook</span> <span class="variable">scCook</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SichuanCook</span>();</span><br><span class="line">		<span class="comment">// 访问对象结构执行其accept方法，接收具体访问者的访问</span></span><br><span class="line">		<span class="comment">// 输出“粤菜白斩鸡”，“粤菜清蒸鱼”</span></span><br><span class="line">		obj.accept(gdCook);</span><br><span class="line">		<span class="comment">// 输出”川菜辣子鸡“，”川菜水煮鱼“</span></span><br><span class="line">		obj.accept(scCook);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象访问者</span></span><br><span class="line"><span class="comment"> * 定义对所有访问对象的抽象访问方法，参数是所要访问的对象。</span></span><br><span class="line"><span class="comment"> * 下例抽象访问者为厨师，访问对象是鸡和鱼。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Cook</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">make</span><span class="params">(ChickenMaterial chicken)</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">make</span><span class="params">(FishMaterial fish)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体访问者</span></span><br><span class="line"><span class="comment"> * 继承抽象访问者类，实现抽象方法。</span></span><br><span class="line"><span class="comment"> * 下例是广东厨师访问鸡和鱼的动作,分别处理为粤菜白斩鸡和粤菜清蒸鱼。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GuangdongCook</span> <span class="keyword">extends</span> <span class="title class_">Cook</span> &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">make</span><span class="params">(ChickenMaterial chicken)</span> &#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;粤菜白斩鸡&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">make</span><span class="params">(FishMaterial fish)</span> &#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;粤菜清蒸鱼&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体访问者</span></span><br><span class="line"><span class="comment"> * 下例是四川厨师访问鸡和鱼的动作，分别处理为川菜辣子鸡和川菜水煮鱼。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SichuanCook</span> <span class="keyword">extends</span> <span class="title class_">Cook</span> &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">make</span><span class="params">(ChickenMaterial chicken)</span> &#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;川菜辣子鸡&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">make</span><span class="params">(FishMaterial fish)</span> &#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;川菜水煮鱼&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象访问对象</span></span><br><span class="line"><span class="comment"> * 定义抽象访问方法accept(Cook cook)，用于接受一个具体的访问者类的访问。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Material</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(Cook cook)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体访问对象</span></span><br><span class="line"><span class="comment"> * 实现抽象类中的抽象方法accept(Cook cook)。传入具体访问者，调用访问者</span></span><br><span class="line"><span class="comment"> * 的行为方法(传入此时的访问对象指针this)。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChickenMaterial</span> <span class="keyword">extends</span> <span class="title class_">Material</span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(Cook cook)</span> &#123;</span><br><span class="line">		cook.make(<span class="built_in">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体访问对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FishMaterial</span> <span class="keyword">extends</span> <span class="title class_">Material</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(Cook cook)</span> &#123;</span><br><span class="line">		cook.make(<span class="built_in">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 访问对象结构类</span></span><br><span class="line"><span class="comment"> * 持有访问对象的集合List&lt;Material&gt;，管理访问对象，有增加访问对象方法add，</span></span><br><span class="line"><span class="comment"> * 移除访问对象方法remove，执行访问者对访问对象的访问动作accept方法。该</span></span><br><span class="line"><span class="comment"> * 方法内用for-each遍历该结构类持有的访问对象集合，并对每一个访问对象执行</span></span><br><span class="line"><span class="comment"> * 其accpet方法。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ObjectStructure</span>&#123;</span><br><span class="line">	<span class="keyword">private</span> List&lt;Material&gt; materials = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Material material)</span> &#123;</span><br><span class="line">		<span class="keyword">if</span>(!materials.contains(material))&#123;</span><br><span class="line">			materials.add(material);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(Material material)</span> &#123;</span><br><span class="line">		<span class="keyword">if</span>(materials.contains(material)) &#123;</span><br><span class="line">			materials.remove(material);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(Cook cook)</span> &#123;</span><br><span class="line">		<span class="keyword">for</span>(Material m : materials) &#123;</span><br><span class="line">			m.accept(cook);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />
<h3 id="备忘录模式">备忘录模式</h3>
<h4 id="模式说明-23">模式说明</h4>
<p>以游戏中的存档和恢复存档为例，在游戏过程中需要保存当前游戏状态(包括各种游戏角色属性)作为存档，在之后的某个时刻能够恢复这个存档。文档中的撤销操作也有类似的需求。此类场景可以用备忘录模式(也叫快照模式)实现。该模式涉及三个角色，发起人类，备忘录类和备忘录管理者类。发起人类管理系统当前状态，并有一个保存为备忘的存档方法，一个恢复为指定备忘版本的恢复存档方法。备忘录类只管理该备忘的状态信息，而备忘录管理者只管理备忘录实例。符合单一职责原则。</p>
<p>本示例客户端中展示备忘录使用过程。声明一个发起者，该发起者设置系统状态后存档。然后创建当前系统存档(备忘录)，并让一个备忘录管理者持有。接着该发起者修改系统状态，最后调用存档恢复方法恢复到修改前状态。</p>
<br />
<h4 id="结构-23">结构</h4>
<table>
<thead>
<tr>
<th>类/接口</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>发起人类</strong>: 持有所有状态信息，并有对应的<code>getter/setter</code>方法。维护一个存档方法<code>createMemento</code>，返回记录当前系统状态信息的<code>Memento</code>。另有一个恢复指定存档的方法<code>restoreMomento(Memento m)</code>，通过参数执行要恢复的<code>Memento</code>。<br>
<strong>备忘录类</strong>: 管理一个备忘中的系统状态信息。本例中只设置了一个状态信息<code>String state</code>，通过构造器初始化该<code>state</code>，并有该<code>state</code>的<code>getter/setter</code>。<br>
<strong>备忘录管理者类</strong>: 持有一个备忘录实例，并有该备忘录实例的<code>getter/setter</code>。</p>
<br />
<h4 id="代码演示-22">代码演示</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.pattern.behavior;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 备忘录模式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MementoDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 声明一个发起者实例</span></span><br><span class="line">        <span class="type">Originator</span> <span class="variable">ori</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Originator</span>();</span><br><span class="line">        <span class="comment">// 设置状态为“Alive”</span></span><br><span class="line">        ori.setState(<span class="string">&quot;Alive&quot;</span>);</span><br><span class="line">        <span class="comment">// 初始时状态为&quot;Alive&quot;，输出&quot;当前状态为:Alive&quot;</span></span><br><span class="line">        ori.display();</span><br><span class="line">        <span class="comment">// 声明一个备忘录管理者并让其持有当前memento</span></span><br><span class="line">        <span class="type">MementoManager</span> <span class="variable">manager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MementoManager</span>();</span><br><span class="line">        manager.setMemento(ori.CreateMemento());</span><br><span class="line">        <span class="comment">// 修改ori中的状态为&quot;Dead&quot;</span></span><br><span class="line">        ori.setState(<span class="string">&quot;Dead&quot;</span>);</span><br><span class="line">        <span class="comment">// 此时ori中的状态为&quot;Dead&quot;，输出&quot;当前状态为:Dead&quot;</span></span><br><span class="line">        ori.display();</span><br><span class="line">        <span class="comment">// 通过管理者持有的备忘录恢复存档</span></span><br><span class="line">        ori.restoreMemento(manager.getMemento());</span><br><span class="line">        <span class="comment">// 恢复后状态为存档时的&quot;Alive&quot;，输出&quot;当前状态为:Alive&quot;</span></span><br><span class="line">        ori.display();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 发起人类</span></span><br><span class="line"><span class="comment"> * 持有所有状态信息，并有对应的getter/setter方法。维护一个存档方法</span></span><br><span class="line"><span class="comment"> * createMemento，返回记录当前系统状态信息的Memento。另有一个恢复指定</span></span><br><span class="line"><span class="comment"> * 存档的方法restoreMomento(Memento m)，通过参数执行要恢复的Memento。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Originator</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getState</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setState</span><span class="params">(String state)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.state = state;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Memento <span class="title function_">CreateMemento</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Memento</span>(state);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">restoreMemento</span><span class="params">(Memento memento)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.state = memento.getState();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;当前状态为:&quot;</span> + state);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 备忘录类</span></span><br><span class="line"><span class="comment"> * 管理一个备忘中的系统状态信息。本例中只设置了一个状态信息String state，</span></span><br><span class="line"><span class="comment"> * 通过构造器初始化该state，并有该state的getter/setter。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Memento</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String state;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Memento</span><span class="params">(String state)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.state = state;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getState</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setState</span><span class="params">(String state)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.state = state;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 备忘录管理者类</span></span><br><span class="line"><span class="comment"> * 持有一个备忘录实例，并有该备忘录实例的getter/setter。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MementoManager</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Memento memento;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Memento <span class="title function_">getMemento</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> memento;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMemento</span><span class="params">(Memento memento)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.memento = memento;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />
<h3 id="解释器模式">解释器模式</h3>
<h4 id="模式说明-24">模式说明</h4>
<p>解释器用来处理这样一类对象，该对象可不断划分为更小的对象，使得对该对象的处理和对再分之后的部分的处理类似，且对于不断再分后得到到的最小单位，有最终处理。例如输入歌曲解析出简谱，每个曲子可以划分为更短的曲子，但解析是类似的，直至单个音符可以直接输出简谱符号(或按定义好的规则转换)。该模式类似组合模式，但解释器模式处理对象的元素通常比组合模式的要多，且组合模式是对象结构模式，而解释器模式是类行为模式。在使用上，组合模式在客户端以树的结构将所有节点按层次组合为一个整体再处理。而对于解释器模式，在客户端直接输入整体，处理时再循环或迭代解释(处理) 非终结表达式直到将迭代至终结符表达式，且所有终结符表达式都被解释完毕。</p>
<p>**非终结符：**可再分为非终结符和终结符的元素，例如“我吃饭”可再分为“我(代词，主语)”,“吃饭(动词，谓语)”,“饭(名词，宾语)”。<br>
**终结符：**不可再分的语法元素，例如上述的“我”，“吃”，“饭”。<br>
参考：<br>
<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Terminal_and_nonterminal_symbols">https://en.wikipedia.org/wiki/Terminal_and_nonterminal_symbols</a></p>
<br />
<p>本示例定义一种关于加法运算的规则，只有符号<code>&quot;a&quot;,&quot;b&quot;,&quot;A&quot;,&quot;B&quot;</code>之间的加减法是合法运算。客户端将输入一些表达式，通过解释器来判断(解释)该表达式是否符合语法定义，合法输出<code>true</code>，不合法输出<code>false</code>。客户端声明一个上下文类<code>Context</code>，将要解释的表达式传入<code>Context</code>的<code>interpret</code>方法中，返回解释结果。<code>Context</code>类内持有一个非终结符表达式实例(以抽象表达式类声明)<code>NonterminalExpression</code>，并通过无参构造器初始化该实例<code>NonterminalExpression</code>的构造器是有参的，参数是终结符表达式实例<code>TerminalExpression</code>。</p>
<br />
<h4 id="结构-24">结构</h4>
<table>
<thead>
<tr>
<th>类/接口</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>抽象表达式类</strong>: 定义一个抽象解释方法<code>interpret(String expression)</code>。<br>
<strong>终结符表达式类</strong>: 继承抽象表达式类。持有一个<code>Set&lt;String&gt;</code>泛型的终结符集合。实现抽象表达式类的抽象解释方法<code>interpret</code>。<br>
<strong>非终结符表达式类</strong>: 继承抽象表达式。持有所有种类的终结符表达式实例(以<code>AbstractExpress</code>类型)。实现抽象表达式类中的抽象解释方法<code>interpret</code>。<br>
<strong>环境类(上下文类)</strong>: 持有所有种类的终结符集合(以<code>String</code>数组类型)，持有一个非终结符实例(以<code>AbstractExpression</code>类型)。维护一个<code>interpret</code>方法，调用非终结符的<code>interpret</code>方法返回解释结果。</p>
<br />
<h4 id="代码演示-23">代码演示</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.pattern.behavior;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 解释器模式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InterpreterDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 声明一个上下文实例</span></span><br><span class="line">        <span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Context</span>();</span><br><span class="line">        <span class="comment">// 合法表达式，输出“true”</span></span><br><span class="line">        System.out.println(context.interpret(<span class="string">&quot;a&quot;</span>));</span><br><span class="line">        <span class="comment">// 合法表达式，输出“true”</span></span><br><span class="line">        System.out.println(context.interpret(<span class="string">&quot;A+b&quot;</span>));</span><br><span class="line">        <span class="comment">// 合法表达式，输出“true”</span></span><br><span class="line">        System.out.println(context.interpret(<span class="string">&quot;A+b-a+a-B&quot;</span>));</span><br><span class="line">        <span class="comment">// 非法表达式，输出“false”</span></span><br><span class="line">        System.out.println(context.interpret(<span class="string">&quot;C+a&quot;</span>));</span><br><span class="line">        <span class="comment">// 非法表达式，输出“false”</span></span><br><span class="line">        System.out.println(context.interpret(<span class="string">&quot;b+a*B&quot;</span>));</span><br><span class="line">        <span class="comment">// 非法表达式，输出“false”</span></span><br><span class="line">        System.out.println(context.interpret(<span class="string">&quot;3&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象表达式类</span></span><br><span class="line"><span class="comment"> * 定义一个抽象解释方法interpret(String expression)。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractExpression</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">boolean</span> <span class="title function_">interpret</span><span class="params">(String expression)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 终结符表达式类</span></span><br><span class="line"><span class="comment"> * 继承抽象表达式类。持有一个Set&lt;String&gt;泛型的终结符集合。并通过有参构造器</span></span><br><span class="line"><span class="comment"> * 初始化。实现抽象表达式类的抽象解释方法interpret。解释过程很简单，判断该</span></span><br><span class="line"><span class="comment"> * 传入的expression是否包含在其持有的终结符集合里，包含则true，否则false。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TerminalExpression</span> <span class="keyword">extends</span> <span class="title class_">AbstractExpression</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;String&gt; terminals = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TerminalExpression</span><span class="params">(String[] terminals)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; terminals.length; i++) &#123;</span><br><span class="line">            <span class="built_in">this</span>.terminals.add(terminals[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Set&lt;String&gt; <span class="title function_">getTerminals</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> terminals;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTerminals</span><span class="params">(Set&lt;String&gt; terminals)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.terminals = terminals;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">interpret</span><span class="params">(String expression)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> terminals.contains(expression);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 非终结表达式类</span></span><br><span class="line"><span class="comment"> * 继承抽象表达式。持有所有终结符(以AbstractExpress类型)，并通过有参构造器</span></span><br><span class="line"><span class="comment"> * 传入终结符集合来初始化。本示例定义两种终结符，小写字母&quot;a&quot;和&quot;b&quot;是一种，大写</span></span><br><span class="line"><span class="comment"> * 字母&quot;A&quot;和&quot;B是另一种。所以本例的非终结符表达式持有两个终结符表达式lowerExp</span></span><br><span class="line"><span class="comment"> * 和upperExp，通过构造器传入lowerExp和upperExp来初始化。</span></span><br><span class="line"><span class="comment"> * 实现抽象表达式类中的抽象解释方法interpret。借助已知的合法的运算符号(&quot;+&quot;,&quot;-&quot;)</span></span><br><span class="line"><span class="comment"> * 通过字符串的split方法将原始表达式分割成一个终结符和一个非终结符，对终结符调用</span></span><br><span class="line"><span class="comment"> * 终结符表达式类的interpret判断，一旦非法立即返回false。对非终结符，递归调用</span></span><br><span class="line"><span class="comment"> * 非终结符表达式的interpret。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NonterminalExpression</span> <span class="keyword">extends</span> <span class="title class_">AbstractExpression</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> AbstractExpression lowerExp;</span><br><span class="line">    <span class="keyword">private</span> AbstractExpression upperExp;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">NonterminalExpression</span><span class="params">(AbstractExpression lowerExp, AbstractExpression upperExp)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.lowerExp = lowerExp;</span><br><span class="line">        <span class="built_in">this</span>.upperExp = upperExp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">interpret</span><span class="params">(String exp)</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> isLegal;</span><br><span class="line">        <span class="comment">// exp多于1个字符时</span></span><br><span class="line">        <span class="keyword">if</span>(exp.length() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// 将表达式分割为两部分，elements[0]为第一个合法运算符号左边的1个字符</span></span><br><span class="line">            <span class="comment">// elements[1]为第一个合法运算符号右边的部分</span></span><br><span class="line">            String[] elements = exp.split(<span class="string">&quot;\\+|\\-&quot;</span>, <span class="number">2</span>);</span><br><span class="line">            <span class="comment">// 判断(解释)elements[0]是否合法</span></span><br><span class="line">            isLegal = lowerExp.interpret(elements[<span class="number">0</span>]) || upperExp.interpret(elements[<span class="number">0</span>]);</span><br><span class="line">            <span class="comment">// lements[0]不合法直接返回false</span></span><br><span class="line">            <span class="keyword">if</span>(!isLegal)&#123;</span><br><span class="line">                <span class="keyword">return</span> isLegal;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 递归调用当前非终结表达式实例的interpret方法判断右边部分</span></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.interpret(elements[<span class="number">1</span>]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 若表达式exp等于或少于一个字符时，调用终结符的interpret返回解释结果</span></span><br><span class="line">            <span class="keyword">return</span> lowerExp.interpret(exp) || upperExp.interpret(exp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 环境类(上下文类)</span></span><br><span class="line"><span class="comment"> * 持有所有种类的终结符集合(以String数组类型)，持有一个非终结符实例</span></span><br><span class="line"><span class="comment"> * (以AbstractExpression类型)。无参构造器中初始化非终结符实例，方法如下：</span></span><br><span class="line"><span class="comment"> * 先通过两个String数组实例化两种终结符，再向非终结符构造参数中传入这两个</span></span><br><span class="line"><span class="comment"> * 终结符实例。</span></span><br><span class="line"><span class="comment"> * 维护一个interpret方法，调用非终结符的interpret方法返回解释结果。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Context</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String[] lowers = &#123;<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">private</span> String[] uppers = &#123;<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">private</span> AbstractExpression exp;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Context</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">AbstractExpression</span> <span class="variable">lowerExp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TerminalExpression</span>(lowers);</span><br><span class="line">        <span class="type">AbstractExpression</span> <span class="variable">upperExp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TerminalExpression</span>(uppers);</span><br><span class="line">        exp = <span class="keyword">new</span> <span class="title class_">NonterminalExpression</span>(lowerExp, upperExp);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">interpret</span><span class="params">(String expression)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.exp.interpret(expression);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://iyukiyama.github.io">yukiyama</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://iyukiyama.github.io/design-pattern/">https://iyukiyama.github.io/design-pattern/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://iyukiyama.github.io" target="_blank">yukiyama</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a></div><div class="post_share"><div class="social-share" data-image="https://raw.githubusercontent.com/iyukiyama/pics/master/hexo-iyukiyama/site_img/posts/design-patterns-bg.png" data-sites="wechat,weibo,twitter,facebook,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/edmonds-karp-complexity-proof/"><img class="prev-cover" src="https://raw.githubusercontent.com/iyukiyama/pics/master/hexo-iyukiyama/site_img/posts/graph/edmonds-karp-bg.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Edmonds-Karp算法复杂度证明</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/hexo-iyukiyama/site_img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">yukiyama</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">31</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">49</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/iyukiyama"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/iyukiyama" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://www.zhihu.com/people/yukiyamama" target="_blank" title="zhihu"><i class="fab fa-zhihu"></i></a><a class="social-icon" href="mailto:iyukiyama@outlook.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">GoF设计模式讲解与实现</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B8%80%E8%A7%88"><span class="toc-number">1.1.</span> <span class="toc-text">设计模式一览</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99%E4%B8%80%E8%A7%88"><span class="toc-number">1.2.</span> <span class="toc-text">设计原则一览</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9E%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.3.</span> <span class="toc-text">创建型设计模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.3.1.</span> <span class="toc-text">单例模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E8%AF%B4%E6%98%8E"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">模式说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%BC%94%E7%A4%BA"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">代码演示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.3.2.</span> <span class="toc-text">原型模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E8%AF%B4%E6%98%8E-2"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">模式说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84-2"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%BC%94%E7%A4%BA-2"><span class="toc-number">1.3.2.3.</span> <span class="toc-text">代码演示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95-%E9%9D%99%E6%80%81-%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.3.3.</span> <span class="toc-text">简单(静态)工厂模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E8%AF%B4%E6%98%8E-3"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">模式说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84-3"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%BC%94%E7%A4%BA-3"><span class="toc-number">1.3.3.3.</span> <span class="toc-text">代码演示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.3.4.</span> <span class="toc-text">工厂方法模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E8%AF%B4%E6%98%8E-4"><span class="toc-number">1.3.4.1.</span> <span class="toc-text">模式说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84-4"><span class="toc-number">1.3.4.2.</span> <span class="toc-text">结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%BC%94%E7%A4%BA-4"><span class="toc-number">1.3.4.3.</span> <span class="toc-text">代码演示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.3.5.</span> <span class="toc-text">抽象工厂模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E8%AF%B4%E6%98%8E-5"><span class="toc-number">1.3.5.1.</span> <span class="toc-text">模式说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84-5"><span class="toc-number">1.3.5.2.</span> <span class="toc-text">结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%BC%94%E7%A4%BA-5"><span class="toc-number">1.3.5.3.</span> <span class="toc-text">代码演示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.3.6.</span> <span class="toc-text">建造者模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E8%AF%B4%E6%98%8E-6"><span class="toc-number">1.3.6.1.</span> <span class="toc-text">模式说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84-6"><span class="toc-number">1.3.6.2.</span> <span class="toc-text">结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%BC%94%E7%A4%BA-6"><span class="toc-number">1.3.6.3.</span> <span class="toc-text">代码演示</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E5%9E%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.</span> <span class="toc-text">结构型设计模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.1.</span> <span class="toc-text">代理模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E8%AF%B4%E6%98%8E-7"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">模式说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84-7"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%BC%94%E7%A4%BA-7"><span class="toc-number">1.4.1.3.</span> <span class="toc-text">代码演示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.2.</span> <span class="toc-text">适配器模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E8%AF%B4%E6%98%8E-8"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">模式说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84-8"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%BC%94%E7%A4%BA-8"><span class="toc-number">1.4.2.3.</span> <span class="toc-text">代码演示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.3.</span> <span class="toc-text">桥接模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E8%AF%B4%E6%98%8E-9"><span class="toc-number">1.4.3.1.</span> <span class="toc-text">模式说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84-9"><span class="toc-number">1.4.3.2.</span> <span class="toc-text">结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.4.3.3.</span> <span class="toc-text">代码示例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.4.</span> <span class="toc-text">装饰器模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E8%AF%B4%E6%98%8E-10"><span class="toc-number">1.4.4.1.</span> <span class="toc-text">模式说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84-10"><span class="toc-number">1.4.4.2.</span> <span class="toc-text">结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%BC%94%E7%A4%BA-9"><span class="toc-number">1.4.4.3.</span> <span class="toc-text">代码演示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.5.</span> <span class="toc-text">外观模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E8%AF%B4%E6%98%8E-11"><span class="toc-number">1.4.5.1.</span> <span class="toc-text">模式说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84-11"><span class="toc-number">1.4.5.2.</span> <span class="toc-text">结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%BC%94%E7%A4%BA-10"><span class="toc-number">1.4.5.3.</span> <span class="toc-text">代码演示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.6.</span> <span class="toc-text">享元模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E8%AF%B4%E6%98%8E-12"><span class="toc-number">1.4.6.1.</span> <span class="toc-text">模式说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84-12"><span class="toc-number">1.4.6.2.</span> <span class="toc-text">结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%BC%94%E7%A4%BA-11"><span class="toc-number">1.4.6.3.</span> <span class="toc-text">代码演示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.7.</span> <span class="toc-text">组合模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E8%AF%B4%E6%98%8E-13"><span class="toc-number">1.4.7.1.</span> <span class="toc-text">模式说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84-13"><span class="toc-number">1.4.7.2.</span> <span class="toc-text">结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%BC%94%E7%A4%BA-12"><span class="toc-number">1.4.7.3.</span> <span class="toc-text">代码演示</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%8C%E4%B8%BA%E5%9E%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.5.</span> <span class="toc-text">行为型设计模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.5.1.</span> <span class="toc-text">模板方法模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E8%AF%B4%E6%98%8E-14"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">模式说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84-14"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%BC%94%E7%A4%BA-13"><span class="toc-number">1.5.1.3.</span> <span class="toc-text">代码演示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.5.2.</span> <span class="toc-text">策略模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E8%AF%B4%E6%98%8E-15"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">模式说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84-15"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%BC%94%E7%A4%BA-14"><span class="toc-number">1.5.2.3.</span> <span class="toc-text">代码演示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.5.3.</span> <span class="toc-text">命令模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E8%AF%B4%E6%98%8E-16"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">模式说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84-16"><span class="toc-number">1.5.3.2.</span> <span class="toc-text">结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%BC%94%E7%A4%BA-15"><span class="toc-number">1.5.3.3.</span> <span class="toc-text">代码演示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.5.4.</span> <span class="toc-text">责任链模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E8%AF%B4%E6%98%8E-17"><span class="toc-number">1.5.4.1.</span> <span class="toc-text">模式说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84-17"><span class="toc-number">1.5.4.2.</span> <span class="toc-text">结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%BC%94%E7%A4%BA-16"><span class="toc-number">1.5.4.3.</span> <span class="toc-text">代码演示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.5.5.</span> <span class="toc-text">状态模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E8%AF%B4%E6%98%8E-18"><span class="toc-number">1.5.5.1.</span> <span class="toc-text">模式说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84-18"><span class="toc-number">1.5.5.2.</span> <span class="toc-text">结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%BC%94%E7%A4%BA-17"><span class="toc-number">1.5.5.3.</span> <span class="toc-text">代码演示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.5.6.</span> <span class="toc-text">观察者模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E8%AF%B4%E6%98%8E-19"><span class="toc-number">1.5.6.1.</span> <span class="toc-text">模式说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84-19"><span class="toc-number">1.5.6.2.</span> <span class="toc-text">结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%BC%94%E7%A4%BA-18"><span class="toc-number">1.5.6.3.</span> <span class="toc-text">代码演示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.5.7.</span> <span class="toc-text">中介者模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E8%AF%B4%E6%98%8E-20"><span class="toc-number">1.5.7.1.</span> <span class="toc-text">模式说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84-20"><span class="toc-number">1.5.7.2.</span> <span class="toc-text">结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%BC%94%E7%A4%BA-19"><span class="toc-number">1.5.7.3.</span> <span class="toc-text">代码演示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.5.8.</span> <span class="toc-text">迭代器模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E8%AF%B4%E6%98%8E-21"><span class="toc-number">1.5.8.1.</span> <span class="toc-text">模式说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84-21"><span class="toc-number">1.5.8.2.</span> <span class="toc-text">结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%BC%94%E7%A4%BA-20"><span class="toc-number">1.5.8.3.</span> <span class="toc-text">代码演示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.5.9.</span> <span class="toc-text">访问者模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E8%AF%B4%E6%98%8E-22"><span class="toc-number">1.5.9.1.</span> <span class="toc-text">模式说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84-22"><span class="toc-number">1.5.9.2.</span> <span class="toc-text">结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%BC%94%E7%A4%BA-21"><span class="toc-number">1.5.9.3.</span> <span class="toc-text">代码演示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.5.10.</span> <span class="toc-text">备忘录模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E8%AF%B4%E6%98%8E-23"><span class="toc-number">1.5.10.1.</span> <span class="toc-text">模式说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84-23"><span class="toc-number">1.5.10.2.</span> <span class="toc-text">结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%BC%94%E7%A4%BA-22"><span class="toc-number">1.5.10.3.</span> <span class="toc-text">代码演示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%87%8A%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.5.11.</span> <span class="toc-text">解释器模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E8%AF%B4%E6%98%8E-24"><span class="toc-number">1.5.11.1.</span> <span class="toc-text">模式说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84-24"><span class="toc-number">1.5.11.2.</span> <span class="toc-text">结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%BC%94%E7%A4%BA-23"><span class="toc-number">1.5.11.3.</span> <span class="toc-text">代码演示</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/0/" title="无题"><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/hexo-iyukiyama/site_img/takaoyama-landscape.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/0/" title="无题">无题</a><time datetime="2022-12-01T14:10:23.280Z" title="发表于 2022-12-01 22:10:23">2022-12-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/graph/" title="图论算法从入门到放下"><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/hexo-iyukiyama/site_img/posts/algorithms/graph-bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="图论算法从入门到放下"/></a><div class="content"><a class="title" href="/graph/" title="图论算法从入门到放下">图论算法从入门到放下</a><time datetime="2022-12-01T11:00:12.217Z" title="发表于 2022-12-01 19:00:12">2022-12-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/intellij-idea/" title="IntelliJ Idea使用指南"><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/hexo-iyukiyama/site_img/posts/intellij-idea-bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="IntelliJ Idea使用指南"/></a><div class="content"><a class="title" href="/intellij-idea/" title="IntelliJ Idea使用指南">IntelliJ Idea使用指南</a><time datetime="2022-11-18T10:00:33.820Z" title="发表于 2022-11-18 18:00:33">2022-11-18</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 By yukiyama</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://iyukiyama.github.io/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js"></script><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo4hexo.vercel.app/',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo4hexo.vercel.app/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>