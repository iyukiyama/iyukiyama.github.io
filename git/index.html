<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Git学习实战 | yukiyama</title><meta name="author" content="yukiyama,iyukiyama@outlook.com"><meta name="copyright" content="yukiyama"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Git学习实战_yukiyama  本文总结自 progit 。 操作环境为 macOS Monterey 12.6 &#x2F; git 2.37.3 &#x2F; IntelliJ IDEA 2022.2.1 (Ultimate Edition) 。   Git概述 Git 是一个开源的 分布式版本控制系统 。 git 文件四种状态: 未跟踪 (untracked)、 未修改 (unmodified)、已修改 (">
<meta property="og:type" content="website">
<meta property="og:title" content="Git学习实战">
<meta property="og:url" content="https://iyukiyama.github.io/git/index.html">
<meta property="og:site_name" content="yukiyama">
<meta property="og:description" content="Git学习实战_yukiyama  本文总结自 progit 。 操作环境为 macOS Monterey 12.6 &#x2F; git 2.37.3 &#x2F; IntelliJ IDEA 2022.2.1 (Ultimate Edition) 。   Git概述 Git 是一个开源的 分布式版本控制系统 。 git 文件四种状态: 未跟踪 (untracked)、 未修改 (unmodified)、已修改 (">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/iyukiyama/pics/master/hexo-iyukiyama/site_img/takaoyama-landscape.jpg">
<meta property="article:published_time" content="2022-11-17T09:25:05.180Z">
<meta property="article:modified_time" content="2022-11-11T09:01:46.000Z">
<meta property="article:author" content="yukiyama">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/iyukiyama/pics/master/hexo-iyukiyama/site_img/takaoyama-landscape.jpg"><link rel="shortcut icon" href="https://raw.githubusercontent.com/iyukiyama/pics/f64481f5339a9a86561027eda41a81aaf1c3a92b/hexo-iyukiyama/site_img/favicon.svg"><link rel="canonical" href="https://iyukiyama.github.io/git/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="8txPepZr-K8-G42klmRZPinO36bw-JYKtqBKyT6YLow"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":500},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: yukiyama","link":"链接: ","source":"来源: yukiyama","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Git学习实战',
  isPost: false,
  isHome: false,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2022-11-11 17:01:46'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/hexo-iyukiyama/site_img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">29</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">48</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-chart-simple"></i><span> 算法</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/binary-search/"><span> 二分查找</span></a></li><li><a class="site-page child" href="/sorting/"><span> 十大排序</span></a></li><li><a class="site-page child" href="/union-find/"><span> 并查集</span></a></li><li><a class="site-page child" href="/graph/"><span> 图论算法</span></a></li><li><a class="site-page child" href="/binary-search-tree/"><span> 二叉查找树</span></a></li><li><a class="site-page child" href="/avl-tree/"><span> AVL树</span></a></li><li><a class="site-page child" href="/splay-tree/"><span> splay树</span></a></li><li><a class="site-page child" href="/binary-indexed-tree/"><span> 树状数组</span></a></li><li><a class="site-page child" href="/segment-tree/"><span> 线段树</span></a></li><li><a class="site-page child" href="/red-black-tree/"><span> 红黑树</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-diagram-project"></i><span> 图论证明</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/dijkstra-proof/"><span> Dijkstra</span></a></li><li><a class="site-page child" href="/prim-proof/"><span> Prim</span></a></li><li><a class="site-page child" href="/bellman-ford-spfa-proof/"><span> Bellman-Ford &amp; SPFA</span></a></li><li><a class="site-page child" href="/floyd-warshall-proof/"><span> Floyd-Warshall</span></a></li><li><a class="site-page child" href="/max-flow-min-cut-proof/"><span> 最大流最小割定理</span></a></li><li><a class="site-page child" href="/edmonds-karp-complexity-proof/"><span> Edmonds-Karp</span></a></li><li><a class="site-page child" href="/dinic-complexity-proof/"><span> Dinic</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="https://iyukiyama.github.io/docsify-leetcode/"><i class="fa-fw fas fa-code"></i><span> LeetCode</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-mug-saucer"></i><span> Java</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/jdbc-in-action/"><span> JDBC</span></a></li><li><a class="site-page child" href="/javaweb-in-action/"><span> Java Web</span></a></li><li><a class="site-page child" href="/spring5-framework-in-action/"><span> Spring Framework</span></a></li><li><a class="site-page child" href="/springmvc-in-action/"><span> SpringMVC</span></a></li><li><a class="site-page child" href="/springboot-in-action/"><span> SpringBoot</span></a></li><li><a class="site-page child" href="/lombok-in-action/"><span> Lombok</span></a></li><li><a class="site-page child" href="/concurrency-in-action/"><span> Concurrency</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://iyukiyama.gitbook.io/design-pattern/"><i class="fa-fw fas fa-palette"></i><span> 设计模式</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-database"></i><span> Database</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/mysql-in-action/"><span> MySQL</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-screwdriver-wrench"></i><span> Tools</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/git-in-action/"><span> Git</span></a></li><li><a class="site-page child" href="/maven-in-action/"><span> Maven</span></a></li><li><a class="site-page child" href="/docsify-in-action/"><span> docsify</span></a></li><li><a class="site-page child" href="/intellj-idea/"><span> IntellJ Idea</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-circle-info"></i><span> 关于</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="not-home-page" id="page-header" style="background-image: url('https://raw.githubusercontent.com/iyukiyama/pics/master/hexo-iyukiyama/site_img/takaoyama-landscape.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">yukiyama</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-chart-simple"></i><span> 算法</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/binary-search/"><span> 二分查找</span></a></li><li><a class="site-page child" href="/sorting/"><span> 十大排序</span></a></li><li><a class="site-page child" href="/union-find/"><span> 并查集</span></a></li><li><a class="site-page child" href="/graph/"><span> 图论算法</span></a></li><li><a class="site-page child" href="/binary-search-tree/"><span> 二叉查找树</span></a></li><li><a class="site-page child" href="/avl-tree/"><span> AVL树</span></a></li><li><a class="site-page child" href="/splay-tree/"><span> splay树</span></a></li><li><a class="site-page child" href="/binary-indexed-tree/"><span> 树状数组</span></a></li><li><a class="site-page child" href="/segment-tree/"><span> 线段树</span></a></li><li><a class="site-page child" href="/red-black-tree/"><span> 红黑树</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-diagram-project"></i><span> 图论证明</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/dijkstra-proof/"><span> Dijkstra</span></a></li><li><a class="site-page child" href="/prim-proof/"><span> Prim</span></a></li><li><a class="site-page child" href="/bellman-ford-spfa-proof/"><span> Bellman-Ford &amp; SPFA</span></a></li><li><a class="site-page child" href="/floyd-warshall-proof/"><span> Floyd-Warshall</span></a></li><li><a class="site-page child" href="/max-flow-min-cut-proof/"><span> 最大流最小割定理</span></a></li><li><a class="site-page child" href="/edmonds-karp-complexity-proof/"><span> Edmonds-Karp</span></a></li><li><a class="site-page child" href="/dinic-complexity-proof/"><span> Dinic</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="https://iyukiyama.github.io/docsify-leetcode/"><i class="fa-fw fas fa-code"></i><span> LeetCode</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-mug-saucer"></i><span> Java</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/jdbc-in-action/"><span> JDBC</span></a></li><li><a class="site-page child" href="/javaweb-in-action/"><span> Java Web</span></a></li><li><a class="site-page child" href="/spring5-framework-in-action/"><span> Spring Framework</span></a></li><li><a class="site-page child" href="/springmvc-in-action/"><span> SpringMVC</span></a></li><li><a class="site-page child" href="/springboot-in-action/"><span> SpringBoot</span></a></li><li><a class="site-page child" href="/lombok-in-action/"><span> Lombok</span></a></li><li><a class="site-page child" href="/concurrency-in-action/"><span> Concurrency</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://iyukiyama.gitbook.io/design-pattern/"><i class="fa-fw fas fa-palette"></i><span> 设计模式</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-database"></i><span> Database</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/mysql-in-action/"><span> MySQL</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-screwdriver-wrench"></i><span> Tools</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/git-in-action/"><span> Git</span></a></li><li><a class="site-page child" href="/maven-in-action/"><span> Maven</span></a></li><li><a class="site-page child" href="/docsify-in-action/"><span> docsify</span></a></li><li><a class="site-page child" href="/intellj-idea/"><span> IntellJ Idea</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-circle-info"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="page-site-info"><h1 id="site-title">Git学习实战</h1></div></header><main class="layout" id="content-inner"><div id="page"><div id="article-container"><h1>Git学习实战_yukiyama</h1>
<blockquote>
<p>本文总结自 <a target="_blank" rel="noopener" href="https://git-scm.com/book/en/v2">progit</a> 。</p>
<p>操作环境为 macOS Monterey 12.6 / git 2.37.3 / IntelliJ IDEA 2022.2.1 (Ultimate Edition) 。</p>
</blockquote>
<br />
<h2 id="Git概述">Git概述</h2>
<p>Git 是一个开源的 <strong>分布式版本控制系统</strong> 。</p>
<p>git 文件四种状态: 未跟踪 (untracked)、 未修改 (unmodified)、已修改 (modified) 、已暂存 (staged) 。</p>
<table>
<thead>
<tr>
<th>状态</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>untracked</td>
<td>未追踪。文件未被 git 管理，执行 <code>git add</code> 可将其转换为「已追踪」的「未修改状态」。</td>
</tr>
<tr>
<td>unmodified</td>
<td>未修改。已追踪，从「已暂存」状态执行 <code>git commit</code> 提交后的状态。因此也被称作「已提交」状态 (commited) 。</td>
</tr>
<tr>
<td>modified</td>
<td>已修改。已追踪，并且发生了修改，但还未暂存。</td>
</tr>
<tr>
<td>staged</td>
<td>已暂存。已追踪，对一个修改过的文件执行 <code>git add</code> 后的状态。</td>
</tr>
</tbody>
</table>
<p><img src="https://git-scm.com/book/en/v2/images/lifecycle.png" alt="image-20220927002133083"></p>
<p>git 中的三个区域: 仓库、工作目录、暂存区域。</p>
<table>
<thead>
<tr>
<th>区域</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>工作目录</td>
<td>对项目的某个版本独立提取出来的内容。从 Git 仓库的压缩数据库中提取出来，放在磁盘上供用户使用和修改。</td>
</tr>
<tr>
<td>暂存区 / 索引</td>
<td>实际上是一个文件，保存了下次将提交的文件列表信息，一般在 Git 仓库目录中，有时也被称作「索引」。</td>
</tr>
<tr>
<td>Git仓库 / 版本库</td>
<td>Git 用来保存项目的元数据和对象数据库的地方。</td>
</tr>
</tbody>
</table>
<p><img src="https://git-scm.com/book/en/v2/images/areas.png" alt="image-20220927004419468"></p>
<br />
<h2 id="Git安装">Git安装</h2>
<p>在装有 homebrew 的 mac 下安装 git ，只需执行如下命令。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install git</span><br></pre></td></tr></table></figure>
<p>安装后执行 <code>git --version</code> 可查看 git 版本。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama ~ % git --version</span><br><span class="line">git version 2.37.3</span><br><span class="line">yukiyama@yukiyama ~ %</span><br></pre></td></tr></table></figure>
<br />
<h2 id="命令一览">命令一览</h2>
<p>git 常用命令。使用 <code>git help &lt;verb&gt;</code>, <code>git &lt;verb&gt; --help</code>, <code>man git-&lt;verb&gt;</code> 可查看相关命令的详细用法。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>■ 基本操作</strong></td>
<td></td>
</tr>
<tr>
<td>git config --[system/global/local] <a target="_blank" rel="noopener" href="http://user.name">user.name</a> &lt;用户名&gt;</td>
<td>设置不同层级git配置文件中的git用户名</td>
</tr>
<tr>
<td>git config --[system/global/local] user.email &lt;邮箱&gt;</td>
<td>设置不同层级git配置文件中的git邮箱</td>
</tr>
<tr>
<td>git config --[system/global/local] --list</td>
<td>查看不同层级git配置内容</td>
</tr>
<tr>
<td>git config --[system/global/local] --edit</td>
<td>编辑不同层级git配置内容</td>
</tr>
<tr>
<td>git config --[system/global/local] &lt;变量组名.变量&gt;</td>
<td>查看不同层级下的git配置中的变量值</td>
</tr>
<tr>
<td>git init</td>
<td>将当前文件夹初始化为本地库</td>
</tr>
<tr>
<td>git add &lt;文件名&gt;</td>
<td>添加到暂存区</td>
</tr>
<tr>
<td>git add &lt;目录&gt;</td>
<td>添加指定目录及其子目录到暂存区</td>
</tr>
<tr>
<td>git add .</td>
<td>添加当前目录下的所有文件和所有子目录到暂存区<br />※ 过滤 <code>.gitignore</code></td>
</tr>
<tr>
<td>git add *</td>
<td>添加当前目录下的所有文件和所有子目录到暂存区<br />※ 不过滤 <code>.gitignore</code> ，一般不使用该命令。</td>
</tr>
<tr>
<td>git ls-files</td>
<td>查看当前目录下已跟踪的文件</td>
</tr>
<tr>
<td>git commit -m “&lt;本次提交的附带信息&gt;”</td>
<td>提交到本地库</td>
</tr>
<tr>
<td>git status</td>
<td>本地库状态</td>
</tr>
<tr>
<td>git status -s</td>
<td>本地库状态缩略信息</td>
</tr>
<tr>
<td>git diff &lt;文件名&gt;</td>
<td>列出指定文件在工作目录中修改前后的差异。</td>
</tr>
<tr>
<td>git diff --staged &lt;文件名&gt;</td>
<td>列出指定文件在暂存区与当前仓库版本间的差异。</td>
</tr>
<tr>
<td>git diff &lt;版本号&gt; &lt;文件名&gt;</td>
<td>列出指定文件在工作目录及指定仓库版本间的差异。</td>
</tr>
<tr>
<td>git reflog</td>
<td>查看历史记录缩略信息</td>
</tr>
<tr>
<td>git rm &lt;文件名&gt;</td>
<td>从已经跟踪的文件清单中 (暂存区域) 移除指定文件，同时删除该文件</td>
</tr>
<tr>
<td>git mv &lt;文件名1&gt; &lt;文件名2&gt;</td>
<td>将文件名1改成文件名2</td>
</tr>
<tr>
<td>git log</td>
<td>查看历史记录完整信息</td>
</tr>
<tr>
<td>git log -p</td>
<td>查看历史记录完整信息并展示每次提交的差异</td>
</tr>
<tr>
<td>git log -2</td>
<td>查看2条历史记录完整信息</td>
</tr>
<tr>
<td>git log --oneline --graph --all</td>
<td>以图形形式 (分支流) 查看提交历史</td>
</tr>
<tr>
<td>git reflog</td>
<td>查看历史记录缩略信息</td>
</tr>
<tr>
<td>git reflog -p</td>
<td>查看历史记录缩略信息并展示每次提交的差异</td>
</tr>
<tr>
<td>git reflog -2</td>
<td>查看2条历史记录缩略信息</td>
</tr>
<tr>
<td><strong>■ 撤销操作</strong></td>
<td></td>
</tr>
<tr>
<td>git commit --amend</td>
<td>修改 message 后提交暂存区，替换掉最后一次提交，即提交数不变 (commit id不同)。</td>
</tr>
<tr>
<td>git commit --amend -m “&lt;提交信息&gt;”</td>
<td>同上，但不会打开编辑器编辑提交信息，而是直接写上提交信息。</td>
</tr>
<tr>
<td>git restore --staged &lt;文件名&gt;</td>
<td>将暂存区的指定文件移出暂存区</td>
</tr>
<tr>
<td>git restore &lt;文件名&gt;</td>
<td>都在工作目录下，将已修改状态的指定文件回退到未修改的状态。</td>
</tr>
<tr>
<td>git rest HEAD &lt;文件名&gt;</td>
<td>同 <code>git restore --staged &lt;文件名&gt;</code></td>
</tr>
<tr>
<td>git checkout –</td>
<td>同 <code>git restore &lt;文件名&gt;</code></td>
</tr>
<tr>
<td><strong>■ 切换操作</strong></td>
<td></td>
</tr>
<tr>
<td>git reset --soft &lt;版本号&gt;</td>
<td>将 HEAD 指向指定的版本 (commit) ，不改动 index 和 working tree。<br />※ 不可指定文件名 (指定则报错)。</td>
</tr>
<tr>
<td>git reset --mixed  &lt;版本号&gt;</td>
<td>不指定文件。将 HEAD 指向指定的版本 (commit) ，并使得暂存区与指定版本一致，即在指定版本之后加入暂存区的所有文件都移出暂存区。<br />※ <code>--mixed</code> 参数是默认的，也可不写。</td>
</tr>
<tr>
<td>git reset --mixed  &lt;版本号&gt; &lt;文件名&gt;</td>
<td>指定文件。<code>HEAD</code> 指针不变，但指定的文件对应的暂存区内容将切换到指定版本的状态，其他文件在暂存区的内容不变。</td>
</tr>
<tr>
<td>git reset --hard &lt;版本号&gt;</td>
<td>将 HEAD, index 和 working tree 都切换到指定版本号的状态。<br />※ 不可指定文件名 (指定则报错)。</td>
</tr>
<tr>
<td><strong>■ 分支操作</strong></td>
<td></td>
</tr>
<tr>
<td>git branch</td>
<td>列出本地所有分支名</td>
</tr>
<tr>
<td>git branch -r</td>
<td>列出远程所有分支名</td>
</tr>
<tr>
<td>git branch -a</td>
<td>列出本地及远程的所有分支名</td>
</tr>
<tr>
<td>git branch &lt;分支名&gt;</td>
<td>以指定分支名创建新分支</td>
</tr>
<tr>
<td>git branch -d &lt;分支名&gt;</td>
<td>删除指定分支</td>
</tr>
<tr>
<td>git switch &lt;分支名&gt;</td>
<td>切换到指定分支</td>
</tr>
<tr>
<td>git switch -c &lt;分支名&gt;</td>
<td>创建并切换分支</td>
</tr>
<tr>
<td>git checkout &lt;分支名&gt;</td>
<td>切换到指定分支</td>
</tr>
<tr>
<td>git checkout -b &lt;分支名&gt;</td>
<td>创建并切换分支</td>
</tr>
<tr>
<td>git merge &lt;分支名&gt;</td>
<td>将指定分支合并入当前分支</td>
</tr>
<tr>
<td>git rebase &lt;分支名&gt;</td>
<td>以当前分支为基底，将指定分支在分歧后的修改合入当前分支</td>
</tr>
<tr>
<td><strong>■ 远程操作</strong></td>
<td></td>
</tr>
<tr>
<td>git remote add &lt;远程仓库地址别名&gt; &lt;远程仓库地址&gt;</td>
<td>关联本地仓库与远程仓库</td>
</tr>
<tr>
<td>git remote</td>
<td>列出远程仓库 (别名)</td>
</tr>
<tr>
<td>git remove -v</td>
<td>列出远程仓库详细信息 (别&amp;原地址 fetch&amp;push)</td>
</tr>
<tr>
<td>git remote show &lt;远程仓库地址别名&gt;</td>
<td>查看远程仓库详细信息</td>
</tr>
<tr>
<td>git remote rename &lt;当前别名&gt; &lt;新别名&gt;</td>
<td>修改远程仓库地址别名</td>
</tr>
<tr>
<td>git clone &lt;远程仓库地址&gt;</td>
<td>将远程仓库克隆到当前目录下</td>
</tr>
<tr>
<td>git push &lt;远程仓库地址&gt; &lt;本地分支名&gt;:&lt;远程分支名&gt;</td>
<td>推送本地当前分支版本到远程仓库指定分支</td>
</tr>
<tr>
<td>git push -u &lt;远程仓库地址别名&gt; &lt;远程仓库分支名&gt;</td>
<td>将本地仓库当前分支内容推送到指定远程仓库的指定分支<br />※ <code>-u</code> 是 <code>--set-upstream</code> 的缩略，关联当前分支与指定的远程仓库分支，方便之后仅使用 <code>git push</code> 完成推送。</td>
</tr>
<tr>
<td>git push &lt;远程仓库地址&gt; &lt;分支名&gt;</td>
<td>当本地分支名与远程分支名相同时的略写</td>
</tr>
<tr>
<td>git push</td>
<td>若当前本地分支已与远程仓库某分支通过 <code>--set-upstream</code> 参数绑定过，则可直接将本地分支当前版本推送到该远程分支</td>
</tr>
<tr>
<td>git fetch &lt;远程仓库别名&gt; &lt;远程仓库分支名&gt;</td>
<td>从指定远程仓库获取指定分支的最新版本到当前仓库中，但不 merge</td>
</tr>
<tr>
<td>git fetch &lt;远程仓库别名&gt;</td>
<td>从指定远程仓库的获取所有分支中的最新版本到当前仓库中，但不 merge</td>
</tr>
<tr>
<td>git fetch</td>
<td>类似 push ，若已经设置了 <code>--set-upstream</code> ，则可省略后续参数</td>
</tr>
<tr>
<td>git pull &lt;远程仓库别名&gt; &lt;远程分支名&gt;:&lt;本地分支名&gt;</td>
<td>从指定远程仓库获取指定分支的最新版本到指定本地分支中，并 merge</td>
</tr>
<tr>
<td>git pull &lt;远程仓库别名&gt; &lt;分支名&gt;</td>
<td>远程分支名与本地分支名相同时的简写</td>
</tr>
<tr>
<td>git pull</td>
<td>类似 push ，若已经设置了 <code>--set-upstream</code> ，则可省略后续参数</td>
</tr>
</tbody>
</table>
<br />
<h2 id="基本操作">基本操作</h2>
<h3 id="git-config">git config</h3>
<p>git 有三个层级的配置文件。</p>
<table>
<thead>
<tr>
<th>配置文件</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>系统级 (system)</td>
<td>配置对OS系统下所有用户有效。<br />使用 brew 安装时，为该文件: <code>/usr/local/etc/config</code></td>
</tr>
<tr>
<td>系统用户级 (global)</td>
<td>配置对OS系统下当前用户有效。<br />为该文件 <code>/Users/yukiyama/.gitconfig</code></td>
</tr>
<tr>
<td>当前仓库级别 (local)</td>
<td>配置对当前仓库有效。<br />为 <code>.git</code> 文件夹下的 <code>.gitconfig</code></td>
</tr>
</tbody>
</table>
<p>如下，可通过 <code>cat</code> 命令查看三个层级下的 git 配置内容。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama ~ % cat /usr/local/etc/gitconfig</span><br><span class="line">[credential]</span><br><span class="line">	helper = osxkeychain</span><br><span class="line">yukiyama@yukiyama ~ % cat ~/.gitconfig</span><br><span class="line">[filter &quot;lfs&quot;]</span><br><span class="line">	clean = git-lfs clean -- %f</span><br><span class="line">	smudge = git-lfs smudge -- %f</span><br><span class="line">	process = git-lfs filter-process</span><br><span class="line">	required = true</span><br><span class="line">[user]</span><br><span class="line">	name = yukiyama</span><br><span class="line">	email = yukiyama@yuki.com</span><br><span class="line">[init]</span><br><span class="line">	defaultBranch = master</span><br><span class="line">yukiyama@yukiyama ~ % cat iCloud/study/tech/git/git-demo/.git/config</span><br><span class="line">[core]</span><br><span class="line">	repositoryformatversion = 0</span><br><span class="line">	filemode = true</span><br><span class="line">	bare = false</span><br><span class="line">	logallrefupdates = true</span><br><span class="line">	ignorecase = true</span><br><span class="line">	precomposeunicode = true</span><br><span class="line">[user]</span><br><span class="line">	name = iyukiyama</span><br><span class="line">	email = yukiyama@yama.com</span><br><span class="line">yukiyama@yukiyama ~ %</span><br></pre></td></tr></table></figure>
<p>也可以通过 <code>git config --[system/global/local] --list</code> 查看。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama ~ % git config --system --list</span><br><span class="line">credential.helper=osxkeychain</span><br><span class="line">yukiyama@yukiyama ~ % git config --global --list</span><br><span class="line">filter.lfs.clean=git-lfs clean -- %f</span><br><span class="line">filter.lfs.smudge=git-lfs smudge -- %f</span><br><span class="line">filter.lfs.process=git-lfs filter-process</span><br><span class="line">filter.lfs.required=true</span><br><span class="line">user.name=yukiyama</span><br><span class="line">user.email=yukiyama@yuki.com</span><br><span class="line">init.defaultbranch=master</span><br><span class="line">yukiyama@yukiyama ~ % cd iCloud/study/tech/git/git-demo/</span><br><span class="line">yukiyama@yukiyama git-demo % git config --local --list</span><br><span class="line">core.repositoryformatversion=0</span><br><span class="line">core.filemode=true</span><br><span class="line">core.bare=false</span><br><span class="line">core.logallrefupdates=true</span><br><span class="line">core.ignorecase=true</span><br><span class="line">core.precomposeunicode=true</span><br><span class="line">user.name=iyukiyama</span><br><span class="line">user.email=yukiyama@yama.com</span><br><span class="line">yukiyama@yukiyama git-demo %</span><br></pre></td></tr></table></figure>
<p>需要注意带有 <code>--local</code> 参数的 <code>git config</code> 命令要在仓库内执行，否则返回如下错误提示。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama ~ % git config --local user.name</span><br><span class="line">fatal: --local can only be used inside a git repository</span><br><span class="line">yukiyama@yukiyama ~ %</span><br></pre></td></tr></table></figure>
<br />
<h4 id="配置用户签名">配置用户签名</h4>
<p>可以通过 <code>vim</code> 命令或者带 <code>--edit</code> 参数的 <code>git config</code> 命令打开配置文件完成编辑，更好的方式是直接使用 <code>git config</code> 命令指定具体的变量。通常在使用 git 进行版本控制管理前，需要设置用户名及邮箱，即「用户签名」，用于标识操作者信息，无该信息则无法提交。</p>
<p>如下设置 global 层级的 <a target="_blank" rel="noopener" href="http://user.name">user.name</a> 及 user.email。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama git-demo % git config --global user.name yukiyama</span><br><span class="line">yukiyama@yukiyama git-demo % git config --global user.name</span><br><span class="line">yukiyama</span><br><span class="line">yukiyama@yukiyama git-demo % git config --global user.email yukiyama@gmail.com</span><br><span class="line">yukiyama@yukiyama git-demo % git config --global user.email</span><br><span class="line">yukiyama@gmail.com</span><br></pre></td></tr></table></figure>
<p>当我们希望对某个具体的 git 项目 (即 <code>.git</code> 所在目录) 使用不同于 global 的用户签名时，使用 <code>--local</code> 参数单独设置，如下。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama git-demo % git config --local user.name yukiyama123</span><br><span class="line">yukiyama@yukiyama git-demo % git config --local user.name</span><br><span class="line">yukiyama123</span><br><span class="line">yukiyama@yukiyama git-demo % git config --local user.email yukiyama@outlook.com</span><br><span class="line">yukiyama@yukiyama git-demo % git config --local user.email</span><br><span class="line">yukiyama@outlook.com</span><br></pre></td></tr></table></figure>
<p>需要注意的是，「用户签名」与在「远程操作」中使用远程库平台 (如 github) 的账户信息无关，只不过我们也可以将用户签名设置为远程库平台的账号名及邮箱。</p>
<br />
<h4 id="配置全局忽略">配置全局忽略</h4>
<p>使用 MacOS 时，本地 git 仓库中可能会出现 MacOS 中特有的 <code>.DS_Store</code> 文件。类似这样的文件或文件夹，我们可以针对每一个本地 git 仓库，在 <code>.git</code> 所在目录下设置相应地 <code>.gitignore</code> 文件来忽略指定的文件和文件夹，也可以设置一个全局忽略配置文件 <code>.gitignore_global</code> (通常与全局配置文件 <code>.gitconfig</code> 放置在同一目录下，即 <code>~/</code> 下) 。例如新建一个 <code>~/.gitignore_global</code> 文件如下。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama ~ % cat ~/.gitignore_global</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">MacOS .DS_Store</span></span><br><span class="line">**/.DS_Store</span><br><span class="line">yukiyama@yukiyama ~ %</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>**</code> 表示子目录子子目录等多层匹配</p>
</blockquote>
<p>然后使用 <code>git config --global core.excludesfile ~/.gitignore_global</code> 命令配置到全局配置文件中。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama git-demo % git config --global core.excludesfile ~/.gitignore_global</span><br><span class="line">yukiyama@yukiyama git-demo % git config --global --list</span><br><span class="line">filter.lfs.clean=git-lfs clean -- %f</span><br><span class="line">filter.lfs.smudge=git-lfs smudge -- %f</span><br><span class="line">filter.lfs.process=git-lfs filter-process</span><br><span class="line">target/</span><br><span class="line">filter.lfs.required=true</span><br><span class="line">user.name=yukiyama</span><br><span class="line">user.email=yukiyama@163.com</span><br><span class="line">init.defaultbranch=master</span><br><span class="line">core.excludesfile=/Users/yukiyama/.gitignore_global</span><br><span class="line">yukiyama@yukiyama git-demo %</span><br></pre></td></tr></table></figure>
<p>对于已经在 <code>.gitignore_global</code> 中的忽略规则，之后就不需要再针对每一个 git 仓库设置单独设置了。</p>
<br />
<h4 id="配置忽略转义">配置忽略转义</h4>
<p>使用 git 命令时，命令行回显信息的中文字符会被转义。如下，<code>中文.md</code> 被显示为 <code>\344\270\255\346\226\207.md</code> 。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama pics % vim 中文.md</span><br><span class="line">yukiyama@yukiyama pics % git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is up to date with &#x27;origin/master&#x27;.</span><br><span class="line"></span><br><span class="line">Untracked files:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)</span><br><span class="line">	&quot;\344\270\255\346\226\207.md&quot;</span><br><span class="line"></span><br><span class="line">nothing added to commit but untracked files present (use &quot;git add&quot; to track)</span><br><span class="line">yukiyama@yukiyama pics %</span><br></pre></td></tr></table></figure>
<p>可以将 <code>core.quotepath</code> 设置为 <code>false</code> 禁止转义，以便显示中文。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama pics % git config --global core.quotepath false</span><br><span class="line">yukiyama@yukiyama pics % git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is up to date with &#x27;origin/master&#x27;.</span><br><span class="line"></span><br><span class="line">Untracked files:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)</span><br><span class="line">	中文.md</span><br><span class="line"></span><br><span class="line">nothing added to commit but untracked files present (use &quot;git add&quot; to track)</span><br><span class="line">yukiyama@yukiyama pics %</span><br></pre></td></tr></table></figure>
<p><code>core.quotePath</code> 参数的作用如下 (来自 <a target="_blank" rel="noopener" href="https://git-scm.com/docs/git-config">官方文档</a> )。</p>
<blockquote>
<p>Commands that output paths (e.g. <em>ls-files</em>, <em>diff</em>), will quote “unusual” characters in the pathname by enclosing the pathname in double-quotes and escaping those characters with backslashes in the same way C escapes control characters (e.g. <code>\t</code> for TAB, <code>\n</code> for LF, <code>\\</code> for backslash) or bytes with values larger than 0x80 (e.g. octal <code>\302\265</code> for “micro” in UTF-8). If this variable is set to false, bytes higher than 0x80 are not considered “unusual” any more. Double-quotes, backslash and control characters are always escaped regardless of the setting of this variable. A simple space character is not considered “unusual”. Many commands can output pathnames completely verbatim using the <code>-z</code> option. The default value is true.</p>
</blockquote>
<br />
<h3 id="git-init">git init</h3>
<p>使用在文件夹下目录下执行 <code>git init</code> ，将此文件夹作为 git 本地仓库管理。执行后将出现 <code>.git</code> 隐藏文件夹，其内保存了 git 用于版本管理的各种信息文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama git-demo % git init</span><br><span class="line">Initialized empty Git repository in /Users/yukiyama/Library/Mobile Documents/com~apple~CloudDocs/study/tech/git/git-demo/.git/</span><br><span class="line">yukiyama@yukiyama git-demo %</span><br></pre></td></tr></table></figure>
<p>可以随时使用 <code>git status</code> 查看仓库文件状态。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama git-demo1 % git status</span><br><span class="line">On branch master</span><br><span class="line"></span><br><span class="line">No commits yet</span><br><span class="line"></span><br><span class="line">nothing to commit (create/copy files and use &quot;git add&quot; to track)</span><br><span class="line">yukiyama@yukiyama git-demo1 %</span><br></pre></td></tr></table></figure>
<br />
<h3 id="git-add">git add</h3>
<p>文件夹初始化为 git 仓库后，尚未有文件被 git 追踪管理，此时使用 <code>git add &lt;文件名&gt;</code> 命令将指定文件放入「暂存区」。暂存区本质上是一个文件，它保存了下次将提交的文件列表信息。如下，新增一个 <code>hello.txt</code> 文件后，使用 <code>git status</code> 查看仓库内文件所属状态，可以看到 <code>Untracked files</code> 信息。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama git-demo % git status</span><br><span class="line">On branch master</span><br><span class="line"></span><br><span class="line">No commits yet</span><br><span class="line"></span><br><span class="line">Untracked files:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)</span><br><span class="line">	.DS_Store</span><br><span class="line">	hello.txt</span><br><span class="line"></span><br><span class="line">nothing added to commit but untracked files present (use &quot;git add&quot; to track)</span><br><span class="line">yukiyama@yukiyama git-demo %</span><br></pre></td></tr></table></figure>
<p>此时使用 <code>git add helle.txt</code> 即可将文件放入「暂存区」(标记为追踪文件)。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama git-demo % git add hello.txt</span><br><span class="line">yukiyama@yukiyama git-demo % git status</span><br><span class="line">On branch master</span><br><span class="line"></span><br><span class="line">No commits yet</span><br><span class="line"></span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git rm --cached &lt;file&gt;...&quot; to unstage)</span><br><span class="line">	new file:   hello.txt</span><br><span class="line"></span><br><span class="line">Untracked files:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)</span><br><span class="line">	.DS_Store</span><br><span class="line"></span><br><span class="line">yukiyama@yukiyama git-demo %</span><br></pre></td></tr></table></figure>
<ul>
<li><code>git add .</code> 会把本地所 有 untrack 的 (包括追踪过但又修改了的) 文件都加入暂存区，并且会根据 <code>.gitignore</code> 过滤忽略文件。</li>
<li><code>git add *</code> 会忽略 <code>.gitignore</code> 把任何文件都加入。执行时会出现如下提示，加上 <code>-f</code> 参数后可强制加入，但显然通常我们不会这么做。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git add *</span><br><span class="line">The following paths are ignored by one of your .gitignore files:</span><br><span class="line">test</span><br><span class="line">test.txt</span><br><span class="line">hint: Use -f if you really want to add them.</span><br><span class="line">hint: Turn this message off by running</span><br><span class="line">hint: &quot;git config advice.addIgnoredFile false&quot;</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<br />
<h3 id="git-commit">git commit</h3>
<p>使用 <code>git commit -m &quot;&lt;message&gt;&quot; &lt;filename&gt;</code>提交指定文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama git-demo % git commit -m &quot;first commit&quot; hello.txt</span><br><span class="line">[master (root-commit) 3d542ed] first commit</span><br><span class="line"> 1 file changed, 3 insertions(+)</span><br><span class="line"> create mode 100644 hello.txt</span><br><span class="line">yukiyama@yukiyama git-demo % git status</span><br><span class="line">On branch master</span><br><span class="line">Untracked files:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)</span><br><span class="line">	.DS_Store</span><br><span class="line"></span><br><span class="line">nothing added to commit but untracked files present (use &quot;git add&quot; to track)</span><br><span class="line">yukiyama@yukiyama git-demo %</span><br></pre></td></tr></table></figure>
<p><strong>修改文件</strong></p>
<p>修改文件后 git 会检测到被修改的文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama git-demo % git status</span><br><span class="line">On branch master</span><br><span class="line">Changes not staged for commit:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span><br><span class="line">  (use &quot;git restore &lt;file&gt;...&quot; to discard changes in working directory)</span><br><span class="line">	modified:   hello.txt</span><br><span class="line"></span><br><span class="line">Untracked files:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)</span><br><span class="line">	.DS_Store</span><br><span class="line"></span><br><span class="line">no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)</span><br><span class="line">yukiyama@yukiyama git-demo %</span><br></pre></td></tr></table></figure>
<p><strong>再次添加并提交</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama git-demo % git add hello.txt</span><br><span class="line">yukiyama@yukiyama git-demo % git status</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git restore --staged &lt;file&gt;...&quot; to unstage)</span><br><span class="line">	modified:   hello.txt</span><br><span class="line"></span><br><span class="line">Untracked files:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)</span><br><span class="line">	.DS_Store</span><br><span class="line"></span><br><span class="line">yukiyama@yukiyama git-demo % git commit -m &quot;first changed&quot;</span><br><span class="line">[master c246db6] first changed</span><br><span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span><br><span class="line">yukiyama@yukiyama git-demo %</span><br></pre></td></tr></table></figure>
<p>也可以使用 <code>git commit -am &quot;&lt;message&gt;&quot;</code> 将所有已跟踪的文件 <strong>暂存并提交</strong> (即 add 与 commit 一起完成)。</p>
<br />
<h3 id="git-status">git status</h3>
<p><code>git status</code> 命令可以添加 <code>-s</code> (<code>--short</code>) 参数以紧凑形式返回状态信息。如下，添加 <code>untracked.txt</code>, <code>added.txt</code> 和 <code>modified.txt</code> 文件演示处于 <code>untracked(??)</code>, <code>added(A)</code> , <code>modified(_M)</code> (M在右侧) 以及 <code>modifiedAdded(M_)</code> (M在左侧) 状态的情况。</p>
<ul>
<li><code>untracked.txt</code> 新建后尚未通过 <code>git add</code> 添加到暂存区。</li>
<li><code>added.txt</code> 新建后通过 <code>git add</code> 添加到了暂存区，但未 <code>git commit</code> 提交。</li>
<li><code>modified.txt</code> 新建后添加到了暂存区，且已提交，并在提交后做了修改。</li>
<li><code>modifiedAdded.txt</code> 新建后添加到了暂存区，且已提交，并在提交后做了修改，之后又提交到了暂存区。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama git-demo % git status</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git restore --staged &lt;file&gt;...&quot; to unstage)</span><br><span class="line">	new file:   added.txt</span><br><span class="line">	modified:   modifiedAdded.txt</span><br><span class="line"></span><br><span class="line">Changes not staged for commit:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span><br><span class="line">  (use &quot;git restore &lt;file&gt;...&quot; to discard changes in working directory)</span><br><span class="line">	modified:   .DS_Store</span><br><span class="line">	modified:   modified.txt</span><br><span class="line"></span><br><span class="line">Untracked files:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)</span><br><span class="line">	untracked.txt</span><br><span class="line">	</span><br><span class="line">yukiyama@yukiyama git-demo % git status -s</span><br><span class="line"> M .DS_Store</span><br><span class="line">A  added.txt</span><br><span class="line"> M modified.txt</span><br><span class="line">M  modifiedAdded.txt</span><br><span class="line">?? untracked.txt</span><br><span class="line">yukiyama@yukiyama git-demo %</span><br></pre></td></tr></table></figure>
<br />
<h3 id="git-diff">git diff</h3>
<table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>git diff &lt;文件名&gt;</td>
<td>列出指定文件在工作目录中修改前后的差异。</td>
</tr>
<tr>
<td>git diff --staged &lt;文件名&gt;</td>
<td>列出指定文件在暂存区与当前仓库版本间的差异。</td>
</tr>
<tr>
<td>git diff &lt;版本号&gt; &lt;文件名&gt;</td>
<td>列出指定文件在工作目录及指定仓库版本间的差异。</td>
</tr>
</tbody>
</table>
<p>※ <code>--staged</code> 也可以使用 <code>--cached</code> 代替。</p>
<p>※ 上述命令均针对被 git 管理的文件，即被 <code>git add</code> 过的文件。当不指定具体文件时，列出所有文件的差异。</p>
<p>※ 「版本号」可以用 HEAD, HEAD^, HEAD^^, HEAD~1, HEAD~2 等形式表示。HEAD 表示当前版本，HEAD^ 表示当前版本的前一个版本，有多少个 <code>^</code> 就往前多少个版本，<code>~1</code> 表示当前版本的前一个版本，数字是多少，就表示往前多少个版本。</p>
<p>新建 diff.txt 且该文件只有一行「only first line when created」。可以看到由于尚未对 compare.txt 执行 <code>git add</code> ，即此文件还未被 git 管理，因此 三条 <code>git diff</code> 命令均无回显。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % vim compare.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git diff</span><br><span class="line">yukiyama@yukiyama hello-git % git diff --staged compare.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git diff HEAD compare.txt</span><br></pre></td></tr></table></figure>
<p>执行 <code>git add compare.txt</code> 之后。可以看到如下。</p>
<ul>
<li><code>git diff</code> 命令无回显，因为是初次被 git 管理，即第一次出现在 git 的工作目录，此文件在工作目录中无历史可比较版本。</li>
<li><code>git diff --staged</code> 列出首行差异，因为此时暂存区比当前仓库版本多一行 (多了此文件，并且有一行差异) 。</li>
<li><code>git diff HEAD</code> 列出首行差异，因为此时工作目录比当前仓库版本多一行 (多了此文件，并且有一行差异) 。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git add compare.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git diff</span><br><span class="line">yukiyama@yukiyama hello-git % git diff --staged compare.txt</span><br><span class="line">diff --git a/compare.txt b/compare.txt</span><br><span class="line">new file mode 100644</span><br><span class="line">index 0000000..80dd23d</span><br><span class="line">--- /dev/null</span><br><span class="line">+++ b/compare.txt</span><br><span class="line">@@ -0,0 +1 @@</span><br><span class="line">+only first line when created</span><br><span class="line">yukiyama@yukiyama hello-git % git diff HEAD compare.txt</span><br><span class="line">diff --git a/compare.txt b/compare.txt</span><br><span class="line">new file mode 100644</span><br><span class="line">index 0000000..80dd23d</span><br><span class="line">--- /dev/null</span><br><span class="line">+++ b/compare.txt</span><br><span class="line">@@ -0,0 +1 @@</span><br><span class="line">+only first line when created</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<p>执行 <code>git commit -m &quot;add compare.txt&quot;</code> 提交 compare.txt 之后。可看到如下。此时工作目录、暂存区和当前版本均无差异。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git commit -m &quot;add compare.txt&quot;</span><br><span class="line">[master 1e05a4f] add compare.txt</span><br><span class="line"> 2 files changed, 1 insertion(+), 1 deletion(-)</span><br><span class="line"> create mode 100644 compare.txt</span><br><span class="line"> delete mode 100644 diff.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git diff</span><br><span class="line">yukiyama@yukiyama hello-git % git diff --staged compare.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git diff HEAD compare.txt</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<p>增加第二行 「second line added」之后。可以看到如下。</p>
<ul>
<li><code>git diff</code> 列出第二行差异，因为此时工作目录下该文件多了一行 。</li>
<li><code>git diff --staged</code> 由于暂存区与当前仓库版本无差异，因此无回显。</li>
<li><code>git diff HEAD</code> 由于工作目录与当前仓库版本无差异，因此无回显。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git diff compare.txt</span><br><span class="line">diff --git a/compare.txt b/compare.txt</span><br><span class="line">index 80dd23d..3d555a6 100644</span><br><span class="line">--- a/compare.txt</span><br><span class="line">+++ b/compare.txt</span><br><span class="line">@@ -1 +1,2 @@</span><br><span class="line"> only first line when created</span><br><span class="line">+second line added</span><br><span class="line">yukiyama@yukiyama hello-git % git diff --staged compare.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git diff HEAD compare.txt</span><br><span class="line">diff --git a/compare.txt b/compare.txt</span><br><span class="line">index 80dd23d..3d555a6 100644</span><br><span class="line">--- a/compare.txt</span><br><span class="line">+++ b/compare.txt</span><br><span class="line">@@ -1 +1,2 @@</span><br><span class="line"> only first line when created</span><br><span class="line">+second line added</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<p>「版本号」的不同写法。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git diff HEAD~1 compare.txt</span><br><span class="line">diff --git a/compare.txt b/compare.txt</span><br><span class="line">new file mode 100644</span><br><span class="line">index 0000000..3d555a6</span><br><span class="line">--- /dev/null</span><br><span class="line">+++ b/compare.txt</span><br><span class="line">@@ -0,0 +1,2 @@</span><br><span class="line">+only first line when created</span><br><span class="line">+second line added</span><br><span class="line">yukiyama@yukiyama hello-git % git diff HEAD^ compare.txt</span><br><span class="line">diff --git a/compare.txt b/compare.txt</span><br><span class="line">new file mode 100644</span><br><span class="line">index 0000000..3d555a6</span><br><span class="line">--- /dev/null</span><br><span class="line">+++ b/compare.txt</span><br><span class="line">@@ -0,0 +1,2 @@</span><br><span class="line">+only first line when created</span><br><span class="line">+second line added</span><br><span class="line">yukiyama@yukiyama hello-git % git reflog -2</span><br><span class="line">1e05a4f (HEAD -&gt; master) HEAD@&#123;0&#125;: commit: add compare.txt</span><br><span class="line">f08b6a1 HEAD@&#123;1&#125;: commit: add diff.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git diff f08b6a1 compare.txt</span><br><span class="line">diff --git a/compare.txt b/compare.txt</span><br><span class="line">new file mode 100644</span><br><span class="line">index 0000000..3d555a6</span><br><span class="line">--- /dev/null</span><br><span class="line">+++ b/compare.txt</span><br><span class="line">@@ -0,0 +1,2 @@</span><br><span class="line">+only first line when created</span><br><span class="line">+second line added</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<br />
<h3 id="git-rm">git rm</h3>
<p>使用 <code>git rm &lt;filename&gt;</code> 从已跟踪的文件清单中移除指定文件 (即从暂存区域移除) 并提交，同时删除该文件。如果只是 使用 <code>rm</code> ，虽然文件被删除，但 <code>git status</code> 后还是能看到已被删除的文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama git-demo % git rm hello.txt</span><br><span class="line">error: the following file has staged content different from both the</span><br><span class="line">file and the HEAD:</span><br><span class="line">    hello.txt</span><br><span class="line">(use -f to force removal)</span><br><span class="line">yukiyama@yukiyama git-demo % git status</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git restore --staged &lt;file&gt;...&quot; to unstage)</span><br><span class="line">	modified:   hello.txt</span><br><span class="line"></span><br><span class="line">Changes not staged for commit:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span><br><span class="line">  (use &quot;git restore &lt;file&gt;...&quot; to discard changes in working directory)</span><br><span class="line">	modified:   .DS_Store</span><br><span class="line">	modified:   hello.txt</span><br><span class="line"></span><br><span class="line">yukiyama@yukiyama git-demo %</span><br></pre></td></tr></table></figure>
<p>如上，在 <code>git rm</code> 删除指定文件前，若该文件有过修改，则拒绝删除，这样做的目的是防止删除未添加到仓库中的数据，这样的数据无法被 git 恢复。确定要删除时可以使用 <code>-f</code> 参数强制删除 (force) 。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama git-demo % git rm -f hello.txt</span><br><span class="line">rm &#x27;hello.txt&#x27;</span><br><span class="line">yukiyama@yukiyama git-demo % git status</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git restore --staged &lt;file&gt;...&quot; to unstage)</span><br><span class="line">	deleted:    hello.txt</span><br><span class="line"></span><br><span class="line">Changes not staged for commit:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span><br><span class="line">  (use &quot;git restore &lt;file&gt;...&quot; to discard changes in working directory)</span><br><span class="line">	modified:   .DS_Store</span><br><span class="line"></span><br><span class="line">yukiyama@yukiyama git-demo %</span><br></pre></td></tr></table></figure>
<br />
<h3 id="git-mv">git mv</h3>
<p>使用 <code>git mv</code> 命令修改文件名，例如 <code>git mv a.txt b.txt</code> 相当于如下三行命令。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mv a.txt b.txt</span><br><span class="line">git rm a.txt</span><br><span class="line">git add b.txt</span><br></pre></td></tr></table></figure>
<br />
<h3 id="git-log">git log</h3>
<p>使用 <code>git log</code> 查看提交历史。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama git-demo % git log</span><br><span class="line">commit b8d829123843fe1d760983ed5bfc9f2cbcc22d13 (HEAD -&gt; master)</span><br><span class="line">Author: iyukiyama &lt;youremail@yama.com&gt;</span><br><span class="line">Date:   Mon Sep 26 19:54:50 2022 +0800</span><br><span class="line"></span><br><span class="line">    modified one line</span><br><span class="line"></span><br><span class="line">commit 5f3d03819d450b534153b90531393efd38e6a0a1</span><br><span class="line">Author: iyukiyama &lt;youremail@yama.com&gt;</span><br><span class="line">Date:   Mon Sep 26 19:53:32 2022 +0800</span><br><span class="line"></span><br><span class="line">    first commit</span><br></pre></td></tr></table></figure>
<p>使用 <code>git log -p</code> 查看每次提交的差异，使用 <code>git log -p -2</code> 查看最近 2 次提交的差异。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama git-demo % git log -p</span><br><span class="line">commit b8d829123843fe1d760983ed5bfc9f2cbcc22d13 (HEAD -&gt; master)</span><br><span class="line">Author: iyukiyama &lt;youremail@yama.com&gt;</span><br><span class="line">Date:   Mon Sep 26 19:54:50 2022 +0800</span><br><span class="line"></span><br><span class="line">    modified one line</span><br><span class="line"></span><br><span class="line">diff --git a/hello.txt b/hello.txt</span><br><span class="line">index 40f4dc0..06227ce 100644</span><br><span class="line">--- a/hello.txt</span><br><span class="line">+++ b/hello.txt</span><br><span class="line">@@ -1,3 +1,3 @@</span><br><span class="line">-hello 1</span><br><span class="line">+hello 1 modified</span><br><span class="line"> hello 2</span><br><span class="line"> hello 3</span><br><span class="line"></span><br><span class="line">commit 5f3d03819d450b534153b90531393efd38e6a0a1</span><br><span class="line">Author: iyukiyama &lt;youremail@yama.com&gt;</span><br><span class="line">Date:   Mon Sep 26 19:53:32 2022 +0800</span><br><span class="line"></span><br><span class="line">    first commit</span><br><span class="line"></span><br><span class="line">diff --git a/hello.txt b/hello.txt</span><br><span class="line">new file mode 100644</span><br><span class="line">index 0000000..40f4dc0</span><br><span class="line">--- /dev/null</span><br><span class="line">+++ b/hello.txt</span><br><span class="line">@@ -0,0 +1,3 @@</span><br><span class="line">+hello 1</span><br><span class="line">+hello 2</span><br><span class="line">+hello 3</span><br></pre></td></tr></table></figure>
<p><code>git log</code> 命令有许多参数可用于调整输出历史记录的信息。</p>
<br />
<h3 id="git-reflog">git reflog</h3>
<p>也可以使用 <code>git reflog</code> 查看缩略的提交历史信息。<code>git reflog -p</code>, <code>git reflog -2</code> 的作用与 <code>git log -p</code> 和 <code>git log -2</code> 类似。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama git-demo % git reflog</span><br><span class="line">b8d8291 (HEAD -&gt; master) HEAD@&#123;0&#125;: commit: modified one line</span><br><span class="line">5f3d038 HEAD@&#123;1&#125;: commit: first commit</span><br></pre></td></tr></table></figure>
<br />
<h2 id="撤销操作">撤销操作</h2>
<table>
<thead>
<tr>
<th>撤销操作</th>
<th>执行前状态</th>
<th>区域变化</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>git commit --amend</td>
<td>未修改</td>
<td>暂存区 &gt; 仓库</td>
<td>修改 message 后提交暂存区，替换掉最后一次提交，即提交数不变 (commit id不同)。</td>
</tr>
<tr>
<td>git commit --amend -m “&lt;提交信息&gt;”</td>
<td>未修改</td>
<td>暂存区 &gt; 仓库</td>
<td>同上，但不会打开编辑器编辑提交信息，而是直接写上提交信息。</td>
</tr>
<tr>
<td>git restore --staged &lt;文件名&gt;</td>
<td>已暂存</td>
<td>暂存区 &gt; 工作区</td>
<td>将指定文件移出暂存区<br />※ 必须指定文件名</td>
</tr>
<tr>
<td>git restore &lt;文件名&gt;</td>
<td>已修改</td>
<td>不变</td>
<td>都在工作目录下，将已修改状态的指定文件回退到未修改的状态，即丢弃指定文件的所有修改。</td>
</tr>
<tr>
<td>git rest HEAD &lt;文件名&gt;</td>
<td>已暂存</td>
<td>暂存区 &gt; 工作区</td>
<td>同 <code>git restore --staged &lt;文件名&gt;</code><br />※ 若不指定文件名，则清空暂存区</td>
</tr>
<tr>
<td>git checkout – &lt;文件名&gt;</td>
<td>已修改</td>
<td>不变</td>
<td>同 <code>git restore &lt;文件名&gt;</code><br />※ 必须指定文件名</td>
</tr>
</tbody>
</table>
<br />
<h3 id="git-commit-amend">git commit --amend</h3>
<p>在某次提交后发现该提交的 message 描述有误，想要修改该 message ，或者想要再 add 一些文件，可以使用 <code>git commit --amend</code> 。</p>
<p>如下先完成两次提交。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">commit 6d70b38bd6becddcd2b70fb1a5bc3ee929070497 (HEAD -&gt; master)</span><br><span class="line">Author: yukiyama &lt;yukiyama@163.com&gt;</span><br><span class="line">iiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiijjjiiiiiiiiiiiixx</span><br><span class="line">Date:   Wed Sep 28 20:11:01 2022 +0800</span><br><span class="line"></span><br><span class="line">    first commit</span><br><span class="line">yukiyama@yukiyama hello-git % vim hello.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git add .</span><br><span class="line">yukiyama@yukiyama hello-git % git commit -m &quot;second commit&quot;</span><br><span class="line">[master 6eefb40] second commit</span><br><span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span><br><span class="line">yukiyama@yukiyama hello-git % git log</span><br><span class="line">commit 6eefb4065d6b3f02cedf9edce05d3de2afaace87 (HEAD -&gt; master)</span><br><span class="line">Author: yukiyama &lt;yukiyama@163.com&gt;</span><br><span class="line">Date:   Wed Sep 28 20:11:37 2022 +0800</span><br><span class="line"></span><br><span class="line">    second commit</span><br><span class="line"></span><br><span class="line">commit 6d70b38bd6becddcd2b70fb1a5bc3ee929070497</span><br><span class="line">Author: yukiyama &lt;yukiyama@163.com&gt;</span><br><span class="line">Date:   Wed Sep 28 20:11:01 2022 +0800</span><br><span class="line"></span><br><span class="line">    first commit</span><br><span class="line">yukiyama@yukiyama hello-git % git status</span><br><span class="line">On branch master</span><br><span class="line">nothing to commit, working tree clean</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<p>修改文件并执行 <code>git add</code> 后，将 message 修改为 “second commit (amend)” 来取代上一次提交。再次执行 <code>git log</code> 可以看到前次提交 (6eefb) 已不显示，取而代之的是新提交 (b299e) ，message 发生变化但提交时间和作者信息与之前是一致的。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % vim hello.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git add hello.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git status</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git restore --staged &lt;file&gt;...&quot; to unstage)</span><br><span class="line">	modified:   hello.txt</span><br><span class="line"></span><br><span class="line">yukiyama@yukiyama hello-git % git commit --amend -m &quot;second commit (amend)&quot;</span><br><span class="line">[master b299e54] second commit (amend)</span><br><span class="line"> Date: Wed Sep 28 20:11:37 2022 +0800</span><br><span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span><br><span class="line">yukiyama@yukiyama hello-git % git log</span><br><span class="line">commit b299e542f8677f2c1e55b17cd9aa24bb2241ebad (HEAD -&gt; master)</span><br><span class="line">Author: yukiyama &lt;yukiyama@163.com&gt;</span><br><span class="line">Date:   Wed Sep 28 20:11:37 2022 +0800</span><br><span class="line"></span><br><span class="line">    second commit (amend)</span><br><span class="line"></span><br><span class="line">commit 6d70b38bd6becddcd2b70fb1a5bc3ee929070497</span><br><span class="line">Author: yukiyama &lt;yukiyama@163.com&gt;</span><br><span class="line">Date:   Wed Sep 28 20:11:01 2022 +0800</span><br><span class="line"></span><br><span class="line">    first commit</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<p>每次提交时都可以使用 <code>git commit --amend -m &quot;&lt;message&gt;&quot;</code> 来取代上一次提交，这样无论有多少次提交， <code>git log</code> 都只显示最后一次提交。(但是 <code>git reflog</code> 仍会显示每一次提交) 。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git reflog</span><br><span class="line">b299e54 (HEAD -&gt; master) HEAD@&#123;0&#125;: commit (amend): second commit (amend)</span><br><span class="line">6eefb40 HEAD@&#123;1&#125;: commit: second commit</span><br><span class="line">6d70b38 HEAD@&#123;2&#125;: commit (initial): first commit</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<br />
<h3 id="git-restore">git restore</h3>
<p>主要有两种用法，两种用法都必须指定文件名，可以一次指定多个文件 (文件名用空格分开) 。</p>
<ul>
<li>使用 <code>git restore --staged &lt;文件名&gt;</code> 将指定的暂存区中的文件移出暂存区。</li>
<li>使用 <code>git restore &lt;文件名&gt;</code> 将工作目录下的「已修改」文件恢复为未修改状态。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git add hello.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git status</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git restore --staged &lt;file&gt;...&quot; to unstage)</span><br><span class="line">	modified:   hello.txt</span><br><span class="line"></span><br><span class="line">yukiyama@yukiyama hello-git % git restore --staged hello.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git status</span><br><span class="line">On branch master</span><br><span class="line">Changes not staged for commit:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span><br><span class="line">  (use &quot;git restore &lt;file&gt;...&quot; to discard changes in working directory)</span><br><span class="line">	modified:   hello.txt</span><br><span class="line"></span><br><span class="line">no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)</span><br><span class="line">yukiyama@yukiyama hello-git % git restore hello.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git status</span><br><span class="line">On branch master</span><br><span class="line">nothing to commit, working tree clean</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<br />
<h3 id="git-reset">git reset</h3>
<p>使用 <code>git rest HEAD &lt;filename&gt;</code> 将指定的已暂存的文件移出暂存区 (同 <code>git restore --staged &lt;filename&gt;</code> )， 若不指定文件，则取消所有文件的暂存内容 (清空暂存区)。其中，<code>HEAD</code> 表示当前版本，退回到上一个版本可用 <code>HEAD^ </code>。</p>
<p><code>git rest HEAD &lt;filename&gt;</code> 与 <code>git restore --staged &lt;filename&gt;</code> 效果相同，但 git 的提示推荐使用 <code>git restore &lt;文件名&gt;</code> 用法。</p>
<p>如下展示 <code>hello.txt</code> 加入暂存区后，执行 <code>git rest HEAD</code> 取消暂存的过程。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git add hello.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git status</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git restore --staged &lt;file&gt;...&quot; to unstage)</span><br><span class="line">	modified:   hello.txt</span><br><span class="line"></span><br><span class="line">yukiyama@yukiyama hello-git % git reset HEAD hello.txt</span><br><span class="line">Unstaged changes after reset:</span><br><span class="line">M	hello.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git status</span><br><span class="line">On branch master</span><br><span class="line">Changes not staged for commit:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span><br><span class="line">  (use &quot;git restore &lt;file&gt;...&quot; to discard changes in working directory)</span><br><span class="line">	modified:   hello.txt</span><br><span class="line"></span><br><span class="line">no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<br />
<h3 id="git-checkout-–">git checkout –</h3>
<p>使用 <code>git checkout -- &lt;filename&gt;</code> 将工作目录下的「已修改」文件恢复为未修改状态，同 <code>git restore &lt;文件名&gt;</code> ，git 的提示推荐使用 <code>git restore &lt;文件名&gt;</code> 用法。</p>
<p>如下，接上一节的操作。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git checkout -- hello.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git status</span><br><span class="line">On branch master</span><br><span class="line">nothing to commit, working tree clean</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<br />
<h2 id="切换操作">切换操作</h2>
<p>切换操作也属于广义上的撤销，但更强调在版本间穿梭的特点。<code>git reset</code> 的主要能力特点就是能够实现版本之间穿梭的操作，即「切换操作」。</p>
<p>在介绍命令之前有必要先说明如下三个「切换目标」的概念。</p>
<table>
<thead>
<tr>
<th>切换目标</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>HEAD</td>
<td>指向当前分支的当前版本 (commit) 的指针，可以理解为就是当前版本。</td>
</tr>
<tr>
<td>index</td>
<td>可以理解为当前暂存区</td>
</tr>
<tr>
<td>working tree</td>
<td>可以理解为当前工作目录</td>
</tr>
</tbody>
</table>
<p><code>git reset</code> 命令有三种常用模式 <code>--mixed</code> (默认，不显式写出时即为此模式)、<code>--soft</code> 以及 <code>--hard</code> ，分别实现对不同「切换目标」的操作。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>git reset --soft &lt;版本号&gt;</td>
<td>将 HEAD 指向指定的版本 (commit) ，不改动 index 和 working tree。<br />※ 不可指定文件名 (指定则报错)。</td>
</tr>
<tr>
<td>git reset --mixed  &lt;版本号&gt;</td>
<td>不指定文件。将 HEAD 指向指定的版本 (commit) ，并使得暂存区与指定版本一致，即在指定版本之后加入暂存区的所有文件都移出暂存区。<br />※ <code>--mixed</code> 参数是默认的，也可不写。</td>
</tr>
<tr>
<td>git reset --mixed  &lt;版本号&gt; &lt;文件名&gt;</td>
<td>指定文件。HEAD 指针不变，但指定的文件对应的暂存区内容将切换到指定版本的状态，其他文件在暂存区的内容不变。</td>
</tr>
<tr>
<td>git reset --hard &lt;版本号&gt;</td>
<td>将 HEAD, index 和 working tree 都切换到指定版本号的状态。<br />※ 不可指定文件名 (指定则报错)。</td>
</tr>
</tbody>
</table>
<p>※ 「版本号」可以用 HEAD, HEAD^, HEAD^^, HEAD~1, HEAD~2 等形式表示。HEAD 表示当前版本，HEAD^ 表示当前版本的前一个版本，有多少个 <code>^</code> 就往前多少个版本，<code>~1</code> 表示当前版本的前一个版本，数字是多少，就表示往前多少个版本。</p>
<p>※ 在「撤销操作」中，我们说过 <a target="_blank" rel="noopener" href="https://github.blog/2019-08-16-highlights-from-git-2-23/">git 2.23</a> 版本加入 <code>git restore</code> 命令后，推荐使用 <code>git restore --staged &lt;文件名&gt;</code> 来代替 <code>git reset HEAD &lt;filename&gt;</code> ，原因之一就是 <code>git reset</code> 承担的功能太多，有必要引入新的更直观的命令来取代一部分功能。</p>
<br />
<h3 id="git-reset-soft">git reset --soft</h3>
<p><code>git reset --soft &lt;commit id&gt;</code> 将 HEAD 指向指定的版本 (commit) ，不改动 index 和 working tree。简单直观的理解即执行后，在版本历史中的第一条 (当前版本) 即为指定的那个版本，除此之外无其他变化。</p>
<p>如下演示 <code>--soft</code> 模式的效果。</p>
<p>首先，依次提交 1.txt , 2.txt 和 3.txt 之后<code>git add</code> 4.txt 但不提交，则当前有 3 个版本，暂存区中有四个文件 (通过 <code>git ls-files</code> 查看)。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git reflog</span><br><span class="line">5bff39f (HEAD -&gt; master) HEAD@&#123;0&#125;: commit: add 3</span><br><span class="line">d287e4b HEAD@&#123;1&#125;: commit: add 2</span><br><span class="line">c97c40e HEAD@&#123;2&#125;: commit (initial): add 1</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br><span class="line">yukiyama@yukiyama hello-git % git ls-files</span><br><span class="line">1.txt</span><br><span class="line">2.txt</span><br><span class="line">3.txt</span><br><span class="line">yukiyama@yukiyama hello-git % vim 4.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git add 4.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git status</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git restore --staged &lt;file&gt;...&quot; to unstage)</span><br><span class="line">	new file:   4.txt</span><br><span class="line"></span><br><span class="line">yukiyama@yukiyama hello-git % git ls-files</span><br><span class="line">1.txt</span><br><span class="line">2.txt</span><br><span class="line">3.txt</span><br><span class="line">4.txt</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<p>然后软切换回  (<code>--soft</code>) 第一个版本 (c97c40e)，此时当前分支 (master) 的 HEAD 确实指向了指定的版本。通过 <code>git status</code> 和 <code>git ls-files</code> 可以看到，在暂存区的内容无变化，只不过因为切回了若干个版本，暂存区「领先」了当前版本 (c97c40e) ，因此 2.txt, 3.txt, 4.txt 都是「Changes to be committed」。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git reset --soft c97c40e</span><br><span class="line">yukiyama@yukiyama hello-git % git reflog</span><br><span class="line">c97c40e (HEAD -&gt; master) HEAD@&#123;0&#125;: reset: moving to c97c40e</span><br><span class="line">5bff39f HEAD@&#123;1&#125;: commit: add 3</span><br><span class="line">d287e4b HEAD@&#123;2&#125;: commit: add 2</span><br><span class="line">c97c40e (HEAD -&gt; master) HEAD@&#123;3&#125;: commit (initial): add 1</span><br><span class="line">yukiyama@yukiyama hello-git % git status</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git restore --staged &lt;file&gt;...&quot; to unstage)</span><br><span class="line">	new file:   2.txt</span><br><span class="line">	new file:   3.txt</span><br><span class="line">	new file:   4.txt</span><br><span class="line"></span><br><span class="line">yukiyama@yukiyama hello-git % git ls-files</span><br><span class="line">1.txt</span><br><span class="line">2.txt</span><br><span class="line">3.txt</span><br><span class="line">4.txt</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<p>由此我们验证了 <code>--soft</code> 模式确实只是将 HEAD 指向指定的版本，暂存区与工作目录无变化。</p>
<br />
<h3 id="git-reset-mixed">git reset --mixed</h3>
<p><code>git reset --mixed &lt;commit id&gt;</code> 命令，可以指定文件或不指定文件，效果不同。</p>
<ul>
<li>不指定文件时。即包含了 <code>--soft</code> 实现的功能，即 <code>HEAD</code> 指针指向指定的版本，又实现了「暂存区」的切换，即使得暂存区与指定版本一致。</li>
<li>指定文件时。<code>HEAD</code> 指针不变，但指定的文件对应的暂存区内容将切换到指定版本的状态。</li>
</ul>
<p>首先，提交 1.txt 作为第一个版本 (fc746eb) ，提交 2-1.txt 和 2-2.txt 作为第二个版本 (d3f6a97) ，提交 3.txt 作为第三个版本 (23a6441) ，将 4.txt 放入暂存区但不提交。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % vim 1.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git add 1.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git commit -m &quot;add 1.txt&quot;</span><br><span class="line">[master (root-commit) fc746eb] add 1.txt</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 1.txt</span><br><span class="line">yukiyama@yukiyama hello-git % vim 2-1.txt</span><br><span class="line">yukiyama@yukiyama hello-git % vim 2-2.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git add 2-1.txt 2-2.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git commit -m &quot;add 2-1.txt 2-2.txt&quot;</span><br><span class="line">[master d3f6a97] add 2-1.txt 2-2.txt</span><br><span class="line"> 2 files changed, 2 insertions(+)</span><br><span class="line"> create mode 100644 2-1.txt</span><br><span class="line"> create mode 100644 2-2.txt</span><br><span class="line">yukiyama@yukiyama hello-git % vim 3.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git add 3.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git commit -m &quot;add 3.txt&quot;</span><br><span class="line">[master 23a6441] add 3.txt</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 3.txt</span><br><span class="line">yukiyama@yukiyama hello-git % vim 4.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git add 4.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git status</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git restore --staged &lt;file&gt;...&quot; to unstage)</span><br><span class="line">	new file:   4.txt</span><br><span class="line"></span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<p>可以看到暂存区中有五个文件，提交历史有三次，当前 HEAD 指向的是提交了 3.txt 的版本。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git ls-files</span><br><span class="line">1.txt</span><br><span class="line">2-1.txt</span><br><span class="line">2-2.txt</span><br><span class="line">3.txt</span><br><span class="line">4.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git reflog</span><br><span class="line">23a6441 (HEAD -&gt; master) HEAD@&#123;0&#125;: commit: add 3.txt</span><br><span class="line">d3f6a97 HEAD@&#123;1&#125;: commit: add 2-1.txt 2-2.txt</span><br><span class="line">fc746eb HEAD@&#123;2&#125;: commit (initial): add 1.txt</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<p>接着执行混合切换 (<code>--mixed</code>) 到第二个版本，即提交了 2-1.txt 和 2-2.txt 的版本 (d3f6a97) ，由于未指定文件，因此实现的效果是 HEAD 指向 d3f6a97 ，且暂存区也恢复到 d3f6a97 的状态。查看提交历史，HEAD 确实为 d3f6a97，且 message 提示了是通过 reset 切换而来的。通过 <code>git ls-files</code> 看到此时暂存区里的文件也确实是第二个版本对应的三个文件 1.txt, 2-1.txt, 2-2.txt ，即相当于把指定版本之后才放到暂存区的文件都移出了暂存区，导致这些文件出现在 <code>git status</code> 的提示中，即他们此时是 「Untracked files」(在指定版本之后才创建的)。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git reset --mixed d3f6a97</span><br><span class="line">yukiyama@yukiyama hello-git % git reflog</span><br><span class="line">d3f6a97 (HEAD -&gt; master) HEAD@&#123;0&#125;: reset: moving to d3f6a97</span><br><span class="line">23a6441 HEAD@&#123;1&#125;: commit: add 3.txt</span><br><span class="line">d3f6a97 (HEAD -&gt; master) HEAD@&#123;2&#125;: commit: add 2-1.txt 2-2.txt</span><br><span class="line">fc746eb HEAD@&#123;3&#125;: commit (initial): add 1.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git status</span><br><span class="line">On branch master</span><br><span class="line">Untracked files:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)</span><br><span class="line">	3.txt</span><br><span class="line">	4.txt</span><br><span class="line"></span><br><span class="line">nothing added to commit but untracked files present (use &quot;git add&quot; to track)</span><br><span class="line">yukiyama@yukiyama hello-git % git ls-files</span><br><span class="line">1.txt</span><br><span class="line">2-1.txt</span><br><span class="line">2-2.txt</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<p>接着再测试指定文件的效果，如下，由于 <code>--mixed</code> 是默认的参数，可以省略。执行 <code>git reset fc746eb 2-1.txt</code> 将指定文件 2-1.txt 对应的暂存区内容切换回 <code>fc746eb</code> 版本 (提交了 1.txt 的第一个版本) ，即只将此文件对应暂存区的内容移除对应到指定的版本状态 (对这个例子来说，即移除，因为 1.txt 提交的时候尚未创建 2-1.txt)，其他文件在暂存区的内容保留。</p>
<p>首先通过 <code>git reflog</code> 可以看到 HEAD 不变。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git reset fc746eb 2-1.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git reflog</span><br><span class="line">d3f6a97 (HEAD -&gt; master) HEAD@&#123;0&#125;: reset: moving to d3f6a97</span><br><span class="line">23a6441 HEAD@&#123;1&#125;: commit: add 3.txt</span><br><span class="line">d3f6a97 (HEAD -&gt; master) HEAD@&#123;2&#125;: commit: add 2-1.txt 2-2.txt</span><br><span class="line">fc746eb HEAD@&#123;3&#125;: commit (initial): add 1.txt</span><br><span class="line">yukiyama@yukiyama hello-git % </span><br></pre></td></tr></table></figure>
<p>接着，通过 <code>git ls-files</code> 看到当前暂存区已无 2-1.txt ，但却有 2-2.txt ，说明只是移除了指定的文件对应的暂存区内容。另外执行 <code>git status</code> 可以看到移出的 2-1.txt 以及在前一次不带文件名的混合切换后移出的 3.txt 和 4.txt 都变为了 「Untracked files」。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git status</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git restore --staged &lt;file&gt;...&quot; to unstage)</span><br><span class="line">	deleted:    2-1.txt</span><br><span class="line"></span><br><span class="line">Untracked files:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)</span><br><span class="line">	2-1.txt</span><br><span class="line">	3.txt</span><br><span class="line">	4.txt</span><br><span class="line"></span><br><span class="line">yukiyama@yukiyama hello-git % git ls-files</span><br><span class="line">1.txt</span><br><span class="line">2-2.txt</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<br />
<h3 id="git-reset-hard">git reset --hard</h3>
<p><code>git reset --hard &lt;commit id&gt;</code> 命令将 HEAD, index 和 working tree 都切换到指定版本号的状态</p>
<p>接着之前 <code>git reset --mixed</code> 的操作后继续演示，首先执行 <code>git reset 23a6441</code> 恢复到提交了 3.txt 之后的版本状态。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git reset 23a6441</span><br><span class="line">yukiyama@yukiyama hello-git % git status</span><br><span class="line">On branch master</span><br><span class="line">Untracked files:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)</span><br><span class="line">	4.txt</span><br><span class="line"></span><br><span class="line">nothing added to commit but untracked files present (use &quot;git add&quot; to track)</span><br><span class="line">yukiyama@yukiyama hello-git % git ls-files</span><br><span class="line">1.txt</span><br><span class="line">2-1.txt</span><br><span class="line">2-2.txt</span><br><span class="line">3.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git log --oneline</span><br><span class="line">23a6441 (HEAD -&gt; master) add 3.txt</span><br><span class="line">d3f6a97 add 2-1.txt 2-2.txt</span><br><span class="line">fc746eb add 1.txt</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<p>然后执行 <code>git reset --hard fc746eb</code> 硬切换回提交了 1.txt 之后的版本。可以看到如下效果，即 HEAD, index (暂存区) 和工作目录确实都切换到了 fc746eb 的状态。略有不同的是此时还存在新建状态但未 <code>git add</code> 的 4.txt，这是因为执行此次硬切换时 4.txx 是未 <code>git add</code> 的状态，不被 git 所管控。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git reset --hard fc746eb</span><br><span class="line">HEAD is now at fc746eb add 1.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git log --oneline</span><br><span class="line">fc746eb (HEAD -&gt; master) add 1.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git reflog</span><br><span class="line">fc746eb (HEAD -&gt; master) HEAD@&#123;0&#125;: reset: moving to fc746eb</span><br><span class="line">23a6441 HEAD@&#123;1&#125;: reset: moving to 23a6441</span><br><span class="line">d3f6a97 HEAD@&#123;2&#125;: reset: moving to d3f6a97</span><br><span class="line">23a6441 HEAD@&#123;3&#125;: commit: add 3.txt</span><br><span class="line">d3f6a97 HEAD@&#123;4&#125;: commit: add 2-1.txt 2-2.txt</span><br><span class="line">fc746eb (HEAD -&gt; master) HEAD@&#123;5&#125;: commit (initial): add 1.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git status</span><br><span class="line">On branch master</span><br><span class="line">Untracked files:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)</span><br><span class="line">	4.txt</span><br><span class="line"></span><br><span class="line">nothing added to commit but untracked files present (use &quot;git add&quot; to track)</span><br><span class="line">yukiyama@yukiyama hello-git % git ls-files</span><br><span class="line">1.txt</span><br><span class="line">yukiyama@yukiyama hello-git % ls -al</span><br><span class="line">total 16</span><br><span class="line">drwxr-xr-x@  5 yukiyama  staff  160 Sep 29 16:21 .</span><br><span class="line">drwxr-xr-x@ 10 yukiyama  staff  320 Sep 29 16:21 ..</span><br><span class="line">drwxr-xr-x@ 13 yukiyama  staff  416 Sep 29 16:20 .git</span><br><span class="line">-rw-r--r--   1 yukiyama  staff    3 Sep 29 15:34 1.txt</span><br><span class="line">-rw-r--r--   1 yukiyama  staff    4 Sep 29 15:35 4.txt</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<p>如果这时候我们再次硬切换回提交了 3.txt 的版本 (23a6441)，可以看到如下效果，即恢复到了该版本状态，不同的也是 4.txt 仍然存在，原因同前述。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git reset --hard 23a6441</span><br><span class="line">HEAD is now at 23a6441 add 3.txt</span><br><span class="line">yukiyama@yukiyama hello-git % ls -al</span><br><span class="line">total 40</span><br><span class="line">drwxr-xr-x@  8 yukiyama  staff  256 Sep 29 16:21 .</span><br><span class="line">drwxr-xr-x@ 10 yukiyama  staff  320 Sep 29 16:21 ..</span><br><span class="line">drwxr-xr-x@ 13 yukiyama  staff  416 Sep 29 16:21 .git</span><br><span class="line">-rw-r--r--   1 yukiyama  staff    3 Sep 29 15:34 1.txt</span><br><span class="line">-rw-r--r--   1 yukiyama  staff    2 Sep 29 16:21 2-1.txt</span><br><span class="line">-rw-r--r--   1 yukiyama  staff    4 Sep 29 16:21 2-2.txt</span><br><span class="line">-rw-r--r--   1 yukiyama  staff    4 Sep 29 16:21 3.txt</span><br><span class="line">-rw-r--r--   1 yukiyama  staff    4 Sep 29 15:35 4.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git status</span><br><span class="line">On branch master</span><br><span class="line">Untracked files:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)</span><br><span class="line">	4.txt</span><br><span class="line"></span><br><span class="line">nothing added to commit but untracked files present (use &quot;git add&quot; to track)</span><br><span class="line">yukiyama@yukiyama hello-git % git ls-files</span><br><span class="line">1.txt</span><br><span class="line">2-1.txt</span><br><span class="line">2-2.txt</span><br><span class="line">3.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git log --oneline</span><br><span class="line">23a6441 (HEAD -&gt; master) add 3.txt</span><br><span class="line">d3f6a97 add 2-1.txt 2-2.txt</span><br><span class="line">fc746eb add 1.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git reflog</span><br><span class="line">23a6441 (HEAD -&gt; master) HEAD@&#123;0&#125;: reset: moving to 23a6441</span><br><span class="line">fc746eb HEAD@&#123;1&#125;: reset: moving to fc746eb</span><br><span class="line">23a6441 (HEAD -&gt; master) HEAD@&#123;2&#125;: reset: moving to 23a6441</span><br><span class="line">d3f6a97 HEAD@&#123;3&#125;: reset: moving to d3f6a97</span><br><span class="line">23a6441 (HEAD -&gt; master) HEAD@&#123;4&#125;: commit: add 3.txt</span><br><span class="line">d3f6a97 HEAD@&#123;5&#125;: commit: add 2-1.txt 2-2.txt</span><br><span class="line">fc746eb HEAD@&#123;6&#125;: commit (initial): add 1.txt</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<br />
<h2 id="分支操作">分支操作</h2>
<p>分支本质上是指向提交对象的可变指针。</p>
<br />
<h3 id="git-branch">git branch</h3>
<p>新建分支本质上是 git 创建了一个可以移动的指向当前提交对象的新指针。</p>
<p>使用 <code>git branch &lt;分支名&gt;</code> 创建分支。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git branch testing</span><br><span class="line">yukiyama@yukiyama hello-git % git branch -a</span><br><span class="line">* master</span><br><span class="line">  remote</span><br><span class="line">  testing</span><br><span class="line">  remotes/origin/master</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<p>使用  <code>git branch -d &lt;分支名&gt;</code> 删除分支，执行 <code>git branch</code> 查看本地仓库分支列表， <code>*</code> 表示当前分支。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git branch -d testing</span><br><span class="line">Deleted branch testing (was 070472d).</span><br><span class="line">yukiyama@yukiyama hello-git % git branch</span><br><span class="line">* master</span><br><span class="line">  remote</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<br />
<h3 id="git-switch">git switch</h3>
<p>使用 <code>git switch &lt;分支名&gt;</code> 切换分支。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git branch testing</span><br><span class="line">yukiyama@yukiyama hello-git % git branch</span><br><span class="line">* master</span><br><span class="line">  testing</span><br><span class="line">yukiyama@yukiyama hello-git % git switch testing</span><br><span class="line">Switched to branch &#x27;testing&#x27;</span><br><span class="line">yukiyama@yukiyama hello-git % git status</span><br><span class="line">On branch testing</span><br><span class="line">nothing to commit, working tree clean</span><br><span class="line">yukiyama@yukiyama hello-git % git switch -c fix</span><br><span class="line">Switched to a new branch &#x27;fix&#x27;</span><br><span class="line">yukiyama@yukiyama hello-git % git branch</span><br><span class="line">* fix</span><br><span class="line">  master</span><br><span class="line">  testing</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<p>使用 <code>git switch -c &lt;分支名&gt;</code> 创建并切换分支。</p>
<br />
<h3 id="git-checkout">git checkout</h3>
<p>使用 <code>git checkout &lt;分支名&gt;</code> 切换分支。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git checkout testing</span><br><span class="line">Switched to branch &#x27;testing&#x27;</span><br><span class="line">yukiyama@yukiyama hello-git % git status</span><br><span class="line">On branch testing</span><br><span class="line">nothing to commit, working tree clean</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<p>使用 <code>git checkout -b &lt;分支名&gt;</code> 创建并切换分支。</p>
<br />
<h3 id="git-merge">git merge</h3>
<p><code>git merge &lt;分支名&gt;</code> 将指定分支合并到当前分支中。合并通常有「快进」和</p>
<p>新建并切换到 testing 分支后，在 testing 分支上完成若干次 commit，且 master 无新的 commit，此时切回 master 分支，并执行 <code>git merge</code> 将 testing 合并到当前分支中。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git checkout master</span><br><span class="line">Switched to branch &#x27;master&#x27;</span><br><span class="line">Your branch is ahead of &#x27;origin/master&#x27; by 3 commits.</span><br><span class="line">  (use &quot;git push&quot; to publish your local commits)</span><br><span class="line">yukiyama@yukiyama hello-git % git merge testing</span><br><span class="line">Updating 44f99a2..b4552ad</span><br><span class="line">Fast-forward</span><br><span class="line"> hello.txt | 2 +-</span><br><span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<p>由于 master 是 testing 的直接祖先，master 可顺着 testing 分支的历次 commit 直接到达当前 testing，此情况下的合并无需解决分歧，因此 master 可以「快进」直达 testing，而不会产生新的版本 (快照)，回显中的 <code>Fast-forwad</code> 反映了这一特点。</p>
<p>若从分歧点开始 master 和 testing 都各自前进了若干个 commit，则此时合并为「三方合并」。若产生冲突，则有如下提示。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git log --oneline --graph --all</span><br><span class="line">* 4a3e876 (HEAD -&gt; testing) testing 1</span><br><span class="line">| * b6c50b9 (master) master 1</span><br><span class="line">|/</span><br><span class="line">* b4552ad modified hello.txt 3</span><br><span class="line">...(略)...</span><br><span class="line">yukiyama@yukiyama hello-git % git merge testing</span><br><span class="line">Auto-merging hello.txt</span><br><span class="line">CONFLICT (content): Merge conflict in hello.txt</span><br><span class="line">Automatic merge failed; fix conflicts and then commit the result.</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<p>解决冲突后，执行 <code>git status</code> 可以看到 <code>All conflicts fixed but you are still merging.</code> ，即说明冲突已解决，根据提示再次提交即完成合并。与「快进」合并不同的是，「三方合并」会生成一个新的快照。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is ahead of &#x27;origin/master&#x27; by 7 commits.</span><br><span class="line">  (use &quot;git push&quot; to publish your local commits)</span><br><span class="line"></span><br><span class="line">All conflicts fixed but you are still merging.</span><br><span class="line">  (use &quot;git commit&quot; to conclude merge)</span><br><span class="line"></span><br><span class="line">yukiyama@yukiyama hello-git %</span><br><span class="line">yukiyama@yukiyama hello-git % git commit</span><br><span class="line">[master b8da922] Merge branch &#x27;testing&#x27;</span><br><span class="line">yukiyama@yukiyama hello-git % git log --oneline --graph --all</span><br><span class="line">*   b8da922 (HEAD -&gt; master) Merge branch &#x27;testing&#x27;</span><br><span class="line">|\</span><br><span class="line">| * 4a3e876 (testing) testing 1</span><br><span class="line">* | b6c50b9 master 1</span><br><span class="line">|/</span><br><span class="line">* b4552ad modified hello.txt 3</span><br><span class="line">...(略)...</span><br></pre></td></tr></table></figure>
<p>使用如下命令随时以图形形式查看不同分支的前进和合并过程。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log --oneline --decorate --graph --all</span><br></pre></td></tr></table></figure>
<br />
<h3 id="git-rebase">git rebase</h3>
<p>两分支从分叉处开始各自有若干提交，合并这两个分支的另一种方式是 <code>git rebase</code> (变基)，与 <code>git merge</code> 执行「三方合并」不同的是，<code>git rebase</code> 会在当前分支下重放另一个分支在分叉处后的历次提交，最终得到一个新提交，结果与 <code>git merge</code> 相同，但提交历史更整洁，分支虽并行，但变基之后的提交历史是一条串行的直线。</p>
<p>当前分叉后 master 分支和 testing 分支各有一个提交版本。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git log --oneline --decorate --graph --all</span><br><span class="line">* e2f517c (HEAD -&gt; testing) testing modified 1</span><br><span class="line">| * ae47d2e (master) master modified 1</span><br><span class="line">| *   b8da922 Merge branch &#x27;testing&#x27;</span><br><span class="line">| |\</span><br><span class="line">| |/</span><br><span class="line">|/|</span><br><span class="line">* | 4a3e876 testing 1</span><br><span class="line">...(略)...</span><br></pre></td></tr></table></figure>
<p>切回 master ，执行变基，如下，有冲突，根据提示先解决冲突。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git checkout master</span><br><span class="line">Switched to branch &#x27;master&#x27;</span><br><span class="line">yukiyama@yukiyama hello-git % git rebase testing</span><br><span class="line">Auto-merging hello.txt</span><br><span class="line">CONFLICT (content): Merge conflict in hello.txt</span><br><span class="line">error: could not apply b6c50b9... master 1</span><br><span class="line">hint: Resolve all conflicts manually, mark them as resolved with</span><br><span class="line">hint: &quot;git add/rm &lt;conflicted_files&gt;&quot;, then run &quot;git rebase --continue&quot;.</span><br><span class="line">hint: You can instead skip this commit: run &quot;git rebase --skip&quot;.</span><br><span class="line">hint: To abort and get back to the state before &quot;git rebase&quot;, run &quot;git rebase --abort&quot;.</span><br><span class="line">Could not apply b6c50b9... master 1</span><br></pre></td></tr></table></figure>
<p>解决冲突后，对冲突文件执行 <code>git add</code> 后，再次执行变基 <code>git rebase --continue</code> 。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git rebase --continue</span><br><span class="line">Successfully rebased and updated refs/heads/master.</span><br><span class="line">yukiyama@yukiyama hello-git % git log --oneline --decorate --graph --all</span><br><span class="line">* e2f517c (HEAD -&gt; master, testing) testing modified 1</span><br><span class="line">* 4a3e876 testing 1</span><br><span class="line">...(略)...</span><br></pre></td></tr></table></figure>
<p>也可以直接执行 <code>git rebase &lt;basebranch&gt; &lt;topicbranch&gt;</code> 将 topicbranch 分叉后的修改在 basebranch 上重放，省去了 <code>git checkout</code> 切换到 basebranch 的操作。</p>
<p><strong>变基的原则</strong>：只对尚未推送的本地修改执行变基，而不对本地仓库外有副本的分支执行变基。</p>
<br />
<h2 id="远程操作">远程操作</h2>
<p>本地仓库与远程仓库之间建立关联的方式如下。</p>
<ul>
<li>方式一(本地到远程)：先建立本地仓库，然后将本地仓库推送到远程仓库。</li>
<li>方式二(远程到本地)：先建立远程仓库，然后在本地克隆远程仓库。</li>
</ul>
<br />
<h3 id="git-remote">git remote</h3>
<p>实现从本地到远程的方式一，首先要使用 <code>git remote add &lt;仓库别名&gt; &lt;url/ssh&gt;</code> 关联本地仓库与远程 github 仓库。根据通信协议的不同，分为 https 方式和 ssh 方式。</p>
<br />
<h4 id="https方式">https方式</h4>
<p>【1. 关联本地仓库与远程仓库】</p>
<p>执行如下命令完成关联，并检查关联结果。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama git-demo % git remote add origin https://github.com/iyukiyama/git-demo.git</span><br><span class="line">yukiyama@yukiyama git-demo % git remote</span><br><span class="line">origin</span><br><span class="line">yukiyama@yukiyama git-demo % git remote -v</span><br><span class="line">origin	https://github.com/iyukiyama/git-demo.git (fetch)</span><br><span class="line">origin	https://github.com/iyukiyama/git-demo.git (push)</span><br><span class="line">yukiyama@yukiyama git-demo %</span><br></pre></td></tr></table></figure>
<br />
<p>【2. 在 github 上创建远程仓库】</p>
<p>仓库名通常与本地仓库相同，但也可以不同。</p>
<br />
<p>【3. 推送】</p>
<p>关联后执行 <code>git push -u origin master</code> 推送本地仓库到远程仓库中。其中 <code>-u</code> 参数是 <code>--set-upstream</code> 的缩略，使得当前本地分支 <code>master</code>  与远程仓库分支 <code>master</code> 关联起来，后续再推送，就只需要执行 <code>git push</code> 即可。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama git-demo % git push -u origin master</span><br><span class="line">Username for &#x27;https://github.com&#x27;: iyukiyama</span><br><span class="line">Password for &#x27;https://iyukiyama@github.com&#x27;:</span><br><span class="line">remote: Support for password authentication was removed on August 13, 2021.</span><br><span class="line">remote: Please see https://docs.github.com/en/get-started/getting-started-with-git/about-remote-repositories#cloning-with-https-urls for information on currently recommended modes of authentication.</span><br><span class="line">fatal: Authentication failed for &#x27;https://github.com/iyukiyama/git-demo.git/&#x27;</span><br><span class="line">yukiyama@yukiyama git-demo %</span><br></pre></td></tr></table></figure>
<p>注意，根据如上提示，github 从 2021年8月13日起，https 方式的接入校验不再支持使用 <strong>普通密码</strong> 的方式，目前支持使用 <strong>Personal Access Token</strong> 来完成认证，即 <code>Password for 'https://...'</code> 处应当填写目标 github 账号的 Personal Access Token (PAT) ，设置方式在 <a target="_blank" rel="noopener" href="https://docs.github.com/cn/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token">这里</a> 查看。</p>
<p>填入正确的 PAT 后即可成功推送，如下。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama git-demo % git push -u origin master</span><br><span class="line">Username for &#x27;https://github.com&#x27;: iyukiyama</span><br><span class="line">Password for &#x27;https://iyukiyama@github.com&#x27;:</span><br><span class="line">Enumerating objects: 57, done.</span><br><span class="line">Counting objects: 100% (57/57), done.</span><br><span class="line">Delta compression using up to 8 threads</span><br><span class="line">Compressing objects: 100% (37/37), done.</span><br><span class="line">Writing objects: 100% (57/57), 5.02 KiB | 642.00 KiB/s, done.</span><br><span class="line">Total 57 (delta 5), reused 0 (delta 0), pack-reused 0</span><br><span class="line">remote: Resolving deltas: 100% (5/5), done.</span><br><span class="line">To https://github.com/iyukiyama/git-demo.git</span><br><span class="line"> * [new branch]      master -&gt; master</span><br><span class="line">branch &#x27;master&#x27; set up to track &#x27;origin/master&#x27;.</span><br><span class="line">yukiyama@yukiyama git-demo %</span><br></pre></td></tr></table></figure>
<p>注意，如果没有事先在 github 上创建目标关联远程仓库的话，推送将会失败，并显示失败原因是找不到指定的远程仓库。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama git-demo % git push -u origin master</span><br><span class="line">remote: Repository not found.</span><br><span class="line">fatal: repository &#x27;https://github.com/iyukiyama/git-demo.git/&#x27; not found</span><br><span class="line">yukiyama@yukiyama git-demo</span><br></pre></td></tr></table></figure>
<br />
<p>【4. 查看远程库信息】</p>
<p>执行 <code>git remote show origin</code> 查看远程库信息。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git remote show origin</span><br><span class="line">* remote origin</span><br><span class="line">  Fetch URL: https://github.com/iyukiyama/hello-git.git</span><br><span class="line">  Push  URL: https://github.com/iyukiyama/hello-git.git</span><br><span class="line">  HEAD branch: master</span><br><span class="line">  Remote branch:</span><br><span class="line">    master tracked</span><br><span class="line">  Local branch configured for &#x27;git pull&#x27;:</span><br><span class="line">    master merges with remote master</span><br><span class="line">  Local ref configured for &#x27;git push&#x27;:</span><br><span class="line">    master pushes to master (up to date)</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<br />
<h4 id="ssh方式">ssh方式</h4>
<p>https 方式每次推送都需要认证，可以采用 ssh 方式约定本地仓库与远程仓库的公私钥，即可自动认证。</p>
<p>通常情况下客户端环境只需要一对公私钥建立到 github 远程库的 ssh 通信。若希望在同一个客户端下与多个 github 账号下的仓库建立 ssh 通信，则由于 github 不同账号下的公钥必须不同，相应地，在本地创建公私钥对时，也需要创建多对。</p>
<p>如下演示如何创建两对不同的公私钥，并应用到对不同的 github 账号的 ssh 连接中。</p>
<p>【1. ssh-keygen 命令生成公私钥对】</p>
<p>执行 <code>ssh-keygen -t rsa -C &quot;yuki.com&quot;</code> 命令生成公私钥对。<code>-t</code> 选择加密算法， <code>-C</code> 添加备注，习惯上会填写一个邮箱地址，也可以填写其他字符串。</p>
<table>
<thead>
<tr>
<th>设置</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>Enter file in which to save the key ()</td>
<td>括号后是默认公私钥路径和名称<br />私钥默认名: id_rsa<br />公钥默认名: id_rsa.pub</td>
</tr>
<tr>
<td>Enter passphrase</td>
<td>加密串，即 ssh 通信时的口令，通常不使用，回车即可</td>
</tr>
</tbody>
</table>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama ~ % ssh-keygen -t rsa -C &quot;yuki.com&quot;</span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file in which to save the key (/Users/yukiyama/.ssh/id_rsa): /Users/yukiyama/.ssh/id_rsa_163</span><br><span class="line">Enter passphrase (empty for no passphrase):</span><br><span class="line">Enter same passphrase again:</span><br><span class="line">Your identification has been saved in /Users/yukiyama/.ssh/id_rsa_163</span><br><span class="line">Your public key has been saved in /Users/yukiyama/.ssh/id_rsa_163.pub</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:rS6a3ou3HauNl0w+1Y5v6oTzbVo7xu/PKaOVIQbMCoI yuki.com</span><br><span class="line">The key&#x27;s randomart image is:</span><br><span class="line">+---[RSA 3072]----+</span><br><span class="line">|                 |</span><br><span class="line">|  .     o        |</span><br><span class="line">| E . .   +       |</span><br><span class="line">|    . . ...      |</span><br><span class="line">|       .S .+ .   |</span><br><span class="line">|        .oo o o  |</span><br><span class="line">|       +=o.+.o   |</span><br><span class="line">|     +o=**.oO+ ..|</span><br><span class="line">|   .=o**=o=O=+=oo|</span><br><span class="line">+----[SHA256]-----+</span><br><span class="line">yukiyama@yukiyama ~ % </span><br></pre></td></tr></table></figure>
<p>接着执行 <code>ssh-keygen -t rsa -C &quot;yama.com&quot;</code> 生成另一对公私钥对，在 <code>~/.ssh</code> 下可以看到如下两对公私钥对。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">id_rsa_163</span><br><span class="line">id_rsa_163.pub</span><br><span class="line">id_rsa_outlook</span><br><span class="line">id_rsa_outlook.pub</span><br></pre></td></tr></table></figure>
<p>【2. 在 <code>.ssh</code> 下创建 <code>config</code> 文件】</p>
<p>创建如下 <code>config</code> 文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># github-163</span><br><span class="line">Host github.com.163</span><br><span class="line">HostName github.com</span><br><span class="line">PreferredAuthentications publickey</span><br><span class="line">IdentityFile ~/.ssh/id_rsa_163</span><br><span class="line"></span><br><span class="line"># github-outlook</span><br><span class="line">Host github.com.outlook</span><br><span class="line">HostName github.com</span><br><span class="line">PreferredAuthentications publickey</span><br><span class="line">IdentityFile ~/.ssh/id_rsa_outlook</span><br></pre></td></tr></table></figure>
<p>后面我们会看到，将指定的公私钥对与指定的账户的 github 相关联的关键时 <code>Host</code> ，它是服务器端的别名，在使用 <code>git@&lt;host&gt;</code> 方式执行 ssh 连接时，<code>&lt;host&gt;</code> 填入的即 <code>Host</code> 。</p>
<p><code>Host</code> 与 <code>IdentityFile</code> 决定了公私钥对与具体账户的对应 (该账户下用公钥与 <code>IdentifyFile</code> 中指定的一样) ，而实际上会连接 <code>Hostname</code> 。</p>
<p>【3. 将公钥添加对应的 github 账户中】</p>
<p>在 github 的 <code>setting &gt; SSH and GPG keys &gt; SSH keys</code> 中点击 <code>New SSH key</code> 添加。</p>
<p>使用 <code>ssh -T git@github.com.outlook</code> 命令测试 ssh 连接，出现如下提示即说明可通过 ssh 方式通信。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % ssh -T git@github.com.outlook</span><br><span class="line">Hi iyukiyama! You&#x27;ve successfully authenticated, but GitHub does not provide shell access.</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<p>【4. 关联本地仓库与远程仓库】</p>
<p>使用 <code>git remote add</code> 命令关联本地仓库与远程仓库。若当前存在 https 方式的关联，先执行 <code>git remote rm origin</code> 删除。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git remote add origin git@github.com.outlook:iyukiyama/hello-git.git</span><br><span class="line">yukiyama@yukiyama hello-git % git remote -v</span><br><span class="line">origin	git@github.com.outlook:iyukiyama/hello-git.git (fetch)</span><br><span class="line">origin	git@github.com.outlook:iyukiyama/hello-git.git (push)</span><br></pre></td></tr></table></figure>
<p>【5. 推送】</p>
<p>与 https 方式一样，推送前也要提前在 github 中创建好目标远程仓库，否则会报如下错 <code>ERROR: Repository not found.</code> 。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git push -u origin master</span><br><span class="line">ERROR: Repository not found.</span><br><span class="line">fatal: Could not read from remote repository.</span><br></pre></td></tr></table></figure>
<p>创建后再次推送成功，远程库中也出现了本地库推送的文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git push -u origin master</span><br><span class="line">Enumerating objects: 57, done.</span><br><span class="line">Counting objects: 100% (57/57), done.</span><br><span class="line">Delta compression using up to 8 threads</span><br><span class="line">Compressing objects: 100% (32/32), done.</span><br><span class="line">Writing objects: 100% (57/57), 5.02 KiB | 5.02 MiB/s, done.</span><br><span class="line">Total 57 (delta 5), reused 57 (delta 5), pack-reused 0</span><br><span class="line">remote: Resolving deltas: 100% (5/5), done.</span><br><span class="line">To github.com.outlook:iyukiyama/hello-git.git</span><br><span class="line"> * [new branch]      master -&gt; master</span><br><span class="line">branch &#x27;master&#x27; set up to track &#x27;origin/master&#x27;.</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<p>【6. 查看远程库信息】</p>
<p>执行 <code>git remote show origin</code> 查看远程库信息。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git remote show origin</span><br><span class="line">* remote origin</span><br><span class="line">  Fetch URL: git@github.com.outlook:iyukiyama/hello-git.git</span><br><span class="line">  Push  URL: git@github.com.outlook:iyukiyama/hello-git.git</span><br><span class="line">  HEAD branch: master</span><br><span class="line">  Remote branch:</span><br><span class="line">    master tracked</span><br><span class="line">  Local branch configured for &#x27;git pull&#x27;:</span><br><span class="line">    master merges with remote master</span><br><span class="line">  Local ref configured for &#x27;git push&#x27;:</span><br><span class="line">    master pushes to master (up to date)</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<br />
<h4 id="rename">rename</h4>
<p>可以通过 <code>git remote rename &lt;当前别名&gt; &lt;新别名&gt;</code> 来修改远程仓库地址别名。下面是一些修改后的操作，可以看到远程仓库地址别名已经变为 <code>main</code> ，原先的 <code>origin</code> 已不可用，且远程仓库分支也相应变为 <code>main/master</code> 。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git remote rename origin main</span><br><span class="line">Renaming remote references: 100% (1/1), done.</span><br><span class="line">yukiyama@yukiyama hello-git % git remote</span><br><span class="line">main</span><br><span class="line">yukiyama@yukiyama hello-git % git remote -v</span><br><span class="line">main	git@github.com.outlook:iyukiyama/hello-git.git (fetch)</span><br><span class="line">main	git@github.com.outlook:iyukiyama/hello-git.git (push)</span><br><span class="line">yukiyama@yukiyama hello-git % git branch -r</span><br><span class="line">  main/master</span><br><span class="line">yukiyama@yukiyama hello-git % git branch -a</span><br><span class="line">* master</span><br><span class="line">  remote</span><br><span class="line">  remotes/main/master</span><br><span class="line">yukiyama@yukiyama hello-git % git push</span><br><span class="line">Everything up-to-date</span><br><span class="line">yukiyama@yukiyama hello-git % git push main master</span><br><span class="line">Everything up-to-date</span><br><span class="line">yukiyama@yukiyama hello-git % git remote show origin</span><br><span class="line">fatal: &#x27;origin&#x27; does not appear to be a git repository</span><br><span class="line">fatal: Could not read from remote repository.</span><br><span class="line"></span><br><span class="line">Please make sure you have the correct access rights</span><br><span class="line">and the repository exists.</span><br><span class="line">yukiyama@yukiyama hello-git % git remote show main</span><br><span class="line">* remote main</span><br><span class="line">  Fetch URL: git@github.com.outlook:iyukiyama/hello-git.git</span><br><span class="line">  Push  URL: git@github.com.outlook:iyukiyama/hello-git.git</span><br><span class="line">  HEAD branch: master</span><br><span class="line">  Remote branch:</span><br><span class="line">    master tracked</span><br><span class="line">  Local branch configured for &#x27;git pull&#x27;:</span><br><span class="line">    master merges with remote master</span><br><span class="line">  Local ref configured for &#x27;git push&#x27;:</span><br><span class="line">    master pushes to master (up to date)</span><br><span class="line">yukiyama@yukiyama hello-git % git reflog main/master</span><br><span class="line">be33e38 (HEAD -&gt; master, main/master) refs/remotes/main/master@&#123;0&#125;: remote: renamed refs/remotes/origin/master to refs/remotes/main/master</span><br><span class="line">be33e38 (HEAD -&gt; master, main/master) refs/remotes/main/master@&#123;1&#125;: update by push</span><br><span class="line">ad50bf4 refs/remotes/main/master@&#123;2&#125;: fetch: fast-forward</span><br><span class="line">edf13a1 refs/remotes/main/master@&#123;3&#125;: fetch: fast-forward</span><br><span class="line">b0c4efa (remote) refs/remotes/main/master@&#123;4&#125;: update by push</span><br><span class="line">de2bb32 refs/remotes/main/master@&#123;5&#125;: fetch: fast-forward</span><br><span class="line">a343286 refs/remotes/main/master@&#123;6&#125;: update by push</span><br><span class="line">eeeea6f refs/remotes/main/master@&#123;7&#125;: pull: fast-forward</span><br><span class="line">2464feb refs/remotes/main/master@&#123;8&#125;: update by push</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<br />
<h4 id="remove">remove</h4>
<p>使用 <code>git remote remove &lt;远程仓库地址别名&gt;</code> 来解除本地仓库与远程仓库的关联。<code>remove</code> 也可以简写为 <code>rm</code> 。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git remote remove main</span><br><span class="line">yukiyama@yukiyama hello-git % git remote</span><br><span class="line">yukiyama@yukiyama hello-git % git branch -r</span><br><span class="line">yukiyama@yukiyama hello-git % git reflog main/master</span><br><span class="line">fatal: ambiguous argument &#x27;main/master&#x27;: unknown revision or path not in the working tree.</span><br><span class="line">Use &#x27;--&#x27; to separate paths from revisions, like this:</span><br><span class="line">&#x27;git &lt;command&gt; [&lt;revision&gt;...] -- [&lt;file&gt;...]&#x27;</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<br />
<h3 id="git-clone">git clone</h3>
<p>使用 <code>git clone</code> 命令将远程仓库克隆到当前本地目录下。可以看到该命令将远程仓库拉取到当前路径下 (即相当于下载了 hello-git) ，并且完成了 <code>git init</code> 管理已经下载到本地的 <code>hello-git</code> (有 <code>.git</code> 隐藏文件夹)，也完成了 <code>git remote add</code> 关联，并且远程仓库地址也已简写也已自动设置为 <code>origin</code> 。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama git % git clone https://github.com/iyukiyama/hello-git.git</span><br><span class="line">Cloning into &#x27;hello-git&#x27;...</span><br><span class="line">remote: Enumerating objects: 57, done.</span><br><span class="line">remote: Counting objects: 100% (57/57), done.</span><br><span class="line">remote: Compressing objects: 100% (32/32), done.</span><br><span class="line">remote: Total 57 (delta 5), reused 57 (delta 5), pack-reused 0</span><br><span class="line">Receiving objects: 100% (57/57), 5.02 KiB | 733.00 KiB/s, done.</span><br><span class="line">Resolving deltas: 100% (5/5), done.</span><br><span class="line">yukiyama@yukiyama git % cd hello-git</span><br><span class="line">yukiyama@yukiyama hello-git % ls -la</span><br><span class="line">total 24</span><br><span class="line">drwxr-xr-x@  5 yukiyama  staff   160 Sep 27 05:53 .</span><br><span class="line">drwxr-xr-x@ 10 yukiyama  staff   320 Sep 27 05:53 ..</span><br><span class="line">-rw-r--r--   1 yukiyama  staff  6148 Sep 27 05:53 .DS_Store</span><br><span class="line">drwxr-xr-x@ 12 yukiyama  staff   384 Sep 27 05:53 .git</span><br><span class="line">-rw-r--r--   1 yukiyama  staff    31 Sep 27 05:53 hello.txt</span><br><span class="line">yukiyama@yukiyama hello-git % git remote -v</span><br><span class="line">origin	https://github.com/iyukiyama/hello-git.git (fetch)</span><br><span class="line">origin	https://github.com/iyukiyama/hello-git.git (push)</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<br />
<h3 id="git-push">git push</h3>
<p>执行 <code>git push &lt;远程仓库地址&gt; &lt;本地分支名&gt;:&lt;远程分支名&gt;</code> 推送当前仓库到远程库。</p>
<ul>
<li>远程仓库地址在 <code>git remote add</code> 命令中已经设置了 <code>origin</code> 别名，因此可以填入 <code>origin</code> 。</li>
<li>当「本地分支名」与「远程分支名」相同时，本例中为 <code>master</code> ，可以写为 <code>git push origin master</code> 。</li>
<li>在第一次推送时，我们使用了 <code>-u</code> 参数指定了本地分支到指定远程分支的通道 (master -&gt; master) 。因此可以直接执行 <code>git push</code> ，效果等同如下。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push git@github.com.outlook:iyukiyama/hello-git.git master:master</span><br></pre></td></tr></table></figure>
<p>如果本地仓库当前分支比远程分支要落后，例如远程分支上的文件有更新，本地在尚未拉取合并该更新的情况下尝试推送本地的新提交，则会出现失败，如下。可以使用 <code>git pull</code> 先行拉取合并，或者执行 <code>git merger &lt;远程仓库地址&gt;/&lt;远程分支&gt;</code> 来将「本地的远程分支」合并到本地当前分支。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">To github.com.outlook:iyukiyama/hello-git.git</span><br><span class="line"> ! [rejected]        master -&gt; master (non-fast-forward)</span><br><span class="line">error: failed to push some refs to &#x27;github.com.outlook:iyukiyama/hello-git.git&#x27;</span><br><span class="line">hint: Updates were rejected because the tip of your current branch is behind</span><br><span class="line">hint: its remote counterpart. Integrate the remote changes (e.g.</span><br><span class="line">hint: &#x27;git pull ...&#x27;) before pushing again.</span><br><span class="line">hint: See the &#x27;Note about fast-forwards&#x27; in &#x27;git push --help&#x27; for details.</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<p>如果本地和远程分支是同一个版本，即无更新，则推送后显示 <code>Everything up-to-date</code> 。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git push</span><br><span class="line">Everything up-to-date</span><br></pre></td></tr></table></figure>
<p>若有更新，且正常推送，则显示如下。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git push</span><br><span class="line">Enumerating objects: 5, done.</span><br><span class="line">Counting objects: 100% (5/5), done.</span><br><span class="line">Delta compression using up to 8 threads</span><br><span class="line">Compressing objects: 100% (3/3), done.</span><br><span class="line">Writing objects: 100% (3/3), 312 bytes | 312.00 KiB/s, done.</span><br><span class="line">Total 3 (delta 0), reused 0 (delta 0), pack-reused 0</span><br><span class="line">To github.com.outlook:iyukiyama/hello-git.git</span><br><span class="line">   eeeea6f..a343286  master -&gt; master</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<br />
<h3 id="git-fetch">git fetch</h3>
<p>将远程库当前版本拉取到本地，但不合并 (<code>git merge</code>) 。若本地分支与远程分支版本相同，则无回显，若不同，则如下。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git fetch</span><br><span class="line">remote: Enumerating objects: 5, done.</span><br><span class="line">remote: Counting objects: 100% (5/5), done.</span><br><span class="line">remote: Compressing objects: 100% (3/3), done.</span><br><span class="line">remote: Total 3 (delta 1), reused 0 (delta 0), pack-reused 0</span><br><span class="line">Unpacking objects: 100% (3/3), 683 bytes | 170.00 KiB/s, done.</span><br><span class="line">From github.com.outlook:iyukiyama/hello-git</span><br><span class="line">   edf13a1..ad50bf4  master     -&gt; origin/master</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<p>可通过 <code>git log origin/master</code> 或 <code>git reflog origin/master</code> 查看本地的远程分支提交历史来确认确实拉取了远程分支当前版本。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git reflog origin/master</span><br><span class="line">ad50bf4 (origin/master) refs/remotes/origin/master@&#123;0&#125;: fetch: fast-forward</span><br><span class="line">edf13a1 (HEAD -&gt; master) refs/remotes/origin/master@&#123;1&#125;: fetch: fast-forward</span><br><span class="line">b0c4efa (remote) refs/remotes/origin/master@&#123;2&#125;: update by push</span><br><span class="line">de2bb32 refs/remotes/origin/master@&#123;3&#125;: fetch: fast-forward</span><br><span class="line">a343286 refs/remotes/origin/master@&#123;4&#125;: update by push</span><br><span class="line">eeeea6f refs/remotes/origin/master@&#123;5&#125;: pull: fast-forward</span><br><span class="line">2464feb refs/remotes/origin/master@&#123;6&#125;: update by push</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<p>可通过 <code>git branch -a</code> 查看本地和远程分支，或者通过 <code>git branch -r</code> 查看远程分支。</p>
<br />
<h3 id="git-merge-2">git merge</h3>
<p><code>git fetch</code> 之后要通过 <code>git merge</code> 将远程分支合并到本地分支，相当于 <code>git merge origin/master</code> 。从回显中还能看到这是一次「快进」 (Fast-forward) 合并。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git merge</span><br><span class="line">Updating b0c4efa..edf13a1</span><br><span class="line">Fast-forward</span><br><span class="line"> hello.txt | 1 +</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<br />
<h3 id="git-pull">git pull</h3>
<p>将远程库当前版本拉取到本地并合并 (<code>git merge</code>) 。格式如下。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull &lt;远程仓库别名&gt; &lt;远程分支名&gt;:&lt;本地分支名&gt;</span><br></pre></td></tr></table></figure>
<p>若远程分支名与本地分支名相同，可简写如下。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull &lt;远程仓库别名&gt; &lt;分支名&gt;</span><br></pre></td></tr></table></figure>
<p>若已经配置过 upstream ，可简写如下。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull</span><br></pre></td></tr></table></figure>
<p>若版本相同，则显示 <code>Already up to date.</code> 。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git pull</span><br><span class="line">Already up to date.</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<p>若有冲突，则显示如下。此时需要先解决冲突，接着 <code>git add</code>, <code>git commit</code> ，然后再 <code>git pull</code> 。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git pull</span><br><span class="line">error: Pulling is not possible because you have unmerged files.</span><br><span class="line">hint: Fix them up in the work tree, and then use &#x27;git add/rm &lt;file&gt;&#x27;</span><br><span class="line">hint: as appropriate to mark resolution and make a commit.</span><br><span class="line">fatal: Exiting because of an unresolved conflict.</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<p>若拉取后可正常合并，则显示如下。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">yukiyama@yukiyama hello-git % git pull</span><br><span class="line">remote: Enumerating objects: 5, done.</span><br><span class="line">remote: Counting objects: 100% (5/5), done.</span><br><span class="line">remote: Compressing objects: 100% (2/2), done.</span><br><span class="line">remote: Total 3 (delta 0), reused 0 (delta 0), pack-reused 0</span><br><span class="line">Unpacking objects: 100% (3/3), 686 bytes | 171.00 KiB/s, done.</span><br><span class="line">From github.com.outlook:iyukiyama/hello-git</span><br><span class="line">   2464feb..eeeea6f  master     -&gt; origin/master</span><br><span class="line">Updating 2464feb..eeeea6f</span><br><span class="line">Fast-forward</span><br><span class="line"> hello.txt | 1 +</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line">yukiyama@yukiyama hello-git %</span><br></pre></td></tr></table></figure>
<p>使用 <code>git fetch</code> 是更好的实践 (<a target="_blank" rel="noopener" href="https://www.oschina.net/translate/git-fetch-and-merge?print">参考</a>) 。</p>
<br />
<h2 id="IDEA-Git">IDEA Git</h2>
<p>在 idea 上使用 git。</p>
<h3 id="集成Git">集成Git</h3>
<h4 id="添加Git">添加Git</h4>
<p>在 IntellJ IDEA &gt; Preferences &gt; Version Control &gt; Git 中设置 git 执行文件路径 <code>Path to Git executable</code> 。例如 /usr/local/Cellar/git/2.37.3.bin/git 。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/git_in_action/idea-set-git.png" alt="idea-set-git"></p>
<br />
<h4 id="git-init-2">git init</h4>
<p>点击 VCS &gt; Create Git Repository ，选择项目根目录，即可将项目根目录作为本地 git 仓库 (即 idea 在该目录下创建了 <code>.git</code> 文件夹)。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/git_in_action/idea-git-init.png" alt="idea-git-init"></p>
<br />
<h4 id="gitignore">.gitignore</h4>
<p>在项目根目录下创建 <code>.gitignore</code> 文件，设置忽略文件和忽略文件夹。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/git_in_action/idea-gitignore.png" alt="idea-gitignore"></p>
<p>可以手动编辑该文件，也可以选中希望忽略的文件或文件夹，右键选择 Git &gt; Add to .gitignore &gt; .gitignore ，则选中的文件或文件夹会自动配置到 <code>.gitignore</code> 文件中。</p>
<br />
<h4 id="git-add-2">git add</h4>
<p>选中希望加入到暂存区的文件或文件夹 (如项目根文件夹)，右键 Git &gt; Add ，即可将已追踪的已修改状态的文件加入到暂存区中。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/git_in_action/idea-git-add.png" alt="idea-git-add"></p>
<br />
<h4 id="git-commit-2">git commit</h4>
<p>选中要提交的文件或文件夹 (如项目根文件夹)，右键 Git &gt; Commit Directory ，即可提交暂存区中对应的文件 (见上一张图，Add 的上一条菜单即为 Commit Directory) 。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/git_in_action/idea-git-commit.png" alt="idea-git-commit"></p>
<br />
<h4 id="git-reset-soft-2">git reset --soft</h4>
<p>左下角 <code>Git</code> 栏目中的 <code>Log</code> 页签下，选择需要切换的版本，右键 <code>Checkout Revision &lt;commit id&gt;</code> 即可移动 <code>HEAD</code> 指针到该提交版本，等同于命令行 <code>git reset --soft</code> 。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/git_in_action/idea-git-reset-soft.png" alt="idea-git-reset-soft"></p>
<br />
<h4 id="git-branch-2">git branch</h4>
<p>右键 Git &gt; Branches 或者点击页面右下角当前分支栏目，例如 <code>master</code> ，可以看到一些分支操作的选项。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/git_in_action/idea-git-branch.png" alt="idea-git-branch"></p>
<br />
<h4 id="git-switch-2">git switch</h4>
<p>通过 New Branch 创建新分支后，上述弹窗界面会多出该分支的菜单选项。例如创建一个 <code>hotfix</code> 分支，进行若改修并提交后，选择 master &gt; checkout 切回 <code>master</code> 分支。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/git_in_action/idea-git-switch.png" alt="idea-git-switch"></p>
<br />
<h4 id="git-merge-3">git merge</h4>
<p>再次打开 Branches 界面，选择 hotfix &gt; Merge “hotfix” into “master” 完成合并。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/git_in_action/idea-git-merge.png" alt="idea-git-merge"></p>
<p>可以看到完成合并后 <code>HEAD</code>, <code>master</code>, <code>hotfix</code> 指针都指向当前最新版本。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/git_in_action/idea-after-merge.png" alt="idea-after-merge"></p>
<p>若出现冲突，则弹出「Conflicts」界面，点击「Merge…」解决冲突。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/git_in_action/idea-merge-conflicts.png" alt="idea-merge-conflicts"></p>
<p>在如下冲突解决界面中解决冲突。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/git_in_action/idea-conflicts-detail.png" alt="idea-conflicts-detail"></p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/git_in_action/idea-solve-conflicts.png" alt="idea-solve-conflicts"></p>
<p>解决冲突后。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/git_in_action/idea-solved-conflicts.png" alt="idea-solved-conflicts"></p>
<br />
<h3 id="集成Github">集成Github</h3>
<h4 id="添加github账号">添加github账号</h4>
<p>在 IntellJ IDEA &gt; Preferences &gt; Version Control &gt; Github 中添加 Github 账号。「Log in via GitHub… 」方式是通过账号密码方式登陆，「Log in with Token…」 是通过 Token 方式登陆。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/git_in_action/idea-add-github.png" alt="idea-add-github"></p>
<p>若选择通过账号密码方式登陆，则弹出认证界面，点击「Authorize in GitHub」 在 GitHub 关联第三方的界面中完成认证即可。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/git_in_action/idea-login-github-acc-pw.png" alt="idea-login-github-acc-pw"></p>
<p>若选择 Token 方式，则需要填写已经在 Github 账户中生成过的 Token 。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/git_in_action/idea-login-github-token.png" alt="idea-login-github-token"></p>
<p>完成登陆后。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/git_in_action/idea-logined-github.png" alt="idea-logined-github"></p>
<br />
<h4 id="首次推送">首次推送</h4>
<p>在登陆 Github 的状态下，一级菜单栏中的 VCS 变为了 Git ，点击 Git &gt; Github &gt; Share Project on GitHub 将所选项目关联并推送到远程 Github 仓库。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/git_in_action/idea-share-to-github.png" alt="idea-share-to-github"></p>
<p>设置仓库名称，远程仓库别名，仓库描述，以及选择是否设置为私有仓库 (Private) 后，点击「Share」完成推送。</p>
<p>需要注意的是，使用命令行完成本地仓库和远程仓库的关联操作时，必须先在 Github 个人页面中创建好远程仓库，否则推送失败。但是在 idea 中首次推送时，远程仓库可不必提前创建，若无远程仓库，则 idea 会帮我们创建和关联远程仓库，并完成首次推送。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/git_in_action/idea-share-to-github-init.png" alt="idea-share-to-github-init"></p>
<br />
<h4 id="git-push-2">git push</h4>
<p>通过 Git &gt; Push 菜单推送当前版本到远程仓库。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/git_in_action/idea-git-push.png" alt="idea-git-push"></p>
<p>在 「Push Commits to xxx」 界面中确认推送的本地分支和远程分支以及推送内容，点击「Push」完成推送。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/git_in_action/idea-git-push-confirm.png" alt="idea-git-push-confirm"></p>
<br />
<h4 id="git-fetch-2">git fetch</h4>
<p>通过 Git &gt; Push 菜单抓取 (fetch) 远程仓库到本地 (但不合并)。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/git_in_action/idea-git-fetch-finished.png" alt="idea-git-fetch"></p>
<br />
<h4 id="git-merge-4">git merge</h4>
<p>Fetch 之后通过 Git &gt; Merge 菜单完成合并。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/git_in_action/idea-git-merge2.png" alt="idea-git-merge2"></p>
<br />
<h4 id="git-pull-2">git pull</h4>
<p>通过 Git &gt; Pull 菜单拉取 (pull) 远程仓库到本地 (并完成合并) 。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/git_in_action/idea-git-pull.png" alt="idea-git-pull"></p>
<p>若有冲突，则需像之前介绍的那样，先解决冲突。</p>
<br />
<h4 id="git-clone-2">git clone</h4>
<p>通过 File &gt; New &gt; Project from Version Control… 或者在打开 idea 时选择 「Get from VCS」 来克隆远程仓库到本地。</p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/git_in_action/idea-project-from-vcs.png" alt="idea-project-from-vcs"></p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/git_in_action/idea-get-from-vcs.png" alt="idea-get-from-vcs"></p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/git_in_action/idea-get-from-vcs-select.png" alt="idea-get-from-vcs-select"></p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/git_in_action/idea-clone-finished.png" alt="idea-clone-finished"></p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/git_in_action/git-cloned-project.png" alt="git-cloned-project"></p>
<br />
</div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/hexo-iyukiyama/site_img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">yukiyama</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">29</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">48</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/iyukiyama"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/iyukiyama" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://www.zhihu.com/people/yukiyamama" target="_blank" title="zhihu"><i class="fab fa-zhihu"></i></a><a class="social-icon" href="mailto:iyukiyama@outlook.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/intellj-idea/" title="IntellJ Idea使用指南"><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/hexo-iyukiyama/site_img/takaoyama-landscape.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="IntellJ Idea使用指南"/></a><div class="content"><a class="title" href="/intellj-idea/" title="IntellJ Idea使用指南">IntellJ Idea使用指南</a><time datetime="2022-11-18T10:00:33.820Z" title="发表于 2022-11-18 18:00:33">2022-11-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/lombok-in-action/" title="Lombok学习实战"><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/hexo-iyukiyama/site_img/posts/lombok-bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Lombok学习实战"/></a><div class="content"><a class="title" href="/lombok-in-action/" title="Lombok学习实战">Lombok学习实战</a><time datetime="2022-11-17T14:23:56.080Z" title="发表于 2022-11-17 22:23:56">2022-11-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/docsify-in-action/" title="docsify使用指南"><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/hexo-iyukiyama/site_img/posts/docsify-bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="docsify使用指南"/></a><div class="content"><a class="title" href="/docsify-in-action/" title="docsify使用指南">docsify使用指南</a><time datetime="2022-11-16T14:09:13.490Z" title="发表于 2022-11-16 22:09:13">2022-11-16</time></div></div></div></div><div class="card-widget" id="card-newest-comments"><div class="item-headline"><i class="fas fa-comment-dots"></i><span>最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Database/"><span class="card-category-list-name">Database</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Java/"><span class="card-category-list-name">Java</span><span class="card-category-list-count">3</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Spring%E7%B3%BB%E5%88%97/"><span class="card-category-list-name">Spring系列</span><span class="card-category-list-count">3</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/%E5%B7%A5%E5%85%B7/"><span class="card-category-list-name">工具</span><span class="card-category-list-count">4</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"><span class="card-category-list-name">算法与数据结构</span><span class="card-category-list-count">17</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"><span class="card-category-list-name">设计模式</span><span class="card-category-list-count">1</span></a></li>
            </ul></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/11/"><span class="card-archive-list-date">十一月 2022</span><span class="card-archive-list-count">4</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/10/"><span class="card-archive-list-date">十月 2022</span><span class="card-archive-list-count">2</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/09/"><span class="card-archive-list-date">九月 2022</span><span class="card-archive-list-count">3</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/08/"><span class="card-archive-list-date">八月 2022</span><span class="card-archive-list-count">7</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/07/"><span class="card-archive-list-date">七月 2022</span><span class="card-archive-list-count">2</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/06/"><span class="card-archive-list-date">六月 2022</span><span class="card-archive-list-count">6</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/05/"><span class="card-archive-list-date">五月 2022</span><span class="card-archive-list-count">4</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/02/"><span class="card-archive-list-date">二月 2022</span><span class="card-archive-list-count">1</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">29</div></div><div class="webinfo-item"><div class="item-name">已运行时间 :</div><div class="item-count" id="runtimeshow" data-publishDate="2022-11-10T16:00:00.000Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总字数 :</div><div class="item-count">387.8k</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2022-11-18T11:24:46.403Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 By yukiyama</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://iyukiyama.github.io/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo4hexo.vercel.app/',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo4hexo.vercel.app/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://twikoo4hexo.vercel.app/',
        region: '',
        pageSize: 2,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.innerHTML= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>