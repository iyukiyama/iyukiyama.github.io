<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Spring5框架学习实战 | yukiyama</title><meta name="author" content="yukiyama,iyukiyama@outlook.com"><meta name="copyright" content="yukiyama"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Spring 是一个开源的 Java EE 开发框架。Spring 框架的 IoC 模块实现松耦合，AOP 模块支持面向切面的编程，这两大利器使得 Java EE 应用程序的开发更加简便快捷，并使 Java EE 平台上的 Web 应用程序具有更好的扩展性。">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring5框架学习实战">
<meta property="og:url" content="https://iyukiyama.github.io/spring5-framework-in-action/index.html">
<meta property="og:site_name" content="yukiyama">
<meta property="og:description" content="Spring 是一个开源的 Java EE 开发框架。Spring 框架的 IoC 模块实现松耦合，AOP 模块支持面向切面的编程，这两大利器使得 Java EE 应用程序的开发更加简便快捷，并使 Java EE 平台上的 Web 应用程序具有更好的扩展性。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/iyukiyama/pics/master/hexo-iyukiyama/site_img/posts/spring-framwork-bg.png">
<meta property="article:published_time" content="2022-10-07T04:54:34.999Z">
<meta property="article:modified_time" content="2022-11-13T05:38:03.230Z">
<meta property="article:author" content="yukiyama">
<meta property="article:tag" content="Spring全家桶">
<meta property="article:tag" content="Spring5">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/iyukiyama/pics/master/hexo-iyukiyama/site_img/posts/spring-framwork-bg.png"><link rel="shortcut icon" href="https://raw.githubusercontent.com/iyukiyama/pics/f64481f5339a9a86561027eda41a81aaf1c3a92b/hexo-iyukiyama/site_img/favicon.svg"><link rel="canonical" href="https://iyukiyama.github.io/spring5-framework-in-action/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="8txPepZr-K8-G42klmRZPinO36bw-JYKtqBKyT6YLow"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":500},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: yukiyama","link":"链接: ","source":"来源: yukiyama","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Spring5框架学习实战',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-13 13:38:03'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/hexo-iyukiyama/site_img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">29</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">48</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-chart-simple"></i><span> 算法</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/binary-search/"><span> 二分查找</span></a></li><li><a class="site-page child" href="/sorting/"><span> 十大排序</span></a></li><li><a class="site-page child" href="/union-find/"><span> 并查集</span></a></li><li><a class="site-page child" href="/graph/"><span> 图论算法</span></a></li><li><a class="site-page child" href="/binary-search-tree/"><span> 二叉查找树</span></a></li><li><a class="site-page child" href="/avl-tree/"><span> AVL树</span></a></li><li><a class="site-page child" href="/splay-tree/"><span> splay树</span></a></li><li><a class="site-page child" href="/binary-indexed-tree/"><span> 树状数组</span></a></li><li><a class="site-page child" href="/segment-tree/"><span> 线段树</span></a></li><li><a class="site-page child" href="/red-black-tree/"><span> 红黑树</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-diagram-project"></i><span> 图论证明</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/dijkstra-proof/"><span> Dijkstra</span></a></li><li><a class="site-page child" href="/prim-proof/"><span> Prim</span></a></li><li><a class="site-page child" href="/bellman-ford-spfa-proof/"><span> Bellman-Ford &amp; SPFA</span></a></li><li><a class="site-page child" href="/floyd-warshall-proof/"><span> Floyd-Warshall</span></a></li><li><a class="site-page child" href="/max-flow-min-cut-proof/"><span> 最大流最小割定理</span></a></li><li><a class="site-page child" href="/edmonds-karp-complexity-proof/"><span> Edmonds-Karp</span></a></li><li><a class="site-page child" href="/dinic-complexity-proof/"><span> Dinic</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="https://iyukiyama.github.io/docsify-leetcode/"><i class="fa-fw fas fa-code"></i><span> LeetCode</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-mug-saucer"></i><span> Java</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/jdbc-in-action/"><span> JDBC</span></a></li><li><a class="site-page child" href="/javaweb-in-action/"><span> Java Web</span></a></li><li><a class="site-page child" href="/spring5-framework-in-action/"><span> Spring Framework</span></a></li><li><a class="site-page child" href="/springmvc-in-action/"><span> SpringMVC</span></a></li><li><a class="site-page child" href="/springboot-in-action/"><span> SpringBoot</span></a></li><li><a class="site-page child" href="/lombok-in-action/"><span> Lombok</span></a></li><li><a class="site-page child" href="/concurrency-in-action/"><span> Concurrency</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://iyukiyama.gitbook.io/design-pattern/"><i class="fa-fw fas fa-palette"></i><span> 设计模式</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-database"></i><span> Database</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/mysql-in-action/"><span> MySQL</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-screwdriver-wrench"></i><span> Tools</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/git-in-action/"><span> Git</span></a></li><li><a class="site-page child" href="/maven-in-action/"><span> Maven</span></a></li><li><a class="site-page child" href="/docsify-in-action/"><span> docsify</span></a></li><li><a class="site-page child" href="/intellij-idea/"><span> IntelliJ Idea</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-circle-info"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://raw.githubusercontent.com/iyukiyama/pics/master/hexo-iyukiyama/site_img/posts/spring-framwork-bg.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">yukiyama</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-chart-simple"></i><span> 算法</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/binary-search/"><span> 二分查找</span></a></li><li><a class="site-page child" href="/sorting/"><span> 十大排序</span></a></li><li><a class="site-page child" href="/union-find/"><span> 并查集</span></a></li><li><a class="site-page child" href="/graph/"><span> 图论算法</span></a></li><li><a class="site-page child" href="/binary-search-tree/"><span> 二叉查找树</span></a></li><li><a class="site-page child" href="/avl-tree/"><span> AVL树</span></a></li><li><a class="site-page child" href="/splay-tree/"><span> splay树</span></a></li><li><a class="site-page child" href="/binary-indexed-tree/"><span> 树状数组</span></a></li><li><a class="site-page child" href="/segment-tree/"><span> 线段树</span></a></li><li><a class="site-page child" href="/red-black-tree/"><span> 红黑树</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-diagram-project"></i><span> 图论证明</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/dijkstra-proof/"><span> Dijkstra</span></a></li><li><a class="site-page child" href="/prim-proof/"><span> Prim</span></a></li><li><a class="site-page child" href="/bellman-ford-spfa-proof/"><span> Bellman-Ford &amp; SPFA</span></a></li><li><a class="site-page child" href="/floyd-warshall-proof/"><span> Floyd-Warshall</span></a></li><li><a class="site-page child" href="/max-flow-min-cut-proof/"><span> 最大流最小割定理</span></a></li><li><a class="site-page child" href="/edmonds-karp-complexity-proof/"><span> Edmonds-Karp</span></a></li><li><a class="site-page child" href="/dinic-complexity-proof/"><span> Dinic</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="https://iyukiyama.github.io/docsify-leetcode/"><i class="fa-fw fas fa-code"></i><span> LeetCode</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-mug-saucer"></i><span> Java</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/jdbc-in-action/"><span> JDBC</span></a></li><li><a class="site-page child" href="/javaweb-in-action/"><span> Java Web</span></a></li><li><a class="site-page child" href="/spring5-framework-in-action/"><span> Spring Framework</span></a></li><li><a class="site-page child" href="/springmvc-in-action/"><span> SpringMVC</span></a></li><li><a class="site-page child" href="/springboot-in-action/"><span> SpringBoot</span></a></li><li><a class="site-page child" href="/lombok-in-action/"><span> Lombok</span></a></li><li><a class="site-page child" href="/concurrency-in-action/"><span> Concurrency</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://iyukiyama.gitbook.io/design-pattern/"><i class="fa-fw fas fa-palette"></i><span> 设计模式</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-database"></i><span> Database</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/mysql-in-action/"><span> MySQL</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-screwdriver-wrench"></i><span> Tools</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/git-in-action/"><span> Git</span></a></li><li><a class="site-page child" href="/maven-in-action/"><span> Maven</span></a></li><li><a class="site-page child" href="/docsify-in-action/"><span> docsify</span></a></li><li><a class="site-page child" href="/intellij-idea/"><span> IntelliJ Idea</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-circle-info"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Spring5框架学习实战</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-10-07T04:54:34.999Z" title="发表于 2022-10-07 12:54:34">2022-10-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-11-13T05:38:03.230Z" title="更新于 2022-11-13 13:38:03">2022-11-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Spring%E7%B3%BB%E5%88%97/">Spring系列</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">15.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>68分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Spring5框架学习实战"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="Spring5框架学习实战">Spring5框架学习实战</h2>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Vf4y127N5?spm_id_from=333.999.0.0&amp;vd_source=c56ec421dded765a52ade50885eaab60">本文总结自尚硅谷视频</a>, <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_35843514/article/details/114287046?spm=1001.2014.3001.5501">参考1</a>, <a target="_blank" rel="noopener" href="https://repo.spring.io/ui/native/release/org/springframework/spring/">Spring 下载地址</a>, <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.x/reference/html/">Spring框架官方文档 (5.3.22)</a></p>
</blockquote>
<br />
<h3 id="框架概述">框架概述</h3>
<p><strong>Spring框架是什么？</strong></p>
<ul>
<li>
<p>Spring 是一个 <strong>开源的 Java EE 开发框架</strong> 。</p>
</li>
<li>
<p>Spring 框架的核心功能可以应用在任何 Java 应用程序中，尤其对 Java EE 平台上的 Web 应用程序有更好的扩展性。</p>
</li>
<li>
<p>Spring 框架的目标是使得 Java EE 应用程序的开发更加简便快捷，通过使用 POJO (Plain Old Java Object) 为基础的编程模型促进良好的编程风格。</p>
</li>
</ul>
<p><strong>Spring有哪些优点？</strong></p>
<ol>
<li>
<p><strong>方便解耦，简化开发</strong>。</p>
<ol>
<li>IoC 容器实现松耦合。对象之间的依赖关系交由 Spring 控制，避免了在一个对象代码中操作另一个对象所造成的耦合。</li>
<li>AOP 编程的支持。通过 Spring 提供的 AOP 功能，方便进行 <strong>面向切面</strong> 的编程，把应用的业务逻辑与系统的服务分离开来。</li>
</ol>
</li>
<li>
<p><strong>声明事务的支持</strong>。在 Spring 中，我们可以从单调烦闷的事务管理代码中解脱出来，通过声明式方式灵活地进行事务的管理，提高开发效率和质量。</p>
</li>
<li>
<p><strong>方便程序的测试</strong>。可以用非容器依赖的编程方式进行几乎所有的测试工作。Spring支持 Junit，可以通过注解方便的测试 Spring 程序。</p>
</li>
<li>
<p><strong>方便集成各种优秀框架</strong>。Spring 提供了对各种优秀框架（如Struts, Hibernate）等的直接支持。</p>
</li>
<li>
<p><strong>Java 源码是经典学习范例</strong>。Spring 的源码设计精妙、结构清晰、应用了许多 Java 设计模式，是对 Java 技术的极佳实践范例。</p>
</li>
<li>
<p><strong>异常处理</strong>。Spring 提供一个方便的 API 将特定技术的异常 (由 JDBC, Hibernate 等抛出) 转化为一致的 Unchecked 异常。</p>
</li>
</ol>
<p><strong>Spring 由哪些模块组成？(架构图)</strong></p>
<p><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/spring_framework_in_action/spring-overview.png" alt="spring-overview"></p>
<table>
<thead>
<tr>
<th>模块</th>
<th>细分</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>Data Access/Integration <br />数据访问/集成</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>JDBC</td>
<td>对JDBC的封装。</td>
</tr>
<tr>
<td></td>
<td>ORM</td>
<td>支持数据集成框架的封装（如 Mybatis，Hibernate）。</td>
</tr>
<tr>
<td></td>
<td>OXM</td>
<td>Object XML Mapper，支持在 Java 对象和 XML 文档间转换。</td>
</tr>
<tr>
<td></td>
<td>JMS</td>
<td>生产者和消费者的消息功能实现。</td>
</tr>
<tr>
<td></td>
<td>Transactions</td>
<td>事务管理。</td>
</tr>
<tr>
<td>Web</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>WebSocket</td>
<td>提供 Socket 通信，web 端的的推送功能。</td>
</tr>
<tr>
<td></td>
<td>Servlet</td>
<td>Spring MVC 框架实现。</td>
</tr>
<tr>
<td></td>
<td>Web</td>
<td>包含 web 应用开发用到 Spring 框架时所需的核心类，包括自动载入 WebApplicationContext 特性的类，Struts 集成类、文件上传的支持类、Filter 类和大量辅助工具类。</td>
</tr>
<tr>
<td></td>
<td>Portlet</td>
<td>实现 web 模块功能的聚合（如网站首页（Port）下面可能会有不同的子窗口（Portlet））。</td>
</tr>
<tr>
<td>AOP</td>
<td></td>
<td>面向切面功能模块。</td>
</tr>
<tr>
<td>Aspects</td>
<td></td>
<td>面向切面的一个重要的组成部分，提供对 AspectJ 框架的整合。</td>
</tr>
<tr>
<td>Instrumentation</td>
<td></td>
<td>检测器，检测JVM 及 Tomcat 。</td>
</tr>
<tr>
<td>Messaging</td>
<td></td>
<td>Spring 提供的消息处理功能。</td>
</tr>
<tr>
<td>Core Container<br />核心容器</td>
<td>Beans</td>
<td>负责Bean工厂中Bean的装配，所谓Bean工厂即是创建对象的工厂，Bean的装配也就是对象的创建工作。</td>
</tr>
<tr>
<td></td>
<td>Core</td>
<td>负责 IoC 基本实现。</td>
</tr>
<tr>
<td></td>
<td>Context</td>
<td>Spring 的 IoC 容器大量调用 Spring Core 中的函数。Bean 创建好对象后，由 Context 负责建立 Bean 与 Bean 之间的关系并维护，可以把 Context 看成是 Bean 关系的集合。</td>
</tr>
<tr>
<td></td>
<td>SpEl</td>
<td>Spring Expression Language（Spring 表达式语言）。</td>
</tr>
<tr>
<td>Test</td>
<td></td>
<td>在做单元测试时，Spring会帮我们初始化一些测试过程当中需要用到的资源对象</td>
</tr>
</tbody>
</table>
<blockquote>
<p>该表内容 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/zilongmao/p/10156310.html">来源</a> 。</p>
</blockquote>
<br />
<h3 id="本文测试例">本文测试例</h3>
<p>对于每一个知识点，本文均给出对应的测试例。</p>
<table>
<thead>
<tr>
<th>测试例</th>
<th>涉及的类</th>
<th>测试方法</th>
<th>xml</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>基于XML文件的Bean管理</strong></td>
<td>com.yukiyama.spring.xml</td>
<td>TestXML</td>
<td></td>
</tr>
<tr>
<td>注入bean (创建对象)</td>
<td>User</td>
<td>testInjectBean</td>
<td>injectBean.xml</td>
</tr>
<tr>
<td>bean的作用域</td>
<td>Book, Order</td>
<td>testScope</td>
<td>scope.xml</td>
</tr>
<tr>
<td>bean的生命周期</td>
<td>LifeCycle</td>
<td>testLifeCycle</td>
<td>lifeCycle.xml</td>
</tr>
<tr>
<td>通过setter注入字段</td>
<td>Book</td>
<td>testInjectFieldBySetter</td>
<td>injectFieldBySetter.xml</td>
</tr>
<tr>
<td>通过构造器注入字段</td>
<td>User</td>
<td>testInjectFieldByConstructor</td>
<td>injectFieldByConstructor.xml</td>
</tr>
<tr>
<td>p名称空间的使用</td>
<td>Book</td>
<td>testInjectFieldBySetterWithPNamespace</td>
<td>pNamespace.xml</td>
</tr>
<tr>
<td>注入空值和特殊符号</td>
<td>Book</td>
<td>testNullAndSpecialStringDI</td>
<td>nullAndSpecialString.xml</td>
</tr>
<tr>
<td>注入外部bean</td>
<td>UserService, UserDao, UserDaoImpl</td>
<td>testInjectOuterBean</td>
<td>injectOuterBean.xml</td>
</tr>
<tr>
<td>注入内部bean</td>
<td>UserService, UserDao, UserDaoImpl</td>
<td>testInjectInnerBean</td>
<td>injectInnerBean.xml</td>
</tr>
<tr>
<td>外部级联赋值</td>
<td>Order, Book</td>
<td>testCascadeOuter</td>
<td>cascadeOuter.xml</td>
</tr>
<tr>
<td>内部级联赋值</td>
<td>Order, Book</td>
<td>testCascadeInner</td>
<td>cascadeInner.xml</td>
</tr>
<tr>
<td>注入集合字段</td>
<td>Bucket</td>
<td>testInjectCollectionType</td>
<td>injectCollectionType.xml</td>
</tr>
<tr>
<td>提取集合元素</td>
<td>Bucket</td>
<td>testInjectCollectionTypeUsingUtilTag</td>
<td>injectCollectionTypeUsingUtilTag.xml</td>
</tr>
<tr>
<td>FactoryBean</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>自动装配</td>
<td>Book, Order</td>
<td>testAutowire</td>
<td>autowire.xml</td>
</tr>
<tr>
<td>外部配置文件</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>基于注解的bean管理</strong></td>
<td>com.yukiyama.spring.anno</td>
<td>TestAnno</td>
<td></td>
</tr>
<tr>
<td>注入bean</td>
<td>UserService</td>
<td>testAnnoInjectBean</td>
<td>anno.xml</td>
</tr>
<tr>
<td>注入引用类型字段</td>
<td>UserService, UserDao, UserDaoImpl</td>
<td>testAnnoInjectRefFiled</td>
<td>anno.xml</td>
</tr>
<tr>
<td>注入基本类型字段</td>
<td>UserService, UserDao, UserDaoImpl</td>
<td>testAnnoInjectValueFiled</td>
<td>anno.xml</td>
</tr>
<tr>
<td>完全注解开发</td>
<td>UserService, UserDao, UserDaoImpl</td>
<td>testCompleteAnno</td>
<td>无</td>
</tr>
</tbody>
</table>
<br />
<h3 id="IoC">IoC</h3>
<h4 id="IoC基本概念">IoC基本概念</h4>
<p><strong>什么是 IoC？</strong></p>
<p>IoC (Inversion of Control), <strong>控制反转 / 反转控制</strong>，一种程序设计思想，目的是为了降低程序的耦合度。</p>
<ul>
<li>控制 指的是对象的创建、字段注入、对象间的引用等。</li>
<li><strong>反转</strong> 指原本在对象内部直接控制 (例如通过 new 来创建对象) 其他对象，转变为将所有对象都交给 IoC 容器来控制。对于一个对象，IoC 容器负责查找和注入它所依赖的对象。</li>
</ul>
<p>在框架中，<code>org.springframework.beans</code> 和 <code>org.springframework.context</code> 两个包是 IoC 的基础。</p>
<p><strong>什么是 IoC 容器？</strong></p>
<p>IoC 容器即 <strong>对象工厂</strong> 。负责创建对象、通过 DI 管理对象、装配对象、配置对象、管理对象的生命周期。</p>
<p>IoC 容器有两种实现方式 (两个接口)：</p>
<ul>
<li><strong>BeanFactory 接口</strong>。IoC 容器的基本实现，加载配置文件时不会创建对象，在获取对象时才会创建对象。</li>
<li><strong>ApplicationContex 接口</strong>。BeanFactory 接口的子接口，是 <strong>BeanFactory 的超集</strong>，提供更多更强大的面向企业开发的功能。与 BeanFactory 不同的是，<strong>加载配置文件时即创建对象</strong>。</li>
</ul>
<p>下图是 IoC 容器示意图。</p>
<p><img src="https://docs.spring.io/spring-framework/docs/5.3.x/reference/html/images/container-magic.png" alt=""></p>
<p><strong>ApplicationContext 及其具体实现类？</strong></p>
<p><code>org.springframework.context.ApplicationContext</code> 接口 <strong>代表 Spring IoC 容器</strong>，负责实例化、配置和组装bean。容器通过读取 <strong>配置元数据</strong> 来获得关于要实例化、配置和组装哪些对象的指示。配置元数据以 XML、Java 注解或 Java 代码表示。它可以让你表达构成你的应用程序的对象以及这些对象之间丰富的相互依赖关系。</p>
<ul>
<li>FileSystemXmlApplicationContext ：此容器从一个 XML 文件中加载 beans 的配置，其有参构造器的参数为 XML  <strong>配置文件的全路径名</strong> (带盘符文件路径)。</li>
<li>ClassPathXmlApplicationContext：此容器从一个 XML 文件中加载 beans 的配置，该实现 <strong>在 classpath 里搜索XML 配置文件</strong>  (src文件夹中)。</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h5qfkb8vfej21w80r8dno.jpg" alt="image-20220901004924269"></p>
<p><strong>IoC 的实现原理？</strong></p>
<ul>
<li>XML 解析。</li>
<li>工厂模式。不是通过 new 来创建对象，而是通过工厂 (IoC 容器) 来获取对象。</li>
<li>反射。创建对象实例是通过反射实现的。</li>
</ul>
<p><strong>什么是 DI？</strong></p>
<p>DI (Dependency Injection)， <strong>依赖注入</strong> 。与 IoC 可看作对同一概念的两个不同角度的描述，IoC 是对「将对象交给 Spring 管理」这一概念的概括描述，DI 则指出管理的具体实现，即 IoC 容器根据配置信息来为一个对象注入它所依赖的内容。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.x/reference/html/core.html#spring-core">5.3.x官方文档</a>: “IoC is also known as dependency injection (DI).”</p>
</blockquote>
<br />
<h4 id="SpringBean">SpringBean</h4>
<p><strong>Bean 的定义</strong> : Spring 中的 Bean 是一个被 Spring IoC 容器 <strong>实例化、组装和管理</strong> 的对象。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.x/reference/html/core.html#spring-core">5.3.x官方文档定义</a></p>
<p>In Spring, the objects that form the backbone of your application and that are managed by the Spring IoC <em>container</em> are called <em>beans</em>. <strong>A bean is an object that is instantiated, assembled, and managed by a Spring IoC container</strong>. Otherwise, a bean is simply one of many objects in your application. Beans, and the dependencies among them, are reflected in the <em>configuration metadata</em> used by a container.</p>
<p>另外注意与 JavaBean 的区别。JavaBean 是可序列化，具有空参构造器和 getter 和 setter 方法的 Java 对象。</p>
</blockquote>
<p><strong>Bean 管理的定义</strong> : 可理解为 IoC 中的 「控制」，即负责 <strong>对象的创建</strong> 和 <strong>字段的注入</strong>。</p>
<p><strong>Bean 管理的方式</strong></p>
<ul>
<li>基于 XML 配置文件</li>
<li>基于注解</li>
</ul>
<p><strong>两种 Bean</strong></p>
<ul>
<li>普通 bean 。bean 标签中 class 属性指定的类。 <code>ApplicationContext</code> 的 <code>getBean</code> 方法获取的类型即为 bean 标签中指定的类型。</li>
<li>工厂 bean (FactoryBean) 。 <code>ApplicationContext</code> 的 <code>getBean</code> 方法获取的类型可以与 bean 标签中指定的类型不同。</li>
</ul>
<p><strong>Bean 的配置元数据</strong></p>
<br />
<h4 id="基于XML文件的Bean管理">基于XML文件的Bean管理</h4>
<h5 id="XML-配置文件的内容">XML 配置文件的内容</h5>
<ul>
<li>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/xml/xml-namespaces.html">命名空间</a>。</p>
</li>
<li>
<p><code>bean</code> 标签：描述 Java 对象。通过无参构造器创建对象。</p>
<ul>
<li>id 属性: 对象的标识。</li>
<li>class: 类全路径 (包类路径) 。</li>
<li>name 属性: 也是对象的标识，可以有特殊符号，不常用。</li>
</ul>
</li>
<li>
<p><code>property</code> 标签：描述对象的字段，为 Bean 标签的子标签。</p>
<ul>
<li>name 属性：字段名</li>
<li>value 属性：字段值</li>
<li>ref 属性: bean 标签的 id 值。</li>
</ul>
</li>
<li>
<p><code>constructor-arg</code> 标签：描述构造器，为 Bean 标签的子标签。</p>
<ul>
<li>name 属性：参数名</li>
<li>value 属性：参数值</li>
<li>index 属性: 参数的序号，可替代 name 的作用，但不清晰，故不常用。</li>
</ul>
</li>
</ul>
<p><strong>XML 文件的名称空间</strong></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/gonjan-blog/p/6637106.html">参考</a></p>
</blockquote>
<p>如下最基本的 Spring XML 配置文件中，xmlns / xmlns:xsi / xsi:schemaLocation 三项便是 <strong><a target="_blank" rel="noopener" href="https://www.runoob.com/xml/xml-namespaces.html">命名空间</a></strong>。命名空间的作用是<strong>自动为 XML 标签补全前缀，避免标签命名冲突</strong> 。类似 Java 中的包，不同的包下面可以存放相同的类名，只要在引入类时前面加上类的包就可以避免同名类的冲突。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<br />
<h5 id="注入bean">注入bean</h5>
<ol>
<li>在 idea 中创建 maven 工程 (quitckstart)</li>
<li>pom.xml 中添加必要依赖</li>
<li>工程中创建测试用的普通类</li>
<li>创建相关测试类</li>
<li>创建 xml 配置文件</li>
<li>在 src/main/ 下创建 resources 文件夹，将 xml 配置文件放入该文件夹下</li>
</ol>
<p>pom.xml 文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.yukiyama.spring<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring_demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>spring_demo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.apache.org<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/commons-logging/commons-logging --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-context --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>依赖关系</p>
<p>通过命令行工具，在该项目的 pom.xml 文件目录下执行 <code>mvn dependency:tree</code> 可看到如下依赖关系。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[INFO] --- maven-dependency-plugin:2.8:tree (default-cli) @ spring_demo ---</span><br><span class="line">[INFO] com.yukiyama.spring:spring_demo:jar:1.0-SNAPSHOT</span><br><span class="line">[INFO] +- junit:junit:jar:4.12:test</span><br><span class="line">[INFO] |  \- org.hamcrest:hamcrest-core:jar:1.3:test</span><br><span class="line">[INFO] +- commons-logging:commons-logging:jar:1.1.1:compile</span><br><span class="line">[INFO] \- org.springframework:spring-context:jar:5.2.6.RELEASE:compile</span><br><span class="line">[INFO]    +- org.springframework:spring-aop:jar:5.2.6.RELEASE:compile</span><br><span class="line">[INFO]    +- org.springframework:spring-beans:jar:5.2.6.RELEASE:compile</span><br><span class="line">[INFO]    +- org.springframework:spring-core:jar:5.2.6.RELEASE:compile</span><br><span class="line">[INFO]    |  \- org.springframework:spring-jcl:jar:5.2.6.RELEASE:compile</span><br><span class="line">[INFO]    \- org.springframework:spring-expression:jar:5.2.6.RELEASE:compile</span><br></pre></td></tr></table></figure>
<p>通过 idea 还可以看到重复的依赖已被自动忽略。</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1h6pyld0vygj30k00diabg.jpg" alt="image-20221001182238675"></p>
<p>普通类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.spring.xml.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 装配 bean (通过 xml 配置方式获取对象)</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInjectBean</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;【测试】装配 bean (通过 xml 配置方式获取对象)&quot;</span>);</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;getBean.xml&quot;</span>);</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;user&quot;</span>, User.class);</span><br><span class="line">    System.out.println(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置文件 <code>injectBean.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 测试：配置bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yukiyama.spring.xml.bean.User&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<br />
<h5 id="Bean的作用域">Bean的作用域</h5>
<p>所谓作用域 (scope) 即值 Bean 是 <strong>单实例</strong> 的还是 <strong>多实例</strong> 的。</p>
<ul>
<li>单实例 Bean 在 bean 标签中由 <code>scope=&quot;singleton&quot;</code> 属性确定 (默认值，可不写)，在 IoC 容器对象创建的时候 (BeanFactory / ApplicationContext) 就会创建 bean 实例。整个 IoC 容器中该 bean 只存在这一个实例。</li>
<li>多实例 Bean 在 bean 标签中由 <code>scope=&quot;prototype&quot;</code> 属性确定，在 IoC 容器对象创建的时候 (BeanFactory / ApplicationContext) 不会创建 bean 实例，而是在 IoC 容器获取该 bean 时 (如 <code>getBean()</code> 方法) 才创建实例。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 测试：bean 的作用域 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;book&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yukiyama.spring.xml.bean.Book&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;singleton&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;order&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yukiyama.spring.xml.bean.Order&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>除了 singleton 和 prototype 外，还有三种应用于 <code>WebApplicationContext</code> 的作用域。</p>
<table>
<thead>
<tr>
<th style="text-align:left">作用域</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">singleton</td>
<td style="text-align:left"><strong>默认作用域</strong>。在 Spring IoC 容器仅存在一个 Bean 实例，单例方式存在。</td>
</tr>
<tr>
<td style="text-align:left">prototype</td>
<td style="text-align:left">每次从容器中调用 Bean 时，都返回一个新的实例，即每次调用 getBean() 时，相当于执行 newXxxBean() 。</td>
</tr>
<tr>
<td style="text-align:left">request</td>
<td style="text-align:left">每次 HTTP 请求都会创建一个新的 Bean，该作用域仅适用于 WebApplicationContext 环境。</td>
</tr>
<tr>
<td style="text-align:left">session</td>
<td style="text-align:left">同一个 HTTP Session 共享一个 Bean，不同 Session 使用不同的 Bean ，仅适用于 WebApplicationContext 环境。</td>
</tr>
<tr>
<td style="text-align:left">global-session</td>
<td style="text-align:left">一般用于 Portlet 应用环境，该作用域仅适用于 WebApplicationContex t环境。</td>
</tr>
</tbody>
</table>
<br />
<h5 id="Bean的生命周期">Bean的生命周期</h5>
<p>从对象创建到销毁的过程。可在「调用初始化方法」前后加上「后置处理器」过程。</p>
<ol>
<li>创建 bean 实例。</li>
<li>为 bean 的字段设置值及引入其他 bean 。</li>
<li>执行 bean 后置处理器的 <code>postProcessBeforeInitialization</code> 方法。</li>
<li>执行 bean 的初始化方法  (需要在 xml 中配置初始化方法) 。</li>
<li>执行 bean 后置处理器的 <code>postProcessAfterInitialization</code> 方法。</li>
<li>使用 bean 。</li>
<li>关闭容器时，调用 bean 的销毁方法  (需要在 xml 中配置销毁方法) 。</li>
</ol>
<p>后置处理器的使用步骤。</p>
<ol>
<li>创建后置处理器类，实现  <code>BeanPostProcessor</code> 接口，重写 <code>postProcessBeforeInitialization</code> 和 <code>postProcessAfterInitialization</code> 方法。。</li>
<li>在 XML 文件中以 bean 标签添加后置处理器。XML 文件中的所有 bean 都会应用该后置处理器。</li>
</ol>
<p>如下代码演示 bean 的生命周期。</p>
<p>普通类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.spring.xml.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LifeCycle</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LifeCycle</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;step: non-args&#x27; constructor.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;step: initial method.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;LifeCycle&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;step: destroy method&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>后置处理器类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.spring.xml.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.BeanPostProcessor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;step: postProcessBeforeInitialization&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;step: postProcessAfterInitialization&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>xml 文件 <code>lifeCycle.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 测试：bean 的生命周期 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;lifeCycle&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yukiyama.spring.xml.bean.LifeCycle&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;destroy&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;lifeCycleBean&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 后置处理器 bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;postProcessor&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yukiyama.spring.xml.bean.PostProcessor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bean 的生命周期</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testLifeCycle</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;【测试】bean 的生命周期&quot;</span>);</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;lifeCycle.xml&quot;</span>);</span><br><span class="line">    <span class="type">LifeCycle</span> <span class="variable">lifeCycle</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;lifeCycle&quot;</span>, LifeCycle.class);</span><br><span class="line">    System.out.println(<span class="string">&quot;step: use bean&quot;</span>);</span><br><span class="line">    System.out.println(lifeCycle.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">【测试】bean 的生命周期</span><br><span class="line">step: non-args&#x27; constructor.</span><br><span class="line">step: postProcessBeforeInitialization</span><br><span class="line">step: initial method.</span><br><span class="line">step: postProcessAfterInitialization</span><br><span class="line">step: use bean</span><br><span class="line">LifeCycle&#123;name=&#x27;lifeCycleBean&#x27;&#125;</span><br></pre></td></tr></table></figure>
<br />
<h5 id="注入字段">注入字段</h5>
<p><strong>XML 文件的字段注入方式？</strong></p>
<ul>
<li>基于 <code>setter</code> 方法。
<ol>
<li>创建类，定义属性和对应的 <code>setter</code> 。</li>
<li>XML 文件中配置对象 (Bean 标签) 和要注入的字段 (Property 标签)。</li>
</ol>
</li>
<li>基于有参构造器。
<ol>
<li>创建类，定义属性和对应的有参构造器。</li>
<li>XML 文件中配置对象 (Bean 标签) 和相应的有参构造器参数 (constructor-arg 标签) ，即需要注入的字段。</li>
</ol>
</li>
</ul>
<p>使用基于有参构造器的方式时通常基于构造器的方式用于 <strong>强制依赖</strong> ，setter 方式用于 <strong>可选依赖</strong> 。</p>
<br />
<h6 id="基于setter">基于setter</h6>
<p>如下演示基于 setter 的 DI。</p>
<p>普通类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.spring.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Book</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String author;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAuthor</span><span class="params">(String author)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.author = author;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Book&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, author=&#x27;&quot;</span> + author + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInjectFieldBySetter</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;【测试】通过 setter 注入字段&quot;</span>);</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;injectFieldBySetter.xml&quot;</span>);</span><br><span class="line">    <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;book&quot;</span>, Book.class);</span><br><span class="line">    System.out.println(book.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>xml 配置文件 <code>injectFieldBySetter.xml</code>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 测试：通过setter注入字段 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;book&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yukiyama.spring.xml.bean.Book&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Hamlet&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;author&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Shakespeare&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<br />
<h6 id="基于构造器">基于构造器</h6>
<p>如下演示基于有参构造器的 DI。当一个类具有有参构造器时，参数对应的字段都需要在 xml 的 bean 标签下写出，即有多少个字段，就对应写出多少个 <code>&lt;constructor-arg&gt;</code> 标签内容，否则报错。因此说基于构造器的方式用于 <strong>强制依赖</strong> 。</p>
<p>普通类</p>
<p>在前述 <code>User</code> 类中加入有参构造器和 <code>toString()</code> 方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.spring.xml.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String userName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userName = userName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;userName=&#x27;&quot;</span> + userName + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过构造器注入字段</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInjectFieldByConstructor</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;【测试】通过构造器注入字段&quot;</span>);</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;injectFieldByConstructor.xml&quot;</span>);</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;user&quot;</span>, User.class);</span><br><span class="line">    System.out.println(user.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>xml 配置文件 <code>injectFieldByConstructor.xml</code>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 测试：通过构造器注入字段 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yukiyama.spring.xml.bean.User&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;userName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;USER#1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<br />
<h6 id="p名称空间">p名称空间</h6>
<p>使用p名称空间可简化 setter 方式的字段注入的写法。</p>
<ol>
<li>
<p>在 XML 文件中添加 p 名称空间配置。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>注入字段时，在 bean 标签中无需再以 property 子标签注入字段，可直接作为 bean 标签的属性注入字段。</p>
</li>
</ol>
<p>测试方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过 p 命名空间简化 setter 注入字段</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInjectFieldBySetterWithPNamespace</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;【测试】通过 p 命名空间简化 setter 注入字段&quot;</span>);</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;pNamespace.xml&quot;</span>);</span><br><span class="line">    <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;book&quot;</span>, Book.class);</span><br><span class="line">    System.out.println(book.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>xml 配置文件 <code>pNamespace.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 测试：p 名称空间简化 setter 注入字段写法 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;book&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yukiyama.spring.xml.bean.Book&quot;</span> <span class="attr">p:name</span>=<span class="string">&quot;Harry Potter&quot;</span> <span class="attr">p:author</span>=<span class="string">&quot;J. K. Rowling&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<br />
<h5 id="注入空值和特殊符号">注入空值和特殊符号</h5>
<ul>
<li>
<p>注入空值: <code>&lt;null/&gt;</code> 标签</p>
</li>
<li>
<p>注入特殊符号: <code>![CDATA[]]</code></p>
</li>
</ul>
<p>测试方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注入空值和特殊符号字段</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testNullAndSpecialStringDI</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;【测试】注入空值和特殊符号字段&quot;</span>);</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;nullAndSpecialString.xml&quot;</span>);</span><br><span class="line">    <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;book&quot;</span>, Book.class);</span><br><span class="line">    System.out.println(book.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>xml 配置文件: <code> nullAndSpecialString.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 测试：注入空值和特殊符号 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;book&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yukiyama.spring.xml.bean.Book&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">null</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;author&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>&lt;![CDATA[&lt;&lt;special string&gt;&gt;]]&gt;<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<br />
<h5 id="注入外部bean">注入外部bean</h5>
<p>指在 XML 配置文件中，对于一个 bean 对象，其字段是另一个 bean 对象的情况下，若两者并列写出，且前者 bean 标签内通过 <code>&lt;property name=&quot;&quot; ref=&quot;&quot;&gt;</code> 的方式注入，则为「注入外部bean」。</p>
<p>例子:</p>
<ol>
<li>
<p>创建类 UserService 、接口 UserDao 及其实现类 UserDaoImpl。</p>
</li>
<li>
<p>在 UserService 中调用 UserDao 实现类中的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.spring.xml.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yukiyama.spring.xml.dao.UserDao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserDao</span><span class="params">(UserDao userDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userDao = userDao;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> UserDao <span class="title function_">getUserDao</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userDao;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.spring.xml.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.spring.xml.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;This method: UserDaoImpl.update()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在 XML 配置文件中配置 <code>injectOuterBean.xml</code> 。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 测试：注入外部bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yukiyama.spring.xml.Service.UserService&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userDao&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yukiyama.spring.xml.dao.UserDaoImpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>测试方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注入外部bean</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInjectOuterBean</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;【测试】注入外部bean&quot;</span>);</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;injectOuterBean.xml&quot;</span>);</span><br><span class="line">    <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;userService&quot;</span>, UserService.class);</span><br><span class="line">    userService.getUserDao().update();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />
<h5 id="注入内部bean">注入内部bean</h5>
<p>与「注入外部bean」相对，在 property 中将 bean 标签作为子标签注入的方式为「注入内部bean」。</p>
<p>如下为 <code>injectInnerBean.xml</code> 。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 测试：注入内部bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yukiyama.spring.xml.Service.UserService&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userDao&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yukiyama.spring.xml.dao.UserDaoImpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注入内部bean</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInjectInnerBean</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;【测试】注入内部bean&quot;</span>);</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;injectInnerBean.xml&quot;</span>);</span><br><span class="line">    <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;userService&quot;</span>, UserService.class);</span><br><span class="line">    userService.getUserDao().update();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />
<h5 id="级联赋值">级联赋值</h5>
<p>在一个 bean 对象 A 中注入另一个 bean 对象 B 的属性并对该属性赋值。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.nhooo.com/note/qa3npp.html">参考</a></p>
</blockquote>
<br />
<h6 id="外部级联赋值">外部级联赋值</h6>
<p>在外部 bean <code>Book</code> 中注入字段 <code>name</code> 和 <code>author</code>  后，<code>Order</code> 再引用。</p>
<p>普通类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.spring.xml.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Book book;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBook</span><span class="params">(Book book)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.book = book;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Book <span class="title function_">getBook</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> book;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 级联赋值</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCascade</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;【测试】级联赋值&quot;</span>);</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;cascadeOuter.xml&quot;</span>);</span><br><span class="line">    <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;order&quot;</span>, Order.class);</span><br><span class="line">    System.out.println(order.getBook().toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>xml 配置文件 <code>cascadeOuter.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 测试：外部级联赋值 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;order&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yukiyama.spring.xml.bean.Order&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;book&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;book&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;book&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yukiyama.spring.xml.bean.Book&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Story of the stone&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;author&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Cao Xueqin&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<br />
<h6 id="内部级联赋值">内部级联赋值</h6>
<p>bean <code>Order</code> 直接赋值 bean <code>Book</code> 的属性 <code>name</code> 和 <code>author</code>。</p>
<p>xml 配置文件 <code>cascadeInner.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 测试：内部级联赋值 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;order&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yukiyama.spring.xml.bean.Order&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;book&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;book&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;book.name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Story of the stone&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;book.author&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Cao Xueqin&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;book&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yukiyama.spring.xml.bean.Book&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<br />
<h5 id="注入集合字段">注入集合字段</h5>
<ol>
<li>创建类，定义数组、list、map、set 类型字段，生成对应的 setter 方法。</li>
<li>在 XML 配置文件中配置。</li>
</ol>
<p>普通类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.spring.xml.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bucket</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String[] arr;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; list;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Book&gt; bookList;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Integer&gt; bookMap;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;String&gt; set;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setArr</span><span class="params">(String[] arr)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.arr = arr;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setList</span><span class="params">(List&lt;String&gt; list)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.list = list;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBookList</span><span class="params">(List&lt;Book&gt; bookList)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.bookList = bookList;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBookMap</span><span class="params">(Map&lt;String, Integer&gt; bookMap)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.bookMap = bookMap;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSet</span><span class="params">(Set&lt;String&gt; set)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.set = set;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Bucket&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;arr=&quot;</span> + Arrays.toString(arr) +</span><br><span class="line">                <span class="string">&quot;, list=&quot;</span> + list +</span><br><span class="line">                <span class="string">&quot;, bookList=&quot;</span> + bookList +</span><br><span class="line">                <span class="string">&quot;, bookMap=&quot;</span> + bookMap +</span><br><span class="line">                <span class="string">&quot;, set=&quot;</span> + set +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注入各种集合类型字段</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInjectCollectionType</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;【测试】注入各种集合类型字段&quot;</span>);</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;injectCollectionType.xml&quot;</span>);</span><br><span class="line">    <span class="type">Bucket</span> <span class="variable">bucket</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;bucket&quot;</span>, Bucket.class);</span><br><span class="line">    System.out.println(bucket.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>xml 配置文件 <code>injectCollectionType.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 测试注入各种集合字段 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bucket&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yukiyama.spring.xml.bean.Bucket&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- array 字段注入 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;arr&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>arr1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>arr2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- list 字段注入 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>listEle1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>listEle2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 泛型的引用类型的 list 字段注入 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;bookList&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;book1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;book2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- map 字段注入 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;bookMap&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;bookName#1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;bookName#2&quot;</span> <span class="attr">value</span>=<span class="string">&quot;456&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- set 字段注入 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;set&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>setEle1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>setEle2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;book1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yukiyama.spring.xml.bean.Book&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Story of the stone&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;author&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Cao Xueqin&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;book2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yukiyama.spring.xml.bean.Book&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Harry Potter&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;author&quot;</span> <span class="attr">value</span>=<span class="string">&quot;J. K. Rowling&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<br />
<h6 id="提取集合元素">提取集合元素</h6>
<ol>
<li>
<p>在 XML 配置文件中引入 util 名称空间。</p>
</li>
<li>
<p>在 XML 配置文件中配置。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:util</span>=<span class="string">&quot;http://www.springframework.org/schema/util&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/util</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/util/spring-util.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 测试提取集合元素 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">util:list</span> <span class="attr">id</span>=<span class="string">&quot;stringList&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>listEle1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>listEle2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">util:list</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 测试集合字段 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bucket&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yukiyama.spring.xml.bean.Bucket&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- list 字段注入，引用 util:list --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;list&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;stringList&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<br />
<h5 id="FactoryBean">FactoryBean</h5>
<p><code>FactoryBean</code> 即工厂 bean， 实现 <code>FactoryBean</code> 接口的类，通过 <code>ApplicationContext</code> 的 <code>getBean</code> 方法获取的类型可以与 bean 标签中指定的类型不同。</p>
<ol>
<li>创建类，令其实现 <code>FactoryBean</code> 接口，那么它就是一个工厂 bean。</li>
<li>实现接口的方法，在该方法中定义返回的具体的 bean 类型。</li>
<li>XML 配置文件完成配置。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.factorybean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yukiyama.collectiontype.Course;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.FactoryBean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBean</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;Course&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> FactoryBean.<span class="built_in">super</span>.isSingleton();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 定义返回 bean 类型</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Course <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Course</span> <span class="variable">course</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Course</span>();</span><br><span class="line">        course.setName(<span class="string">&quot;Spring5&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> course;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 演示 FactoryBean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yukiyama.factorybean.MyBean&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@org</span>.junit.Test</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFactoryBean</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;bean1.xml&quot;</span>);</span><br><span class="line">    <span class="type">Course</span> <span class="variable">course</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;myBean&quot;</span>, Course.class); <span class="comment">// 传入具体的返回类型</span></span><br><span class="line">    System.out.println(course);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />
<h5 id="自动装配">自动装配</h5>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/bear7/p/12531016.html">参考</a></p>
</blockquote>
<p>自动装配指对于 bean 类型的字段的注入不再通过配置文件中的 <code>&lt;property&gt;</code> 标签实现 (参考前面「注入外部Bean」、「注入内部Bean」内容)，而是在 <code>&lt;bean&gt;</code> 标签中通过 <code>autowire</code> 属性为当前 bean 装配字段 (也是 bean) 。Spring 根据指定的装配规则 (字段名称 <code>autowire = byName</code> 或字段类型 <code>autowire = byType</code>) 自动注入匹配的字段值。<code>autowire</code> 默认值为 <code>no</code> ，表示不使用自动装配。</p>
<ul>
<li><code>byName</code> : 根据当前 bean 中的字段名，在 xml 文件中寻找 <code>id</code> 与之对应的 bean，然后作为字段注入当前 bean 中。</li>
<li><code>byType</code> : 根据当前 bean 中的字段类型，在 xml 文件中寻找 <code>class</code> 与之对应的 bean，然后作为字段注入当前 bean 中。</li>
</ul>
<p>需要自动装配多个同类型字段时，应使用 <code>byName</code> ，若使用 <code>byType</code> ，则存在多个同类型 bean 将导致错误。</p>
<p>普通类</p>
<p>在 <code>Order</code> 类中设置两个 <code>Book</code> 类型字段。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.spring.xml.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Book book;</span><br><span class="line">    <span class="keyword">private</span> Book book1;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBook</span><span class="params">(Book book)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.book = book;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBook1</span><span class="params">(Book book)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.book1 = book;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Book <span class="title function_">getBook</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> book;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Order&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;book=&quot;</span> + book +</span><br><span class="line">                <span class="string">&quot;, book1=&quot;</span> + book1 +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自动装配</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAutowire</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;【测试】自动装配&quot;</span>);</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;autowire.xml&quot;</span>);</span><br><span class="line">    <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;order&quot;</span>, Order.class);</span><br><span class="line">    System.out.println(order);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>xml 配置文件 <code>autowire.xml</code> 。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">&lt;!-- 测试：自动装配 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;order&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yukiyama.spring.xml.bean.Order&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;byName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;book&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yukiyama.spring.xml.bean.Book&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;book1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yukiyama.spring.xml.bean.Book&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>若 <code>autowire=&quot;byType&quot;</code> 则报错。</p>
<br />
<h5 id="外部配置文件">外部配置文件</h5>
<p>对于 JDBC 连接等场景，需要注入的字段 (例如 <code>username</code>, <code>password</code> 等) 适合用配置文件维护，可以将这些字段的在 <code>&lt;property&gt;</code> 中的 <code>name</code> 和 <code>value</code> 作为键值对写到外部配置文件中。在 XML 中通过 <code>context</code> 名称空间引入配置文件来注入相应的字段。</p>
<p>例如，使用 <code>Druid</code> 连接池，直接在 XML 中配置字段注入的写法如下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/crash&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;xxxxxx&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>通过外部配置文件注入的方法步骤如下。</p>
<ol>
<li>在项目 pom.xml 文件中增加 <a target="_blank" rel="noopener" href="https://mvnrepository.com/artifact/com.alibaba/druid">druid</a> 依赖。</li>
<li>创建外部字段配置 <code>.properties</code> 文件，写入字段键值对 (字段名=字段值)。</li>
<li>在 XML 中添加 <code>context</code> 命名空间声明，并通过 <code>&lt;context:property-placeholder&gt;</code> 引入 <code>.properties</code> 文件。</li>
<li>在 XML 中通过引入的 <code>.properties</code> 文件注入字段。</li>
</ol>
<p>jdbc.properties 文件。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">prop.driver</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">prop.url</span>=<span class="string">jdbc:mysql://localhost:3306/crash</span></span><br><span class="line"><span class="attr">prop.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">prop.password</span>=<span class="string">xxxxxx</span></span><br></pre></td></tr></table></figure>
<p>xml 配置文件 <code>properties.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 测试：引入外部配置文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:jdbc.properties&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 外部字段配置文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;prop.driver&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;prop.url&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;prop.username&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;prop.password&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<br />
<h4 id="基于注解的Bean管理">基于注解的Bean管理</h4>
<p>使用注解能够简化 XML 配置。</p>
<br />
<h5 id="注入bean-2">注入bean</h5>
<p>Spring 针对 Bean 管理中的「对象创建」提供如下注解。Spring 实际上 <strong>并不区分不同注解名称</strong> ，也就是说在代码中用如下任意一个注解标注一个 Bean 都是可以的。但 Spring 提倡在不同层次中使用对应名称的注解，使逻辑更清晰。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Component: 一般 bean 注解</span><br><span class="line">@Service: 通常用于 Service 层</span><br><span class="line">@Controller: 通常用于 Web 层</span><br><span class="line">@Repository: 通常用于 DAO 层</span><br></pre></td></tr></table></figure>
<p>使用注解创建对象的过程。</p>
<ol>
<li>在 pom.xml 中引入 AOP 依赖 <code>spring-aop-5.2.6.RELEASE.jar</code> (已经通过 <code>org.springframework:spring-context:5.2.6.RELEASE</code> 完成了依赖传递)。</li>
<li>在 XML 文件中添加 <code>context</code> 命名空间，并开启组件扫描 (<code>context:component-scan</code> 标签)。</li>
<li>创建类 (bean) ，添加类注解 (前述四种之一)。</li>
</ol>
<p><code>anno.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 测试：注解方式注入 bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.yukiyama.spring.anno&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>普通类</p>
<p>在其上添加类注解 <code>@Service(value = &quot;userService&quot;)</code> 。括号及其内的参数为该 bean 名称，若不写出则默认为该类名 (首字母小写) 。<code>UserDao</code> 接口与 <code>UserDaoImpl</code> 的代码与「注入外部bean」一节中给出的相同。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.spring.anno.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yukiyama.spring.anno.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service(value = &quot;userService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">useDao</span><span class="params">()</span>&#123;</span><br><span class="line">        userDao.update();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注解方式注入 bean</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAnnoInjectBean</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;【测试】注解方式注入 bean&quot;</span>);</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;annoInjectBean.xml&quot;</span>);</span><br><span class="line">    <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;userService&quot;</span>, UserService.class);</span><br><span class="line">    System.out.println(userService);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />
<h6 id="组件扫描过滤器">组件扫描过滤器</h6>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/W_Z_W_888/article/details/80946783">参考</a></p>
</blockquote>
<p>在 XML 中的组件扫描标签中 (<code>&lt;context:component-scan&gt;</code>) ，通过过滤标签可设置只扫描某些注解，或不扫描哪些注解。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.yukiyama.spring.anno&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Service&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>
<br />
<h5 id="注入字段-2">注入字段</h5>
<p>注入字段主要使用如下注解。</p>
<ul>
<li>注入引用类型字段
<ul>
<li>@Autowired: 根据字段类型注入 (自动装配)</li>
<li>@Qualifier: 根据字段名称注入</li>
<li>@Resource: 支持根据类型或名称注入</li>
</ul>
</li>
<li>注入基本类型字段
<ul>
<li>@Value</li>
</ul>
</li>
</ul>
<ol>
<li>创建类，添加类注解 (以 <code>UserService</code> 和 <code>UserDaoImpl</code> 为例，为前者添加类注解 <code>@Service</code> ，为后者添加 <code>@Repository</code>)。</li>
<li>在 <code>UserService</code> 中添加 <code>UserDao</code> 类型字段，并使用上述 <strong>字段注解</strong> 。</li>
</ol>
<p>例一：使用 <code>@Autowired</code> 注解根据字段类型 <code>UserDao</code> (接口) ，寻找其实现类 <code>UserDaoImpl</code> 后注入。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.spring.anno.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yukiyama.spring.anno.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">useDao</span><span class="params">()</span>&#123;</span><br><span class="line">        userDao.update();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>例二：同时使用  <code>@Autowired</code> 和 <code>@Qulifier</code> ，并为后者添加 <code>value</code> 属性，实现根据名称注入。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.spring.anno.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yukiyama.spring.anno.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier(value = &quot;yukiyamaDao&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">useDao</span><span class="params">()</span>&#123;</span><br><span class="line">        userDao.update();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时的 <code>UserDaoImpl</code> 类注解 <code>@Repository</code> 后需要添加 <code>value</code> 属性 (只使用 <code>@Autowired</code> 注解时不需要该属性)。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.spring.anno.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository(value = &quot;yukiyamaDao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;This method: UserDaoImpl.update()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>例三：演示 <code>@Resource</code> 的使用。需要注意的是 <code>@Resource</code> 在 <code>javax.annotation.Resource;</code> 中，并不在 Spring 框架中，因此不被推荐使用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 只需要将 UserService 中的注解换成 @Resource 即可实现按类型注入。</span></span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如下实现按名称注入。</span></span><br><span class="line"><span class="meta">@Resource(name = &quot;yukiyamaDao&quot;)</span></span><br><span class="line"><span class="keyword">private</span> UserDao userDao;</span><br></pre></td></tr></table></figure>
<p>以上三例使用如下测试方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注解方式注入引用类型字段</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAnnoInjectRefFiled</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;【测试】注解方式注入引用类型字段&quot;</span>);</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;annoInjectBean.xml&quot;</span>);</span><br><span class="line">    <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;userService&quot;</span>, UserService.class);</span><br><span class="line">    userService.useDao();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>演示 <code>@Value</code> 的使用。在 <code>UserService</code> 中加入 <code>String</code> 类型的 <code>name</code> 字段及 <code>getName</code> 方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(value = &quot;yukiyamaUserService&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注解方式注入基本类型字段</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAnnoInjectValueFiled</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;【测试】注解方式注入引用类型字段&quot;</span>);</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;annoInjectBean.xml&quot;</span>);</span><br><span class="line">    <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;userService&quot;</span>, UserService.class);</span><br><span class="line">    System.out.println(userService.getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />
<h5 id="完全注解方式">完全注解方式</h5>
<p>前述基于注解的 Bean 管理中，XML 中只需要开启组件扫描即可，已经十分简化，但若将此功能用类文件而不是 XML 来实现，则可完全抛弃 XML 配置，此形式称为「完全注解开发」。</p>
<ol>
<li>创建替代 XML 文件的配置类，并添加 <code>@Configuration</code> 和 <code>@ComponentScan</code> 注解。</li>
<li>测试类需要相应修改 (使用 <code>AnnotationConfigApplicationContext</code>)。</li>
</ol>
<p>配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.spring.anno.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 标记该类为配置类</span></span><br><span class="line"><span class="meta">@Configuration</span> </span><br><span class="line"><span class="comment">// 相当于 xml 文件中的 &lt;context:component-scan base-package=&quot;com.yukiyama.spring.anno&quot;/&gt;</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;com.yukiyama.spring.anno&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 完全注解开发</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCompleteAnno</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;【测试】注解方式注入引用类型字段&quot;</span>);</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);</span><br><span class="line">    <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;userService&quot;</span>, UserService.class);</span><br><span class="line">    System.out.println(userService.getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />
<h3 id="AOP">AOP</h3>
<h4 id="AOP基本概念">AOP基本概念</h4>
<p>AOP (Aspect Oriented Programming)，面向切面编程 / 面向方面编程。利用 AOP 可以 <strong>解耦业务逻辑，提高程序重用性和开发效率</strong> 。</p>
<p>更通俗地说，可以在不修改原有代码的基础上为主干功能添加新功能。例如对于一个页面登录功能，若希望加入用户鉴权功能，无需在原有代码中加入判断逻辑，而是通过 AOP 的方式在不修改源代码的情况下添加该新功能。</p>
<p><strong>AOP 的实现原理</strong></p>
<p>动态代理。</p>
<ul>
<li>有接口，使用 JDK 动态代理。</li>
<li>无接口，使用 CGLIB 动态代理。</li>
</ul>
<br />
<h5 id="JDK-动态代理">JDK 动态代理</h5>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Dt41187wj?spm_id_from=333.337.search-card.all.click&amp;vd_source=c56ec421dded765a52ade50885eaab60">参考1</a>, <a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000011291179">参考2</a>, <a target="_blank" rel="noopener" href="https://www.liaoxuefeng.com/wiki/1252599548343744/1264804593397984#0">参考3</a></p>
</blockquote>
<p>动态代理与静态代理的区别主要为: 静态代理类要实现接口，编译完成后有一 <code>.class</code> 文件。动态代理类不实现接口，在运行时动态生成，编译后无 <code>.class</code> 文件，而是在 <strong>运行时动态生成类字节码并加载到 JVM 中</strong> 。</p>
<p>动态代理是 <strong>反射与代理模式</strong> 的应用，涉及到 <code>java.lang.reflect</code> 中若干类和方法， 其中最关键的方法为 <code>Proxy.newProxyInstance</code> 静态方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> Object <span class="title function_">newProxyInstance</span><span class="params">(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h)</span> </span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>方法参数和返回值</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ClassLoader loader</code></td>
<td>指定当前目标对象使用的类加载器</td>
</tr>
<tr>
<td><code>Class&lt;?&gt;[] interfaces</code></td>
<td>目标对象实现的接口的类型 (数组)</td>
</tr>
<tr>
<td><code>InvocationHandler h</code></td>
<td>事件处理器</td>
</tr>
<tr>
<td><code>Object</code></td>
<td>返回一个指定接口的代理类实例</td>
</tr>
</tbody>
</table>
<p>动态代理的实现步骤如下。</p>
<ol>
<li>创建主题类和代理类都要实现的 <strong>接口</strong> ，定义接口方法。</li>
<li>创建 <strong>接口实现类作为主题类</strong> ，重写方法。</li>
<li>创建实现 <code>InvocationHandler</code> 接口的实现类作为 <strong>代理类</strong>  (也可以用匿名类形式写出)。
<ol>
<li>内部通过有参构造器持有主题类对象。</li>
<li>重写 <code>invoke</code> 方法，在方法中完成 <strong>「前置增强」</strong> 与 <strong>「后置增强」</strong> (按需要) 。</li>
<li>可自定义一个 <code>getProxyInstance</code> 方法，内部调用 <code>Proxy.newProxyInstance</code> 静态方法，返回代理对象实例。</li>
</ol>
</li>
<li>完成代理。</li>
</ol>
<p>如下代码演示动态代理实现。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 代理类和主题类需要实现的接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span>;</span><br><span class="line">    String <span class="title function_">update</span><span class="params">(String id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 主题类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;执行主题类add方法，&quot;</span> + a + <span class="string">&quot;+&quot;</span> + b + <span class="string">&quot; = &quot;</span> + (a + b));</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">update</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;执行主题类update方法，更新为&quot;</span> + id);</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代理类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoProxy</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Object obj; <span class="comment">// 持有主题类对象</span></span><br><span class="line">    <span class="comment">// 通过有参构造器传入主题类对象</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserDaoProxy</span><span class="params">(Object obj)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.obj = obj;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 增强的逻辑</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">// 前置增强</span></span><br><span class="line">        System.out.println(<span class="string">&quot;前置增强 &quot;</span> + method.getName() + <span class="string">&quot; ，传递的参数: &quot;</span> + Arrays.toString(args));</span><br><span class="line">        <span class="comment">// 被增强的方法，指定代理对象及其参数</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">res</span> <span class="operator">=</span> method.invoke(obj, args);</span><br><span class="line">        <span class="comment">// 后置增强</span></span><br><span class="line">        System.out.println(<span class="string">&quot;后置增强&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 通过 Proxy.newProxyInstance 静态方法返回代理对象</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getProxyInstance</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Proxy.newProxyInstance(obj.getClass().getClassLoader(),</span><br><span class="line">                obj.getClass().getInterfaces(), <span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如下代码执行动态代理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 动态代理演示</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DynamicProxyDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 主题对象</span></span><br><span class="line">        <span class="type">UserDao</span> <span class="variable">userDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>();</span><br><span class="line">        <span class="comment">// 代理人对象</span></span><br><span class="line">        <span class="type">UserDaoProxy</span> <span class="variable">proxy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDaoProxy</span>(userDao);</span><br><span class="line">        <span class="comment">// 代理人对象代理后得到的代理对象</span></span><br><span class="line">        <span class="type">UserDao</span> <span class="variable">proxyDao</span> <span class="operator">=</span> (UserDao) proxy.getProxyInstance();</span><br><span class="line">        proxyDao.add(<span class="number">7</span>, <span class="number">8</span>);</span><br><span class="line">        proxyDao.update(<span class="string">&quot;yukiyama&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">前置增强 add ，传递的参数: [7, 8]</span><br><span class="line">执行主题类add方法，7+8 = 15</span><br><span class="line">后置增强</span><br><span class="line">前置增强 update ，传递的参数: [yukiyama]</span><br><span class="line">执行主题类update方法，更新为yukiyama</span><br><span class="line">后置增强</span><br></pre></td></tr></table></figure>
<br />
<h5 id="AOP术语">AOP术语</h5>
<p>AOP 中有许多重要的概念，对应了一些并不是很直观的术语。这些术语是通用的而非 Spring 所特有的。这些术语的官方释义如下 (来自 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop">Spring官方文档</a>) ，每一条概念的英文原文下是中文翻译和必要的注释。</p>
<blockquote>
<p>Aspect 切面, Join Point 连接点, Advice 通知/增强, Pointcut 切点, Introduction 引入, Target object 目标类, AOP Proxy AOP代理, Weaving 织入</p>
</blockquote>
<p>在不了解 AOP 实现细节的情况下，即便阅读如下较为详细的定义，也很难形成具象的理解，尽管如此，我们仍先列出这些概念的释义，在后续 AOP 实现中再反复体会理解。</p>
<table>
<thead>
<tr>
<th>AOP Concepts</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Aspect</strong>: A modularization of a concern that cuts across multiple classes. Transaction management is a good example of a crosscutting concern in enterprise Java applications. In Spring AOP, aspects are implemented by using regular classes (the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-schema">schema-based approach</a>) or regular classes annotated with the <code>@Aspect</code> annotation (the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-ataspectj">@AspectJ style</a>).</td>
</tr>
<tr>
<td><strong>切面</strong>: 横跨不同类的关注点的模块化。「事务管理」即是企业级 Java 应用中横跨 (类) 的关注点中的一个好例子。在 Spring AOP 中，切面由基于模式的方法或由 <code>@Aspect</code> 注解的普通类来实现。<br />※ 解释: concern 指的是代理类，代理类里的通知 (功能增强) 是业务所关注的 (concern) ，它可以作用到不同类 (的方法) 上，所以说「 …that cuts across multiple classes」。基于模式的方法指的是用 XML 配置文件实现 AOP 的方式。</td>
</tr>
<tr>
<td><strong>Join point</strong>: A point during the execution of a program, such as the execution of a method or the handling of an exception. In Spring AOP, a join point always represents a method execution.</td>
</tr>
<tr>
<td><strong>连接点</strong>: 程序执行过程中的点 (一个动作)，例如一个方法的执行或一个异常的处理。在 Spring AOP 中，一个连接点总是代表一个方法的执行。<br />※ 解释: 连接点即被代理的类的被增强的方法或执行该方法时产生的异常 (当使用 <code>@AfterThrowing</code> 通知时)，通知 (增强方法) 作用于该方法或执行该方法时产生的异常 (当使用 <code>@AfterThrowing</code> 通知时)。</td>
</tr>
<tr>
<td><strong>Advice</strong>: Action taken by an aspect at a particular join point. Different types of advice include “around”, “before” and “after” advice. (Advice types are discussed later.) Many AOP frameworks, including Spring, model an advice as an interceptor and maintain a chain of interceptors around the join point.</td>
</tr>
<tr>
<td><strong>通知/增强/建议</strong>: 切面在特定连接点上的动作。不同类型的通知包括「环绕通知」、「前置通知」、「后置通知」等 (后续讨论)。包括 Spring 在内的许多 AOP 框架，都将通知作为一个拦截器，并在连接点周围维护一个拦截器链。<br />※ 解释: 通知即切面类中的用于增强目标类方法的方法 (即 Action) 。「拦截」是说这个通知 (方法) 会在目标方法执行之前或之后或前后 (所谓「around」) 执行 (由通知类型决定) 。「拦截器链」指的是对要增强的方法，可以有多个通知 (多个增强方法)。</td>
</tr>
<tr>
<td><strong>Pointcut</strong>: A predicate that matches join points. Advice is associated with a pointcut expression and runs at any join point matched by the pointcut (for example, the execution of a method with a certain name). The concept of join points as matched by pointcut expressions is central to AOP, and Spring uses the AspectJ pointcut expression language by default.</td>
</tr>
<tr>
<td><strong>切点/切入点</strong>: 连接点的声明。通知会作用于切点表达式匹配的所有连接点 (例如，执行一个具有特定名称的方法)。由切点表达式匹配连接点这一概念是 AOP 的核心，Spring 默认使用 AspectJ 的切点表达式语言。<br />※ 解释: 所谓「predicate」即 XML 方式中的 <code>&lt;aop:pointcut id=&quot;&quot; expression=&quot;&quot;&gt;</code> 或注解方式中的 <code>@Before(value = &quot;execution()&quot;)</code> ，均通过 <code>expression</code> (切点表达式) 来指定具体的连接点 (被增强的方法) 。</td>
</tr>
<tr>
<td><strong>Introduction</strong>: Declaring additional methods or fields on behalf of a type. Spring AOP lets you introduce new interfaces (and a corresponding implementation) to any advised object. For example, you could use an introduction to make a bean implement an <code>IsModified</code> interface, to simplify caching. (An introduction is known as an inter-type declaration in the AspectJ community.)</td>
</tr>
<tr>
<td><strong>引入</strong>: 为一个类型声明额外的方法或字段。Spring AOP 允许你为任何通知的对象引入新的接口 (以及相应的实现) 。例如，你可以使用引入来使一个 bean 实现 <code>IsModified</code> 接口，以实现一个简化的缓存功能 (引入在 AspectJ 社区中被称为类型间声明)。<br />※ 解释: 对方法的增强的过程为「织入」，对接口的增强的过程为「引入」。所谓对接口的增强，即在不改动接口的前提下，使该接口的实现类实现一个该接口并不提供的方法，具体过程可以参考 <a target="_blank" rel="noopener" href="https://blog.csdn.net/zyhlwzy/article/details/70314157">这里</a> 。</td>
</tr>
<tr>
<td><strong>Target object</strong>: An object being advised by one or more aspects. Also referred to as the “advised object”. Since Spring AOP is implemented by using runtime proxies, this object is always a proxied object.</td>
</tr>
<tr>
<td><strong>目标对象/目标类</strong>: 被一个或多个切面所增强的对象。也被称为 「被增强对象」。由于 Spring AOP 是通过使用运行时代理来实现的，这个对象总是一个被代理的对象。<br />※ 解释: 即动态代理中主题类 (被代理的类)。</td>
</tr>
<tr>
<td><strong>AOP proxy</strong>: An object created by the AOP framework in order to implement the aspect contracts (advise method executions and so on). In the Spring Framework, an AOP proxy is a JDK dynamic proxy or a CGLIB proxy.</td>
</tr>
<tr>
<td><strong>AOP 代理</strong>: 一个由 AOP 框架创建的对象，以实现切面功能 (增强方法的执行等) 。在 Spring 框架中，AOP 代理是一个 JDK 动态代理或CGLIB 代理。<br />※ 解释: 即动态代理，有接口时，使用基于接口的 JDK 动态代理，否则使用基于类的 CGLIB 动态代理。</td>
</tr>
<tr>
<td><strong>Weaving</strong>: linking aspects with other application types or objects to create an advised object. This can be done at compile time (using the AspectJ compiler, for example), load time, or at runtime. Spring AOP, like other pure Java AOP frameworks, performs weaving at runtime.</td>
</tr>
<tr>
<td><strong>织入</strong>: 将切面与其他应用类型或对象联系起来，以创建一个增强对象。这可以在编译期 (如使用 AspectJ 编译器) 、加载期或运行时完成。Spring AOP 和其他纯 Java AOP 框架一样，在运行时织入。<br />※ 解释: 即创建增强对象 (代理类对象) 的过程，该过程如同将通知  (增强方法) 「织入」到被代理类中。</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>通知类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>前置通知 <code>@Before</code></td>
<td>在连接点之前执行的增强方法。</td>
</tr>
<tr>
<td>环绕通知 <code>@Around</code></td>
<td>在连接点之前以及之后都可以执行的增强方法，可选择是否传入 <code>ProceedingJoinPoint</code> 对象来决定是否执行连接点 (被增强方法) 。</td>
</tr>
<tr>
<td>返回型后置通知 <code>@AfterReturning</code></td>
<td>在连接点正常返回后执行的增强方法。</td>
</tr>
<tr>
<td>异常型后置通知 <code>@AfterThrowing</code></td>
<td>在连接点发生异常后执行的增强方法。</td>
</tr>
<tr>
<td>后置通知 (最终通知) <code>@After</code></td>
<td>无论连接点是否正常完成运行，在其运行结束后都会执行的增强方法。</td>
</tr>
</tbody>
</table>
<br />
<h4 id="基于AspectJ的AOP">基于AspectJ的AOP</h4>
<p><a target="_blank" rel="noopener" href="https://www.eclipse.org/aspectj/">AspectJ</a> 是 Eclipse 基金会的独立的开源 AOP 框架，Spring 框架整合了 AspectJ，并支持 <strong>利用 XML 配置文件</strong> 或 <strong>注解方式</strong> ，通过 AspectJ 来实现 AOP。使用前应向项目中引入相关依赖，此外还要了解 <strong>「切入点表达式」</strong> 的写法。</p>
<ul>
<li>在项目中引入 AOP 相关依赖。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-aspects --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>切入点表达式。用于指示将通知施加到哪些方法中。</li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">语法结构： execution([权限修饰符] [返回类型] [类全路径] [方法名称]([参数列表]))</span><br><span class="line"></span><br><span class="line">举例1：增强 com.yukiyama.dao.BookDao 类的 add 方法</span><br><span class="line">execution(* com.yukiyama.dao.BookDao.add(..))</span><br><span class="line">举例2：增强 com.yukiyama.dao.BookDao 类的所有方法</span><br><span class="line">execution(* com.yukiyama.dao.BookDao.*(..))</span><br><span class="line">举例3：增强 com.yukiyama.dao 下所有类的所有方法</span><br><span class="line">execution(* com.yukiyama.dao.*.*(..))</span><br></pre></td></tr></table></figure>
<br />
<h5 id="基于XML">基于XML</h5>
<p>按如下步骤演示使用 <strong>XML配置文件方式</strong> 实现 AOP 增强的过程。</p>
<p>第1步: 创建主题类 (要被增强的目标类) ，定义方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.spring.aop.xml.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.spring.aop.xml.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;This method: UserDaoImpl.update()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第2步: 创建代理类 (即增强主题类功能的增强类) 。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.spring.aop.xml.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoProxy</span> &#123;</span><br><span class="line">    <span class="comment">// 前置增强: 在连接点之前执行</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;==== before advice ====&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;This method: UserDaoProxy.before()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 环绕增强: 在连接点前后均执行</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">around</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;This method: UserDaoProxy.around()&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;==== around advice: before ====&quot;</span>);</span><br><span class="line">        pjp.proceed();</span><br><span class="line">        System.out.println(<span class="string">&quot;==== around advice: after ====&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 后置增强 (正常退出): 在方法返回之后，正常返回后执行</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;==== afterReturning advice ====&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;This method: UserDaoProxy.afterReturning()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 后置增强 (异常退出): 抛出异常时执行</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;==== afterThrowing advice ====&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;This method: UserDaoProxy.afterThrowing()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 后置增强 (最终增强): 无论是否抛出异常均执行</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;==== after advice ====&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;This method: UserDaoProxy.after()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第3步: 完成通知的配置。在 XML 配置文件中添加 <code>aop</code> 命名空间，声明要创建的 bean 对象，完成 aop 配置。</p>
<p>xml 配置文件 <code>aop.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                          http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 测试：aop --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDaoImpl&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yukiyama.spring.aop.xml.dao.UserDaoImpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDaoProxy&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yukiyama.spring.aop.xml.dao.UserDaoProxy&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- aop 配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置切点 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.yukiyama.spring.aop.xml.dao.UserDao.update(..))&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置切面 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;userDaoProxy&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 配置通知类型及作用的方法 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;before&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;update&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">&quot;around&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;update&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">&quot;afterReturning&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;update&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">&quot;afterThrowing&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;update&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">&quot;after&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;update&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>完成上述步骤后以如下测试代码测试效果。<code>TestAOPXML</code> 中的如下方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// xml-based aop</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAopXml</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;aop.xml&quot;</span>);</span><br><span class="line">    <span class="type">UserDao</span> <span class="variable">userDao</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;userDaoImpl&quot;</span>, UserDao.class);</span><br><span class="line">    userDao.update();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>无异常时控制台输出如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">==== before advice ====</span><br><span class="line">This method: UserDaoProxy.before()</span><br><span class="line">This method: UserDaoProxy.around()</span><br><span class="line">==== around advice: before ====</span><br><span class="line">This method: UserDaoImpl.update()</span><br><span class="line">==== around advice: after ====</span><br><span class="line">==== afterReturning advice ====</span><br><span class="line">This method: UserDaoProxy.afterReturning()</span><br><span class="line">==== after advice ====</span><br><span class="line">This method: UserDaoProxy.after()</span><br></pre></td></tr></table></figure>
<p>有异常时控制台输出如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">==== before advice ====</span><br><span class="line">This method: UserDaoProxy.before()</span><br><span class="line">This method: UserDaoProxy.around()</span><br><span class="line">==== around advice: before ====</span><br><span class="line">This method: UserDaoImpl.update()</span><br><span class="line">==== afterThrowing advice ====</span><br><span class="line">This method: UserDaoProxy.afterThrowing()</span><br><span class="line">==== after advice ====</span><br><span class="line">This method: UserDaoProxy.after()</span><br></pre></td></tr></table></figure>
<br />
<h5 id="基于注解">基于注解</h5>
<p>按如下步骤演示使用 <strong>注解方式</strong> 实现 AOP 增强的过程，展示五种通知类型的效果。</p>
<p>第1步: 创建主题类 (要被增强的目标类) ，定义方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.spring.aop.anno.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component(&quot;userDaoImpl&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;This method: UserDaoImpl.update()&quot;</span>);</span><br><span class="line">        <span class="comment">// int a = 10 / 0;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第2步: 创建代理类 (即增强主题类功能的增强类) 。</p>
<p>如下添加了五种通知，并展示了增强注解参数的几种不同的写法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引用公共切入点</span></span><br><span class="line"><span class="meta">@Before(&quot;pointcut()&quot;)</span></span><br><span class="line"><span class="comment">// 普通写法</span></span><br><span class="line"><span class="meta">@AfterReturning(value = &quot;execution(* com.yukiyama.spring.aop.anno.dao.UserDao.update(..))&quot;)</span></span><br><span class="line"><span class="comment">// 省略 &quot;value = &quot;</span></span><br><span class="line"><span class="meta">@AfterThrowing(&quot;execution(* com.yukiyama.spring.aop.anno.dao.UserDao.update(..))&quot;)</span></span><br><span class="line"><span class="comment">// 使用通配符</span></span><br><span class="line"><span class="meta">@After(&quot;execution(void com.yukiyama.spring.aop.anno.*.*.*(..))&quot;)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.spring.aop.anno.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoProxy</span> &#123;</span><br><span class="line">    <span class="comment">// 提取公共切入点</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.yukiyama.spring.aop.anno.dao.UserDao.update(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pointcut</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 前置增强: 在连接点之前执行</span></span><br><span class="line">    <span class="meta">@Before(&quot;pointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;==== before advice ====&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;This method: UserDaoProxy.before()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 环绕增强: 在连接点前后均执行</span></span><br><span class="line">    <span class="meta">@Around(&quot;pointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">around</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;This method: UserDaoProxy.around()&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;==== around advice: before ====&quot;</span>);</span><br><span class="line">        pjp.proceed();</span><br><span class="line">        System.out.println(<span class="string">&quot;==== around advice: after ====&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 后置增强 (正常退出): 在方法返回之后，正常返回后执行</span></span><br><span class="line">    <span class="meta">@AfterReturning(value = &quot;execution(* com.yukiyama.spring.aop.anno.dao.UserDao.update(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;==== afterReturning advice ====&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;This method: UserDaoProxy.afterReturning()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 后置增强 (异常退出): 抛出异常时执行</span></span><br><span class="line">    <span class="meta">@AfterThrowing(&quot;execution(* com.yukiyama.spring.aop.anno.dao.UserDao.update(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;==== afterThrowing advice ====&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;This method: UserDaoProxy.afterThrowing()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 后置增强 (最终增强): 无论是否抛出异常均执行</span></span><br><span class="line">    <span class="meta">@After(&quot;execution(void com.yukiyama.spring.aop.anno.*.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;==== after advice ====&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;This method: UserDaoProxy.after()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第3步: 完成通知的配置。</p>
<ol>
<li>在 XML 配置文件中添加 <code>context</code> 和 <code>aop</code> 命名空间，开启注解扫描，添加生成代理对象的配置。 xml 配置文件 <code>aopAnno.xml</code>。</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 测试：注解方式aop --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 开启注解扫描 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.yukiyama.spring.aop.anno.dao&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 启用 AspectJ 生成代理对象 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>在被增强类和增强类上类上添加 <code>@Component</code> 注解，在增强类上添加 <code>@Aspect</code> 注解 (见给出的类代码) 。</li>
</ol>
<p>第4步: 在增强类的通知方法中添加使用切入点表达式的通知类型注解 (见前面的增强类代码) 。</p>
<p>完成上述步骤后以如下测试代码测试效果。在 <code>TestAOPAnno</code> 中的如下方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// anno-based aop</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAopAnno</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;aopAnno.xml&quot;</span>);</span><br><span class="line">    <span class="type">UserDao</span> <span class="variable">userDao</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;userDaoImpl&quot;</span>, UserDao.class);</span><br><span class="line">    userDao.update();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>无异常时控制台输出如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">This method: UserDaoProxy.around()</span><br><span class="line">==== around advice: before ====</span><br><span class="line">==== before advice ====</span><br><span class="line">This method: UserDaoProxy.before()</span><br><span class="line">This method: UserDaoImpl.update()</span><br><span class="line">==== around advice: after ====</span><br><span class="line">==== after advice ====</span><br><span class="line">This method: UserDaoProxy.after()</span><br><span class="line">==== afterReturning advice ====</span><br><span class="line">This method: UserDaoProxy.afterReturning()</span><br></pre></td></tr></table></figure>
<p>有异常时控制台输出如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">This method: UserDaoProxy.around()</span><br><span class="line">==== around advice: before ====</span><br><span class="line">==== before advice ====</span><br><span class="line">This method: UserDaoProxy.before()</span><br><span class="line">This method: UserDaoImpl.update()</span><br><span class="line">==== after advice ====</span><br><span class="line">This method: UserDaoProxy.after()</span><br><span class="line">==== afterThrowing advice ====</span><br><span class="line">This method: UserDaoProxy.afterThrowing()</span><br></pre></td></tr></table></figure>
<br />
<h6 id="切入点抽取">切入点抽取</h6>
<p>前面的例子中，每一个通知的切入点表达式都是相同的，可以利用 <code>@Pointcut</code> 注解抽取相同的表达式。见前面给出的 <code>UserDaoProxy</code> 类的如下方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 提取公共切入点</span></span><br><span class="line"><span class="meta">@Pointcut(&quot;execution(* com.yukiyama.spring.aop.anno.dao.UserDao.update(..))&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pointcut</span><span class="params">()</span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<br />
<h6 id="Order注解">Order注解</h6>
<p>当一个类有多个增强类时，可通过在不同增强类上添加类注解 <code>@Order(n)</code> 来设置增强的优先级，整数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 越小优先级越高。例如另建一个 <code>VIPUserDaoProxy</code> 类作为 <code>UserDao</code> 类的增强类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.spring.aop.anno.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Order(1)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VIPUserDaoProxy</span> &#123;</span><br><span class="line">    <span class="meta">@Before(&quot;execution(void com.yukiyama.spring.aop.anno.*.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;==== VIPUserDaoProxy: before advice ====&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;This method: VIPUserDaoProxy.before()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同时在 <code>UserProxy</code> 上添加类注解 <code>@Order(5)</code> ，则 <code>VIPUserDaoProxy</code> 的通知先执行。得到如下结果。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">==== VIPUserDaoProxy: before advice ====</span><br><span class="line">This method: VIPUserDaoProxy.before()</span><br><span class="line">This method: UserDaoProxy.around()</span><br><span class="line">==== around advice: before ====</span><br><span class="line">==== before advice ====</span><br><span class="line">This method: UserDaoProxy.before()</span><br><span class="line">This method: UserDaoImpl.update()</span><br><span class="line">==== around advice: after ====</span><br><span class="line">==== after advice ====</span><br><span class="line">This method: UserDaoProxy.after()</span><br><span class="line">==== afterReturning advice ====</span><br><span class="line">This method: UserDaoProxy.afterReturning()</span><br></pre></td></tr></table></figure>
<br />
<h6 id="完全注解方式-2">完全注解方式</h6>
<p>可以创建配置类实现无需 XML 文件的完全注解方式的 AOP 。配置类如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yukiyama.spring.aop.anno.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.EnableAspectJAutoProxy;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &quot;com.yukiyama.spring.aop.anno&quot;)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy(proxyTargetClass = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>配置类的三个用于支持纯注解方式的类注解的作用如下。</p>
<table>
<thead>
<tr>
<th>类注解</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@Configuration</code></td>
<td>表明当前类是配置类，代替 xml 的作用。</td>
</tr>
<tr>
<td><code>@ComponentScan</code></td>
<td>属性 <code>basePackages</code> 指定扫描哪个包下的类，装配哪些具有 Bean 注解的类 (如 <code>@Component</code>)。若不指定包，则默认扫描配置类所在包。<br />代替 xml 方式中 <code>&lt;context:component-scan base-package=&quot;&quot;&gt;</code> 的作用。</td>
</tr>
<tr>
<td><code>@EnableAspectJAutoProxy</code></td>
<td>启用 AspectJ 自动生成代理对象，需要设置属性 <code>proxyTargetClass = true</code> (默认为 false) 。<br />代替 xml 方式中 <code>&lt;aop:aspectj-autoproxy&gt;</code> 的作用。</td>
</tr>
</tbody>
</table>
<p>无需 XML ，而是由 <code>AnnotationConfigApplicationContext</code> 获取 <code>ApplicationContext</code> 实例。 在 <code>TestAOPAnno</code> 中添加如下方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// anno-based aop (complete annotation)</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAopCompleteAnno</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);</span><br><span class="line">    <span class="type">UserDao</span> <span class="variable">userDao</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;userDaoImpl&quot;</span>, UserDao.class);</span><br><span class="line">    userDao.update();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />
<h4 id="AOP概念具象化">AOP概念具象化</h4>
<p>有了前述 AOP 实现的具体例子，对应具体代码，给出如下具像化描述。</p>
<table>
<thead>
<tr>
<th>概念</th>
<th>具象描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>切面</td>
<td>切面类，由切点和通知组合而成，即 <code>UserDaoProxy</code> 类和 <code>VIPUserDaoProxy</code> 类。</td>
</tr>
<tr>
<td>连接点</td>
<td>可以被增强的主题类 (被代理类) 中的方法，即 <code>UserDaoImpl.update()</code> 。</td>
</tr>
<tr>
<td>通知 (增强/建议)</td>
<td>切面类中的增强方法，即 <code>UserDaoProxy.before()</code>, <code>UserDaoProxy.after()</code> 等。</td>
</tr>
<tr>
<td>切点</td>
<td>连接点的声明，即切面类中的通知注解，例如 <code>@Before(value = &quot;execution()&quot;)</code> (若是 XML 方式，则为 <code>&lt;aop:pointcut id=&quot;p&quot; expression=&quot;execution()&quot; /&gt;</code>)。<br />又因为切点表达式对应到实际被增强的连接点，所以切点有时也指该连接点，即  <code>UserDaoImpl.update()</code>  。</td>
</tr>
<tr>
<td>引入</td>
<td>对接口的增强的过程，前述例子不涉及。</td>
</tr>
<tr>
<td>目标类</td>
<td>主题类 (被代理类)，即 <code>UserDaoImpl</code> 。</td>
</tr>
<tr>
<td>AOP代理</td>
<td>指经过动态代理后创建出来的代理类的对象，即测试方法中 <code>UserDao userDao = context.getBean(&quot;userDaoImpl&quot;, UserDao.class);</code> 得到的 <code>userDao</code> 。</td>
</tr>
<tr>
<td>织入</td>
<td>创建增强对象 (代理类对象) 的过程。</td>
</tr>
</tbody>
</table>
<br />
<h3 id="JdbcTemplate">JdbcTemplate</h3>
<br />
<h3 id="事务管理">事务管理</h3>
<br />
<h3 id="总结">总结</h3>
<p>本文主要内容总结如下。</p>
<table>
<thead>
<tr>
<th>问题</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>描述 Spring 框架</td>
<td></td>
</tr>
<tr>
<td>Spring 的优点</td>
<td></td>
</tr>
<tr>
<td>Spring 的模块组成</td>
<td></td>
</tr>
<tr>
<td>描述 IoC</td>
<td></td>
</tr>
<tr>
<td>描述 IoC 容器</td>
<td></td>
</tr>
<tr>
<td>ApplicationContext 的具体实现类</td>
<td></td>
</tr>
<tr>
<td>IoC 的实现原理</td>
<td></td>
</tr>
<tr>
<td>描述 DI</td>
<td></td>
</tr>
<tr>
<td>Bean 的定义</td>
<td></td>
</tr>
<tr>
<td>Bean 的管理的含义</td>
<td></td>
</tr>
<tr>
<td>Bean 管理的方式</td>
<td></td>
</tr>
<tr>
<td>两种 Bean</td>
<td></td>
</tr>
<tr>
<td>Bean 的配置元数据</td>
<td></td>
</tr>
<tr>
<td>Bean 的作用域</td>
<td></td>
</tr>
<tr>
<td>Bean 的生命周期</td>
<td></td>
</tr>
<tr>
<td>XML配置文件的内容，主要标签和字段</td>
<td></td>
</tr>
<tr>
<td>XML配置文件的命名空间</td>
<td></td>
</tr>
<tr>
<td>注入字段 (DI) 的三种方式</td>
<td></td>
</tr>
<tr>
<td>注入空值和特殊符号</td>
<td></td>
</tr>
<tr>
<td>注入外部 Bean 写法</td>
<td></td>
</tr>
<tr>
<td>注入内部 Bean 写法</td>
<td></td>
</tr>
<tr>
<td>级联赋值的两种方式</td>
<td></td>
</tr>
</tbody>
</table>
<br />
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://iyukiyama.github.io">yukiyama</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://iyukiyama.github.io/spring5-framework-in-action/">https://iyukiyama.github.io/spring5-framework-in-action/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://iyukiyama.github.io" target="_blank">yukiyama</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/">Spring全家桶</a><a class="post-meta__tags" href="/tags/Spring5/">Spring5</a></div><div class="post_share"><div class="social-share" data-image="https://raw.githubusercontent.com/iyukiyama/pics/master/hexo-iyukiyama/site_img/posts/spring-framwork-bg.png" data-sites="wechat,weibo,twitter,facebook,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/springmvc-in-action/"><img class="prev-cover" src="https://raw.githubusercontent.com/iyukiyama/pics/master/hexo-iyukiyama/site_img/posts/springmvc-bg.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">SpringMVC学习实战</div></div></a></div><div class="next-post pull-right"><a href="/prim-proof/"><img class="next-cover" src="https://raw.githubusercontent.com/iyukiyama/pics/master/hexo-iyukiyama/site_img/posts/graph/prim-bg.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Prim算法正确性证明</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/springboot-in-action/" title="SpringBoot学习实战"><img class="cover" src="https://raw.githubusercontent.com/iyukiyama/pics/master/hexo-iyukiyama/site_img/posts/springboot-bg.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-07</div><div class="title">SpringBoot学习实战</div></div></a></div><div><a href="/springmvc-in-action/" title="SpringMVC学习实战"><img class="cover" src="https://raw.githubusercontent.com/iyukiyama/pics/master/hexo-iyukiyama/site_img/posts/springmvc-bg.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-20</div><div class="title">SpringMVC学习实战</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/hexo-iyukiyama/site_img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">yukiyama</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">29</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">48</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/iyukiyama"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/iyukiyama" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://www.zhihu.com/people/yukiyamama" target="_blank" title="zhihu"><i class="fab fa-zhihu"></i></a><a class="social-icon" href="mailto:iyukiyama@outlook.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring5%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98"><span class="toc-number">1.</span> <span class="toc-text">Spring5框架学习实战</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%86%E6%9E%B6%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">框架概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E6%96%87%E6%B5%8B%E8%AF%95%E4%BE%8B"><span class="toc-number">1.2.</span> <span class="toc-text">本文测试例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IoC"><span class="toc-number">1.3.</span> <span class="toc-text">IoC</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#IoC%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">1.3.1.</span> <span class="toc-text">IoC基本概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SpringBean"><span class="toc-number">1.3.2.</span> <span class="toc-text">SpringBean</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8EXML%E6%96%87%E4%BB%B6%E7%9A%84Bean%E7%AE%A1%E7%90%86"><span class="toc-number">1.3.3.</span> <span class="toc-text">基于XML文件的Bean管理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#XML-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E5%86%85%E5%AE%B9"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">XML 配置文件的内容</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5bean"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">注入bean</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-number">1.3.3.3.</span> <span class="toc-text">Bean的作用域</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Bean%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">1.3.3.4.</span> <span class="toc-text">Bean的生命周期</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E5%AD%97%E6%AE%B5"><span class="toc-number">1.3.3.5.</span> <span class="toc-text">注入字段</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8Esetter"><span class="toc-number">1.3.3.5.1.</span> <span class="toc-text">基于setter</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E6%9E%84%E9%80%A0%E5%99%A8"><span class="toc-number">1.3.3.5.2.</span> <span class="toc-text">基于构造器</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#p%E5%90%8D%E7%A7%B0%E7%A9%BA%E9%97%B4"><span class="toc-number">1.3.3.5.3.</span> <span class="toc-text">p名称空间</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E7%A9%BA%E5%80%BC%E5%92%8C%E7%89%B9%E6%AE%8A%E7%AC%A6%E5%8F%B7"><span class="toc-number">1.3.3.6.</span> <span class="toc-text">注入空值和特殊符号</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E5%A4%96%E9%83%A8bean"><span class="toc-number">1.3.3.7.</span> <span class="toc-text">注入外部bean</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E5%86%85%E9%83%A8bean"><span class="toc-number">1.3.3.8.</span> <span class="toc-text">注入内部bean</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BA%A7%E8%81%94%E8%B5%8B%E5%80%BC"><span class="toc-number">1.3.3.9.</span> <span class="toc-text">级联赋值</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%A4%96%E9%83%A8%E7%BA%A7%E8%81%94%E8%B5%8B%E5%80%BC"><span class="toc-number">1.3.3.9.1.</span> <span class="toc-text">外部级联赋值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%86%85%E9%83%A8%E7%BA%A7%E8%81%94%E8%B5%8B%E5%80%BC"><span class="toc-number">1.3.3.9.2.</span> <span class="toc-text">内部级联赋值</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E9%9B%86%E5%90%88%E5%AD%97%E6%AE%B5"><span class="toc-number">1.3.3.10.</span> <span class="toc-text">注入集合字段</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%8F%90%E5%8F%96%E9%9B%86%E5%90%88%E5%85%83%E7%B4%A0"><span class="toc-number">1.3.3.10.1.</span> <span class="toc-text">提取集合元素</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#FactoryBean"><span class="toc-number">1.3.3.11.</span> <span class="toc-text">FactoryBean</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D"><span class="toc-number">1.3.3.12.</span> <span class="toc-text">自动装配</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%96%E9%83%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.3.3.13.</span> <span class="toc-text">外部配置文件</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E7%9A%84Bean%E7%AE%A1%E7%90%86"><span class="toc-number">1.3.4.</span> <span class="toc-text">基于注解的Bean管理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5bean-2"><span class="toc-number">1.3.4.1.</span> <span class="toc-text">注入bean</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E6%89%AB%E6%8F%8F%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">1.3.4.1.1.</span> <span class="toc-text">组件扫描过滤器</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E5%AD%97%E6%AE%B5-2"><span class="toc-number">1.3.4.2.</span> <span class="toc-text">注入字段</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%8C%E5%85%A8%E6%B3%A8%E8%A7%A3%E6%96%B9%E5%BC%8F"><span class="toc-number">1.3.4.3.</span> <span class="toc-text">完全注解方式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOP"><span class="toc-number">1.4.</span> <span class="toc-text">AOP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AOP%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">1.4.1.</span> <span class="toc-text">AOP基本概念</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#JDK-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">JDK 动态代理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#AOP%E6%9C%AF%E8%AF%AD"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">AOP术语</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8EAspectJ%E7%9A%84AOP"><span class="toc-number">1.4.2.</span> <span class="toc-text">基于AspectJ的AOP</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8EXML"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">基于XML</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">基于注解</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%88%87%E5%85%A5%E7%82%B9%E6%8A%BD%E5%8F%96"><span class="toc-number">1.4.2.2.1.</span> <span class="toc-text">切入点抽取</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Order%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.4.2.2.2.</span> <span class="toc-text">Order注解</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%AE%8C%E5%85%A8%E6%B3%A8%E8%A7%A3%E6%96%B9%E5%BC%8F-2"><span class="toc-number">1.4.2.2.3.</span> <span class="toc-text">完全注解方式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOP%E6%A6%82%E5%BF%B5%E5%85%B7%E8%B1%A1%E5%8C%96"><span class="toc-number">1.4.3.</span> <span class="toc-text">AOP概念具象化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JdbcTemplate"><span class="toc-number">1.5.</span> <span class="toc-text">JdbcTemplate</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86"><span class="toc-number">1.6.</span> <span class="toc-text">事务管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.7.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/intellij-idea/" title="IntellJ Idea使用指南"><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/hexo-iyukiyama/site_img/posts/intellij-idea-bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="IntellJ Idea使用指南"/></a><div class="content"><a class="title" href="/intellij-idea/" title="IntellJ Idea使用指南">IntellJ Idea使用指南</a><time datetime="2022-11-18T10:00:33.820Z" title="发表于 2022-11-18 18:00:33">2022-11-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/lombok-in-action/" title="Lombok学习实战"><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/hexo-iyukiyama/site_img/posts/lombok-bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Lombok学习实战"/></a><div class="content"><a class="title" href="/lombok-in-action/" title="Lombok学习实战">Lombok学习实战</a><time datetime="2022-11-17T14:23:56.080Z" title="发表于 2022-11-17 22:23:56">2022-11-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/docsify-in-action/" title="docsify使用指南"><img src="https://raw.githubusercontent.com/iyukiyama/pics/master/hexo-iyukiyama/site_img/posts/docsify-bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="docsify使用指南"/></a><div class="content"><a class="title" href="/docsify-in-action/" title="docsify使用指南">docsify使用指南</a><time datetime="2022-11-16T14:09:13.490Z" title="发表于 2022-11-16 22:09:13">2022-11-16</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 By yukiyama</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://iyukiyama.github.io/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js"></script><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo4hexo.vercel.app/',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo4hexo.vercel.app/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>